var EN=Object.defineProperty;var Bb=n=>{throw TypeError(n)};var CN=(n,e,t)=>e in n?EN(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var xe=(n,e,t)=>CN(n,typeof e!="symbol"?e+"":e,t),og=(n,e,t)=>e.has(n)||Bb("Cannot "+t);var l=(n,e,t)=>(og(n,e,"read from private field"),t?t.call(n):e.get(n)),S=(n,e,t)=>e.has(n)?Bb("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),v=(n,e,t,s)=>(og(n,e,"write to private field"),s?s.call(n,t):e.set(n,t),t),A=(n,e,t)=>(og(n,e,"access private method"),t);var bs=(n,e,t,s)=>({set _(r){v(n,e,r,t)},get _(){return l(n,e,s)}});(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}})();var Pn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function jN(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function TN(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var t=function s(){return this instanceof s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(s){var r=Object.getOwnPropertyDescriptor(n,s);Object.defineProperty(t,s,r.get?r:{enumerable:!0,get:function(){return n[s]}})}),t}var Uw={exports:{}},Ip={},zw={exports:{}},$e={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rf=Symbol.for("react.element"),RN=Symbol.for("react.portal"),IN=Symbol.for("react.fragment"),PN=Symbol.for("react.strict_mode"),DN=Symbol.for("react.profiler"),MN=Symbol.for("react.provider"),LN=Symbol.for("react.context"),ON=Symbol.for("react.forward_ref"),FN=Symbol.for("react.suspense"),$N=Symbol.for("react.memo"),BN=Symbol.for("react.lazy"),Ub=Symbol.iterator;function UN(n){return n===null||typeof n!="object"?null:(n=Ub&&n[Ub]||n["@@iterator"],typeof n=="function"?n:null)}var Hw={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},qw=Object.assign,Ww={};function fu(n,e,t){this.props=n,this.context=e,this.refs=Ww,this.updater=t||Hw}fu.prototype.isReactComponent={};fu.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};fu.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function Vw(){}Vw.prototype=fu.prototype;function bv(n,e,t){this.props=n,this.context=e,this.refs=Ww,this.updater=t||Hw}var xv=bv.prototype=new Vw;xv.constructor=bv;qw(xv,fu.prototype);xv.isPureReactComponent=!0;var zb=Array.isArray,Gw=Object.prototype.hasOwnProperty,wv={current:null},Kw={key:!0,ref:!0,__self:!0,__source:!0};function Xw(n,e,t){var s,r={},i=null,a=null;if(e!=null)for(s in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(i=""+e.key),e)Gw.call(e,s)&&!Kw.hasOwnProperty(s)&&(r[s]=e[s]);var o=arguments.length-2;if(o===1)r.children=t;else if(1<o){for(var c=Array(o),d=0;d<o;d++)c[d]=arguments[d+2];r.children=c}if(n&&n.defaultProps)for(s in o=n.defaultProps,o)r[s]===void 0&&(r[s]=o[s]);return{$$typeof:rf,type:n,key:i,ref:a,props:r,_owner:wv.current}}function zN(n,e){return{$$typeof:rf,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function _v(n){return typeof n=="object"&&n!==null&&n.$$typeof===rf}function HN(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var Hb=/\/+/g;function lg(n,e){return typeof n=="object"&&n!==null&&n.key!=null?HN(""+n.key):e.toString(36)}function Hf(n,e,t,s,r){var i=typeof n;(i==="undefined"||i==="boolean")&&(n=null);var a=!1;if(n===null)a=!0;else switch(i){case"string":case"number":a=!0;break;case"object":switch(n.$$typeof){case rf:case RN:a=!0}}if(a)return a=n,r=r(a),n=s===""?"."+lg(a,0):s,zb(r)?(t="",n!=null&&(t=n.replace(Hb,"$&/")+"/"),Hf(r,e,t,"",function(d){return d})):r!=null&&(_v(r)&&(r=zN(r,t+(!r.key||a&&a.key===r.key?"":(""+r.key).replace(Hb,"$&/")+"/")+n)),e.push(r)),1;if(a=0,s=s===""?".":s+":",zb(n))for(var o=0;o<n.length;o++){i=n[o];var c=s+lg(i,o);a+=Hf(i,e,t,c,r)}else if(c=UN(n),typeof c=="function")for(n=c.call(n),o=0;!(i=n.next()).done;)i=i.value,c=s+lg(i,o++),a+=Hf(i,e,t,c,r);else if(i==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function yf(n,e,t){if(n==null)return n;var s=[],r=0;return Hf(n,s,"","",function(i){return e.call(t,i,r++)}),s}function qN(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var Rs={current:null},qf={transition:null},WN={ReactCurrentDispatcher:Rs,ReactCurrentBatchConfig:qf,ReactCurrentOwner:wv};function Yw(){throw Error("act(...) is not supported in production builds of React.")}$e.Children={map:yf,forEach:function(n,e,t){yf(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return yf(n,function(){e++}),e},toArray:function(n){return yf(n,function(e){return e})||[]},only:function(n){if(!_v(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};$e.Component=fu;$e.Fragment=IN;$e.Profiler=DN;$e.PureComponent=bv;$e.StrictMode=PN;$e.Suspense=FN;$e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=WN;$e.act=Yw;$e.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var s=qw({},n.props),r=n.key,i=n.ref,a=n._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,a=wv.current),e.key!==void 0&&(r=""+e.key),n.type&&n.type.defaultProps)var o=n.type.defaultProps;for(c in e)Gw.call(e,c)&&!Kw.hasOwnProperty(c)&&(s[c]=e[c]===void 0&&o!==void 0?o[c]:e[c])}var c=arguments.length-2;if(c===1)s.children=t;else if(1<c){o=Array(c);for(var d=0;d<c;d++)o[d]=arguments[d+2];s.children=o}return{$$typeof:rf,type:n.type,key:r,ref:i,props:s,_owner:a}};$e.createContext=function(n){return n={$$typeof:LN,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:MN,_context:n},n.Consumer=n};$e.createElement=Xw;$e.createFactory=function(n){var e=Xw.bind(null,n);return e.type=n,e};$e.createRef=function(){return{current:null}};$e.forwardRef=function(n){return{$$typeof:ON,render:n}};$e.isValidElement=_v;$e.lazy=function(n){return{$$typeof:BN,_payload:{_status:-1,_result:n},_init:qN}};$e.memo=function(n,e){return{$$typeof:$N,type:n,compare:e===void 0?null:e}};$e.startTransition=function(n){var e=qf.transition;qf.transition={};try{n()}finally{qf.transition=e}};$e.unstable_act=Yw;$e.useCallback=function(n,e){return Rs.current.useCallback(n,e)};$e.useContext=function(n){return Rs.current.useContext(n)};$e.useDebugValue=function(){};$e.useDeferredValue=function(n){return Rs.current.useDeferredValue(n)};$e.useEffect=function(n,e){return Rs.current.useEffect(n,e)};$e.useId=function(){return Rs.current.useId()};$e.useImperativeHandle=function(n,e,t){return Rs.current.useImperativeHandle(n,e,t)};$e.useInsertionEffect=function(n,e){return Rs.current.useInsertionEffect(n,e)};$e.useLayoutEffect=function(n,e){return Rs.current.useLayoutEffect(n,e)};$e.useMemo=function(n,e){return Rs.current.useMemo(n,e)};$e.useReducer=function(n,e,t){return Rs.current.useReducer(n,e,t)};$e.useRef=function(n){return Rs.current.useRef(n)};$e.useState=function(n){return Rs.current.useState(n)};$e.useSyncExternalStore=function(n,e,t){return Rs.current.useSyncExternalStore(n,e,t)};$e.useTransition=function(){return Rs.current.useTransition()};$e.version="18.3.1";zw.exports=$e;var V=zw.exports;const Sv=jN(V);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var VN=V,GN=Symbol.for("react.element"),KN=Symbol.for("react.fragment"),XN=Object.prototype.hasOwnProperty,YN=VN.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,JN={key:!0,ref:!0,__self:!0,__source:!0};function Jw(n,e,t){var s,r={},i=null,a=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(a=e.ref);for(s in e)XN.call(e,s)&&!JN.hasOwnProperty(s)&&(r[s]=e[s]);if(n&&n.defaultProps)for(s in e=n.defaultProps,e)r[s]===void 0&&(r[s]=e[s]);return{$$typeof:GN,type:n,key:i,ref:a,props:r,_owner:YN.current}}Ip.Fragment=KN;Ip.jsx=Jw;Ip.jsxs=Jw;Uw.exports=Ip;var u=Uw.exports,Qw={exports:{}},gn={},Zw={exports:{}},e_={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(F,W){var ne=F.length;F.push(W);e:for(;0<ne;){var be=ne-1>>>1,_e=F[be];if(0<r(_e,W))F[be]=W,F[ne]=_e,ne=be;else break e}}function t(F){return F.length===0?null:F[0]}function s(F){if(F.length===0)return null;var W=F[0],ne=F.pop();if(ne!==W){F[0]=ne;e:for(var be=0,_e=F.length,Oe=_e>>>1;be<Oe;){var et=2*(be+1)-1,qe=F[et],Se=et+1,Q=F[Se];if(0>r(qe,ne))Se<_e&&0>r(Q,qe)?(F[be]=Q,F[Se]=ne,be=Se):(F[be]=qe,F[et]=ne,be=et);else if(Se<_e&&0>r(Q,ne))F[be]=Q,F[Se]=ne,be=Se;else break e}}return W}function r(F,W){var ne=F.sortIndex-W.sortIndex;return ne!==0?ne:F.id-W.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;n.unstable_now=function(){return i.now()}}else{var a=Date,o=a.now();n.unstable_now=function(){return a.now()-o}}var c=[],d=[],h=1,f=null,m=3,p=!1,g=!1,y=!1,N=typeof setTimeout=="function"?setTimeout:null,b=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function _(F){for(var W=t(d);W!==null;){if(W.callback===null)s(d);else if(W.startTime<=F)s(d),W.sortIndex=W.expirationTime,e(c,W);else break;W=t(d)}}function w(F){if(y=!1,_(F),!g)if(t(c)!==null)g=!0,P(k);else{var W=t(d);W!==null&&se(w,W.startTime-F)}}function k(F,W){g=!1,y&&(y=!1,b(D),D=-1),p=!0;var ne=m;try{for(_(W),f=t(c);f!==null&&(!(f.expirationTime>W)||F&&!M());){var be=f.callback;if(typeof be=="function"){f.callback=null,m=f.priorityLevel;var _e=be(f.expirationTime<=W);W=n.unstable_now(),typeof _e=="function"?f.callback=_e:f===t(c)&&s(c),_(W)}else s(c);f=t(c)}if(f!==null)var Oe=!0;else{var et=t(d);et!==null&&se(w,et.startTime-W),Oe=!1}return Oe}finally{f=null,m=ne,p=!1}}var C=!1,T=null,D=-1,B=5,ee=-1;function M(){return!(n.unstable_now()-ee<B)}function E(){if(T!==null){var F=n.unstable_now();ee=F;var W=!0;try{W=T(!0,F)}finally{W?$():(C=!1,T=null)}}else C=!1}var $;if(typeof x=="function")$=function(){x(E)};else if(typeof MessageChannel<"u"){var ie=new MessageChannel,pe=ie.port2;ie.port1.onmessage=E,$=function(){pe.postMessage(null)}}else $=function(){N(E,0)};function P(F){T=F,C||(C=!0,$())}function se(F,W){D=N(function(){F(n.unstable_now())},W)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(F){F.callback=null},n.unstable_continueExecution=function(){g||p||(g=!0,P(k))},n.unstable_forceFrameRate=function(F){0>F||125<F?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):B=0<F?Math.floor(1e3/F):5},n.unstable_getCurrentPriorityLevel=function(){return m},n.unstable_getFirstCallbackNode=function(){return t(c)},n.unstable_next=function(F){switch(m){case 1:case 2:case 3:var W=3;break;default:W=m}var ne=m;m=W;try{return F()}finally{m=ne}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(F,W){switch(F){case 1:case 2:case 3:case 4:case 5:break;default:F=3}var ne=m;m=F;try{return W()}finally{m=ne}},n.unstable_scheduleCallback=function(F,W,ne){var be=n.unstable_now();switch(typeof ne=="object"&&ne!==null?(ne=ne.delay,ne=typeof ne=="number"&&0<ne?be+ne:be):ne=be,F){case 1:var _e=-1;break;case 2:_e=250;break;case 5:_e=1073741823;break;case 4:_e=1e4;break;default:_e=5e3}return _e=ne+_e,F={id:h++,callback:W,priorityLevel:F,startTime:ne,expirationTime:_e,sortIndex:-1},ne>be?(F.sortIndex=ne,e(d,F),t(c)===null&&F===t(d)&&(y?(b(D),D=-1):y=!0,se(w,ne-be))):(F.sortIndex=_e,e(c,F),g||p||(g=!0,P(k))),F},n.unstable_shouldYield=M,n.unstable_wrapCallback=function(F){var W=m;return function(){var ne=m;m=W;try{return F.apply(this,arguments)}finally{m=ne}}}})(e_);Zw.exports=e_;var QN=Zw.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ZN=V,pn=QN;function X(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var t_=new Set,hd={};function hl(n,e){iu(n,e),iu(n+"Capture",e)}function iu(n,e){for(hd[n]=e,n=0;n<e.length;n++)t_.add(e[n])}var _i=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Yg=Object.prototype.hasOwnProperty,ek=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,qb={},Wb={};function tk(n){return Yg.call(Wb,n)?!0:Yg.call(qb,n)?!1:ek.test(n)?Wb[n]=!0:(qb[n]=!0,!1)}function sk(n,e,t,s){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return s?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function nk(n,e,t,s){if(e===null||typeof e>"u"||sk(n,e,t,s))return!0;if(s)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Is(n,e,t,s,r,i,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=s,this.attributeNamespace=r,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=i,this.removeEmptyString=a}var is={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){is[n]=new Is(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];is[e]=new Is(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){is[n]=new Is(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){is[n]=new Is(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){is[n]=new Is(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){is[n]=new Is(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){is[n]=new Is(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){is[n]=new Is(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){is[n]=new Is(n,5,!1,n.toLowerCase(),null,!1,!1)});var Av=/[\-:]([a-z])/g;function Nv(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(Av,Nv);is[e]=new Is(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(Av,Nv);is[e]=new Is(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(Av,Nv);is[e]=new Is(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){is[n]=new Is(n,1,!1,n.toLowerCase(),null,!1,!1)});is.xlinkHref=new Is("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){is[n]=new Is(n,1,!1,n.toLowerCase(),null,!0,!0)});function kv(n,e,t,s){var r=is.hasOwnProperty(e)?is[e]:null;(r!==null?r.type!==0:s||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(nk(e,t,r,s)&&(t=null),s||r===null?tk(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):r.mustUseProperty?n[r.propertyName]=t===null?r.type===3?!1:"":t:(e=r.attributeName,s=r.attributeNamespace,t===null?n.removeAttribute(e):(r=r.type,t=r===3||r===4&&t===!0?"":""+t,s?n.setAttributeNS(s,e,t):n.setAttribute(e,t))))}var Ci=ZN.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,vf=Symbol.for("react.element"),Rl=Symbol.for("react.portal"),Il=Symbol.for("react.fragment"),Ev=Symbol.for("react.strict_mode"),Jg=Symbol.for("react.profiler"),s_=Symbol.for("react.provider"),n_=Symbol.for("react.context"),Cv=Symbol.for("react.forward_ref"),Qg=Symbol.for("react.suspense"),Zg=Symbol.for("react.suspense_list"),jv=Symbol.for("react.memo"),Pi=Symbol.for("react.lazy"),r_=Symbol.for("react.offscreen"),Vb=Symbol.iterator;function vu(n){return n===null||typeof n!="object"?null:(n=Vb&&n[Vb]||n["@@iterator"],typeof n=="function"?n:null)}var xt=Object.assign,cg;function Ru(n){if(cg===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);cg=e&&e[1]||""}return`
`+cg+n}var ug=!1;function dg(n,e){if(!n||ug)return"";ug=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(d){var s=d}Reflect.construct(n,[],e)}else{try{e.call()}catch(d){s=d}n.call(e.prototype)}else{try{throw Error()}catch(d){s=d}n()}}catch(d){if(d&&s&&typeof d.stack=="string"){for(var r=d.stack.split(`
`),i=s.stack.split(`
`),a=r.length-1,o=i.length-1;1<=a&&0<=o&&r[a]!==i[o];)o--;for(;1<=a&&0<=o;a--,o--)if(r[a]!==i[o]){if(a!==1||o!==1)do if(a--,o--,0>o||r[a]!==i[o]){var c=`
`+r[a].replace(" at new "," at ");return n.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",n.displayName)),c}while(1<=a&&0<=o);break}}}finally{ug=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?Ru(n):""}function rk(n){switch(n.tag){case 5:return Ru(n.type);case 16:return Ru("Lazy");case 13:return Ru("Suspense");case 19:return Ru("SuspenseList");case 0:case 2:case 15:return n=dg(n.type,!1),n;case 11:return n=dg(n.type.render,!1),n;case 1:return n=dg(n.type,!0),n;default:return""}}function e0(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case Il:return"Fragment";case Rl:return"Portal";case Jg:return"Profiler";case Ev:return"StrictMode";case Qg:return"Suspense";case Zg:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case n_:return(n.displayName||"Context")+".Consumer";case s_:return(n._context.displayName||"Context")+".Provider";case Cv:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case jv:return e=n.displayName||null,e!==null?e:e0(n.type)||"Memo";case Pi:e=n._payload,n=n._init;try{return e0(n(e))}catch{}}return null}function ik(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return e0(e);case 8:return e===Ev?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function ka(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function i_(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function ak(n){var e=i_(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),s=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var r=t.get,i=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return r.call(this)},set:function(a){s=""+a,i.call(this,a)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return s},setValue:function(a){s=""+a},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function bf(n){n._valueTracker||(n._valueTracker=ak(n))}function a_(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),s="";return n&&(s=i_(n)?n.checked?"true":"false":n.value),n=s,n!==t?(e.setValue(n),!0):!1}function Im(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function t0(n,e){var t=e.checked;return xt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function Gb(n,e){var t=e.defaultValue==null?"":e.defaultValue,s=e.checked!=null?e.checked:e.defaultChecked;t=ka(e.value!=null?e.value:t),n._wrapperState={initialChecked:s,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function o_(n,e){e=e.checked,e!=null&&kv(n,"checked",e,!1)}function s0(n,e){o_(n,e);var t=ka(e.value),s=e.type;if(t!=null)s==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(s==="submit"||s==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?n0(n,e.type,t):e.hasOwnProperty("defaultValue")&&n0(n,e.type,ka(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function Kb(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var s=e.type;if(!(s!=="submit"&&s!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function n0(n,e,t){(e!=="number"||Im(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var Iu=Array.isArray;function Vl(n,e,t,s){if(n=n.options,e){e={};for(var r=0;r<t.length;r++)e["$"+t[r]]=!0;for(t=0;t<n.length;t++)r=e.hasOwnProperty("$"+n[t].value),n[t].selected!==r&&(n[t].selected=r),r&&s&&(n[t].defaultSelected=!0)}else{for(t=""+ka(t),e=null,r=0;r<n.length;r++){if(n[r].value===t){n[r].selected=!0,s&&(n[r].defaultSelected=!0);return}e!==null||n[r].disabled||(e=n[r])}e!==null&&(e.selected=!0)}}function r0(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(X(91));return xt({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function Xb(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(X(92));if(Iu(t)){if(1<t.length)throw Error(X(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:ka(t)}}function l_(n,e){var t=ka(e.value),s=ka(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),s!=null&&(n.defaultValue=""+s)}function Yb(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function c_(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function i0(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?c_(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var xf,u_=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,s,r){MSApp.execUnsafeLocalFunction(function(){return n(e,t,s,r)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(xf=xf||document.createElement("div"),xf.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=xf.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function fd(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var Qu={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ok=["Webkit","ms","Moz","O"];Object.keys(Qu).forEach(function(n){ok.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),Qu[e]=Qu[n]})});function d_(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||Qu.hasOwnProperty(n)&&Qu[n]?(""+e).trim():e+"px"}function h_(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var s=t.indexOf("--")===0,r=d_(t,e[t],s);t==="float"&&(t="cssFloat"),s?n.setProperty(t,r):n[t]=r}}var lk=xt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function a0(n,e){if(e){if(lk[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(X(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(X(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(X(61))}if(e.style!=null&&typeof e.style!="object")throw Error(X(62))}}function o0(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var l0=null;function Tv(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var c0=null,Gl=null,Kl=null;function Jb(n){if(n=lf(n)){if(typeof c0!="function")throw Error(X(280));var e=n.stateNode;e&&(e=Op(e),c0(n.stateNode,n.type,e))}}function f_(n){Gl?Kl?Kl.push(n):Kl=[n]:Gl=n}function m_(){if(Gl){var n=Gl,e=Kl;if(Kl=Gl=null,Jb(n),e)for(n=0;n<e.length;n++)Jb(e[n])}}function p_(n,e){return n(e)}function g_(){}var hg=!1;function y_(n,e,t){if(hg)return n(e,t);hg=!0;try{return p_(n,e,t)}finally{hg=!1,(Gl!==null||Kl!==null)&&(g_(),m_())}}function md(n,e){var t=n.stateNode;if(t===null)return null;var s=Op(t);if(s===null)return null;t=s[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(n=n.type,s=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!s;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(X(231,e,typeof t));return t}var u0=!1;if(_i)try{var bu={};Object.defineProperty(bu,"passive",{get:function(){u0=!0}}),window.addEventListener("test",bu,bu),window.removeEventListener("test",bu,bu)}catch{u0=!1}function ck(n,e,t,s,r,i,a,o,c){var d=Array.prototype.slice.call(arguments,3);try{e.apply(t,d)}catch(h){this.onError(h)}}var Zu=!1,Pm=null,Dm=!1,d0=null,uk={onError:function(n){Zu=!0,Pm=n}};function dk(n,e,t,s,r,i,a,o,c){Zu=!1,Pm=null,ck.apply(uk,arguments)}function hk(n,e,t,s,r,i,a,o,c){if(dk.apply(this,arguments),Zu){if(Zu){var d=Pm;Zu=!1,Pm=null}else throw Error(X(198));Dm||(Dm=!0,d0=d)}}function fl(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function v_(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function Qb(n){if(fl(n)!==n)throw Error(X(188))}function fk(n){var e=n.alternate;if(!e){if(e=fl(n),e===null)throw Error(X(188));return e!==n?null:n}for(var t=n,s=e;;){var r=t.return;if(r===null)break;var i=r.alternate;if(i===null){if(s=r.return,s!==null){t=s;continue}break}if(r.child===i.child){for(i=r.child;i;){if(i===t)return Qb(r),n;if(i===s)return Qb(r),e;i=i.sibling}throw Error(X(188))}if(t.return!==s.return)t=r,s=i;else{for(var a=!1,o=r.child;o;){if(o===t){a=!0,t=r,s=i;break}if(o===s){a=!0,s=r,t=i;break}o=o.sibling}if(!a){for(o=i.child;o;){if(o===t){a=!0,t=i,s=r;break}if(o===s){a=!0,s=i,t=r;break}o=o.sibling}if(!a)throw Error(X(189))}}if(t.alternate!==s)throw Error(X(190))}if(t.tag!==3)throw Error(X(188));return t.stateNode.current===t?n:e}function b_(n){return n=fk(n),n!==null?x_(n):null}function x_(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=x_(n);if(e!==null)return e;n=n.sibling}return null}var w_=pn.unstable_scheduleCallback,Zb=pn.unstable_cancelCallback,mk=pn.unstable_shouldYield,pk=pn.unstable_requestPaint,kt=pn.unstable_now,gk=pn.unstable_getCurrentPriorityLevel,Rv=pn.unstable_ImmediatePriority,__=pn.unstable_UserBlockingPriority,Mm=pn.unstable_NormalPriority,yk=pn.unstable_LowPriority,S_=pn.unstable_IdlePriority,Pp=null,Ir=null;function vk(n){if(Ir&&typeof Ir.onCommitFiberRoot=="function")try{Ir.onCommitFiberRoot(Pp,n,void 0,(n.current.flags&128)===128)}catch{}}var nr=Math.clz32?Math.clz32:wk,bk=Math.log,xk=Math.LN2;function wk(n){return n>>>=0,n===0?32:31-(bk(n)/xk|0)|0}var wf=64,_f=4194304;function Pu(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function Lm(n,e){var t=n.pendingLanes;if(t===0)return 0;var s=0,r=n.suspendedLanes,i=n.pingedLanes,a=t&268435455;if(a!==0){var o=a&~r;o!==0?s=Pu(o):(i&=a,i!==0&&(s=Pu(i)))}else a=t&~r,a!==0?s=Pu(a):i!==0&&(s=Pu(i));if(s===0)return 0;if(e!==0&&e!==s&&!(e&r)&&(r=s&-s,i=e&-e,r>=i||r===16&&(i&4194240)!==0))return e;if(s&4&&(s|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=s;0<e;)t=31-nr(e),r=1<<t,s|=n[t],e&=~r;return s}function _k(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Sk(n,e){for(var t=n.suspendedLanes,s=n.pingedLanes,r=n.expirationTimes,i=n.pendingLanes;0<i;){var a=31-nr(i),o=1<<a,c=r[a];c===-1?(!(o&t)||o&s)&&(r[a]=_k(o,e)):c<=e&&(n.expiredLanes|=o),i&=~o}}function h0(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function A_(){var n=wf;return wf<<=1,!(wf&4194240)&&(wf=64),n}function fg(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function af(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-nr(e),n[e]=t}function Ak(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var s=n.eventTimes;for(n=n.expirationTimes;0<t;){var r=31-nr(t),i=1<<r;e[r]=0,s[r]=-1,n[r]=-1,t&=~i}}function Iv(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var s=31-nr(t),r=1<<s;r&e|n[s]&e&&(n[s]|=e),t&=~r}}var Ye=0;function N_(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var k_,Pv,E_,C_,j_,f0=!1,Sf=[],ya=null,va=null,ba=null,pd=new Map,gd=new Map,Mi=[],Nk="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function ex(n,e){switch(n){case"focusin":case"focusout":ya=null;break;case"dragenter":case"dragleave":va=null;break;case"mouseover":case"mouseout":ba=null;break;case"pointerover":case"pointerout":pd.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":gd.delete(e.pointerId)}}function xu(n,e,t,s,r,i){return n===null||n.nativeEvent!==i?(n={blockedOn:e,domEventName:t,eventSystemFlags:s,nativeEvent:i,targetContainers:[r]},e!==null&&(e=lf(e),e!==null&&Pv(e)),n):(n.eventSystemFlags|=s,e=n.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),n)}function kk(n,e,t,s,r){switch(e){case"focusin":return ya=xu(ya,n,e,t,s,r),!0;case"dragenter":return va=xu(va,n,e,t,s,r),!0;case"mouseover":return ba=xu(ba,n,e,t,s,r),!0;case"pointerover":var i=r.pointerId;return pd.set(i,xu(pd.get(i)||null,n,e,t,s,r)),!0;case"gotpointercapture":return i=r.pointerId,gd.set(i,xu(gd.get(i)||null,n,e,t,s,r)),!0}return!1}function T_(n){var e=Ga(n.target);if(e!==null){var t=fl(e);if(t!==null){if(e=t.tag,e===13){if(e=v_(t),e!==null){n.blockedOn=e,j_(n.priority,function(){E_(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Wf(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=m0(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var s=new t.constructor(t.type,t);l0=s,t.target.dispatchEvent(s),l0=null}else return e=lf(t),e!==null&&Pv(e),n.blockedOn=t,!1;e.shift()}return!0}function tx(n,e,t){Wf(n)&&t.delete(e)}function Ek(){f0=!1,ya!==null&&Wf(ya)&&(ya=null),va!==null&&Wf(va)&&(va=null),ba!==null&&Wf(ba)&&(ba=null),pd.forEach(tx),gd.forEach(tx)}function wu(n,e){n.blockedOn===e&&(n.blockedOn=null,f0||(f0=!0,pn.unstable_scheduleCallback(pn.unstable_NormalPriority,Ek)))}function yd(n){function e(r){return wu(r,n)}if(0<Sf.length){wu(Sf[0],n);for(var t=1;t<Sf.length;t++){var s=Sf[t];s.blockedOn===n&&(s.blockedOn=null)}}for(ya!==null&&wu(ya,n),va!==null&&wu(va,n),ba!==null&&wu(ba,n),pd.forEach(e),gd.forEach(e),t=0;t<Mi.length;t++)s=Mi[t],s.blockedOn===n&&(s.blockedOn=null);for(;0<Mi.length&&(t=Mi[0],t.blockedOn===null);)T_(t),t.blockedOn===null&&Mi.shift()}var Xl=Ci.ReactCurrentBatchConfig,Om=!0;function Ck(n,e,t,s){var r=Ye,i=Xl.transition;Xl.transition=null;try{Ye=1,Dv(n,e,t,s)}finally{Ye=r,Xl.transition=i}}function jk(n,e,t,s){var r=Ye,i=Xl.transition;Xl.transition=null;try{Ye=4,Dv(n,e,t,s)}finally{Ye=r,Xl.transition=i}}function Dv(n,e,t,s){if(Om){var r=m0(n,e,t,s);if(r===null)Sg(n,e,s,Fm,t),ex(n,s);else if(kk(r,n,e,t,s))s.stopPropagation();else if(ex(n,s),e&4&&-1<Nk.indexOf(n)){for(;r!==null;){var i=lf(r);if(i!==null&&k_(i),i=m0(n,e,t,s),i===null&&Sg(n,e,s,Fm,t),i===r)break;r=i}r!==null&&s.stopPropagation()}else Sg(n,e,s,null,t)}}var Fm=null;function m0(n,e,t,s){if(Fm=null,n=Tv(s),n=Ga(n),n!==null)if(e=fl(n),e===null)n=null;else if(t=e.tag,t===13){if(n=v_(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return Fm=n,null}function R_(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(gk()){case Rv:return 1;case __:return 4;case Mm:case yk:return 16;case S_:return 536870912;default:return 16}default:return 16}}var pa=null,Mv=null,Vf=null;function I_(){if(Vf)return Vf;var n,e=Mv,t=e.length,s,r="value"in pa?pa.value:pa.textContent,i=r.length;for(n=0;n<t&&e[n]===r[n];n++);var a=t-n;for(s=1;s<=a&&e[t-s]===r[i-s];s++);return Vf=r.slice(n,1<s?1-s:void 0)}function Gf(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function Af(){return!0}function sx(){return!1}function yn(n){function e(t,s,r,i,a){this._reactName=t,this._targetInst=r,this.type=s,this.nativeEvent=i,this.target=a,this.currentTarget=null;for(var o in n)n.hasOwnProperty(o)&&(t=n[o],this[o]=t?t(i):i[o]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?Af:sx,this.isPropagationStopped=sx,this}return xt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=Af)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=Af)},persist:function(){},isPersistent:Af}),e}var mu={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Lv=yn(mu),of=xt({},mu,{view:0,detail:0}),Tk=yn(of),mg,pg,_u,Dp=xt({},of,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ov,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==_u&&(_u&&n.type==="mousemove"?(mg=n.screenX-_u.screenX,pg=n.screenY-_u.screenY):pg=mg=0,_u=n),mg)},movementY:function(n){return"movementY"in n?n.movementY:pg}}),nx=yn(Dp),Rk=xt({},Dp,{dataTransfer:0}),Ik=yn(Rk),Pk=xt({},of,{relatedTarget:0}),gg=yn(Pk),Dk=xt({},mu,{animationName:0,elapsedTime:0,pseudoElement:0}),Mk=yn(Dk),Lk=xt({},mu,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),Ok=yn(Lk),Fk=xt({},mu,{data:0}),rx=yn(Fk),$k={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Bk={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Uk={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function zk(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=Uk[n])?!!e[n]:!1}function Ov(){return zk}var Hk=xt({},of,{key:function(n){if(n.key){var e=$k[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=Gf(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?Bk[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ov,charCode:function(n){return n.type==="keypress"?Gf(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Gf(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),qk=yn(Hk),Wk=xt({},Dp,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ix=yn(Wk),Vk=xt({},of,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ov}),Gk=yn(Vk),Kk=xt({},mu,{propertyName:0,elapsedTime:0,pseudoElement:0}),Xk=yn(Kk),Yk=xt({},Dp,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),Jk=yn(Yk),Qk=[9,13,27,32],Fv=_i&&"CompositionEvent"in window,ed=null;_i&&"documentMode"in document&&(ed=document.documentMode);var Zk=_i&&"TextEvent"in window&&!ed,P_=_i&&(!Fv||ed&&8<ed&&11>=ed),ax=" ",ox=!1;function D_(n,e){switch(n){case"keyup":return Qk.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function M_(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var Pl=!1;function eE(n,e){switch(n){case"compositionend":return M_(e);case"keypress":return e.which!==32?null:(ox=!0,ax);case"textInput":return n=e.data,n===ax&&ox?null:n;default:return null}}function tE(n,e){if(Pl)return n==="compositionend"||!Fv&&D_(n,e)?(n=I_(),Vf=Mv=pa=null,Pl=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return P_&&e.locale!=="ko"?null:e.data;default:return null}}var sE={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function lx(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!sE[n.type]:e==="textarea"}function L_(n,e,t,s){f_(s),e=$m(e,"onChange"),0<e.length&&(t=new Lv("onChange","change",null,t,s),n.push({event:t,listeners:e}))}var td=null,vd=null;function nE(n){G_(n,0)}function Mp(n){var e=Ll(n);if(a_(e))return n}function rE(n,e){if(n==="change")return e}var O_=!1;if(_i){var yg;if(_i){var vg="oninput"in document;if(!vg){var cx=document.createElement("div");cx.setAttribute("oninput","return;"),vg=typeof cx.oninput=="function"}yg=vg}else yg=!1;O_=yg&&(!document.documentMode||9<document.documentMode)}function ux(){td&&(td.detachEvent("onpropertychange",F_),vd=td=null)}function F_(n){if(n.propertyName==="value"&&Mp(vd)){var e=[];L_(e,vd,n,Tv(n)),y_(nE,e)}}function iE(n,e,t){n==="focusin"?(ux(),td=e,vd=t,td.attachEvent("onpropertychange",F_)):n==="focusout"&&ux()}function aE(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return Mp(vd)}function oE(n,e){if(n==="click")return Mp(e)}function lE(n,e){if(n==="input"||n==="change")return Mp(e)}function cE(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var ir=typeof Object.is=="function"?Object.is:cE;function bd(n,e){if(ir(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),s=Object.keys(e);if(t.length!==s.length)return!1;for(s=0;s<t.length;s++){var r=t[s];if(!Yg.call(e,r)||!ir(n[r],e[r]))return!1}return!0}function dx(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function hx(n,e){var t=dx(n);n=0;for(var s;t;){if(t.nodeType===3){if(s=n+t.textContent.length,n<=e&&s>=e)return{node:t,offset:e-n};n=s}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=dx(t)}}function $_(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?$_(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function B_(){for(var n=window,e=Im();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=Im(n.document)}return e}function $v(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function uE(n){var e=B_(),t=n.focusedElem,s=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&$_(t.ownerDocument.documentElement,t)){if(s!==null&&$v(t)){if(e=s.start,n=s.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var r=t.textContent.length,i=Math.min(s.start,r);s=s.end===void 0?i:Math.min(s.end,r),!n.extend&&i>s&&(r=s,s=i,i=r),r=hx(t,i);var a=hx(t,s);r&&a&&(n.rangeCount!==1||n.anchorNode!==r.node||n.anchorOffset!==r.offset||n.focusNode!==a.node||n.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),n.removeAllRanges(),i>s?(n.addRange(e),n.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var dE=_i&&"documentMode"in document&&11>=document.documentMode,Dl=null,p0=null,sd=null,g0=!1;function fx(n,e,t){var s=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;g0||Dl==null||Dl!==Im(s)||(s=Dl,"selectionStart"in s&&$v(s)?s={start:s.selectionStart,end:s.selectionEnd}:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection(),s={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset}),sd&&bd(sd,s)||(sd=s,s=$m(p0,"onSelect"),0<s.length&&(e=new Lv("onSelect","select",null,e,t),n.push({event:e,listeners:s}),e.target=Dl)))}function Nf(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var Ml={animationend:Nf("Animation","AnimationEnd"),animationiteration:Nf("Animation","AnimationIteration"),animationstart:Nf("Animation","AnimationStart"),transitionend:Nf("Transition","TransitionEnd")},bg={},U_={};_i&&(U_=document.createElement("div").style,"AnimationEvent"in window||(delete Ml.animationend.animation,delete Ml.animationiteration.animation,delete Ml.animationstart.animation),"TransitionEvent"in window||delete Ml.transitionend.transition);function Lp(n){if(bg[n])return bg[n];if(!Ml[n])return n;var e=Ml[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in U_)return bg[n]=e[t];return n}var z_=Lp("animationend"),H_=Lp("animationiteration"),q_=Lp("animationstart"),W_=Lp("transitionend"),V_=new Map,mx="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ra(n,e){V_.set(n,e),hl(e,[n])}for(var xg=0;xg<mx.length;xg++){var wg=mx[xg],hE=wg.toLowerCase(),fE=wg[0].toUpperCase()+wg.slice(1);Ra(hE,"on"+fE)}Ra(z_,"onAnimationEnd");Ra(H_,"onAnimationIteration");Ra(q_,"onAnimationStart");Ra("dblclick","onDoubleClick");Ra("focusin","onFocus");Ra("focusout","onBlur");Ra(W_,"onTransitionEnd");iu("onMouseEnter",["mouseout","mouseover"]);iu("onMouseLeave",["mouseout","mouseover"]);iu("onPointerEnter",["pointerout","pointerover"]);iu("onPointerLeave",["pointerout","pointerover"]);hl("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));hl("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));hl("onBeforeInput",["compositionend","keypress","textInput","paste"]);hl("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));hl("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));hl("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Du="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mE=new Set("cancel close invalid load scroll toggle".split(" ").concat(Du));function px(n,e,t){var s=n.type||"unknown-event";n.currentTarget=t,hk(s,e,void 0,n),n.currentTarget=null}function G_(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var s=n[t],r=s.event;s=s.listeners;e:{var i=void 0;if(e)for(var a=s.length-1;0<=a;a--){var o=s[a],c=o.instance,d=o.currentTarget;if(o=o.listener,c!==i&&r.isPropagationStopped())break e;px(r,o,d),i=c}else for(a=0;a<s.length;a++){if(o=s[a],c=o.instance,d=o.currentTarget,o=o.listener,c!==i&&r.isPropagationStopped())break e;px(r,o,d),i=c}}}if(Dm)throw n=d0,Dm=!1,d0=null,n}function ot(n,e){var t=e[w0];t===void 0&&(t=e[w0]=new Set);var s=n+"__bubble";t.has(s)||(K_(e,n,2,!1),t.add(s))}function _g(n,e,t){var s=0;e&&(s|=4),K_(t,n,s,e)}var kf="_reactListening"+Math.random().toString(36).slice(2);function xd(n){if(!n[kf]){n[kf]=!0,t_.forEach(function(t){t!=="selectionchange"&&(mE.has(t)||_g(t,!1,n),_g(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[kf]||(e[kf]=!0,_g("selectionchange",!1,e))}}function K_(n,e,t,s){switch(R_(e)){case 1:var r=Ck;break;case 4:r=jk;break;default:r=Dv}t=r.bind(null,e,t,n),r=void 0,!u0||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),s?r!==void 0?n.addEventListener(e,t,{capture:!0,passive:r}):n.addEventListener(e,t,!0):r!==void 0?n.addEventListener(e,t,{passive:r}):n.addEventListener(e,t,!1)}function Sg(n,e,t,s,r){var i=s;if(!(e&1)&&!(e&2)&&s!==null)e:for(;;){if(s===null)return;var a=s.tag;if(a===3||a===4){var o=s.stateNode.containerInfo;if(o===r||o.nodeType===8&&o.parentNode===r)break;if(a===4)for(a=s.return;a!==null;){var c=a.tag;if((c===3||c===4)&&(c=a.stateNode.containerInfo,c===r||c.nodeType===8&&c.parentNode===r))return;a=a.return}for(;o!==null;){if(a=Ga(o),a===null)return;if(c=a.tag,c===5||c===6){s=i=a;continue e}o=o.parentNode}}s=s.return}y_(function(){var d=i,h=Tv(t),f=[];e:{var m=V_.get(n);if(m!==void 0){var p=Lv,g=n;switch(n){case"keypress":if(Gf(t)===0)break e;case"keydown":case"keyup":p=qk;break;case"focusin":g="focus",p=gg;break;case"focusout":g="blur",p=gg;break;case"beforeblur":case"afterblur":p=gg;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=nx;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=Ik;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=Gk;break;case z_:case H_:case q_:p=Mk;break;case W_:p=Xk;break;case"scroll":p=Tk;break;case"wheel":p=Jk;break;case"copy":case"cut":case"paste":p=Ok;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=ix}var y=(e&4)!==0,N=!y&&n==="scroll",b=y?m!==null?m+"Capture":null:m;y=[];for(var x=d,_;x!==null;){_=x;var w=_.stateNode;if(_.tag===5&&w!==null&&(_=w,b!==null&&(w=md(x,b),w!=null&&y.push(wd(x,w,_)))),N)break;x=x.return}0<y.length&&(m=new p(m,g,null,t,h),f.push({event:m,listeners:y}))}}if(!(e&7)){e:{if(m=n==="mouseover"||n==="pointerover",p=n==="mouseout"||n==="pointerout",m&&t!==l0&&(g=t.relatedTarget||t.fromElement)&&(Ga(g)||g[Si]))break e;if((p||m)&&(m=h.window===h?h:(m=h.ownerDocument)?m.defaultView||m.parentWindow:window,p?(g=t.relatedTarget||t.toElement,p=d,g=g?Ga(g):null,g!==null&&(N=fl(g),g!==N||g.tag!==5&&g.tag!==6)&&(g=null)):(p=null,g=d),p!==g)){if(y=nx,w="onMouseLeave",b="onMouseEnter",x="mouse",(n==="pointerout"||n==="pointerover")&&(y=ix,w="onPointerLeave",b="onPointerEnter",x="pointer"),N=p==null?m:Ll(p),_=g==null?m:Ll(g),m=new y(w,x+"leave",p,t,h),m.target=N,m.relatedTarget=_,w=null,Ga(h)===d&&(y=new y(b,x+"enter",g,t,h),y.target=_,y.relatedTarget=N,w=y),N=w,p&&g)t:{for(y=p,b=g,x=0,_=y;_;_=gl(_))x++;for(_=0,w=b;w;w=gl(w))_++;for(;0<x-_;)y=gl(y),x--;for(;0<_-x;)b=gl(b),_--;for(;x--;){if(y===b||b!==null&&y===b.alternate)break t;y=gl(y),b=gl(b)}y=null}else y=null;p!==null&&gx(f,m,p,y,!1),g!==null&&N!==null&&gx(f,N,g,y,!0)}}e:{if(m=d?Ll(d):window,p=m.nodeName&&m.nodeName.toLowerCase(),p==="select"||p==="input"&&m.type==="file")var k=rE;else if(lx(m))if(O_)k=lE;else{k=aE;var C=iE}else(p=m.nodeName)&&p.toLowerCase()==="input"&&(m.type==="checkbox"||m.type==="radio")&&(k=oE);if(k&&(k=k(n,d))){L_(f,k,t,h);break e}C&&C(n,m,d),n==="focusout"&&(C=m._wrapperState)&&C.controlled&&m.type==="number"&&n0(m,"number",m.value)}switch(C=d?Ll(d):window,n){case"focusin":(lx(C)||C.contentEditable==="true")&&(Dl=C,p0=d,sd=null);break;case"focusout":sd=p0=Dl=null;break;case"mousedown":g0=!0;break;case"contextmenu":case"mouseup":case"dragend":g0=!1,fx(f,t,h);break;case"selectionchange":if(dE)break;case"keydown":case"keyup":fx(f,t,h)}var T;if(Fv)e:{switch(n){case"compositionstart":var D="onCompositionStart";break e;case"compositionend":D="onCompositionEnd";break e;case"compositionupdate":D="onCompositionUpdate";break e}D=void 0}else Pl?D_(n,t)&&(D="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(D="onCompositionStart");D&&(P_&&t.locale!=="ko"&&(Pl||D!=="onCompositionStart"?D==="onCompositionEnd"&&Pl&&(T=I_()):(pa=h,Mv="value"in pa?pa.value:pa.textContent,Pl=!0)),C=$m(d,D),0<C.length&&(D=new rx(D,n,null,t,h),f.push({event:D,listeners:C}),T?D.data=T:(T=M_(t),T!==null&&(D.data=T)))),(T=Zk?eE(n,t):tE(n,t))&&(d=$m(d,"onBeforeInput"),0<d.length&&(h=new rx("onBeforeInput","beforeinput",null,t,h),f.push({event:h,listeners:d}),h.data=T))}G_(f,e)})}function wd(n,e,t){return{instance:n,listener:e,currentTarget:t}}function $m(n,e){for(var t=e+"Capture",s=[];n!==null;){var r=n,i=r.stateNode;r.tag===5&&i!==null&&(r=i,i=md(n,t),i!=null&&s.unshift(wd(n,i,r)),i=md(n,e),i!=null&&s.push(wd(n,i,r))),n=n.return}return s}function gl(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function gx(n,e,t,s,r){for(var i=e._reactName,a=[];t!==null&&t!==s;){var o=t,c=o.alternate,d=o.stateNode;if(c!==null&&c===s)break;o.tag===5&&d!==null&&(o=d,r?(c=md(t,i),c!=null&&a.unshift(wd(t,c,o))):r||(c=md(t,i),c!=null&&a.push(wd(t,c,o)))),t=t.return}a.length!==0&&n.push({event:e,listeners:a})}var pE=/\r\n?/g,gE=/\u0000|\uFFFD/g;function yx(n){return(typeof n=="string"?n:""+n).replace(pE,`
`).replace(gE,"")}function Ef(n,e,t){if(e=yx(e),yx(n)!==e&&t)throw Error(X(425))}function Bm(){}var y0=null,v0=null;function b0(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var x0=typeof setTimeout=="function"?setTimeout:void 0,yE=typeof clearTimeout=="function"?clearTimeout:void 0,vx=typeof Promise=="function"?Promise:void 0,vE=typeof queueMicrotask=="function"?queueMicrotask:typeof vx<"u"?function(n){return vx.resolve(null).then(n).catch(bE)}:x0;function bE(n){setTimeout(function(){throw n})}function Ag(n,e){var t=e,s=0;do{var r=t.nextSibling;if(n.removeChild(t),r&&r.nodeType===8)if(t=r.data,t==="/$"){if(s===0){n.removeChild(r),yd(e);return}s--}else t!=="$"&&t!=="$?"&&t!=="$!"||s++;t=r}while(t);yd(e)}function xa(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function bx(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var pu=Math.random().toString(36).slice(2),Rr="__reactFiber$"+pu,_d="__reactProps$"+pu,Si="__reactContainer$"+pu,w0="__reactEvents$"+pu,xE="__reactListeners$"+pu,wE="__reactHandles$"+pu;function Ga(n){var e=n[Rr];if(e)return e;for(var t=n.parentNode;t;){if(e=t[Si]||t[Rr]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=bx(n);n!==null;){if(t=n[Rr])return t;n=bx(n)}return e}n=t,t=n.parentNode}return null}function lf(n){return n=n[Rr]||n[Si],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function Ll(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(X(33))}function Op(n){return n[_d]||null}var _0=[],Ol=-1;function Ia(n){return{current:n}}function ct(n){0>Ol||(n.current=_0[Ol],_0[Ol]=null,Ol--)}function at(n,e){Ol++,_0[Ol]=n.current,n.current=e}var Ea={},vs=Ia(Ea),Ws=Ia(!1),nl=Ea;function au(n,e){var t=n.type.contextTypes;if(!t)return Ea;var s=n.stateNode;if(s&&s.__reactInternalMemoizedUnmaskedChildContext===e)return s.__reactInternalMemoizedMaskedChildContext;var r={},i;for(i in t)r[i]=e[i];return s&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=r),r}function Vs(n){return n=n.childContextTypes,n!=null}function Um(){ct(Ws),ct(vs)}function xx(n,e,t){if(vs.current!==Ea)throw Error(X(168));at(vs,e),at(Ws,t)}function X_(n,e,t){var s=n.stateNode;if(e=e.childContextTypes,typeof s.getChildContext!="function")return t;s=s.getChildContext();for(var r in s)if(!(r in e))throw Error(X(108,ik(n)||"Unknown",r));return xt({},t,s)}function zm(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||Ea,nl=vs.current,at(vs,n),at(Ws,Ws.current),!0}function wx(n,e,t){var s=n.stateNode;if(!s)throw Error(X(169));t?(n=X_(n,e,nl),s.__reactInternalMemoizedMergedChildContext=n,ct(Ws),ct(vs),at(vs,n)):ct(Ws),at(Ws,t)}var qr=null,Fp=!1,Ng=!1;function Y_(n){qr===null?qr=[n]:qr.push(n)}function _E(n){Fp=!0,Y_(n)}function Pa(){if(!Ng&&qr!==null){Ng=!0;var n=0,e=Ye;try{var t=qr;for(Ye=1;n<t.length;n++){var s=t[n];do s=s(!0);while(s!==null)}qr=null,Fp=!1}catch(r){throw qr!==null&&(qr=qr.slice(n+1)),w_(Rv,Pa),r}finally{Ye=e,Ng=!1}}return null}var Fl=[],$l=0,Hm=null,qm=0,kn=[],En=0,rl=null,yi=1,vi="";function Fa(n,e){Fl[$l++]=qm,Fl[$l++]=Hm,Hm=n,qm=e}function J_(n,e,t){kn[En++]=yi,kn[En++]=vi,kn[En++]=rl,rl=n;var s=yi;n=vi;var r=32-nr(s)-1;s&=~(1<<r),t+=1;var i=32-nr(e)+r;if(30<i){var a=r-r%5;i=(s&(1<<a)-1).toString(32),s>>=a,r-=a,yi=1<<32-nr(e)+r|t<<r|s,vi=i+n}else yi=1<<i|t<<r|s,vi=n}function Bv(n){n.return!==null&&(Fa(n,1),J_(n,1,0))}function Uv(n){for(;n===Hm;)Hm=Fl[--$l],Fl[$l]=null,qm=Fl[--$l],Fl[$l]=null;for(;n===rl;)rl=kn[--En],kn[En]=null,vi=kn[--En],kn[En]=null,yi=kn[--En],kn[En]=null}var fn=null,hn=null,mt=!1,tr=null;function Q_(n,e){var t=Tn(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function _x(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,fn=n,hn=xa(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,fn=n,hn=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=rl!==null?{id:yi,overflow:vi}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=Tn(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,fn=n,hn=null,!0):!1;default:return!1}}function S0(n){return(n.mode&1)!==0&&(n.flags&128)===0}function A0(n){if(mt){var e=hn;if(e){var t=e;if(!_x(n,e)){if(S0(n))throw Error(X(418));e=xa(t.nextSibling);var s=fn;e&&_x(n,e)?Q_(s,t):(n.flags=n.flags&-4097|2,mt=!1,fn=n)}}else{if(S0(n))throw Error(X(418));n.flags=n.flags&-4097|2,mt=!1,fn=n}}}function Sx(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;fn=n}function Cf(n){if(n!==fn)return!1;if(!mt)return Sx(n),mt=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!b0(n.type,n.memoizedProps)),e&&(e=hn)){if(S0(n))throw Z_(),Error(X(418));for(;e;)Q_(n,e),e=xa(e.nextSibling)}if(Sx(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(X(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){hn=xa(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}hn=null}}else hn=fn?xa(n.stateNode.nextSibling):null;return!0}function Z_(){for(var n=hn;n;)n=xa(n.nextSibling)}function ou(){hn=fn=null,mt=!1}function zv(n){tr===null?tr=[n]:tr.push(n)}var SE=Ci.ReactCurrentBatchConfig;function Su(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(X(309));var s=t.stateNode}if(!s)throw Error(X(147,n));var r=s,i=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(a){var o=r.refs;a===null?delete o[i]:o[i]=a},e._stringRef=i,e)}if(typeof n!="string")throw Error(X(284));if(!t._owner)throw Error(X(290,n))}return n}function jf(n,e){throw n=Object.prototype.toString.call(e),Error(X(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function Ax(n){var e=n._init;return e(n._payload)}function eS(n){function e(b,x){if(n){var _=b.deletions;_===null?(b.deletions=[x],b.flags|=16):_.push(x)}}function t(b,x){if(!n)return null;for(;x!==null;)e(b,x),x=x.sibling;return null}function s(b,x){for(b=new Map;x!==null;)x.key!==null?b.set(x.key,x):b.set(x.index,x),x=x.sibling;return b}function r(b,x){return b=Aa(b,x),b.index=0,b.sibling=null,b}function i(b,x,_){return b.index=_,n?(_=b.alternate,_!==null?(_=_.index,_<x?(b.flags|=2,x):_):(b.flags|=2,x)):(b.flags|=1048576,x)}function a(b){return n&&b.alternate===null&&(b.flags|=2),b}function o(b,x,_,w){return x===null||x.tag!==6?(x=Ig(_,b.mode,w),x.return=b,x):(x=r(x,_),x.return=b,x)}function c(b,x,_,w){var k=_.type;return k===Il?h(b,x,_.props.children,w,_.key):x!==null&&(x.elementType===k||typeof k=="object"&&k!==null&&k.$$typeof===Pi&&Ax(k)===x.type)?(w=r(x,_.props),w.ref=Su(b,x,_),w.return=b,w):(w=em(_.type,_.key,_.props,null,b.mode,w),w.ref=Su(b,x,_),w.return=b,w)}function d(b,x,_,w){return x===null||x.tag!==4||x.stateNode.containerInfo!==_.containerInfo||x.stateNode.implementation!==_.implementation?(x=Pg(_,b.mode,w),x.return=b,x):(x=r(x,_.children||[]),x.return=b,x)}function h(b,x,_,w,k){return x===null||x.tag!==7?(x=sl(_,b.mode,w,k),x.return=b,x):(x=r(x,_),x.return=b,x)}function f(b,x,_){if(typeof x=="string"&&x!==""||typeof x=="number")return x=Ig(""+x,b.mode,_),x.return=b,x;if(typeof x=="object"&&x!==null){switch(x.$$typeof){case vf:return _=em(x.type,x.key,x.props,null,b.mode,_),_.ref=Su(b,null,x),_.return=b,_;case Rl:return x=Pg(x,b.mode,_),x.return=b,x;case Pi:var w=x._init;return f(b,w(x._payload),_)}if(Iu(x)||vu(x))return x=sl(x,b.mode,_,null),x.return=b,x;jf(b,x)}return null}function m(b,x,_,w){var k=x!==null?x.key:null;if(typeof _=="string"&&_!==""||typeof _=="number")return k!==null?null:o(b,x,""+_,w);if(typeof _=="object"&&_!==null){switch(_.$$typeof){case vf:return _.key===k?c(b,x,_,w):null;case Rl:return _.key===k?d(b,x,_,w):null;case Pi:return k=_._init,m(b,x,k(_._payload),w)}if(Iu(_)||vu(_))return k!==null?null:h(b,x,_,w,null);jf(b,_)}return null}function p(b,x,_,w,k){if(typeof w=="string"&&w!==""||typeof w=="number")return b=b.get(_)||null,o(x,b,""+w,k);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case vf:return b=b.get(w.key===null?_:w.key)||null,c(x,b,w,k);case Rl:return b=b.get(w.key===null?_:w.key)||null,d(x,b,w,k);case Pi:var C=w._init;return p(b,x,_,C(w._payload),k)}if(Iu(w)||vu(w))return b=b.get(_)||null,h(x,b,w,k,null);jf(x,w)}return null}function g(b,x,_,w){for(var k=null,C=null,T=x,D=x=0,B=null;T!==null&&D<_.length;D++){T.index>D?(B=T,T=null):B=T.sibling;var ee=m(b,T,_[D],w);if(ee===null){T===null&&(T=B);break}n&&T&&ee.alternate===null&&e(b,T),x=i(ee,x,D),C===null?k=ee:C.sibling=ee,C=ee,T=B}if(D===_.length)return t(b,T),mt&&Fa(b,D),k;if(T===null){for(;D<_.length;D++)T=f(b,_[D],w),T!==null&&(x=i(T,x,D),C===null?k=T:C.sibling=T,C=T);return mt&&Fa(b,D),k}for(T=s(b,T);D<_.length;D++)B=p(T,b,D,_[D],w),B!==null&&(n&&B.alternate!==null&&T.delete(B.key===null?D:B.key),x=i(B,x,D),C===null?k=B:C.sibling=B,C=B);return n&&T.forEach(function(M){return e(b,M)}),mt&&Fa(b,D),k}function y(b,x,_,w){var k=vu(_);if(typeof k!="function")throw Error(X(150));if(_=k.call(_),_==null)throw Error(X(151));for(var C=k=null,T=x,D=x=0,B=null,ee=_.next();T!==null&&!ee.done;D++,ee=_.next()){T.index>D?(B=T,T=null):B=T.sibling;var M=m(b,T,ee.value,w);if(M===null){T===null&&(T=B);break}n&&T&&M.alternate===null&&e(b,T),x=i(M,x,D),C===null?k=M:C.sibling=M,C=M,T=B}if(ee.done)return t(b,T),mt&&Fa(b,D),k;if(T===null){for(;!ee.done;D++,ee=_.next())ee=f(b,ee.value,w),ee!==null&&(x=i(ee,x,D),C===null?k=ee:C.sibling=ee,C=ee);return mt&&Fa(b,D),k}for(T=s(b,T);!ee.done;D++,ee=_.next())ee=p(T,b,D,ee.value,w),ee!==null&&(n&&ee.alternate!==null&&T.delete(ee.key===null?D:ee.key),x=i(ee,x,D),C===null?k=ee:C.sibling=ee,C=ee);return n&&T.forEach(function(E){return e(b,E)}),mt&&Fa(b,D),k}function N(b,x,_,w){if(typeof _=="object"&&_!==null&&_.type===Il&&_.key===null&&(_=_.props.children),typeof _=="object"&&_!==null){switch(_.$$typeof){case vf:e:{for(var k=_.key,C=x;C!==null;){if(C.key===k){if(k=_.type,k===Il){if(C.tag===7){t(b,C.sibling),x=r(C,_.props.children),x.return=b,b=x;break e}}else if(C.elementType===k||typeof k=="object"&&k!==null&&k.$$typeof===Pi&&Ax(k)===C.type){t(b,C.sibling),x=r(C,_.props),x.ref=Su(b,C,_),x.return=b,b=x;break e}t(b,C);break}else e(b,C);C=C.sibling}_.type===Il?(x=sl(_.props.children,b.mode,w,_.key),x.return=b,b=x):(w=em(_.type,_.key,_.props,null,b.mode,w),w.ref=Su(b,x,_),w.return=b,b=w)}return a(b);case Rl:e:{for(C=_.key;x!==null;){if(x.key===C)if(x.tag===4&&x.stateNode.containerInfo===_.containerInfo&&x.stateNode.implementation===_.implementation){t(b,x.sibling),x=r(x,_.children||[]),x.return=b,b=x;break e}else{t(b,x);break}else e(b,x);x=x.sibling}x=Pg(_,b.mode,w),x.return=b,b=x}return a(b);case Pi:return C=_._init,N(b,x,C(_._payload),w)}if(Iu(_))return g(b,x,_,w);if(vu(_))return y(b,x,_,w);jf(b,_)}return typeof _=="string"&&_!==""||typeof _=="number"?(_=""+_,x!==null&&x.tag===6?(t(b,x.sibling),x=r(x,_),x.return=b,b=x):(t(b,x),x=Ig(_,b.mode,w),x.return=b,b=x),a(b)):t(b,x)}return N}var lu=eS(!0),tS=eS(!1),Wm=Ia(null),Vm=null,Bl=null,Hv=null;function qv(){Hv=Bl=Vm=null}function Wv(n){var e=Wm.current;ct(Wm),n._currentValue=e}function N0(n,e,t){for(;n!==null;){var s=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,s!==null&&(s.childLanes|=e)):s!==null&&(s.childLanes&e)!==e&&(s.childLanes|=e),n===t)break;n=n.return}}function Yl(n,e){Vm=n,Hv=Bl=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(qs=!0),n.firstContext=null)}function Dn(n){var e=n._currentValue;if(Hv!==n)if(n={context:n,memoizedValue:e,next:null},Bl===null){if(Vm===null)throw Error(X(308));Bl=n,Vm.dependencies={lanes:0,firstContext:n}}else Bl=Bl.next=n;return e}var Ka=null;function Vv(n){Ka===null?Ka=[n]:Ka.push(n)}function sS(n,e,t,s){var r=e.interleaved;return r===null?(t.next=t,Vv(e)):(t.next=r.next,r.next=t),e.interleaved=t,Ai(n,s)}function Ai(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var Di=!1;function Gv(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function nS(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function bi(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function wa(n,e,t){var s=n.updateQueue;if(s===null)return null;if(s=s.shared,Ue&2){var r=s.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),s.pending=e,Ai(n,t)}return r=s.interleaved,r===null?(e.next=e,Vv(s)):(e.next=r.next,r.next=e),s.interleaved=e,Ai(n,t)}function Kf(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var s=e.lanes;s&=n.pendingLanes,t|=s,e.lanes=t,Iv(n,t)}}function Nx(n,e){var t=n.updateQueue,s=n.alternate;if(s!==null&&(s=s.updateQueue,t===s)){var r=null,i=null;if(t=t.firstBaseUpdate,t!==null){do{var a={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};i===null?r=i=a:i=i.next=a,t=t.next}while(t!==null);i===null?r=i=e:i=i.next=e}else r=i=e;t={baseState:s.baseState,firstBaseUpdate:r,lastBaseUpdate:i,shared:s.shared,effects:s.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function Gm(n,e,t,s){var r=n.updateQueue;Di=!1;var i=r.firstBaseUpdate,a=r.lastBaseUpdate,o=r.shared.pending;if(o!==null){r.shared.pending=null;var c=o,d=c.next;c.next=null,a===null?i=d:a.next=d,a=c;var h=n.alternate;h!==null&&(h=h.updateQueue,o=h.lastBaseUpdate,o!==a&&(o===null?h.firstBaseUpdate=d:o.next=d,h.lastBaseUpdate=c))}if(i!==null){var f=r.baseState;a=0,h=d=c=null,o=i;do{var m=o.lane,p=o.eventTime;if((s&m)===m){h!==null&&(h=h.next={eventTime:p,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var g=n,y=o;switch(m=e,p=t,y.tag){case 1:if(g=y.payload,typeof g=="function"){f=g.call(p,f,m);break e}f=g;break e;case 3:g.flags=g.flags&-65537|128;case 0:if(g=y.payload,m=typeof g=="function"?g.call(p,f,m):g,m==null)break e;f=xt({},f,m);break e;case 2:Di=!0}}o.callback!==null&&o.lane!==0&&(n.flags|=64,m=r.effects,m===null?r.effects=[o]:m.push(o))}else p={eventTime:p,lane:m,tag:o.tag,payload:o.payload,callback:o.callback,next:null},h===null?(d=h=p,c=f):h=h.next=p,a|=m;if(o=o.next,o===null){if(o=r.shared.pending,o===null)break;m=o,o=m.next,m.next=null,r.lastBaseUpdate=m,r.shared.pending=null}}while(!0);if(h===null&&(c=f),r.baseState=c,r.firstBaseUpdate=d,r.lastBaseUpdate=h,e=r.shared.interleaved,e!==null){r=e;do a|=r.lane,r=r.next;while(r!==e)}else i===null&&(r.shared.lanes=0);al|=a,n.lanes=a,n.memoizedState=f}}function kx(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var s=n[e],r=s.callback;if(r!==null){if(s.callback=null,s=t,typeof r!="function")throw Error(X(191,r));r.call(s)}}}var cf={},Pr=Ia(cf),Sd=Ia(cf),Ad=Ia(cf);function Xa(n){if(n===cf)throw Error(X(174));return n}function Kv(n,e){switch(at(Ad,e),at(Sd,n),at(Pr,cf),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:i0(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=i0(e,n)}ct(Pr),at(Pr,e)}function cu(){ct(Pr),ct(Sd),ct(Ad)}function rS(n){Xa(Ad.current);var e=Xa(Pr.current),t=i0(e,n.type);e!==t&&(at(Sd,n),at(Pr,t))}function Xv(n){Sd.current===n&&(ct(Pr),ct(Sd))}var yt=Ia(0);function Km(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var kg=[];function Yv(){for(var n=0;n<kg.length;n++)kg[n]._workInProgressVersionPrimary=null;kg.length=0}var Xf=Ci.ReactCurrentDispatcher,Eg=Ci.ReactCurrentBatchConfig,il=0,bt=null,Bt=null,Xt=null,Xm=!1,nd=!1,Nd=0,AE=0;function as(){throw Error(X(321))}function Jv(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!ir(n[t],e[t]))return!1;return!0}function Qv(n,e,t,s,r,i){if(il=i,bt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Xf.current=n===null||n.memoizedState===null?CE:jE,n=t(s,r),nd){i=0;do{if(nd=!1,Nd=0,25<=i)throw Error(X(301));i+=1,Xt=Bt=null,e.updateQueue=null,Xf.current=TE,n=t(s,r)}while(nd)}if(Xf.current=Ym,e=Bt!==null&&Bt.next!==null,il=0,Xt=Bt=bt=null,Xm=!1,e)throw Error(X(300));return n}function Zv(){var n=Nd!==0;return Nd=0,n}function hr(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Xt===null?bt.memoizedState=Xt=n:Xt=Xt.next=n,Xt}function Mn(){if(Bt===null){var n=bt.alternate;n=n!==null?n.memoizedState:null}else n=Bt.next;var e=Xt===null?bt.memoizedState:Xt.next;if(e!==null)Xt=e,Bt=n;else{if(n===null)throw Error(X(310));Bt=n,n={memoizedState:Bt.memoizedState,baseState:Bt.baseState,baseQueue:Bt.baseQueue,queue:Bt.queue,next:null},Xt===null?bt.memoizedState=Xt=n:Xt=Xt.next=n}return Xt}function kd(n,e){return typeof e=="function"?e(n):e}function Cg(n){var e=Mn(),t=e.queue;if(t===null)throw Error(X(311));t.lastRenderedReducer=n;var s=Bt,r=s.baseQueue,i=t.pending;if(i!==null){if(r!==null){var a=r.next;r.next=i.next,i.next=a}s.baseQueue=r=i,t.pending=null}if(r!==null){i=r.next,s=s.baseState;var o=a=null,c=null,d=i;do{var h=d.lane;if((il&h)===h)c!==null&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),s=d.hasEagerState?d.eagerState:n(s,d.action);else{var f={lane:h,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};c===null?(o=c=f,a=s):c=c.next=f,bt.lanes|=h,al|=h}d=d.next}while(d!==null&&d!==i);c===null?a=s:c.next=o,ir(s,e.memoizedState)||(qs=!0),e.memoizedState=s,e.baseState=a,e.baseQueue=c,t.lastRenderedState=s}if(n=t.interleaved,n!==null){r=n;do i=r.lane,bt.lanes|=i,al|=i,r=r.next;while(r!==n)}else r===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function jg(n){var e=Mn(),t=e.queue;if(t===null)throw Error(X(311));t.lastRenderedReducer=n;var s=t.dispatch,r=t.pending,i=e.memoizedState;if(r!==null){t.pending=null;var a=r=r.next;do i=n(i,a.action),a=a.next;while(a!==r);ir(i,e.memoizedState)||(qs=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),t.lastRenderedState=i}return[i,s]}function iS(){}function aS(n,e){var t=bt,s=Mn(),r=e(),i=!ir(s.memoizedState,r);if(i&&(s.memoizedState=r,qs=!0),s=s.queue,eb(cS.bind(null,t,s,n),[n]),s.getSnapshot!==e||i||Xt!==null&&Xt.memoizedState.tag&1){if(t.flags|=2048,Ed(9,lS.bind(null,t,s,r,e),void 0,null),Yt===null)throw Error(X(349));il&30||oS(t,e,r)}return r}function oS(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=bt.updateQueue,e===null?(e={lastEffect:null,stores:null},bt.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function lS(n,e,t,s){e.value=t,e.getSnapshot=s,uS(e)&&dS(n)}function cS(n,e,t){return t(function(){uS(e)&&dS(n)})}function uS(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!ir(n,t)}catch{return!0}}function dS(n){var e=Ai(n,1);e!==null&&rr(e,n,1,-1)}function Ex(n){var e=hr();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:kd,lastRenderedState:n},e.queue=n,n=n.dispatch=EE.bind(null,bt,n),[e.memoizedState,n]}function Ed(n,e,t,s){return n={tag:n,create:e,destroy:t,deps:s,next:null},e=bt.updateQueue,e===null?(e={lastEffect:null,stores:null},bt.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(s=t.next,t.next=n,n.next=s,e.lastEffect=n)),n}function hS(){return Mn().memoizedState}function Yf(n,e,t,s){var r=hr();bt.flags|=n,r.memoizedState=Ed(1|e,t,void 0,s===void 0?null:s)}function $p(n,e,t,s){var r=Mn();s=s===void 0?null:s;var i=void 0;if(Bt!==null){var a=Bt.memoizedState;if(i=a.destroy,s!==null&&Jv(s,a.deps)){r.memoizedState=Ed(e,t,i,s);return}}bt.flags|=n,r.memoizedState=Ed(1|e,t,i,s)}function Cx(n,e){return Yf(8390656,8,n,e)}function eb(n,e){return $p(2048,8,n,e)}function fS(n,e){return $p(4,2,n,e)}function mS(n,e){return $p(4,4,n,e)}function pS(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function gS(n,e,t){return t=t!=null?t.concat([n]):null,$p(4,4,pS.bind(null,e,n),t)}function tb(){}function yS(n,e){var t=Mn();e=e===void 0?null:e;var s=t.memoizedState;return s!==null&&e!==null&&Jv(e,s[1])?s[0]:(t.memoizedState=[n,e],n)}function vS(n,e){var t=Mn();e=e===void 0?null:e;var s=t.memoizedState;return s!==null&&e!==null&&Jv(e,s[1])?s[0]:(n=n(),t.memoizedState=[n,e],n)}function bS(n,e,t){return il&21?(ir(t,e)||(t=A_(),bt.lanes|=t,al|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,qs=!0),n.memoizedState=t)}function NE(n,e){var t=Ye;Ye=t!==0&&4>t?t:4,n(!0);var s=Eg.transition;Eg.transition={};try{n(!1),e()}finally{Ye=t,Eg.transition=s}}function xS(){return Mn().memoizedState}function kE(n,e,t){var s=Sa(n);if(t={lane:s,action:t,hasEagerState:!1,eagerState:null,next:null},wS(n))_S(e,t);else if(t=sS(n,e,t,s),t!==null){var r=Es();rr(t,n,s,r),SS(t,e,s)}}function EE(n,e,t){var s=Sa(n),r={lane:s,action:t,hasEagerState:!1,eagerState:null,next:null};if(wS(n))_S(e,r);else{var i=n.alternate;if(n.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var a=e.lastRenderedState,o=i(a,t);if(r.hasEagerState=!0,r.eagerState=o,ir(o,a)){var c=e.interleaved;c===null?(r.next=r,Vv(e)):(r.next=c.next,c.next=r),e.interleaved=r;return}}catch{}finally{}t=sS(n,e,r,s),t!==null&&(r=Es(),rr(t,n,s,r),SS(t,e,s))}}function wS(n){var e=n.alternate;return n===bt||e!==null&&e===bt}function _S(n,e){nd=Xm=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function SS(n,e,t){if(t&4194240){var s=e.lanes;s&=n.pendingLanes,t|=s,e.lanes=t,Iv(n,t)}}var Ym={readContext:Dn,useCallback:as,useContext:as,useEffect:as,useImperativeHandle:as,useInsertionEffect:as,useLayoutEffect:as,useMemo:as,useReducer:as,useRef:as,useState:as,useDebugValue:as,useDeferredValue:as,useTransition:as,useMutableSource:as,useSyncExternalStore:as,useId:as,unstable_isNewReconciler:!1},CE={readContext:Dn,useCallback:function(n,e){return hr().memoizedState=[n,e===void 0?null:e],n},useContext:Dn,useEffect:Cx,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,Yf(4194308,4,pS.bind(null,e,n),t)},useLayoutEffect:function(n,e){return Yf(4194308,4,n,e)},useInsertionEffect:function(n,e){return Yf(4,2,n,e)},useMemo:function(n,e){var t=hr();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var s=hr();return e=t!==void 0?t(e):e,s.memoizedState=s.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},s.queue=n,n=n.dispatch=kE.bind(null,bt,n),[s.memoizedState,n]},useRef:function(n){var e=hr();return n={current:n},e.memoizedState=n},useState:Ex,useDebugValue:tb,useDeferredValue:function(n){return hr().memoizedState=n},useTransition:function(){var n=Ex(!1),e=n[0];return n=NE.bind(null,n[1]),hr().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var s=bt,r=hr();if(mt){if(t===void 0)throw Error(X(407));t=t()}else{if(t=e(),Yt===null)throw Error(X(349));il&30||oS(s,e,t)}r.memoizedState=t;var i={value:t,getSnapshot:e};return r.queue=i,Cx(cS.bind(null,s,i,n),[n]),s.flags|=2048,Ed(9,lS.bind(null,s,i,t,e),void 0,null),t},useId:function(){var n=hr(),e=Yt.identifierPrefix;if(mt){var t=vi,s=yi;t=(s&~(1<<32-nr(s)-1)).toString(32)+t,e=":"+e+"R"+t,t=Nd++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=AE++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},jE={readContext:Dn,useCallback:yS,useContext:Dn,useEffect:eb,useImperativeHandle:gS,useInsertionEffect:fS,useLayoutEffect:mS,useMemo:vS,useReducer:Cg,useRef:hS,useState:function(){return Cg(kd)},useDebugValue:tb,useDeferredValue:function(n){var e=Mn();return bS(e,Bt.memoizedState,n)},useTransition:function(){var n=Cg(kd)[0],e=Mn().memoizedState;return[n,e]},useMutableSource:iS,useSyncExternalStore:aS,useId:xS,unstable_isNewReconciler:!1},TE={readContext:Dn,useCallback:yS,useContext:Dn,useEffect:eb,useImperativeHandle:gS,useInsertionEffect:fS,useLayoutEffect:mS,useMemo:vS,useReducer:jg,useRef:hS,useState:function(){return jg(kd)},useDebugValue:tb,useDeferredValue:function(n){var e=Mn();return Bt===null?e.memoizedState=n:bS(e,Bt.memoizedState,n)},useTransition:function(){var n=jg(kd)[0],e=Mn().memoizedState;return[n,e]},useMutableSource:iS,useSyncExternalStore:aS,useId:xS,unstable_isNewReconciler:!1};function $n(n,e){if(n&&n.defaultProps){e=xt({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function k0(n,e,t,s){e=n.memoizedState,t=t(s,e),t=t==null?e:xt({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var Bp={isMounted:function(n){return(n=n._reactInternals)?fl(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var s=Es(),r=Sa(n),i=bi(s,r);i.payload=e,t!=null&&(i.callback=t),e=wa(n,i,r),e!==null&&(rr(e,n,r,s),Kf(e,n,r))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var s=Es(),r=Sa(n),i=bi(s,r);i.tag=1,i.payload=e,t!=null&&(i.callback=t),e=wa(n,i,r),e!==null&&(rr(e,n,r,s),Kf(e,n,r))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=Es(),s=Sa(n),r=bi(t,s);r.tag=2,e!=null&&(r.callback=e),e=wa(n,r,s),e!==null&&(rr(e,n,s,t),Kf(e,n,s))}};function jx(n,e,t,s,r,i,a){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(s,i,a):e.prototype&&e.prototype.isPureReactComponent?!bd(t,s)||!bd(r,i):!0}function AS(n,e,t){var s=!1,r=Ea,i=e.contextType;return typeof i=="object"&&i!==null?i=Dn(i):(r=Vs(e)?nl:vs.current,s=e.contextTypes,i=(s=s!=null)?au(n,r):Ea),e=new e(t,i),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Bp,n.stateNode=e,e._reactInternals=n,s&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=r,n.__reactInternalMemoizedMaskedChildContext=i),e}function Tx(n,e,t,s){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,s),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,s),e.state!==n&&Bp.enqueueReplaceState(e,e.state,null)}function E0(n,e,t,s){var r=n.stateNode;r.props=t,r.state=n.memoizedState,r.refs={},Gv(n);var i=e.contextType;typeof i=="object"&&i!==null?r.context=Dn(i):(i=Vs(e)?nl:vs.current,r.context=au(n,i)),r.state=n.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(k0(n,e,i,t),r.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&Bp.enqueueReplaceState(r,r.state,null),Gm(n,t,r,s),r.state=n.memoizedState),typeof r.componentDidMount=="function"&&(n.flags|=4194308)}function uu(n,e){try{var t="",s=e;do t+=rk(s),s=s.return;while(s);var r=t}catch(i){r=`
Error generating stack: `+i.message+`
`+i.stack}return{value:n,source:e,stack:r,digest:null}}function Tg(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function C0(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var RE=typeof WeakMap=="function"?WeakMap:Map;function NS(n,e,t){t=bi(-1,t),t.tag=3,t.payload={element:null};var s=e.value;return t.callback=function(){Qm||(Qm=!0,F0=s),C0(n,e)},t}function kS(n,e,t){t=bi(-1,t),t.tag=3;var s=n.type.getDerivedStateFromError;if(typeof s=="function"){var r=e.value;t.payload=function(){return s(r)},t.callback=function(){C0(n,e)}}var i=n.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(t.callback=function(){C0(n,e),typeof s!="function"&&(_a===null?_a=new Set([this]):_a.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),t}function Rx(n,e,t){var s=n.pingCache;if(s===null){s=n.pingCache=new RE;var r=new Set;s.set(e,r)}else r=s.get(e),r===void 0&&(r=new Set,s.set(e,r));r.has(t)||(r.add(t),n=WE.bind(null,n,e,t),e.then(n,n))}function Ix(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function Px(n,e,t,s,r){return n.mode&1?(n.flags|=65536,n.lanes=r,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=bi(-1,1),e.tag=2,wa(t,e,1))),t.lanes|=1),n)}var IE=Ci.ReactCurrentOwner,qs=!1;function ks(n,e,t,s){e.child=n===null?tS(e,null,t,s):lu(e,n.child,t,s)}function Dx(n,e,t,s,r){t=t.render;var i=e.ref;return Yl(e,r),s=Qv(n,e,t,s,i,r),t=Zv(),n!==null&&!qs?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~r,Ni(n,e,r)):(mt&&t&&Bv(e),e.flags|=1,ks(n,e,s,r),e.child)}function Mx(n,e,t,s,r){if(n===null){var i=t.type;return typeof i=="function"&&!cb(i)&&i.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=i,ES(n,e,i,s,r)):(n=em(t.type,null,s,e,e.mode,r),n.ref=e.ref,n.return=e,e.child=n)}if(i=n.child,!(n.lanes&r)){var a=i.memoizedProps;if(t=t.compare,t=t!==null?t:bd,t(a,s)&&n.ref===e.ref)return Ni(n,e,r)}return e.flags|=1,n=Aa(i,s),n.ref=e.ref,n.return=e,e.child=n}function ES(n,e,t,s,r){if(n!==null){var i=n.memoizedProps;if(bd(i,s)&&n.ref===e.ref)if(qs=!1,e.pendingProps=s=i,(n.lanes&r)!==0)n.flags&131072&&(qs=!0);else return e.lanes=n.lanes,Ni(n,e,r)}return j0(n,e,t,s,r)}function CS(n,e,t){var s=e.pendingProps,r=s.children,i=n!==null?n.memoizedState:null;if(s.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},at(zl,cn),cn|=t;else{if(!(t&1073741824))return n=i!==null?i.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,at(zl,cn),cn|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},s=i!==null?i.baseLanes:t,at(zl,cn),cn|=s}else i!==null?(s=i.baseLanes|t,e.memoizedState=null):s=t,at(zl,cn),cn|=s;return ks(n,e,r,t),e.child}function jS(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function j0(n,e,t,s,r){var i=Vs(t)?nl:vs.current;return i=au(e,i),Yl(e,r),t=Qv(n,e,t,s,i,r),s=Zv(),n!==null&&!qs?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~r,Ni(n,e,r)):(mt&&s&&Bv(e),e.flags|=1,ks(n,e,t,r),e.child)}function Lx(n,e,t,s,r){if(Vs(t)){var i=!0;zm(e)}else i=!1;if(Yl(e,r),e.stateNode===null)Jf(n,e),AS(e,t,s),E0(e,t,s,r),s=!0;else if(n===null){var a=e.stateNode,o=e.memoizedProps;a.props=o;var c=a.context,d=t.contextType;typeof d=="object"&&d!==null?d=Dn(d):(d=Vs(t)?nl:vs.current,d=au(e,d));var h=t.getDerivedStateFromProps,f=typeof h=="function"||typeof a.getSnapshotBeforeUpdate=="function";f||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==s||c!==d)&&Tx(e,a,s,d),Di=!1;var m=e.memoizedState;a.state=m,Gm(e,s,a,r),c=e.memoizedState,o!==s||m!==c||Ws.current||Di?(typeof h=="function"&&(k0(e,t,h,s),c=e.memoizedState),(o=Di||jx(e,t,o,s,m,c,d))?(f||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=s,e.memoizedState=c),a.props=s,a.state=c,a.context=d,s=o):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),s=!1)}else{a=e.stateNode,nS(n,e),o=e.memoizedProps,d=e.type===e.elementType?o:$n(e.type,o),a.props=d,f=e.pendingProps,m=a.context,c=t.contextType,typeof c=="object"&&c!==null?c=Dn(c):(c=Vs(t)?nl:vs.current,c=au(e,c));var p=t.getDerivedStateFromProps;(h=typeof p=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==f||m!==c)&&Tx(e,a,s,c),Di=!1,m=e.memoizedState,a.state=m,Gm(e,s,a,r);var g=e.memoizedState;o!==f||m!==g||Ws.current||Di?(typeof p=="function"&&(k0(e,t,p,s),g=e.memoizedState),(d=Di||jx(e,t,d,s,m,g,c)||!1)?(h||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(s,g,c),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(s,g,c)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||o===n.memoizedProps&&m===n.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===n.memoizedProps&&m===n.memoizedState||(e.flags|=1024),e.memoizedProps=s,e.memoizedState=g),a.props=s,a.state=g,a.context=c,s=d):(typeof a.componentDidUpdate!="function"||o===n.memoizedProps&&m===n.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===n.memoizedProps&&m===n.memoizedState||(e.flags|=1024),s=!1)}return T0(n,e,t,s,i,r)}function T0(n,e,t,s,r,i){jS(n,e);var a=(e.flags&128)!==0;if(!s&&!a)return r&&wx(e,t,!1),Ni(n,e,i);s=e.stateNode,IE.current=e;var o=a&&typeof t.getDerivedStateFromError!="function"?null:s.render();return e.flags|=1,n!==null&&a?(e.child=lu(e,n.child,null,i),e.child=lu(e,null,o,i)):ks(n,e,o,i),e.memoizedState=s.state,r&&wx(e,t,!0),e.child}function TS(n){var e=n.stateNode;e.pendingContext?xx(n,e.pendingContext,e.pendingContext!==e.context):e.context&&xx(n,e.context,!1),Kv(n,e.containerInfo)}function Ox(n,e,t,s,r){return ou(),zv(r),e.flags|=256,ks(n,e,t,s),e.child}var R0={dehydrated:null,treeContext:null,retryLane:0};function I0(n){return{baseLanes:n,cachePool:null,transitions:null}}function RS(n,e,t){var s=e.pendingProps,r=yt.current,i=!1,a=(e.flags&128)!==0,o;if((o=a)||(o=n!==null&&n.memoizedState===null?!1:(r&2)!==0),o?(i=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(r|=1),at(yt,r&1),n===null)return A0(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(a=s.children,n=s.fallback,i?(s=e.mode,i=e.child,a={mode:"hidden",children:a},!(s&1)&&i!==null?(i.childLanes=0,i.pendingProps=a):i=Hp(a,s,0,null),n=sl(n,s,t,null),i.return=e,n.return=e,i.sibling=n,e.child=i,e.child.memoizedState=I0(t),e.memoizedState=R0,n):sb(e,a));if(r=n.memoizedState,r!==null&&(o=r.dehydrated,o!==null))return PE(n,e,a,s,o,r,t);if(i){i=s.fallback,a=e.mode,r=n.child,o=r.sibling;var c={mode:"hidden",children:s.children};return!(a&1)&&e.child!==r?(s=e.child,s.childLanes=0,s.pendingProps=c,e.deletions=null):(s=Aa(r,c),s.subtreeFlags=r.subtreeFlags&14680064),o!==null?i=Aa(o,i):(i=sl(i,a,t,null),i.flags|=2),i.return=e,s.return=e,s.sibling=i,e.child=s,s=i,i=e.child,a=n.child.memoizedState,a=a===null?I0(t):{baseLanes:a.baseLanes|t,cachePool:null,transitions:a.transitions},i.memoizedState=a,i.childLanes=n.childLanes&~t,e.memoizedState=R0,s}return i=n.child,n=i.sibling,s=Aa(i,{mode:"visible",children:s.children}),!(e.mode&1)&&(s.lanes=t),s.return=e,s.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=s,e.memoizedState=null,s}function sb(n,e){return e=Hp({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function Tf(n,e,t,s){return s!==null&&zv(s),lu(e,n.child,null,t),n=sb(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function PE(n,e,t,s,r,i,a){if(t)return e.flags&256?(e.flags&=-257,s=Tg(Error(X(422))),Tf(n,e,a,s)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(i=s.fallback,r=e.mode,s=Hp({mode:"visible",children:s.children},r,0,null),i=sl(i,r,a,null),i.flags|=2,s.return=e,i.return=e,s.sibling=i,e.child=s,e.mode&1&&lu(e,n.child,null,a),e.child.memoizedState=I0(a),e.memoizedState=R0,i);if(!(e.mode&1))return Tf(n,e,a,null);if(r.data==="$!"){if(s=r.nextSibling&&r.nextSibling.dataset,s)var o=s.dgst;return s=o,i=Error(X(419)),s=Tg(i,s,void 0),Tf(n,e,a,s)}if(o=(a&n.childLanes)!==0,qs||o){if(s=Yt,s!==null){switch(a&-a){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(s.suspendedLanes|a)?0:r,r!==0&&r!==i.retryLane&&(i.retryLane=r,Ai(n,r),rr(s,n,r,-1))}return lb(),s=Tg(Error(X(421))),Tf(n,e,a,s)}return r.data==="$?"?(e.flags|=128,e.child=n.child,e=VE.bind(null,n),r._reactRetry=e,null):(n=i.treeContext,hn=xa(r.nextSibling),fn=e,mt=!0,tr=null,n!==null&&(kn[En++]=yi,kn[En++]=vi,kn[En++]=rl,yi=n.id,vi=n.overflow,rl=e),e=sb(e,s.children),e.flags|=4096,e)}function Fx(n,e,t){n.lanes|=e;var s=n.alternate;s!==null&&(s.lanes|=e),N0(n.return,e,t)}function Rg(n,e,t,s,r){var i=n.memoizedState;i===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:s,tail:t,tailMode:r}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=s,i.tail=t,i.tailMode=r)}function IS(n,e,t){var s=e.pendingProps,r=s.revealOrder,i=s.tail;if(ks(n,e,s.children,t),s=yt.current,s&2)s=s&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&Fx(n,t,e);else if(n.tag===19)Fx(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}s&=1}if(at(yt,s),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(t=e.child,r=null;t!==null;)n=t.alternate,n!==null&&Km(n)===null&&(r=t),t=t.sibling;t=r,t===null?(r=e.child,e.child=null):(r=t.sibling,t.sibling=null),Rg(e,!1,r,t,i);break;case"backwards":for(t=null,r=e.child,e.child=null;r!==null;){if(n=r.alternate,n!==null&&Km(n)===null){e.child=r;break}n=r.sibling,r.sibling=t,t=r,r=n}Rg(e,!0,t,null,i);break;case"together":Rg(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Jf(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function Ni(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),al|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(X(153));if(e.child!==null){for(n=e.child,t=Aa(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=Aa(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function DE(n,e,t){switch(e.tag){case 3:TS(e),ou();break;case 5:rS(e);break;case 1:Vs(e.type)&&zm(e);break;case 4:Kv(e,e.stateNode.containerInfo);break;case 10:var s=e.type._context,r=e.memoizedProps.value;at(Wm,s._currentValue),s._currentValue=r;break;case 13:if(s=e.memoizedState,s!==null)return s.dehydrated!==null?(at(yt,yt.current&1),e.flags|=128,null):t&e.child.childLanes?RS(n,e,t):(at(yt,yt.current&1),n=Ni(n,e,t),n!==null?n.sibling:null);at(yt,yt.current&1);break;case 19:if(s=(t&e.childLanes)!==0,n.flags&128){if(s)return IS(n,e,t);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),at(yt,yt.current),s)break;return null;case 22:case 23:return e.lanes=0,CS(n,e,t)}return Ni(n,e,t)}var PS,P0,DS,MS;PS=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};P0=function(){};DS=function(n,e,t,s){var r=n.memoizedProps;if(r!==s){n=e.stateNode,Xa(Pr.current);var i=null;switch(t){case"input":r=t0(n,r),s=t0(n,s),i=[];break;case"select":r=xt({},r,{value:void 0}),s=xt({},s,{value:void 0}),i=[];break;case"textarea":r=r0(n,r),s=r0(n,s),i=[];break;default:typeof r.onClick!="function"&&typeof s.onClick=="function"&&(n.onclick=Bm)}a0(t,s);var a;t=null;for(d in r)if(!s.hasOwnProperty(d)&&r.hasOwnProperty(d)&&r[d]!=null)if(d==="style"){var o=r[d];for(a in o)o.hasOwnProperty(a)&&(t||(t={}),t[a]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(hd.hasOwnProperty(d)?i||(i=[]):(i=i||[]).push(d,null));for(d in s){var c=s[d];if(o=r!=null?r[d]:void 0,s.hasOwnProperty(d)&&c!==o&&(c!=null||o!=null))if(d==="style")if(o){for(a in o)!o.hasOwnProperty(a)||c&&c.hasOwnProperty(a)||(t||(t={}),t[a]="");for(a in c)c.hasOwnProperty(a)&&o[a]!==c[a]&&(t||(t={}),t[a]=c[a])}else t||(i||(i=[]),i.push(d,t)),t=c;else d==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,o=o?o.__html:void 0,c!=null&&o!==c&&(i=i||[]).push(d,c)):d==="children"?typeof c!="string"&&typeof c!="number"||(i=i||[]).push(d,""+c):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(hd.hasOwnProperty(d)?(c!=null&&d==="onScroll"&&ot("scroll",n),i||o===c||(i=[])):(i=i||[]).push(d,c))}t&&(i=i||[]).push("style",t);var d=i;(e.updateQueue=d)&&(e.flags|=4)}};MS=function(n,e,t,s){t!==s&&(e.flags|=4)};function Au(n,e){if(!mt)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var s=null;t!==null;)t.alternate!==null&&(s=t),t=t.sibling;s===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:s.sibling=null}}function os(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,s=0;if(e)for(var r=n.child;r!==null;)t|=r.lanes|r.childLanes,s|=r.subtreeFlags&14680064,s|=r.flags&14680064,r.return=n,r=r.sibling;else for(r=n.child;r!==null;)t|=r.lanes|r.childLanes,s|=r.subtreeFlags,s|=r.flags,r.return=n,r=r.sibling;return n.subtreeFlags|=s,n.childLanes=t,e}function ME(n,e,t){var s=e.pendingProps;switch(Uv(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return os(e),null;case 1:return Vs(e.type)&&Um(),os(e),null;case 3:return s=e.stateNode,cu(),ct(Ws),ct(vs),Yv(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(n===null||n.child===null)&&(Cf(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,tr!==null&&(U0(tr),tr=null))),P0(n,e),os(e),null;case 5:Xv(e);var r=Xa(Ad.current);if(t=e.type,n!==null&&e.stateNode!=null)DS(n,e,t,s,r),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!s){if(e.stateNode===null)throw Error(X(166));return os(e),null}if(n=Xa(Pr.current),Cf(e)){s=e.stateNode,t=e.type;var i=e.memoizedProps;switch(s[Rr]=e,s[_d]=i,n=(e.mode&1)!==0,t){case"dialog":ot("cancel",s),ot("close",s);break;case"iframe":case"object":case"embed":ot("load",s);break;case"video":case"audio":for(r=0;r<Du.length;r++)ot(Du[r],s);break;case"source":ot("error",s);break;case"img":case"image":case"link":ot("error",s),ot("load",s);break;case"details":ot("toggle",s);break;case"input":Gb(s,i),ot("invalid",s);break;case"select":s._wrapperState={wasMultiple:!!i.multiple},ot("invalid",s);break;case"textarea":Xb(s,i),ot("invalid",s)}a0(t,i),r=null;for(var a in i)if(i.hasOwnProperty(a)){var o=i[a];a==="children"?typeof o=="string"?s.textContent!==o&&(i.suppressHydrationWarning!==!0&&Ef(s.textContent,o,n),r=["children",o]):typeof o=="number"&&s.textContent!==""+o&&(i.suppressHydrationWarning!==!0&&Ef(s.textContent,o,n),r=["children",""+o]):hd.hasOwnProperty(a)&&o!=null&&a==="onScroll"&&ot("scroll",s)}switch(t){case"input":bf(s),Kb(s,i,!0);break;case"textarea":bf(s),Yb(s);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(s.onclick=Bm)}s=r,e.updateQueue=s,s!==null&&(e.flags|=4)}else{a=r.nodeType===9?r:r.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=c_(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=a.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof s.is=="string"?n=a.createElement(t,{is:s.is}):(n=a.createElement(t),t==="select"&&(a=n,s.multiple?a.multiple=!0:s.size&&(a.size=s.size))):n=a.createElementNS(n,t),n[Rr]=e,n[_d]=s,PS(n,e,!1,!1),e.stateNode=n;e:{switch(a=o0(t,s),t){case"dialog":ot("cancel",n),ot("close",n),r=s;break;case"iframe":case"object":case"embed":ot("load",n),r=s;break;case"video":case"audio":for(r=0;r<Du.length;r++)ot(Du[r],n);r=s;break;case"source":ot("error",n),r=s;break;case"img":case"image":case"link":ot("error",n),ot("load",n),r=s;break;case"details":ot("toggle",n),r=s;break;case"input":Gb(n,s),r=t0(n,s),ot("invalid",n);break;case"option":r=s;break;case"select":n._wrapperState={wasMultiple:!!s.multiple},r=xt({},s,{value:void 0}),ot("invalid",n);break;case"textarea":Xb(n,s),r=r0(n,s),ot("invalid",n);break;default:r=s}a0(t,r),o=r;for(i in o)if(o.hasOwnProperty(i)){var c=o[i];i==="style"?h_(n,c):i==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&u_(n,c)):i==="children"?typeof c=="string"?(t!=="textarea"||c!=="")&&fd(n,c):typeof c=="number"&&fd(n,""+c):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(hd.hasOwnProperty(i)?c!=null&&i==="onScroll"&&ot("scroll",n):c!=null&&kv(n,i,c,a))}switch(t){case"input":bf(n),Kb(n,s,!1);break;case"textarea":bf(n),Yb(n);break;case"option":s.value!=null&&n.setAttribute("value",""+ka(s.value));break;case"select":n.multiple=!!s.multiple,i=s.value,i!=null?Vl(n,!!s.multiple,i,!1):s.defaultValue!=null&&Vl(n,!!s.multiple,s.defaultValue,!0);break;default:typeof r.onClick=="function"&&(n.onclick=Bm)}switch(t){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}}s&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return os(e),null;case 6:if(n&&e.stateNode!=null)MS(n,e,n.memoizedProps,s);else{if(typeof s!="string"&&e.stateNode===null)throw Error(X(166));if(t=Xa(Ad.current),Xa(Pr.current),Cf(e)){if(s=e.stateNode,t=e.memoizedProps,s[Rr]=e,(i=s.nodeValue!==t)&&(n=fn,n!==null))switch(n.tag){case 3:Ef(s.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&Ef(s.nodeValue,t,(n.mode&1)!==0)}i&&(e.flags|=4)}else s=(t.nodeType===9?t:t.ownerDocument).createTextNode(s),s[Rr]=e,e.stateNode=s}return os(e),null;case 13:if(ct(yt),s=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(mt&&hn!==null&&e.mode&1&&!(e.flags&128))Z_(),ou(),e.flags|=98560,i=!1;else if(i=Cf(e),s!==null&&s.dehydrated!==null){if(n===null){if(!i)throw Error(X(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(X(317));i[Rr]=e}else ou(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;os(e),i=!1}else tr!==null&&(U0(tr),tr=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(s=s!==null,s!==(n!==null&&n.memoizedState!==null)&&s&&(e.child.flags|=8192,e.mode&1&&(n===null||yt.current&1?Ut===0&&(Ut=3):lb())),e.updateQueue!==null&&(e.flags|=4),os(e),null);case 4:return cu(),P0(n,e),n===null&&xd(e.stateNode.containerInfo),os(e),null;case 10:return Wv(e.type._context),os(e),null;case 17:return Vs(e.type)&&Um(),os(e),null;case 19:if(ct(yt),i=e.memoizedState,i===null)return os(e),null;if(s=(e.flags&128)!==0,a=i.rendering,a===null)if(s)Au(i,!1);else{if(Ut!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(a=Km(n),a!==null){for(e.flags|=128,Au(i,!1),s=a.updateQueue,s!==null&&(e.updateQueue=s,e.flags|=4),e.subtreeFlags=0,s=t,t=e.child;t!==null;)i=t,n=s,i.flags&=14680066,a=i.alternate,a===null?(i.childLanes=0,i.lanes=n,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=a.childLanes,i.lanes=a.lanes,i.child=a.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=a.memoizedProps,i.memoizedState=a.memoizedState,i.updateQueue=a.updateQueue,i.type=a.type,n=a.dependencies,i.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return at(yt,yt.current&1|2),e.child}n=n.sibling}i.tail!==null&&kt()>du&&(e.flags|=128,s=!0,Au(i,!1),e.lanes=4194304)}else{if(!s)if(n=Km(a),n!==null){if(e.flags|=128,s=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),Au(i,!0),i.tail===null&&i.tailMode==="hidden"&&!a.alternate&&!mt)return os(e),null}else 2*kt()-i.renderingStartTime>du&&t!==1073741824&&(e.flags|=128,s=!0,Au(i,!1),e.lanes=4194304);i.isBackwards?(a.sibling=e.child,e.child=a):(t=i.last,t!==null?t.sibling=a:e.child=a,i.last=a)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=kt(),e.sibling=null,t=yt.current,at(yt,s?t&1|2:t&1),e):(os(e),null);case 22:case 23:return ob(),s=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==s&&(e.flags|=8192),s&&e.mode&1?cn&1073741824&&(os(e),e.subtreeFlags&6&&(e.flags|=8192)):os(e),null;case 24:return null;case 25:return null}throw Error(X(156,e.tag))}function LE(n,e){switch(Uv(e),e.tag){case 1:return Vs(e.type)&&Um(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return cu(),ct(Ws),ct(vs),Yv(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return Xv(e),null;case 13:if(ct(yt),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(X(340));ou()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return ct(yt),null;case 4:return cu(),null;case 10:return Wv(e.type._context),null;case 22:case 23:return ob(),null;case 24:return null;default:return null}}var Rf=!1,gs=!1,OE=typeof WeakSet=="function"?WeakSet:Set,de=null;function Ul(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(s){St(n,e,s)}else t.current=null}function D0(n,e,t){try{t()}catch(s){St(n,e,s)}}var $x=!1;function FE(n,e){if(y0=Om,n=B_(),$v(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var s=t.getSelection&&t.getSelection();if(s&&s.rangeCount!==0){t=s.anchorNode;var r=s.anchorOffset,i=s.focusNode;s=s.focusOffset;try{t.nodeType,i.nodeType}catch{t=null;break e}var a=0,o=-1,c=-1,d=0,h=0,f=n,m=null;t:for(;;){for(var p;f!==t||r!==0&&f.nodeType!==3||(o=a+r),f!==i||s!==0&&f.nodeType!==3||(c=a+s),f.nodeType===3&&(a+=f.nodeValue.length),(p=f.firstChild)!==null;)m=f,f=p;for(;;){if(f===n)break t;if(m===t&&++d===r&&(o=a),m===i&&++h===s&&(c=a),(p=f.nextSibling)!==null)break;f=m,m=f.parentNode}f=p}t=o===-1||c===-1?null:{start:o,end:c}}else t=null}t=t||{start:0,end:0}}else t=null;for(v0={focusedElem:n,selectionRange:t},Om=!1,de=e;de!==null;)if(e=de,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,de=n;else for(;de!==null;){e=de;try{var g=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(g!==null){var y=g.memoizedProps,N=g.memoizedState,b=e.stateNode,x=b.getSnapshotBeforeUpdate(e.elementType===e.type?y:$n(e.type,y),N);b.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var _=e.stateNode.containerInfo;_.nodeType===1?_.textContent="":_.nodeType===9&&_.documentElement&&_.removeChild(_.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(X(163))}}catch(w){St(e,e.return,w)}if(n=e.sibling,n!==null){n.return=e.return,de=n;break}de=e.return}return g=$x,$x=!1,g}function rd(n,e,t){var s=e.updateQueue;if(s=s!==null?s.lastEffect:null,s!==null){var r=s=s.next;do{if((r.tag&n)===n){var i=r.destroy;r.destroy=void 0,i!==void 0&&D0(e,t,i)}r=r.next}while(r!==s)}}function Up(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var s=t.create;t.destroy=s()}t=t.next}while(t!==e)}}function M0(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function LS(n){var e=n.alternate;e!==null&&(n.alternate=null,LS(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[Rr],delete e[_d],delete e[w0],delete e[xE],delete e[wE])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function OS(n){return n.tag===5||n.tag===3||n.tag===4}function Bx(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||OS(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function L0(n,e,t){var s=n.tag;if(s===5||s===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=Bm));else if(s!==4&&(n=n.child,n!==null))for(L0(n,e,t),n=n.sibling;n!==null;)L0(n,e,t),n=n.sibling}function O0(n,e,t){var s=n.tag;if(s===5||s===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(s!==4&&(n=n.child,n!==null))for(O0(n,e,t),n=n.sibling;n!==null;)O0(n,e,t),n=n.sibling}var ss=null,Zn=!1;function ji(n,e,t){for(t=t.child;t!==null;)FS(n,e,t),t=t.sibling}function FS(n,e,t){if(Ir&&typeof Ir.onCommitFiberUnmount=="function")try{Ir.onCommitFiberUnmount(Pp,t)}catch{}switch(t.tag){case 5:gs||Ul(t,e);case 6:var s=ss,r=Zn;ss=null,ji(n,e,t),ss=s,Zn=r,ss!==null&&(Zn?(n=ss,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):ss.removeChild(t.stateNode));break;case 18:ss!==null&&(Zn?(n=ss,t=t.stateNode,n.nodeType===8?Ag(n.parentNode,t):n.nodeType===1&&Ag(n,t),yd(n)):Ag(ss,t.stateNode));break;case 4:s=ss,r=Zn,ss=t.stateNode.containerInfo,Zn=!0,ji(n,e,t),ss=s,Zn=r;break;case 0:case 11:case 14:case 15:if(!gs&&(s=t.updateQueue,s!==null&&(s=s.lastEffect,s!==null))){r=s=s.next;do{var i=r,a=i.destroy;i=i.tag,a!==void 0&&(i&2||i&4)&&D0(t,e,a),r=r.next}while(r!==s)}ji(n,e,t);break;case 1:if(!gs&&(Ul(t,e),s=t.stateNode,typeof s.componentWillUnmount=="function"))try{s.props=t.memoizedProps,s.state=t.memoizedState,s.componentWillUnmount()}catch(o){St(t,e,o)}ji(n,e,t);break;case 21:ji(n,e,t);break;case 22:t.mode&1?(gs=(s=gs)||t.memoizedState!==null,ji(n,e,t),gs=s):ji(n,e,t);break;default:ji(n,e,t)}}function Ux(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new OE),e.forEach(function(s){var r=GE.bind(null,n,s);t.has(s)||(t.add(s),s.then(r,r))})}}function Ln(n,e){var t=e.deletions;if(t!==null)for(var s=0;s<t.length;s++){var r=t[s];try{var i=n,a=e,o=a;e:for(;o!==null;){switch(o.tag){case 5:ss=o.stateNode,Zn=!1;break e;case 3:ss=o.stateNode.containerInfo,Zn=!0;break e;case 4:ss=o.stateNode.containerInfo,Zn=!0;break e}o=o.return}if(ss===null)throw Error(X(160));FS(i,a,r),ss=null,Zn=!1;var c=r.alternate;c!==null&&(c.return=null),r.return=null}catch(d){St(r,e,d)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)$S(e,n),e=e.sibling}function $S(n,e){var t=n.alternate,s=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(Ln(e,n),lr(n),s&4){try{rd(3,n,n.return),Up(3,n)}catch(y){St(n,n.return,y)}try{rd(5,n,n.return)}catch(y){St(n,n.return,y)}}break;case 1:Ln(e,n),lr(n),s&512&&t!==null&&Ul(t,t.return);break;case 5:if(Ln(e,n),lr(n),s&512&&t!==null&&Ul(t,t.return),n.flags&32){var r=n.stateNode;try{fd(r,"")}catch(y){St(n,n.return,y)}}if(s&4&&(r=n.stateNode,r!=null)){var i=n.memoizedProps,a=t!==null?t.memoizedProps:i,o=n.type,c=n.updateQueue;if(n.updateQueue=null,c!==null)try{o==="input"&&i.type==="radio"&&i.name!=null&&o_(r,i),o0(o,a);var d=o0(o,i);for(a=0;a<c.length;a+=2){var h=c[a],f=c[a+1];h==="style"?h_(r,f):h==="dangerouslySetInnerHTML"?u_(r,f):h==="children"?fd(r,f):kv(r,h,f,d)}switch(o){case"input":s0(r,i);break;case"textarea":l_(r,i);break;case"select":var m=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!i.multiple;var p=i.value;p!=null?Vl(r,!!i.multiple,p,!1):m!==!!i.multiple&&(i.defaultValue!=null?Vl(r,!!i.multiple,i.defaultValue,!0):Vl(r,!!i.multiple,i.multiple?[]:"",!1))}r[_d]=i}catch(y){St(n,n.return,y)}}break;case 6:if(Ln(e,n),lr(n),s&4){if(n.stateNode===null)throw Error(X(162));r=n.stateNode,i=n.memoizedProps;try{r.nodeValue=i}catch(y){St(n,n.return,y)}}break;case 3:if(Ln(e,n),lr(n),s&4&&t!==null&&t.memoizedState.isDehydrated)try{yd(e.containerInfo)}catch(y){St(n,n.return,y)}break;case 4:Ln(e,n),lr(n);break;case 13:Ln(e,n),lr(n),r=n.child,r.flags&8192&&(i=r.memoizedState!==null,r.stateNode.isHidden=i,!i||r.alternate!==null&&r.alternate.memoizedState!==null||(ib=kt())),s&4&&Ux(n);break;case 22:if(h=t!==null&&t.memoizedState!==null,n.mode&1?(gs=(d=gs)||h,Ln(e,n),gs=d):Ln(e,n),lr(n),s&8192){if(d=n.memoizedState!==null,(n.stateNode.isHidden=d)&&!h&&n.mode&1)for(de=n,h=n.child;h!==null;){for(f=de=h;de!==null;){switch(m=de,p=m.child,m.tag){case 0:case 11:case 14:case 15:rd(4,m,m.return);break;case 1:Ul(m,m.return);var g=m.stateNode;if(typeof g.componentWillUnmount=="function"){s=m,t=m.return;try{e=s,g.props=e.memoizedProps,g.state=e.memoizedState,g.componentWillUnmount()}catch(y){St(s,t,y)}}break;case 5:Ul(m,m.return);break;case 22:if(m.memoizedState!==null){Hx(f);continue}}p!==null?(p.return=m,de=p):Hx(f)}h=h.sibling}e:for(h=null,f=n;;){if(f.tag===5){if(h===null){h=f;try{r=f.stateNode,d?(i=r.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(o=f.stateNode,c=f.memoizedProps.style,a=c!=null&&c.hasOwnProperty("display")?c.display:null,o.style.display=d_("display",a))}catch(y){St(n,n.return,y)}}}else if(f.tag===6){if(h===null)try{f.stateNode.nodeValue=d?"":f.memoizedProps}catch(y){St(n,n.return,y)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===n)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===n)break e;for(;f.sibling===null;){if(f.return===null||f.return===n)break e;h===f&&(h=null),f=f.return}h===f&&(h=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:Ln(e,n),lr(n),s&4&&Ux(n);break;case 21:break;default:Ln(e,n),lr(n)}}function lr(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(OS(t)){var s=t;break e}t=t.return}throw Error(X(160))}switch(s.tag){case 5:var r=s.stateNode;s.flags&32&&(fd(r,""),s.flags&=-33);var i=Bx(n);O0(n,i,r);break;case 3:case 4:var a=s.stateNode.containerInfo,o=Bx(n);L0(n,o,a);break;default:throw Error(X(161))}}catch(c){St(n,n.return,c)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function $E(n,e,t){de=n,BS(n)}function BS(n,e,t){for(var s=(n.mode&1)!==0;de!==null;){var r=de,i=r.child;if(r.tag===22&&s){var a=r.memoizedState!==null||Rf;if(!a){var o=r.alternate,c=o!==null&&o.memoizedState!==null||gs;o=Rf;var d=gs;if(Rf=a,(gs=c)&&!d)for(de=r;de!==null;)a=de,c=a.child,a.tag===22&&a.memoizedState!==null?qx(r):c!==null?(c.return=a,de=c):qx(r);for(;i!==null;)de=i,BS(i),i=i.sibling;de=r,Rf=o,gs=d}zx(n)}else r.subtreeFlags&8772&&i!==null?(i.return=r,de=i):zx(n)}}function zx(n){for(;de!==null;){var e=de;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:gs||Up(5,e);break;case 1:var s=e.stateNode;if(e.flags&4&&!gs)if(t===null)s.componentDidMount();else{var r=e.elementType===e.type?t.memoizedProps:$n(e.type,t.memoizedProps);s.componentDidUpdate(r,t.memoizedState,s.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&kx(e,i,s);break;case 3:var a=e.updateQueue;if(a!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}kx(e,a,t)}break;case 5:var o=e.stateNode;if(t===null&&e.flags&4){t=o;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&t.focus();break;case"img":c.src&&(t.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var d=e.alternate;if(d!==null){var h=d.memoizedState;if(h!==null){var f=h.dehydrated;f!==null&&yd(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(X(163))}gs||e.flags&512&&M0(e)}catch(m){St(e,e.return,m)}}if(e===n){de=null;break}if(t=e.sibling,t!==null){t.return=e.return,de=t;break}de=e.return}}function Hx(n){for(;de!==null;){var e=de;if(e===n){de=null;break}var t=e.sibling;if(t!==null){t.return=e.return,de=t;break}de=e.return}}function qx(n){for(;de!==null;){var e=de;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{Up(4,e)}catch(c){St(e,t,c)}break;case 1:var s=e.stateNode;if(typeof s.componentDidMount=="function"){var r=e.return;try{s.componentDidMount()}catch(c){St(e,r,c)}}var i=e.return;try{M0(e)}catch(c){St(e,i,c)}break;case 5:var a=e.return;try{M0(e)}catch(c){St(e,a,c)}}}catch(c){St(e,e.return,c)}if(e===n){de=null;break}var o=e.sibling;if(o!==null){o.return=e.return,de=o;break}de=e.return}}var BE=Math.ceil,Jm=Ci.ReactCurrentDispatcher,nb=Ci.ReactCurrentOwner,Rn=Ci.ReactCurrentBatchConfig,Ue=0,Yt=null,Tt=null,rs=0,cn=0,zl=Ia(0),Ut=0,Cd=null,al=0,zp=0,rb=0,id=null,Us=null,ib=0,du=1/0,Br=null,Qm=!1,F0=null,_a=null,If=!1,ga=null,Zm=0,ad=0,$0=null,Qf=-1,Zf=0;function Es(){return Ue&6?kt():Qf!==-1?Qf:Qf=kt()}function Sa(n){return n.mode&1?Ue&2&&rs!==0?rs&-rs:SE.transition!==null?(Zf===0&&(Zf=A_()),Zf):(n=Ye,n!==0||(n=window.event,n=n===void 0?16:R_(n.type)),n):1}function rr(n,e,t,s){if(50<ad)throw ad=0,$0=null,Error(X(185));af(n,t,s),(!(Ue&2)||n!==Yt)&&(n===Yt&&(!(Ue&2)&&(zp|=t),Ut===4&&Li(n,rs)),Gs(n,s),t===1&&Ue===0&&!(e.mode&1)&&(du=kt()+500,Fp&&Pa()))}function Gs(n,e){var t=n.callbackNode;Sk(n,e);var s=Lm(n,n===Yt?rs:0);if(s===0)t!==null&&Zb(t),n.callbackNode=null,n.callbackPriority=0;else if(e=s&-s,n.callbackPriority!==e){if(t!=null&&Zb(t),e===1)n.tag===0?_E(Wx.bind(null,n)):Y_(Wx.bind(null,n)),vE(function(){!(Ue&6)&&Pa()}),t=null;else{switch(N_(s)){case 1:t=Rv;break;case 4:t=__;break;case 16:t=Mm;break;case 536870912:t=S_;break;default:t=Mm}t=KS(t,US.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function US(n,e){if(Qf=-1,Zf=0,Ue&6)throw Error(X(327));var t=n.callbackNode;if(Jl()&&n.callbackNode!==t)return null;var s=Lm(n,n===Yt?rs:0);if(s===0)return null;if(s&30||s&n.expiredLanes||e)e=ep(n,s);else{e=s;var r=Ue;Ue|=2;var i=HS();(Yt!==n||rs!==e)&&(Br=null,du=kt()+500,tl(n,e));do try{HE();break}catch(o){zS(n,o)}while(!0);qv(),Jm.current=i,Ue=r,Tt!==null?e=0:(Yt=null,rs=0,e=Ut)}if(e!==0){if(e===2&&(r=h0(n),r!==0&&(s=r,e=B0(n,r))),e===1)throw t=Cd,tl(n,0),Li(n,s),Gs(n,kt()),t;if(e===6)Li(n,s);else{if(r=n.current.alternate,!(s&30)&&!UE(r)&&(e=ep(n,s),e===2&&(i=h0(n),i!==0&&(s=i,e=B0(n,i))),e===1))throw t=Cd,tl(n,0),Li(n,s),Gs(n,kt()),t;switch(n.finishedWork=r,n.finishedLanes=s,e){case 0:case 1:throw Error(X(345));case 2:$a(n,Us,Br);break;case 3:if(Li(n,s),(s&130023424)===s&&(e=ib+500-kt(),10<e)){if(Lm(n,0)!==0)break;if(r=n.suspendedLanes,(r&s)!==s){Es(),n.pingedLanes|=n.suspendedLanes&r;break}n.timeoutHandle=x0($a.bind(null,n,Us,Br),e);break}$a(n,Us,Br);break;case 4:if(Li(n,s),(s&4194240)===s)break;for(e=n.eventTimes,r=-1;0<s;){var a=31-nr(s);i=1<<a,a=e[a],a>r&&(r=a),s&=~i}if(s=r,s=kt()-s,s=(120>s?120:480>s?480:1080>s?1080:1920>s?1920:3e3>s?3e3:4320>s?4320:1960*BE(s/1960))-s,10<s){n.timeoutHandle=x0($a.bind(null,n,Us,Br),s);break}$a(n,Us,Br);break;case 5:$a(n,Us,Br);break;default:throw Error(X(329))}}}return Gs(n,kt()),n.callbackNode===t?US.bind(null,n):null}function B0(n,e){var t=id;return n.current.memoizedState.isDehydrated&&(tl(n,e).flags|=256),n=ep(n,e),n!==2&&(e=Us,Us=t,e!==null&&U0(e)),n}function U0(n){Us===null?Us=n:Us.push.apply(Us,n)}function UE(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var s=0;s<t.length;s++){var r=t[s],i=r.getSnapshot;r=r.value;try{if(!ir(i(),r))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Li(n,e){for(e&=~rb,e&=~zp,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-nr(e),s=1<<t;n[t]=-1,e&=~s}}function Wx(n){if(Ue&6)throw Error(X(327));Jl();var e=Lm(n,0);if(!(e&1))return Gs(n,kt()),null;var t=ep(n,e);if(n.tag!==0&&t===2){var s=h0(n);s!==0&&(e=s,t=B0(n,s))}if(t===1)throw t=Cd,tl(n,0),Li(n,e),Gs(n,kt()),t;if(t===6)throw Error(X(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,$a(n,Us,Br),Gs(n,kt()),null}function ab(n,e){var t=Ue;Ue|=1;try{return n(e)}finally{Ue=t,Ue===0&&(du=kt()+500,Fp&&Pa())}}function ol(n){ga!==null&&ga.tag===0&&!(Ue&6)&&Jl();var e=Ue;Ue|=1;var t=Rn.transition,s=Ye;try{if(Rn.transition=null,Ye=1,n)return n()}finally{Ye=s,Rn.transition=t,Ue=e,!(Ue&6)&&Pa()}}function ob(){cn=zl.current,ct(zl)}function tl(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,yE(t)),Tt!==null)for(t=Tt.return;t!==null;){var s=t;switch(Uv(s),s.tag){case 1:s=s.type.childContextTypes,s!=null&&Um();break;case 3:cu(),ct(Ws),ct(vs),Yv();break;case 5:Xv(s);break;case 4:cu();break;case 13:ct(yt);break;case 19:ct(yt);break;case 10:Wv(s.type._context);break;case 22:case 23:ob()}t=t.return}if(Yt=n,Tt=n=Aa(n.current,null),rs=cn=e,Ut=0,Cd=null,rb=zp=al=0,Us=id=null,Ka!==null){for(e=0;e<Ka.length;e++)if(t=Ka[e],s=t.interleaved,s!==null){t.interleaved=null;var r=s.next,i=t.pending;if(i!==null){var a=i.next;i.next=r,s.next=a}t.pending=s}Ka=null}return n}function zS(n,e){do{var t=Tt;try{if(qv(),Xf.current=Ym,Xm){for(var s=bt.memoizedState;s!==null;){var r=s.queue;r!==null&&(r.pending=null),s=s.next}Xm=!1}if(il=0,Xt=Bt=bt=null,nd=!1,Nd=0,nb.current=null,t===null||t.return===null){Ut=1,Cd=e,Tt=null;break}e:{var i=n,a=t.return,o=t,c=e;if(e=rs,o.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var d=c,h=o,f=h.tag;if(!(h.mode&1)&&(f===0||f===11||f===15)){var m=h.alternate;m?(h.updateQueue=m.updateQueue,h.memoizedState=m.memoizedState,h.lanes=m.lanes):(h.updateQueue=null,h.memoizedState=null)}var p=Ix(a);if(p!==null){p.flags&=-257,Px(p,a,o,i,e),p.mode&1&&Rx(i,d,e),e=p,c=d;var g=e.updateQueue;if(g===null){var y=new Set;y.add(c),e.updateQueue=y}else g.add(c);break e}else{if(!(e&1)){Rx(i,d,e),lb();break e}c=Error(X(426))}}else if(mt&&o.mode&1){var N=Ix(a);if(N!==null){!(N.flags&65536)&&(N.flags|=256),Px(N,a,o,i,e),zv(uu(c,o));break e}}i=c=uu(c,o),Ut!==4&&(Ut=2),id===null?id=[i]:id.push(i),i=a;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var b=NS(i,c,e);Nx(i,b);break e;case 1:o=c;var x=i.type,_=i.stateNode;if(!(i.flags&128)&&(typeof x.getDerivedStateFromError=="function"||_!==null&&typeof _.componentDidCatch=="function"&&(_a===null||!_a.has(_)))){i.flags|=65536,e&=-e,i.lanes|=e;var w=kS(i,o,e);Nx(i,w);break e}}i=i.return}while(i!==null)}WS(t)}catch(k){e=k,Tt===t&&t!==null&&(Tt=t=t.return);continue}break}while(!0)}function HS(){var n=Jm.current;return Jm.current=Ym,n===null?Ym:n}function lb(){(Ut===0||Ut===3||Ut===2)&&(Ut=4),Yt===null||!(al&268435455)&&!(zp&268435455)||Li(Yt,rs)}function ep(n,e){var t=Ue;Ue|=2;var s=HS();(Yt!==n||rs!==e)&&(Br=null,tl(n,e));do try{zE();break}catch(r){zS(n,r)}while(!0);if(qv(),Ue=t,Jm.current=s,Tt!==null)throw Error(X(261));return Yt=null,rs=0,Ut}function zE(){for(;Tt!==null;)qS(Tt)}function HE(){for(;Tt!==null&&!mk();)qS(Tt)}function qS(n){var e=GS(n.alternate,n,cn);n.memoizedProps=n.pendingProps,e===null?WS(n):Tt=e,nb.current=null}function WS(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=LE(t,e),t!==null){t.flags&=32767,Tt=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{Ut=6,Tt=null;return}}else if(t=ME(t,e,cn),t!==null){Tt=t;return}if(e=e.sibling,e!==null){Tt=e;return}Tt=e=n}while(e!==null);Ut===0&&(Ut=5)}function $a(n,e,t){var s=Ye,r=Rn.transition;try{Rn.transition=null,Ye=1,qE(n,e,t,s)}finally{Rn.transition=r,Ye=s}return null}function qE(n,e,t,s){do Jl();while(ga!==null);if(Ue&6)throw Error(X(327));t=n.finishedWork;var r=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(X(177));n.callbackNode=null,n.callbackPriority=0;var i=t.lanes|t.childLanes;if(Ak(n,i),n===Yt&&(Tt=Yt=null,rs=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||If||(If=!0,KS(Mm,function(){return Jl(),null})),i=(t.flags&15990)!==0,t.subtreeFlags&15990||i){i=Rn.transition,Rn.transition=null;var a=Ye;Ye=1;var o=Ue;Ue|=4,nb.current=null,FE(n,t),$S(t,n),uE(v0),Om=!!y0,v0=y0=null,n.current=t,$E(t),pk(),Ue=o,Ye=a,Rn.transition=i}else n.current=t;if(If&&(If=!1,ga=n,Zm=r),i=n.pendingLanes,i===0&&(_a=null),vk(t.stateNode),Gs(n,kt()),e!==null)for(s=n.onRecoverableError,t=0;t<e.length;t++)r=e[t],s(r.value,{componentStack:r.stack,digest:r.digest});if(Qm)throw Qm=!1,n=F0,F0=null,n;return Zm&1&&n.tag!==0&&Jl(),i=n.pendingLanes,i&1?n===$0?ad++:(ad=0,$0=n):ad=0,Pa(),null}function Jl(){if(ga!==null){var n=N_(Zm),e=Rn.transition,t=Ye;try{if(Rn.transition=null,Ye=16>n?16:n,ga===null)var s=!1;else{if(n=ga,ga=null,Zm=0,Ue&6)throw Error(X(331));var r=Ue;for(Ue|=4,de=n.current;de!==null;){var i=de,a=i.child;if(de.flags&16){var o=i.deletions;if(o!==null){for(var c=0;c<o.length;c++){var d=o[c];for(de=d;de!==null;){var h=de;switch(h.tag){case 0:case 11:case 15:rd(8,h,i)}var f=h.child;if(f!==null)f.return=h,de=f;else for(;de!==null;){h=de;var m=h.sibling,p=h.return;if(LS(h),h===d){de=null;break}if(m!==null){m.return=p,de=m;break}de=p}}}var g=i.alternate;if(g!==null){var y=g.child;if(y!==null){g.child=null;do{var N=y.sibling;y.sibling=null,y=N}while(y!==null)}}de=i}}if(i.subtreeFlags&2064&&a!==null)a.return=i,de=a;else e:for(;de!==null;){if(i=de,i.flags&2048)switch(i.tag){case 0:case 11:case 15:rd(9,i,i.return)}var b=i.sibling;if(b!==null){b.return=i.return,de=b;break e}de=i.return}}var x=n.current;for(de=x;de!==null;){a=de;var _=a.child;if(a.subtreeFlags&2064&&_!==null)_.return=a,de=_;else e:for(a=x;de!==null;){if(o=de,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:Up(9,o)}}catch(k){St(o,o.return,k)}if(o===a){de=null;break e}var w=o.sibling;if(w!==null){w.return=o.return,de=w;break e}de=o.return}}if(Ue=r,Pa(),Ir&&typeof Ir.onPostCommitFiberRoot=="function")try{Ir.onPostCommitFiberRoot(Pp,n)}catch{}s=!0}return s}finally{Ye=t,Rn.transition=e}}return!1}function Vx(n,e,t){e=uu(t,e),e=NS(n,e,1),n=wa(n,e,1),e=Es(),n!==null&&(af(n,1,e),Gs(n,e))}function St(n,e,t){if(n.tag===3)Vx(n,n,t);else for(;e!==null;){if(e.tag===3){Vx(e,n,t);break}else if(e.tag===1){var s=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof s.componentDidCatch=="function"&&(_a===null||!_a.has(s))){n=uu(t,n),n=kS(e,n,1),e=wa(e,n,1),n=Es(),e!==null&&(af(e,1,n),Gs(e,n));break}}e=e.return}}function WE(n,e,t){var s=n.pingCache;s!==null&&s.delete(e),e=Es(),n.pingedLanes|=n.suspendedLanes&t,Yt===n&&(rs&t)===t&&(Ut===4||Ut===3&&(rs&130023424)===rs&&500>kt()-ib?tl(n,0):rb|=t),Gs(n,e)}function VS(n,e){e===0&&(n.mode&1?(e=_f,_f<<=1,!(_f&130023424)&&(_f=4194304)):e=1);var t=Es();n=Ai(n,e),n!==null&&(af(n,e,t),Gs(n,t))}function VE(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),VS(n,t)}function GE(n,e){var t=0;switch(n.tag){case 13:var s=n.stateNode,r=n.memoizedState;r!==null&&(t=r.retryLane);break;case 19:s=n.stateNode;break;default:throw Error(X(314))}s!==null&&s.delete(e),VS(n,t)}var GS;GS=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||Ws.current)qs=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return qs=!1,DE(n,e,t);qs=!!(n.flags&131072)}else qs=!1,mt&&e.flags&1048576&&J_(e,qm,e.index);switch(e.lanes=0,e.tag){case 2:var s=e.type;Jf(n,e),n=e.pendingProps;var r=au(e,vs.current);Yl(e,t),r=Qv(null,e,s,n,r,t);var i=Zv();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Vs(s)?(i=!0,zm(e)):i=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,Gv(e),r.updater=Bp,e.stateNode=r,r._reactInternals=e,E0(e,s,n,t),e=T0(null,e,s,!0,i,t)):(e.tag=0,mt&&i&&Bv(e),ks(null,e,r,t),e=e.child),e;case 16:s=e.elementType;e:{switch(Jf(n,e),n=e.pendingProps,r=s._init,s=r(s._payload),e.type=s,r=e.tag=XE(s),n=$n(s,n),r){case 0:e=j0(null,e,s,n,t);break e;case 1:e=Lx(null,e,s,n,t);break e;case 11:e=Dx(null,e,s,n,t);break e;case 14:e=Mx(null,e,s,$n(s.type,n),t);break e}throw Error(X(306,s,""))}return e;case 0:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:$n(s,r),j0(n,e,s,r,t);case 1:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:$n(s,r),Lx(n,e,s,r,t);case 3:e:{if(TS(e),n===null)throw Error(X(387));s=e.pendingProps,i=e.memoizedState,r=i.element,nS(n,e),Gm(e,s,null,t);var a=e.memoizedState;if(s=a.element,i.isDehydrated)if(i={element:s,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){r=uu(Error(X(423)),e),e=Ox(n,e,s,t,r);break e}else if(s!==r){r=uu(Error(X(424)),e),e=Ox(n,e,s,t,r);break e}else for(hn=xa(e.stateNode.containerInfo.firstChild),fn=e,mt=!0,tr=null,t=tS(e,null,s,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(ou(),s===r){e=Ni(n,e,t);break e}ks(n,e,s,t)}e=e.child}return e;case 5:return rS(e),n===null&&A0(e),s=e.type,r=e.pendingProps,i=n!==null?n.memoizedProps:null,a=r.children,b0(s,r)?a=null:i!==null&&b0(s,i)&&(e.flags|=32),jS(n,e),ks(n,e,a,t),e.child;case 6:return n===null&&A0(e),null;case 13:return RS(n,e,t);case 4:return Kv(e,e.stateNode.containerInfo),s=e.pendingProps,n===null?e.child=lu(e,null,s,t):ks(n,e,s,t),e.child;case 11:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:$n(s,r),Dx(n,e,s,r,t);case 7:return ks(n,e,e.pendingProps,t),e.child;case 8:return ks(n,e,e.pendingProps.children,t),e.child;case 12:return ks(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(s=e.type._context,r=e.pendingProps,i=e.memoizedProps,a=r.value,at(Wm,s._currentValue),s._currentValue=a,i!==null)if(ir(i.value,a)){if(i.children===r.children&&!Ws.current){e=Ni(n,e,t);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var o=i.dependencies;if(o!==null){a=i.child;for(var c=o.firstContext;c!==null;){if(c.context===s){if(i.tag===1){c=bi(-1,t&-t),c.tag=2;var d=i.updateQueue;if(d!==null){d=d.shared;var h=d.pending;h===null?c.next=c:(c.next=h.next,h.next=c),d.pending=c}}i.lanes|=t,c=i.alternate,c!==null&&(c.lanes|=t),N0(i.return,t,e),o.lanes|=t;break}c=c.next}}else if(i.tag===10)a=i.type===e.type?null:i.child;else if(i.tag===18){if(a=i.return,a===null)throw Error(X(341));a.lanes|=t,o=a.alternate,o!==null&&(o.lanes|=t),N0(a,t,e),a=i.sibling}else a=i.child;if(a!==null)a.return=i;else for(a=i;a!==null;){if(a===e){a=null;break}if(i=a.sibling,i!==null){i.return=a.return,a=i;break}a=a.return}i=a}ks(n,e,r.children,t),e=e.child}return e;case 9:return r=e.type,s=e.pendingProps.children,Yl(e,t),r=Dn(r),s=s(r),e.flags|=1,ks(n,e,s,t),e.child;case 14:return s=e.type,r=$n(s,e.pendingProps),r=$n(s.type,r),Mx(n,e,s,r,t);case 15:return ES(n,e,e.type,e.pendingProps,t);case 17:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:$n(s,r),Jf(n,e),e.tag=1,Vs(s)?(n=!0,zm(e)):n=!1,Yl(e,t),AS(e,s,r),E0(e,s,r,t),T0(null,e,s,!0,n,t);case 19:return IS(n,e,t);case 22:return CS(n,e,t)}throw Error(X(156,e.tag))};function KS(n,e){return w_(n,e)}function KE(n,e,t,s){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Tn(n,e,t,s){return new KE(n,e,t,s)}function cb(n){return n=n.prototype,!(!n||!n.isReactComponent)}function XE(n){if(typeof n=="function")return cb(n)?1:0;if(n!=null){if(n=n.$$typeof,n===Cv)return 11;if(n===jv)return 14}return 2}function Aa(n,e){var t=n.alternate;return t===null?(t=Tn(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function em(n,e,t,s,r,i){var a=2;if(s=n,typeof n=="function")cb(n)&&(a=1);else if(typeof n=="string")a=5;else e:switch(n){case Il:return sl(t.children,r,i,e);case Ev:a=8,r|=8;break;case Jg:return n=Tn(12,t,e,r|2),n.elementType=Jg,n.lanes=i,n;case Qg:return n=Tn(13,t,e,r),n.elementType=Qg,n.lanes=i,n;case Zg:return n=Tn(19,t,e,r),n.elementType=Zg,n.lanes=i,n;case r_:return Hp(t,r,i,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case s_:a=10;break e;case n_:a=9;break e;case Cv:a=11;break e;case jv:a=14;break e;case Pi:a=16,s=null;break e}throw Error(X(130,n==null?n:typeof n,""))}return e=Tn(a,t,e,r),e.elementType=n,e.type=s,e.lanes=i,e}function sl(n,e,t,s){return n=Tn(7,n,s,e),n.lanes=t,n}function Hp(n,e,t,s){return n=Tn(22,n,s,e),n.elementType=r_,n.lanes=t,n.stateNode={isHidden:!1},n}function Ig(n,e,t){return n=Tn(6,n,null,e),n.lanes=t,n}function Pg(n,e,t){return e=Tn(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function YE(n,e,t,s,r){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=fg(0),this.expirationTimes=fg(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=fg(0),this.identifierPrefix=s,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function ub(n,e,t,s,r,i,a,o,c){return n=new YE(n,e,t,o,c),e===1?(e=1,i===!0&&(e|=8)):e=0,i=Tn(3,null,null,e),n.current=i,i.stateNode=n,i.memoizedState={element:s,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},Gv(i),n}function JE(n,e,t){var s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Rl,key:s==null?null:""+s,children:n,containerInfo:e,implementation:t}}function XS(n){if(!n)return Ea;n=n._reactInternals;e:{if(fl(n)!==n||n.tag!==1)throw Error(X(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Vs(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(X(171))}if(n.tag===1){var t=n.type;if(Vs(t))return X_(n,t,e)}return e}function YS(n,e,t,s,r,i,a,o,c){return n=ub(t,s,!0,n,r,i,a,o,c),n.context=XS(null),t=n.current,s=Es(),r=Sa(t),i=bi(s,r),i.callback=e??null,wa(t,i,r),n.current.lanes=r,af(n,r,s),Gs(n,s),n}function qp(n,e,t,s){var r=e.current,i=Es(),a=Sa(r);return t=XS(t),e.context===null?e.context=t:e.pendingContext=t,e=bi(i,a),e.payload={element:n},s=s===void 0?null:s,s!==null&&(e.callback=s),n=wa(r,e,a),n!==null&&(rr(n,r,a,i),Kf(n,r,a)),a}function tp(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function Gx(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function db(n,e){Gx(n,e),(n=n.alternate)&&Gx(n,e)}function QE(){return null}var JS=typeof reportError=="function"?reportError:function(n){console.error(n)};function hb(n){this._internalRoot=n}Wp.prototype.render=hb.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(X(409));qp(n,e,null,null)};Wp.prototype.unmount=hb.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;ol(function(){qp(null,n,null,null)}),e[Si]=null}};function Wp(n){this._internalRoot=n}Wp.prototype.unstable_scheduleHydration=function(n){if(n){var e=C_();n={blockedOn:null,target:n,priority:e};for(var t=0;t<Mi.length&&e!==0&&e<Mi[t].priority;t++);Mi.splice(t,0,n),t===0&&T_(n)}};function fb(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function Vp(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function Kx(){}function ZE(n,e,t,s,r){if(r){if(typeof s=="function"){var i=s;s=function(){var d=tp(a);i.call(d)}}var a=YS(e,s,n,0,null,!1,!1,"",Kx);return n._reactRootContainer=a,n[Si]=a.current,xd(n.nodeType===8?n.parentNode:n),ol(),a}for(;r=n.lastChild;)n.removeChild(r);if(typeof s=="function"){var o=s;s=function(){var d=tp(c);o.call(d)}}var c=ub(n,0,!1,null,null,!1,!1,"",Kx);return n._reactRootContainer=c,n[Si]=c.current,xd(n.nodeType===8?n.parentNode:n),ol(function(){qp(e,c,t,s)}),c}function Gp(n,e,t,s,r){var i=t._reactRootContainer;if(i){var a=i;if(typeof r=="function"){var o=r;r=function(){var c=tp(a);o.call(c)}}qp(e,a,n,r)}else a=ZE(t,e,n,r,s);return tp(a)}k_=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=Pu(e.pendingLanes);t!==0&&(Iv(e,t|1),Gs(e,kt()),!(Ue&6)&&(du=kt()+500,Pa()))}break;case 13:ol(function(){var s=Ai(n,1);if(s!==null){var r=Es();rr(s,n,1,r)}}),db(n,1)}};Pv=function(n){if(n.tag===13){var e=Ai(n,134217728);if(e!==null){var t=Es();rr(e,n,134217728,t)}db(n,134217728)}};E_=function(n){if(n.tag===13){var e=Sa(n),t=Ai(n,e);if(t!==null){var s=Es();rr(t,n,e,s)}db(n,e)}};C_=function(){return Ye};j_=function(n,e){var t=Ye;try{return Ye=n,e()}finally{Ye=t}};c0=function(n,e,t){switch(e){case"input":if(s0(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var s=t[e];if(s!==n&&s.form===n.form){var r=Op(s);if(!r)throw Error(X(90));a_(s),s0(s,r)}}}break;case"textarea":l_(n,t);break;case"select":e=t.value,e!=null&&Vl(n,!!t.multiple,e,!1)}};p_=ab;g_=ol;var eC={usingClientEntryPoint:!1,Events:[lf,Ll,Op,f_,m_,ab]},Nu={findFiberByHostInstance:Ga,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},tC={bundleType:Nu.bundleType,version:Nu.version,rendererPackageName:Nu.rendererPackageName,rendererConfig:Nu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ci.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=b_(n),n===null?null:n.stateNode},findFiberByHostInstance:Nu.findFiberByHostInstance||QE,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Pf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Pf.isDisabled&&Pf.supportsFiber)try{Pp=Pf.inject(tC),Ir=Pf}catch{}}gn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=eC;gn.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!fb(e))throw Error(X(200));return JE(n,e,null,t)};gn.createRoot=function(n,e){if(!fb(n))throw Error(X(299));var t=!1,s="",r=JS;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(s=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=ub(n,1,!1,null,null,t,!1,s,r),n[Si]=e.current,xd(n.nodeType===8?n.parentNode:n),new hb(e)};gn.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(X(188)):(n=Object.keys(n).join(","),Error(X(268,n)));return n=b_(e),n=n===null?null:n.stateNode,n};gn.flushSync=function(n){return ol(n)};gn.hydrate=function(n,e,t){if(!Vp(e))throw Error(X(200));return Gp(null,n,e,!0,t)};gn.hydrateRoot=function(n,e,t){if(!fb(n))throw Error(X(405));var s=t!=null&&t.hydratedSources||null,r=!1,i="",a=JS;if(t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(i=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),e=YS(e,null,n,1,t??null,r,!1,i,a),n[Si]=e.current,xd(n),s)for(n=0;n<s.length;n++)t=s[n],r=t._getVersion,r=r(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,r]:e.mutableSourceEagerHydrationData.push(t,r);return new Wp(e)};gn.render=function(n,e,t){if(!Vp(e))throw Error(X(200));return Gp(null,n,e,!1,t)};gn.unmountComponentAtNode=function(n){if(!Vp(n))throw Error(X(40));return n._reactRootContainer?(ol(function(){Gp(null,null,n,!1,function(){n._reactRootContainer=null,n[Si]=null})}),!0):!1};gn.unstable_batchedUpdates=ab;gn.unstable_renderSubtreeIntoContainer=function(n,e,t,s){if(!Vp(t))throw Error(X(200));if(n==null||n._reactInternals===void 0)throw Error(X(38));return Gp(n,e,t,!1,s)};gn.version="18.3.1-next-f1338f8080-20240426";function QS(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(QS)}catch(n){console.error(n)}}QS(),Qw.exports=gn;var sC=Qw.exports,ZS,Xx=sC;ZS=Xx.createRoot,Xx.hydrateRoot;/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var nC={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rC=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),Je=(n,e)=>{const t=V.forwardRef(({color:s="currentColor",size:r=24,strokeWidth:i=2,absoluteStrokeWidth:a,className:o="",children:c,...d},h)=>V.createElement("svg",{ref:h,...nC,width:r,height:r,stroke:s,strokeWidth:a?Number(i)*24/Number(r):i,className:["lucide",`lucide-${rC(n)}`,o].join(" "),...d},[...e.map(([f,m])=>V.createElement(f,m)),...Array.isArray(c)?c:[c]]));return t.displayName=`${n}`,t};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iC=Je("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aC=Je("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oC=Je("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yx=Je("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zs=Je("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ks=Je("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tm=Je("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sp=Je("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lC=Je("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const e1=Je("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dg=Je("FileCheck",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hl=Je("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z0=Je("Loader",[["line",{x1:"12",x2:"12",y1:"2",y2:"6",key:"gza1u7"}],["line",{x1:"12",x2:"12",y1:"18",y2:"22",key:"1qhbu9"}],["line",{x1:"4.93",x2:"7.76",y1:"4.93",y2:"7.76",key:"xae44r"}],["line",{x1:"16.24",x2:"19.07",y1:"16.24",y2:"19.07",key:"bxnmvf"}],["line",{x1:"2",x2:"6",y1:"12",y2:"12",key:"89khin"}],["line",{x1:"18",x2:"22",y1:"12",y2:"12",key:"pb8tfm"}],["line",{x1:"4.93",x2:"7.76",y1:"19.07",y2:"16.24",key:"1uxjnu"}],["line",{x1:"16.24",x2:"19.07",y1:"7.76",y2:"4.93",key:"6duxfx"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cC=Je("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uC=Je("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mg=Je("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dC=Je("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hC=Je("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fC=Je("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mC=Je("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const t1=Je("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H0=Je("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mb=Je("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q0=Je("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jx=Je("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Df=Je("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pC=Je("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gC=Je("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W0=Je("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),yC="modulepreload",vC=function(n){return"/"+n},Qx={},uf=function(e,t,s){let r=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),o=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));r=Promise.allSettled(t.map(c=>{if(c=vC(c),c in Qx)return;Qx[c]=!0;const d=c.endsWith(".css"),h=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${h}`))return;const f=document.createElement("link");if(f.rel=d?"stylesheet":yC,d||(f.as="script"),f.crossOrigin="",f.href=c,o&&f.setAttribute("nonce",o),document.head.appendChild(f),d)return new Promise((m,p)=>{f.addEventListener("load",m),f.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return r.then(a=>{for(const o of a||[])o.status==="rejected"&&i(o.reason);return e().catch(i)})},bC=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>uf(async()=>{const{default:s}=await Promise.resolve().then(()=>gu);return{default:s}},[]).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)};class pb extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class xC extends pb{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Zx extends pb{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class ew extends pb{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var V0;(function(n){n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2"})(V0||(V0={}));var wC=function(n,e,t,s){function r(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(h){try{d(s.next(h))}catch(f){a(f)}}function c(h){try{d(s.throw(h))}catch(f){a(f)}}function d(h){h.done?i(h.value):r(h.value).then(o,c)}d((s=s.apply(n,e||[])).next())})};class _C{constructor(e,{headers:t={},customFetch:s,region:r=V0.Any}={}){this.url=e,this.headers=t,this.region=r,this.fetch=bC(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var s;return wC(this,void 0,void 0,function*(){try{const{headers:r,method:i,body:a}=t;let o={},{region:c}=t;c||(c=this.region);const d=new URL(`${this.url}/${e}`);c&&c!=="any"&&(o["x-region"]=c,d.searchParams.set("forceFunctionRegion",c));let h;a&&(r&&!Object.prototype.hasOwnProperty.call(r,"Content-Type")||!r)&&(typeof Blob<"u"&&a instanceof Blob||a instanceof ArrayBuffer?(o["Content-Type"]="application/octet-stream",h=a):typeof a=="string"?(o["Content-Type"]="text/plain",h=a):typeof FormData<"u"&&a instanceof FormData?h=a:(o["Content-Type"]="application/json",h=JSON.stringify(a)));const f=yield this.fetch(d.toString(),{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},o),this.headers),r),body:h}).catch(y=>{throw new xC(y)}),m=f.headers.get("x-relay-error");if(m&&m==="true")throw new Zx(f);if(!f.ok)throw new ew(f);let p=((s=f.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),g;return p==="application/json"?g=yield f.json():p==="application/octet-stream"?g=yield f.blob():p==="text/event-stream"?g=f:p==="multipart/form-data"?g=yield f.formData():g=yield f.text(),{data:g,error:null,response:f}}catch(r){return{data:null,error:r,response:r instanceof ew||r instanceof Zx?r.context:void 0}}})}}var Hs={},gb={},Kp={},df={},Xp={},Yp={},SC=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},hu=SC();const AC=hu.fetch,s1=hu.fetch.bind(hu),n1=hu.Headers,NC=hu.Request,kC=hu.Response,gu=Object.freeze(Object.defineProperty({__proto__:null,Headers:n1,Request:NC,Response:kC,default:s1,fetch:AC},Symbol.toStringTag,{value:"Module"})),EC=TN(gu);var Jp={};Object.defineProperty(Jp,"__esModule",{value:!0});let CC=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};Jp.default=CC;var r1=Pn&&Pn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Yp,"__esModule",{value:!0});const jC=r1(EC),TC=r1(Jp);let RC=class{constructor(e){var t,s;this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=new Headers(e.headers),this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=(t=e.shouldThrowOnError)!==null&&t!==void 0?t:!1,this.signal=e.signal,this.isMaybeSingle=(s=e.isMaybeSingle)!==null&&s!==void 0?s:!1,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=jC.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=new Headers(this.headers),this.headers.set(e,t),this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const s=this.fetch;let r=s(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{var a,o,c,d;let h=null,f=null,m=null,p=i.status,g=i.statusText;if(i.ok){if(this.method!=="HEAD"){const x=await i.text();x===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((a=this.headers.get("Accept"))===null||a===void 0)&&a.includes("application/vnd.pgrst.plan+text"))?f=x:f=JSON.parse(x))}const N=(o=this.headers.get("Prefer"))===null||o===void 0?void 0:o.match(/count=(exact|planned|estimated)/),b=(c=i.headers.get("content-range"))===null||c===void 0?void 0:c.split("/");N&&b&&b.length>1&&(m=parseInt(b[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(f)&&(f.length>1?(h={code:"PGRST116",details:`Results contain ${f.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},f=null,m=null,p=406,g="Not Acceptable"):f.length===1?f=f[0]:f=null)}else{const N=await i.text();try{h=JSON.parse(N),Array.isArray(h)&&i.status===404&&(f=[],h=null,p=200,g="OK")}catch{i.status===404&&N===""?(p=204,g="No Content"):h={message:N}}if(h&&this.isMaybeSingle&&(!((d=h==null?void 0:h.details)===null||d===void 0)&&d.includes("0 rows"))&&(h=null,p=200,g="OK"),h&&this.shouldThrowOnError)throw new TC.default(h)}return{error:h,data:f,count:m,status:p,statusText:g}});return this.shouldThrowOnError||(r=r.catch(i=>{var a,o,c;return{error:{message:`${(a=i==null?void 0:i.name)!==null&&a!==void 0?a:"FetchError"}: ${i==null?void 0:i.message}`,details:`${(o=i==null?void 0:i.stack)!==null&&o!==void 0?o:""}`,hint:"",code:`${(c=i==null?void 0:i.code)!==null&&c!==void 0?c:""}`},data:null,count:null,status:0,statusText:""}})),r.then(e,t)}returns(){return this}overrideTypes(){return this}};Yp.default=RC;var IC=Pn&&Pn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Xp,"__esModule",{value:!0});const PC=IC(Yp);let DC=class extends PC.default{select(e){let t=!1;const s=(e??"*").split("").map(r=>/\s/.test(r)&&!t?"":(r==='"'&&(t=!t),r)).join("");return this.url.searchParams.set("select",s),this.headers.append("Prefer","return=representation"),this}order(e,{ascending:t=!0,nullsFirst:s,foreignTable:r,referencedTable:i=r}={}){const a=i?`${i}.order`:"order",o=this.url.searchParams.get(a);return this.url.searchParams.set(a,`${o?`${o},`:""}${e}.${t?"asc":"desc"}${s===void 0?"":s?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:s=t}={}){const r=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(r,`${e}`),this}range(e,t,{foreignTable:s,referencedTable:r=s}={}){const i=typeof r>"u"?"offset":`${r}.offset`,a=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(i,`${e}`),this.url.searchParams.set(a,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:e=!1,verbose:t=!1,settings:s=!1,buffers:r=!1,wal:i=!1,format:a="text"}={}){var o;const c=[e?"analyze":null,t?"verbose":null,s?"settings":null,r?"buffers":null,i?"wal":null].filter(Boolean).join("|"),d=(o=this.headers.get("Accept"))!==null&&o!==void 0?o:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${a}; for="${d}"; options=${c};`),a==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(e){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${e}`),this}};Xp.default=DC;var MC=Pn&&Pn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(df,"__esModule",{value:!0});const LC=MC(Xp);let OC=class extends LC.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const s=Array.from(new Set(t)).map(r=>typeof r=="string"&&new RegExp("[,()]").test(r)?`"${r}"`:`${r}`).join(",");return this.url.searchParams.append(e,`in.(${s})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:s,type:r}={}){let i="";r==="plain"?i="pl":r==="phrase"?i="ph":r==="websearch"&&(i="w");const a=s===void 0?"":`(${s})`;return this.url.searchParams.append(e,`${i}fts${a}.${t}`),this}match(e){return Object.entries(e).forEach(([t,s])=>{this.url.searchParams.append(t,`eq.${s}`)}),this}not(e,t,s){return this.url.searchParams.append(e,`not.${t}.${s}`),this}or(e,{foreignTable:t,referencedTable:s=t}={}){const r=s?`${s}.or`:"or";return this.url.searchParams.append(r,`(${e})`),this}filter(e,t,s){return this.url.searchParams.append(e,`${t}.${s}`),this}};df.default=OC;var FC=Pn&&Pn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Kp,"__esModule",{value:!0});const ku=FC(df);let $C=class{constructor(e,{headers:t={},schema:s,fetch:r}){this.url=e,this.headers=new Headers(t),this.schema=s,this.fetch=r}select(e,{head:t=!1,count:s}={}){const r=t?"HEAD":"GET";let i=!1;const a=(e??"*").split("").map(o=>/\s/.test(o)&&!i?"":(o==='"'&&(i=!i),o)).join("");return this.url.searchParams.set("select",a),s&&this.headers.append("Prefer",`count=${s}`),new ku.default({method:r,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(e,{count:t,defaultToNull:s=!0}={}){var r;const i="POST";if(t&&this.headers.append("Prefer",`count=${t}`),s||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const a=e.reduce((o,c)=>o.concat(Object.keys(c)),[]);if(a.length>0){const o=[...new Set(a)].map(c=>`"${c}"`);this.url.searchParams.set("columns",o.join(","))}}return new ku.default({method:i,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch})}upsert(e,{onConflict:t,ignoreDuplicates:s=!1,count:r,defaultToNull:i=!0}={}){var a;const o="POST";if(this.headers.append("Prefer",`resolution=${s?"ignore":"merge"}-duplicates`),t!==void 0&&this.url.searchParams.set("on_conflict",t),r&&this.headers.append("Prefer",`count=${r}`),i||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const c=e.reduce((d,h)=>d.concat(Object.keys(h)),[]);if(c.length>0){const d=[...new Set(c)].map(h=>`"${h}"`);this.url.searchParams.set("columns",d.join(","))}}return new ku.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(a=this.fetch)!==null&&a!==void 0?a:fetch})}update(e,{count:t}={}){var s;const r="PATCH";return t&&this.headers.append("Prefer",`count=${t}`),new ku.default({method:r,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch})}delete({count:e}={}){var t;const s="DELETE";return e&&this.headers.append("Prefer",`count=${e}`),new ku.default({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:(t=this.fetch)!==null&&t!==void 0?t:fetch})}};Kp.default=$C;var i1=Pn&&Pn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(gb,"__esModule",{value:!0});const BC=i1(Kp),UC=i1(df);let zC=class a1{constructor(e,{headers:t={},schema:s,fetch:r}={}){this.url=e,this.headers=new Headers(t),this.schemaName=s,this.fetch=r}from(e){const t=new URL(`${this.url}/${e}`);return new BC.default(t,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new a1(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:s=!1,get:r=!1,count:i}={}){var a;let o;const c=new URL(`${this.url}/rpc/${e}`);let d;s||r?(o=s?"HEAD":"GET",Object.entries(t).filter(([f,m])=>m!==void 0).map(([f,m])=>[f,Array.isArray(m)?`{${m.join(",")}}`:`${m}`]).forEach(([f,m])=>{c.searchParams.append(f,m)})):(o="POST",d=t);const h=new Headers(this.headers);return i&&h.set("Prefer",`count=${i}`),new UC.default({method:o,url:c,headers:h,schema:this.schemaName,body:d,fetch:(a=this.fetch)!==null&&a!==void 0?a:fetch})}};gb.default=zC;var yu=Pn&&Pn.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Hs,"__esModule",{value:!0});Hs.PostgrestError=Hs.PostgrestBuilder=Hs.PostgrestTransformBuilder=Hs.PostgrestFilterBuilder=Hs.PostgrestQueryBuilder=Hs.PostgrestClient=void 0;const o1=yu(gb);Hs.PostgrestClient=o1.default;const l1=yu(Kp);Hs.PostgrestQueryBuilder=l1.default;const c1=yu(df);Hs.PostgrestFilterBuilder=c1.default;const u1=yu(Xp);Hs.PostgrestTransformBuilder=u1.default;const d1=yu(Yp);Hs.PostgrestBuilder=d1.default;const h1=yu(Jp);Hs.PostgrestError=h1.default;var HC=Hs.default={PostgrestClient:o1.default,PostgrestQueryBuilder:l1.default,PostgrestFilterBuilder:c1.default,PostgrestTransformBuilder:u1.default,PostgrestBuilder:d1.default,PostgrestError:h1.default};const{PostgrestClient:qC,PostgrestQueryBuilder:lI,PostgrestFilterBuilder:cI,PostgrestTransformBuilder:uI,PostgrestBuilder:dI,PostgrestError:hI}=HC;class WC{static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"&&process.versions&&process.versions.node){const t=parseInt(process.versions.node.split(".")[0]);return t>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${t} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${t} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const s=this.getWebSocketConstructor();return new s(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const VC="2.15.1",GC=`realtime-js/${VC}`,KC="1.0.0",G0=1e4,XC=1e3,YC=100;var od;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(od||(od={}));var Mt;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(Mt||(Mt={}));var er;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(er||(er={}));var K0;(function(n){n.websocket="websocket"})(K0||(K0={}));var qa;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(qa||(qa={}));class JC{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),s=new TextDecoder;return this._decodeBroadcast(e,t,s)}_decodeBroadcast(e,t,s){const r=t.getUint8(1),i=t.getUint8(2);let a=this.HEADER_LENGTH+2;const o=s.decode(e.slice(a,a+r));a=a+r;const c=s.decode(e.slice(a,a+i));a=a+i;const d=JSON.parse(s.decode(e.slice(a,e.byteLength)));return{ref:null,topic:o,event:c,payload:d}}}class f1{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var rt;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(rt||(rt={}));const tw=(n,e,t={})=>{var s;const r=(s=t.skipTypes)!==null&&s!==void 0?s:[];return Object.keys(e).reduce((i,a)=>(i[a]=QC(a,n,e,r),i),{})},QC=(n,e,t,s)=>{const r=e.find(o=>o.name===n),i=r==null?void 0:r.type,a=t[n];return i&&!s.includes(i)?m1(i,a):X0(a)},m1=(n,e)=>{if(n.charAt(0)==="_"){const t=n.slice(1,n.length);return sj(e,t)}switch(n){case rt.bool:return ZC(e);case rt.float4:case rt.float8:case rt.int2:case rt.int4:case rt.int8:case rt.numeric:case rt.oid:return ej(e);case rt.json:case rt.jsonb:return tj(e);case rt.timestamp:return nj(e);case rt.abstime:case rt.date:case rt.daterange:case rt.int4range:case rt.int8range:case rt.money:case rt.reltime:case rt.text:case rt.time:case rt.timestamptz:case rt.timetz:case rt.tsrange:case rt.tstzrange:return X0(e);default:return X0(e)}},X0=n=>n,ZC=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},ej=n=>{if(typeof n=="string"){const e=parseFloat(n);if(!Number.isNaN(e))return e}return n},tj=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch(e){return console.log(`JSON parse error: ${e}`),n}return n},sj=(n,e)=>{if(typeof n!="string")return n;const t=n.length-1,s=n[t];if(n[0]==="{"&&s==="}"){let i;const a=n.slice(1,t);try{i=JSON.parse("["+a+"]")}catch{i=a?a.split(","):[]}return i.map(o=>m1(e,o))}return n},nj=n=>typeof n=="string"?n.replace(" ","T"):n,p1=n=>{let e=n;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"};class Lg{constructor(e,t,s={},r=G0){this.channel=e,this.event=t,this.payload=s,this.timeout=r,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t((s=this.receivedResp)===null||s===void 0?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(s=>s.status===e).forEach(s=>s.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var sw;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(sw||(sw={}));class ld{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},r=>{const{onJoin:i,onLeave:a,onSync:o}=this.caller;this.joinRef=this.channel._joinRef(),this.state=ld.syncState(this.state,r,i,a),this.pendingDiffs.forEach(c=>{this.state=ld.syncDiff(this.state,c,i,a)}),this.pendingDiffs=[],o()}),this.channel._on(s.diff,{},r=>{const{onJoin:i,onLeave:a,onSync:o}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(r):(this.state=ld.syncDiff(this.state,r,i,a),o())}),this.onJoin((r,i,a)=>{this.channel._trigger("presence",{event:"join",key:r,currentPresences:i,newPresences:a})}),this.onLeave((r,i,a)=>{this.channel._trigger("presence",{event:"leave",key:r,currentPresences:i,leftPresences:a})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,s,r){const i=this.cloneDeep(e),a=this.transformState(t),o={},c={};return this.map(i,(d,h)=>{a[d]||(c[d]=h)}),this.map(a,(d,h)=>{const f=i[d];if(f){const m=h.map(N=>N.presence_ref),p=f.map(N=>N.presence_ref),g=h.filter(N=>p.indexOf(N.presence_ref)<0),y=f.filter(N=>m.indexOf(N.presence_ref)<0);g.length>0&&(o[d]=g),y.length>0&&(c[d]=y)}else o[d]=h}),this.syncDiff(i,{joins:o,leaves:c},s,r)}static syncDiff(e,t,s,r){const{joins:i,leaves:a}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),r||(r=()=>{}),this.map(i,(o,c)=>{var d;const h=(d=e[o])!==null&&d!==void 0?d:[];if(e[o]=this.cloneDeep(c),h.length>0){const f=e[o].map(p=>p.presence_ref),m=h.filter(p=>f.indexOf(p.presence_ref)<0);e[o].unshift(...m)}s(o,h,c)}),this.map(a,(o,c)=>{let d=e[o];if(!d)return;const h=c.map(f=>f.presence_ref);d=d.filter(f=>h.indexOf(f.presence_ref)<0),e[o]=d,r(o,d,c),d.length===0&&delete e[o]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(s=>t(s,e[s]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,s)=>{const r=e[s];return"metas"in r?t[s]=r.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[s]=r,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var nw;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(nw||(nw={}));var cd;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes",n.SYSTEM="system"})(cd||(cd={}));var Ur;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(Ur||(Ur={}));class yb{constructor(e,t={config:{}},s){this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=Mt.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Lg(this,er.join,this.params,this.timeout),this.rejoinTimer=new f1(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Mt.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(r=>r.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Mt.closed,this.socket._remove(this)}),this._onError(r=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,r),this.state=Mt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Mt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",r=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,r),this.state=Mt.errored,this.rejoinTimer.scheduleTimeout())}),this._on(er.reply,{},(r,i)=>{this._trigger(this._replyEventName(i),r)}),this.presence=new ld(this),this.broadcastEndpointURL=p1(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var s,r;if(this.socket.isConnected()||this.socket.connect(),this.state==Mt.closed){const{config:{broadcast:i,presence:a,private:o}}=this.params,c=(r=(s=this.bindings.postgres_changes)===null||s===void 0?void 0:s.map(m=>m.filter))!==null&&r!==void 0?r:[],d=!!this.bindings[cd.PRESENCE]&&this.bindings[cd.PRESENCE].length>0,h={},f={broadcast:i,presence:Object.assign(Object.assign({},a),{enabled:d}),postgres_changes:c,private:o};this.socket.accessTokenValue&&(h.access_token=this.socket.accessTokenValue),this._onError(m=>e==null?void 0:e(Ur.CHANNEL_ERROR,m)),this._onClose(()=>e==null?void 0:e(Ur.CLOSED)),this.updateJoinPayload(Object.assign({config:f},h)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:m})=>{var p;if(this.socket.setAuth(),m===void 0){e==null||e(Ur.SUBSCRIBED);return}else{const g=this.bindings.postgres_changes,y=(p=g==null?void 0:g.length)!==null&&p!==void 0?p:0,N=[];for(let b=0;b<y;b++){const x=g[b],{filter:{event:_,schema:w,table:k,filter:C}}=x,T=m&&m[b];if(T&&T.event===_&&T.schema===w&&T.table===k&&T.filter===C)N.push(Object.assign(Object.assign({},x),{id:T.id}));else{this.unsubscribe(),this.state=Mt.errored,e==null||e(Ur.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=N,e&&e(Ur.SUBSCRIBED);return}}).receive("error",m=>{this.state=Mt.errored,e==null||e(Ur.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(m).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(Ur.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,s){return this.state===Mt.joined&&e===cd.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,s)}async send(e,t={}){var s,r;if(!this._canPush()&&e.type==="broadcast"){const{event:i,payload:a}=e,c={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:a,private:this.private}]})};try{const d=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(s=t.timeout)!==null&&s!==void 0?s:this.timeout);return await((r=d.body)===null||r===void 0?void 0:r.cancel()),d.ok?"ok":"error"}catch(d){return d.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var a,o,c;const d=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((c=(o=(a=this.params)===null||a===void 0?void 0:a.config)===null||o===void 0?void 0:o.broadcast)===null||c===void 0)&&c.ack)&&i("ok"),d.receive("ok",()=>i("ok")),d.receive("error",()=>i("error")),d.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Mt.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(er.close,"leave",this._joinRef())};this.joinPush.destroy();let s=null;return new Promise(r=>{s=new Lg(this,er.leave,{},e),s.receive("ok",()=>{t(),r("ok")}).receive("timeout",()=>{t(),r("timed out")}).receive("error",()=>{r("error")}),s.send(),this._canPush()||s.trigger("ok",{})}).finally(()=>{s==null||s.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Mt.closed,this.bindings={}}async _fetchWithTimeout(e,t,s){const r=new AbortController,i=setTimeout(()=>r.abort(),s),a=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:r.signal}));return clearTimeout(i),a}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let r=new Lg(this,e,t,s);return this._canPush()?r.send():this._addToPushBuffer(r),r}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>YC){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var r,i;const a=e.toLocaleLowerCase(),{close:o,error:c,leave:d,join:h}=er;if(s&&[o,c,d,h].indexOf(a)>=0&&s!==this._joinRef())return;let m=this._onMessage(a,t,s);if(t&&!m)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?(r=this.bindings.postgres_changes)===null||r===void 0||r.filter(p=>{var g,y,N;return((g=p.filter)===null||g===void 0?void 0:g.event)==="*"||((N=(y=p.filter)===null||y===void 0?void 0:y.event)===null||N===void 0?void 0:N.toLocaleLowerCase())===a}).map(p=>p.callback(m,s)):(i=this.bindings[a])===null||i===void 0||i.filter(p=>{var g,y,N,b,x,_;if(["broadcast","presence","postgres_changes"].includes(a))if("id"in p){const w=p.id,k=(g=p.filter)===null||g===void 0?void 0:g.event;return w&&((y=t.ids)===null||y===void 0?void 0:y.includes(w))&&(k==="*"||(k==null?void 0:k.toLocaleLowerCase())===((N=t.data)===null||N===void 0?void 0:N.type.toLocaleLowerCase()))}else{const w=(x=(b=p==null?void 0:p.filter)===null||b===void 0?void 0:b.event)===null||x===void 0?void 0:x.toLocaleLowerCase();return w==="*"||w===((_=t==null?void 0:t.event)===null||_===void 0?void 0:_.toLocaleLowerCase())}else return p.type.toLocaleLowerCase()===a}).map(p=>{if(typeof m=="object"&&"ids"in m){const g=m.data,{schema:y,table:N,commit_timestamp:b,type:x,errors:_}=g;m=Object.assign(Object.assign({},{schema:y,table:N,commit_timestamp:b,eventType:x,new:{},old:{},errors:_}),this._getPayloadRecords(g))}p.callback(m,s)})}_isClosed(){return this.state===Mt.closed}_isJoined(){return this.state===Mt.joined}_isJoining(){return this.state===Mt.joining}_isLeaving(){return this.state===Mt.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){const r=e.toLocaleLowerCase(),i={type:r,filter:t,callback:s};return this.bindings[r]?this.bindings[r].push(i):this.bindings[r]=[i],this}_off(e,t){const s=e.toLocaleLowerCase();return this.bindings[s]&&(this.bindings[s]=this.bindings[s].filter(r=>{var i;return!(((i=r.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===s&&yb.isEqual(r.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(er.close,{},e)}_onError(e){this._on(er.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Mt.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=tw(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=tw(e.columns,e.old_record)),t}}const rw=()=>{},Mf={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},rj=[1e3,2e3,5e3,1e4],ij=1e4,aj=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class oj{constructor(e,t){var s;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=G0,this.transport=null,this.heartbeatIntervalMs=Mf.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=rw,this.ref=0,this.reconnectTimer=null,this.logger=rw,this.conn=null,this.sendBuffer=[],this.serializer=new JC,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=r=>{let i;return r?i=r:typeof fetch>"u"?i=(...a)=>uf(async()=>{const{default:o}=await Promise.resolve().then(()=>gu);return{default:o}},void 0).then(({default:o})=>o(...a)).catch(o=>{throw new Error(`Failed to load @supabase/node-fetch: ${o.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):i=fetch,(...a)=>i(...a)},!(!((s=t==null?void 0:t.params)===null||s===void 0)&&s.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${K0.websocket}`,this.httpEndpoint=p1(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t==null?void 0:t.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=WC.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:KC}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const s=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(s),this._setConnectionState("disconnected")},e?this.conn.close(e,t??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case od.connecting:return qa.Connecting;case od.open:return qa.Open;case od.closing:return qa.Closing;default:return qa.Closed}}isConnected(){return this.connectionState()===qa.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const s=`realtime:${e}`,r=this.getChannels().find(i=>i.topic===s);if(r)return r;{const i=new yb(`realtime:${e}`,t,this);return this.channels.push(i),i}}push(e){const{topic:t,event:s,payload:r,ref:i}=e,a=()=>{this.encode(e,o=>{var c;(c=this.conn)===null||c===void 0||c.send(o)})};this.log("push",`${t} ${s} (${i})`,r),this.isConnected()?a():this.sendBuffer.push(a)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(XC,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},Mf.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(s=>s.topic===e&&(s._isJoined()||s._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{t.topic==="phoenix"&&t.event==="phx_reply"&&this.heartbeatCallback(t.payload.status==="ok"?"ok":"error"),t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:s,event:r,payload:i,ref:a}=t,o=a?`(${a})`:"",c=i.status||"";this.log("receive",`${c} ${s} ${r} ${o}`.trim(),i),this.channels.filter(d=>d._isMember(s)).forEach(d=>d._trigger(r,i,a)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(er.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const s=e.match(/\?/)?"&":"?",r=new URLSearchParams(t);return`${e}${s}${r}`}_workerObjectUrl(e){let t;if(e)t=e;else{const s=new Blob([aj],{type:"application/javascript"});t=URL.createObjectURL(s)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t;e?t=e:this.accessToken?t=await this.accessToken():t=this.accessTokenValue,this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(s=>{const r={access_token:t,version:GC};t&&s.updateJoinPayload(r),s.joinedOnce&&s._isJoined()&&s._push(er.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(s=>{try{s(t)}catch(r){this.log("error",`error in ${e} callback`,r)}})}catch(s){this.log("error",`error triggering ${e} callbacks`,s)}}_setupReconnectionTimer(){this.reconnectTimer=new f1(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Mf.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,s,r,i,a,o,c,d;if(this.transport=(t=e==null?void 0:e.transport)!==null&&t!==void 0?t:null,this.timeout=(s=e==null?void 0:e.timeout)!==null&&s!==void 0?s:G0,this.heartbeatIntervalMs=(r=e==null?void 0:e.heartbeatIntervalMs)!==null&&r!==void 0?r:Mf.HEARTBEAT_INTERVAL,this.worker=(i=e==null?void 0:e.worker)!==null&&i!==void 0?i:!1,this.accessToken=(a=e==null?void 0:e.accessToken)!==null&&a!==void 0?a:null,e!=null&&e.params&&(this.params=e.params),e!=null&&e.logger&&(this.logger=e.logger),(e!=null&&e.logLevel||e!=null&&e.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(o=e==null?void 0:e.reconnectAfterMs)!==null&&o!==void 0?o:h=>rj[h-1]||ij,this.encode=(c=e==null?void 0:e.encode)!==null&&c!==void 0?c:(h,f)=>f(JSON.stringify(h)),this.decode=(d=e==null?void 0:e.decode)!==null&&d!==void 0?d:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e==null?void 0:e.workerUrl}}}class vb extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function $t(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}class lj extends vb{constructor(e,t,s){super(e),this.name="StorageApiError",this.status=t,this.statusCode=s}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class Y0 extends vb{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var cj=function(n,e,t,s){function r(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(h){try{d(s.next(h))}catch(f){a(f)}}function c(h){try{d(s.throw(h))}catch(f){a(f)}}function d(h){h.done?i(h.value):r(h.value).then(o,c)}d((s=s.apply(n,e||[])).next())})};const g1=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>uf(async()=>{const{default:s}=await Promise.resolve().then(()=>gu);return{default:s}},void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},uj=()=>cj(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield uf(()=>Promise.resolve().then(()=>gu),void 0)).Response:Response}),J0=n=>{if(Array.isArray(n))return n.map(t=>J0(t));if(typeof n=="function"||n!==Object(n))return n;const e={};return Object.entries(n).forEach(([t,s])=>{const r=t.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[r]=J0(s)}),e},dj=n=>{if(typeof n!="object"||n===null)return!1;const e=Object.getPrototypeOf(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)};var ml=function(n,e,t,s){function r(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(h){try{d(s.next(h))}catch(f){a(f)}}function c(h){try{d(s.throw(h))}catch(f){a(f)}}function d(h){h.done?i(h.value):r(h.value).then(o,c)}d((s=s.apply(n,e||[])).next())})};const Og=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),hj=(n,e,t)=>ml(void 0,void 0,void 0,function*(){const s=yield uj();n instanceof s&&!(t!=null&&t.noResolveJson)?n.json().then(r=>{const i=n.status||500,a=(r==null?void 0:r.statusCode)||i+"";e(new lj(Og(r),i,a))}).catch(r=>{e(new Y0(Og(r),r))}):e(new Y0(Og(n),n))}),fj=(n,e,t,s)=>{const r={method:n,headers:(e==null?void 0:e.headers)||{}};return n==="GET"||!s?r:(dj(s)?(r.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),r.body=JSON.stringify(s)):r.body=s,e!=null&&e.duplex&&(r.duplex=e.duplex),Object.assign(Object.assign({},r),t))};function hf(n,e,t,s,r,i){return ml(this,void 0,void 0,function*(){return new Promise((a,o)=>{n(t,fj(e,s,r,i)).then(c=>{if(!c.ok)throw c;return s!=null&&s.noResolveJson?c:c.json()}).then(c=>a(c)).catch(c=>hj(c,o,s))})})}function np(n,e,t,s){return ml(this,void 0,void 0,function*(){return hf(n,"GET",e,t,s)})}function fr(n,e,t,s,r){return ml(this,void 0,void 0,function*(){return hf(n,"POST",e,s,r,t)})}function Q0(n,e,t,s,r){return ml(this,void 0,void 0,function*(){return hf(n,"PUT",e,s,r,t)})}function mj(n,e,t,s){return ml(this,void 0,void 0,function*(){return hf(n,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),s)})}function y1(n,e,t,s,r){return ml(this,void 0,void 0,function*(){return hf(n,"DELETE",e,s,r,t)})}var xs=function(n,e,t,s){function r(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(h){try{d(s.next(h))}catch(f){a(f)}}function c(h){try{d(s.throw(h))}catch(f){a(f)}}function d(h){h.done?i(h.value):r(h.value).then(o,c)}d((s=s.apply(n,e||[])).next())})};const pj={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},iw={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class gj{constructor(e,t={},s,r){this.url=e,this.headers=t,this.bucketId=s,this.fetch=g1(r)}uploadOrUpdate(e,t,s,r){return xs(this,void 0,void 0,function*(){try{let i;const a=Object.assign(Object.assign({},iw),r);let o=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(a.upsert)});const c=a.metadata;typeof Blob<"u"&&s instanceof Blob?(i=new FormData,i.append("cacheControl",a.cacheControl),c&&i.append("metadata",this.encodeMetadata(c)),i.append("",s)):typeof FormData<"u"&&s instanceof FormData?(i=s,i.append("cacheControl",a.cacheControl),c&&i.append("metadata",this.encodeMetadata(c))):(i=s,o["cache-control"]=`max-age=${a.cacheControl}`,o["content-type"]=a.contentType,c&&(o["x-metadata"]=this.toBase64(this.encodeMetadata(c)))),r!=null&&r.headers&&(o=Object.assign(Object.assign({},o),r.headers));const d=this._removeEmptyFolders(t),h=this._getFinalPath(d),f=yield(e=="PUT"?Q0:fr)(this.fetch,`${this.url}/object/${h}`,i,Object.assign({headers:o},a!=null&&a.duplex?{duplex:a.duplex}:{}));return{data:{path:d,id:f.Id,fullPath:f.Key},error:null}}catch(i){if($t(i))return{data:null,error:i};throw i}})}upload(e,t,s){return xs(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,s)})}uploadToSignedUrl(e,t,s,r){return xs(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),a=this._getFinalPath(i),o=new URL(this.url+`/object/upload/sign/${a}`);o.searchParams.set("token",t);try{let c;const d=Object.assign({upsert:iw.upsert},r),h=Object.assign(Object.assign({},this.headers),{"x-upsert":String(d.upsert)});typeof Blob<"u"&&s instanceof Blob?(c=new FormData,c.append("cacheControl",d.cacheControl),c.append("",s)):typeof FormData<"u"&&s instanceof FormData?(c=s,c.append("cacheControl",d.cacheControl)):(c=s,h["cache-control"]=`max-age=${d.cacheControl}`,h["content-type"]=d.contentType);const f=yield Q0(this.fetch,o.toString(),c,{headers:h});return{data:{path:i,fullPath:f.Key},error:null}}catch(c){if($t(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(e,t){return xs(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e);const r=Object.assign({},this.headers);t!=null&&t.upsert&&(r["x-upsert"]="true");const i=yield fr(this.fetch,`${this.url}/object/upload/sign/${s}`,{},{headers:r}),a=new URL(this.url+i.url),o=a.searchParams.get("token");if(!o)throw new vb("No token returned by API");return{data:{signedUrl:a.toString(),path:e,token:o},error:null}}catch(s){if($t(s))return{data:null,error:s};throw s}})}update(e,t,s){return xs(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,s)})}move(e,t,s){return xs(this,void 0,void 0,function*(){try{return{data:yield fr(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s==null?void 0:s.destinationBucket},{headers:this.headers}),error:null}}catch(r){if($t(r))return{data:null,error:r};throw r}})}copy(e,t,s){return xs(this,void 0,void 0,function*(){try{return{data:{path:(yield fr(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s==null?void 0:s.destinationBucket},{headers:this.headers})).Key},error:null}}catch(r){if($t(r))return{data:null,error:r};throw r}})}createSignedUrl(e,t,s){return xs(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e),i=yield fr(this.fetch,`${this.url}/object/sign/${r}`,Object.assign({expiresIn:t},s!=null&&s.transform?{transform:s.transform}:{}),{headers:this.headers});const a=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${a}`)},{data:i,error:null}}catch(r){if($t(r))return{data:null,error:r};throw r}})}createSignedUrls(e,t,s){return xs(this,void 0,void 0,function*(){try{const r=yield fr(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return{data:r.map(a=>Object.assign(Object.assign({},a),{signedUrl:a.signedURL?encodeURI(`${this.url}${a.signedURL}${i}`):null})),error:null}}catch(r){if($t(r))return{data:null,error:r};throw r}})}download(e,t){return xs(this,void 0,void 0,function*(){const r=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),a=i?`?${i}`:"";try{const o=this._getFinalPath(e);return{data:yield(yield np(this.fetch,`${this.url}/${r}/${o}${a}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(o){if($t(o))return{data:null,error:o};throw o}})}info(e){return xs(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const s=yield np(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:J0(s),error:null}}catch(s){if($t(s))return{data:null,error:s};throw s}})}exists(e){return xs(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield mj(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(s){if($t(s)&&s instanceof Y0){const r=s.originalError;if([400,404].includes(r==null?void 0:r.status))return{data:!1,error:s}}throw s}})}getPublicUrl(e,t){const s=this._getFinalPath(e),r=[],i=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&r.push(i);const o=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",c=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});c!==""&&r.push(c);let d=r.join("&");return d!==""&&(d=`?${d}`),{data:{publicUrl:encodeURI(`${this.url}/${o}/public/${s}${d}`)}}}remove(e){return xs(this,void 0,void 0,function*(){try{return{data:yield y1(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if($t(t))return{data:null,error:t};throw t}})}list(e,t,s){return xs(this,void 0,void 0,function*(){try{const r=Object.assign(Object.assign(Object.assign({},pj),t),{prefix:e||""});return{data:yield fr(this.fetch,`${this.url}/object/list/${this.bucketId}`,r,{headers:this.headers},s),error:null}}catch(r){if($t(r))return{data:null,error:r};throw r}})}listV2(e,t){return xs(this,void 0,void 0,function*(){try{const s=Object.assign({},e);return{data:yield fr(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,s,{headers:this.headers},t),error:null}}catch(s){if($t(s))return{data:null,error:s};throw s}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const yj="2.11.0",vj={"X-Client-Info":`storage-js/${yj}`};var yl=function(n,e,t,s){function r(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(h){try{d(s.next(h))}catch(f){a(f)}}function c(h){try{d(s.throw(h))}catch(f){a(f)}}function d(h){h.done?i(h.value):r(h.value).then(o,c)}d((s=s.apply(n,e||[])).next())})};class bj{constructor(e,t={},s,r){const i=new URL(e);r!=null&&r.useNewHostname&&/supabase\.(co|in|red)$/.test(i.hostname)&&!i.hostname.includes("storage.supabase.")&&(i.hostname=i.hostname.replace("supabase.","storage.supabase.")),this.url=i.href,this.headers=Object.assign(Object.assign({},vj),t),this.fetch=g1(s)}listBuckets(){return yl(this,void 0,void 0,function*(){try{return{data:yield np(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if($t(e))return{data:null,error:e};throw e}})}getBucket(e){return yl(this,void 0,void 0,function*(){try{return{data:yield np(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if($t(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return yl(this,void 0,void 0,function*(){try{return{data:yield fr(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if($t(s))return{data:null,error:s};throw s}})}updateBucket(e,t){return yl(this,void 0,void 0,function*(){try{return{data:yield Q0(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if($t(s))return{data:null,error:s};throw s}})}emptyBucket(e){return yl(this,void 0,void 0,function*(){try{return{data:yield fr(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if($t(t))return{data:null,error:t};throw t}})}deleteBucket(e){return yl(this,void 0,void 0,function*(){try{return{data:yield y1(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if($t(t))return{data:null,error:t};throw t}})}}class xj extends bj{constructor(e,t={},s,r){super(e,t,s,r)}from(e){return new gj(this.url,this.headers,e,this.fetch)}}const wj="2.56.0";let Mu="";typeof Deno<"u"?Mu="deno":typeof document<"u"?Mu="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Mu="react-native":Mu="node";const _j={"X-Client-Info":`supabase-js-${Mu}/${wj}`},Sj={headers:_j},Aj={schema:"public"},Nj={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},kj={};var Ej=function(n,e,t,s){function r(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(h){try{d(s.next(h))}catch(f){a(f)}}function c(h){try{d(s.throw(h))}catch(f){a(f)}}function d(h){h.done?i(h.value):r(h.value).then(o,c)}d((s=s.apply(n,e||[])).next())})};const Cj=n=>{let e;return n?e=n:typeof fetch>"u"?e=s1:e=fetch,(...t)=>e(...t)},jj=()=>typeof Headers>"u"?n1:Headers,Tj=(n,e,t)=>{const s=Cj(t),r=jj();return(i,a)=>Ej(void 0,void 0,void 0,function*(){var o;const c=(o=yield e())!==null&&o!==void 0?o:n;let d=new r(a==null?void 0:a.headers);return d.has("apikey")||d.set("apikey",n),d.has("Authorization")||d.set("Authorization",`Bearer ${c}`),s(i,Object.assign(Object.assign({},a),{headers:d}))})};var Rj=function(n,e,t,s){function r(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(h){try{d(s.next(h))}catch(f){a(f)}}function c(h){try{d(s.throw(h))}catch(f){a(f)}}function d(h){h.done?i(h.value):r(h.value).then(o,c)}d((s=s.apply(n,e||[])).next())})};function Ij(n){return n.endsWith("/")?n:n+"/"}function Pj(n,e){var t,s;const{db:r,auth:i,realtime:a,global:o}=n,{db:c,auth:d,realtime:h,global:f}=e,m={db:Object.assign(Object.assign({},c),r),auth:Object.assign(Object.assign({},d),i),realtime:Object.assign(Object.assign({},h),a),storage:{},global:Object.assign(Object.assign(Object.assign({},f),o),{headers:Object.assign(Object.assign({},(t=f==null?void 0:f.headers)!==null&&t!==void 0?t:{}),(s=o==null?void 0:o.headers)!==null&&s!==void 0?s:{})}),accessToken:()=>Rj(this,void 0,void 0,function*(){return""})};return n.accessToken?m.accessToken=n.accessToken:delete m.accessToken,m}const v1="2.71.1",_l=30*1e3,Z0=3,Fg=Z0*_l,Dj="http://localhost:9999",Mj="supabase.auth.token",Lj={"X-Client-Info":`gotrue-js/${v1}`},ey="X-Supabase-Api-Version",b1={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},Oj=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,Fj=10*60*1e3;class bb extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}}function Te(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class $j extends bb{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}}function Bj(n){return Te(n)&&n.name==="AuthApiError"}class x1 extends bb{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Da extends bb{constructor(e,t,s,r){super(e,s,r),this.name=t,this.status=s}}class Ri extends Da{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Uj(n){return Te(n)&&n.name==="AuthSessionMissingError"}class Lf extends Da{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Of extends Da{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Ff extends Da{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function zj(n){return Te(n)&&n.name==="AuthImplicitGrantRedirectError"}class aw extends Da{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class ty extends Da{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function $g(n){return Te(n)&&n.name==="AuthRetryableFetchError"}class ow extends Da{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}}class sy extends Da{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const rp="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),lw=` 	
\r=`.split(""),Hj=(()=>{const n=new Array(128);for(let e=0;e<n.length;e+=1)n[e]=-1;for(let e=0;e<lw.length;e+=1)n[lw[e].charCodeAt(0)]=-2;for(let e=0;e<rp.length;e+=1)n[rp[e].charCodeAt(0)]=e;return n})();function cw(n,e,t){if(n!==null)for(e.queue=e.queue<<8|n,e.queuedBits+=8;e.queuedBits>=6;){const s=e.queue>>e.queuedBits-6&63;t(rp[s]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const s=e.queue>>e.queuedBits-6&63;t(rp[s]),e.queuedBits-=6}}function w1(n,e,t){const s=Hj[n];if(s>-1)for(e.queue=e.queue<<6|s,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(s===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(n)}"`)}}function uw(n){const e=[],t=a=>{e.push(String.fromCodePoint(a))},s={utf8seq:0,codepoint:0},r={queue:0,queuedBits:0},i=a=>{Vj(a,s,t)};for(let a=0;a<n.length;a+=1)w1(n.charCodeAt(a),r,i);return e.join("")}function qj(n,e){if(n<=127){e(n);return}else if(n<=2047){e(192|n>>6),e(128|n&63);return}else if(n<=65535){e(224|n>>12),e(128|n>>6&63),e(128|n&63);return}else if(n<=1114111){e(240|n>>18),e(128|n>>12&63),e(128|n>>6&63),e(128|n&63);return}throw new Error(`Unrecognized Unicode codepoint: ${n.toString(16)}`)}function Wj(n,e){for(let t=0;t<n.length;t+=1){let s=n.charCodeAt(t);if(s>55295&&s<=56319){const r=(s-55296)*1024&65535;s=(n.charCodeAt(t+1)-56320&65535|r)+65536,t+=1}qj(s,e)}}function Vj(n,e,t){if(e.utf8seq===0){if(n<=127){t(n);return}for(let s=1;s<6;s+=1)if(!(n>>7-s&1)){e.utf8seq=s;break}if(e.utf8seq===2)e.codepoint=n&31;else if(e.utf8seq===3)e.codepoint=n&15;else if(e.utf8seq===4)e.codepoint=n&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(n<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|n&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function Gj(n){const e=[],t={queue:0,queuedBits:0},s=r=>{e.push(r)};for(let r=0;r<n.length;r+=1)w1(n.charCodeAt(r),t,s);return new Uint8Array(e)}function Kj(n){const e=[];return Wj(n,t=>e.push(t)),new Uint8Array(e)}function Xj(n){const e=[],t={queue:0,queuedBits:0},s=r=>{e.push(r)};return n.forEach(r=>cw(r,t,s)),cw(null,t,s),e.join("")}function Yj(n){return Math.round(Date.now()/1e3)+n}function Jj(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const e=Math.random()*16|0;return(n=="x"?e:e&3|8).toString(16)})}const On=()=>typeof window<"u"&&typeof document<"u",La={tested:!1,writable:!1},_1=()=>{if(!On())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(La.tested)return La.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),La.tested=!0,La.writable=!0}catch{La.tested=!0,La.writable=!1}return La.writable};function Qj(n){const e={},t=new URL(n);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((r,i)=>{e[i]=r})}catch{}return t.searchParams.forEach((s,r)=>{e[r]=s}),e}const S1=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>uf(async()=>{const{default:s}=await Promise.resolve().then(()=>gu);return{default:s}},void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},Zj=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",Sl=async(n,e,t)=>{await n.setItem(e,JSON.stringify(t))},Oa=async(n,e)=>{const t=await n.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},Ti=async(n,e)=>{await n.removeItem(e)};class Qp{constructor(){this.promise=new Qp.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Qp.promiseConstructor=Promise;function Bg(n){const e=n.split(".");if(e.length!==3)throw new sy("Invalid JWT structure");for(let s=0;s<e.length;s++)if(!Oj.test(e[s]))throw new sy("JWT not in base64url format");return{header:JSON.parse(uw(e[0])),payload:JSON.parse(uw(e[1])),signature:Gj(e[2]),raw:{header:e[0],payload:e[1]}}}async function e2(n){return await new Promise(e=>{setTimeout(()=>e(null),n)})}function t2(n,e){return new Promise((s,r)=>{(async()=>{for(let i=0;i<1/0;i++)try{const a=await n(i);if(!e(i,null,a)){s(a);return}}catch(a){if(!e(i,a)){r(a);return}}})()})}function s2(n){return("0"+n.toString(16)).substr(-2)}function n2(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",s=t.length;let r="";for(let i=0;i<56;i++)r+=t.charAt(Math.floor(Math.random()*s));return r}return crypto.getRandomValues(e),Array.from(e,s2).join("")}async function r2(n){const t=new TextEncoder().encode(n),s=await crypto.subtle.digest("SHA-256",t),r=new Uint8Array(s);return Array.from(r).map(i=>String.fromCharCode(i)).join("")}async function i2(n){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const t=await r2(n);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function vl(n,e,t=!1){const s=n2();let r=s;t&&(r+="/PASSWORD_RECOVERY"),await Sl(n,`${e}-code-verifier`,r);const i=await i2(s);return[i,s===i?"plain":"s256"]}const a2=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function o2(n){const e=n.headers.get(ey);if(!e||!e.match(a2))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function l2(n){if(!n)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(n<=e)throw new Error("JWT has expired")}function c2(n){switch(n){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const u2=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function bl(n){if(!u2.test(n))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Ug(){const n={};return new Proxy(n,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const s=t.toString();if(s==="Symbol(Symbol.toPrimitive)"||s==="Symbol(Symbol.toStringTag)"||s==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function dw(n){return JSON.parse(JSON.stringify(n))}var d2=function(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(n);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(n,s[r])&&(t[s[r]]=n[s[r]]);return t};const Ba=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),h2=[502,503,504];async function hw(n){var e;if(!Zj(n))throw new ty(Ba(n),0);if(h2.includes(n.status))throw new ty(Ba(n),n.status);let t;try{t=await n.json()}catch(i){throw new x1(Ba(i),i)}let s;const r=o2(n);if(r&&r.getTime()>=b1["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?s=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(s=t.error_code),s){if(s==="weak_password")throw new ow(Ba(t),n.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(s==="session_not_found")throw new Ri}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((i,a)=>i&&typeof a=="string",!0))throw new ow(Ba(t),n.status,t.weak_password.reasons);throw new $j(Ba(t),n.status||500,s)}const f2=(n,e,t,s)=>{const r={method:n,headers:(e==null?void 0:e.headers)||{}};return n==="GET"?r:(r.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),r.body=JSON.stringify(s),Object.assign(Object.assign({},r),t))};async function Fe(n,e,t,s){var r;const i=Object.assign({},s==null?void 0:s.headers);i[ey]||(i[ey]=b1["2024-01-01"].name),s!=null&&s.jwt&&(i.Authorization=`Bearer ${s.jwt}`);const a=(r=s==null?void 0:s.query)!==null&&r!==void 0?r:{};s!=null&&s.redirectTo&&(a.redirect_to=s.redirectTo);const o=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",c=await m2(n,e,t+o,{headers:i,noResolveJson:s==null?void 0:s.noResolveJson},{},s==null?void 0:s.body);return s!=null&&s.xform?s==null?void 0:s.xform(c):{data:Object.assign({},c),error:null}}async function m2(n,e,t,s,r,i){const a=f2(e,s,r,i);let o;try{o=await n(t,Object.assign({},a))}catch(c){throw console.error(c),new ty(Ba(c),0)}if(o.ok||await hw(o),s!=null&&s.noResolveJson)return o;try{return await o.json()}catch(c){await hw(c)}}function Lr(n){var e;let t=null;v2(n)&&(t=Object.assign({},n),n.expires_at||(t.expires_at=Yj(n.expires_in)));const s=(e=n.user)!==null&&e!==void 0?e:n;return{data:{session:t,user:s},error:null}}function fw(n){const e=Lr(n);return!e.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((t,s)=>t&&typeof s=="string",!0)&&(e.data.weak_password=n.weak_password),e}function Oi(n){var e;return{data:{user:(e=n.user)!==null&&e!==void 0?e:n},error:null}}function p2(n){return{data:n,error:null}}function g2(n){const{action_link:e,email_otp:t,hashed_token:s,redirect_to:r,verification_type:i}=n,a=d2(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),o={action_link:e,email_otp:t,hashed_token:s,redirect_to:r,verification_type:i},c=Object.assign({},a);return{data:{properties:o,user:c},error:null}}function y2(n){return n}function v2(n){return n.access_token&&n.refresh_token&&n.expires_in}const zg=["global","local","others"];var b2=function(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(n);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(n,s[r])&&(t[s[r]]=n[s[r]]);return t};class x2{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=S1(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=zg[0]){if(zg.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${zg.join(", ")}`);try{return await Fe(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(Te(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e,t={}){try{return await Fe(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Oi})}catch(s){if(Te(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{const{options:t}=e,s=b2(e,["options"]),r=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(r.new_email=s==null?void 0:s.newEmail,delete r.newEmail),await Fe(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:r,headers:this.headers,xform:g2,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(Te(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await Fe(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Oi})}catch(t){if(Te(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,s,r,i,a,o,c;try{const d={nextPage:null,lastPage:0,total:0},h=await Fe(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&s!==void 0?s:"",per_page:(i=(r=e==null?void 0:e.perPage)===null||r===void 0?void 0:r.toString())!==null&&i!==void 0?i:""},xform:y2});if(h.error)throw h.error;const f=await h.json(),m=(a=h.headers.get("x-total-count"))!==null&&a!==void 0?a:0,p=(c=(o=h.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&c!==void 0?c:[];return p.length>0&&(p.forEach(g=>{const y=parseInt(g.split(";")[0].split("=")[1].substring(0,1)),N=JSON.parse(g.split(";")[1].split("=")[1]);d[`${N}Page`]=y}),d.total=parseInt(m)),{data:Object.assign(Object.assign({},f),d),error:null}}catch(d){if(Te(d))return{data:{users:[]},error:d};throw d}}async getUserById(e){bl(e);try{return await Fe(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Oi})}catch(t){if(Te(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){bl(e);try{return await Fe(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Oi})}catch(s){if(Te(s))return{data:{user:null},error:s};throw s}}async deleteUser(e,t=!1){bl(e);try{return await Fe(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Oi})}catch(s){if(Te(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){bl(e.userId);try{const{data:t,error:s}=await Fe(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:r=>({data:{factors:r},error:null})});return{data:t,error:s}}catch(t){if(Te(t))return{data:null,error:t};throw t}}async _deleteFactor(e){bl(e.userId),bl(e.id);try{return{data:await Fe(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(Te(t))return{data:null,error:t};throw t}}}function mw(n={}){return{getItem:e=>n[e]||null,setItem:(e,t)=>{n[e]=t},removeItem:e=>{delete n[e]}}}function w2(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const xl={debug:!!(globalThis&&_1()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class A1 extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class _2 extends A1{}async function S2(n,e,t){xl.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,e);const s=new globalThis.AbortController;return e>0&&setTimeout(()=>{s.abort(),xl.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(n,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async r=>{if(r){xl.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,r.name);try{return await t()}finally{xl.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,r.name)}}else{if(e===0)throw xl.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new _2(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if(xl.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}w2();const A2={url:Dj,storageKey:Mj,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Lj,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function pw(n,e,t){return await t()}const wl={};class jd{constructor(e){var t,s;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=jd.nextInstanceID,jd.nextInstanceID+=1,this.instanceID>0&&On()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const r=Object.assign(Object.assign({},A2),e);if(this.logDebugMessages=!!r.debug,typeof r.debug=="function"&&(this.logger=r.debug),this.persistSession=r.persistSession,this.storageKey=r.storageKey,this.autoRefreshToken=r.autoRefreshToken,this.admin=new x2({url:r.url,headers:r.headers,fetch:r.fetch}),this.url=r.url,this.headers=r.headers,this.fetch=S1(r.fetch),this.lock=r.lock||pw,this.detectSessionInUrl=r.detectSessionInUrl,this.flowType=r.flowType,this.hasCustomAuthorizationHeader=r.hasCustomAuthorizationHeader,r.lock?this.lock=r.lock:On()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=S2:this.lock=pw,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(r.storage?this.storage=r.storage:_1()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=mw(this.memoryStorage)),r.userStorage&&(this.userStorage=r.userStorage)):(this.memoryStorage={},this.storage=mw(this.memoryStorage)),On()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(s=this.broadcastChannel)===null||s===void 0||s.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}get jwks(){var e,t;return(t=(e=wl[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){wl[this.storageKey]=Object.assign(Object.assign({},wl[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=wl[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){wl[this.storageKey]=Object.assign(Object.assign({},wl[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${v1}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=Qj(window.location.href);let s="none";if(this._isImplicitGrantCallback(t)?s="implicit":await this._isPKCECallback(t)&&(s="pkce"),On()&&this.detectSessionInUrl&&s!=="none"){const{data:r,error:i}=await this._getSessionFromURL(t,s);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),zj(i)){const c=(e=i.details)===null||e===void 0?void 0:e.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:a,redirectType:o}=r;return this._debug("#_initialize()","detected session in URL",a,"redirect type",o),await this._saveSession(a),setTimeout(async()=>{o==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",a):await this._notifyAllSubscribers("SIGNED_IN",a)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return Te(t)?{error:t}:{error:new x1("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,s,r;try{const i=await Fe(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(s=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:(r=e==null?void 0:e.options)===null||r===void 0?void 0:r.captchaToken}},xform:Lr}),{data:a,error:o}=i;if(o||!a)return{data:{user:null,session:null},error:o};const c=a.session,d=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:d,session:c},error:null}}catch(i){if(Te(i))return{data:{user:null,session:null},error:i};throw i}}async signUp(e){var t,s,r;try{let i;if("email"in e){const{email:h,password:f,options:m}=e;let p=null,g=null;this.flowType==="pkce"&&([p,g]=await vl(this.storage,this.storageKey)),i=await Fe(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:m==null?void 0:m.emailRedirectTo,body:{email:h,password:f,data:(t=m==null?void 0:m.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:m==null?void 0:m.captchaToken},code_challenge:p,code_challenge_method:g},xform:Lr})}else if("phone"in e){const{phone:h,password:f,options:m}=e;i=await Fe(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:h,password:f,data:(s=m==null?void 0:m.data)!==null&&s!==void 0?s:{},channel:(r=m==null?void 0:m.channel)!==null&&r!==void 0?r:"sms",gotrue_meta_security:{captcha_token:m==null?void 0:m.captchaToken}},xform:Lr})}else throw new Of("You must provide either an email or phone number and a password");const{data:a,error:o}=i;if(o||!a)return{data:{user:null,session:null},error:o};const c=a.session,d=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:d,session:c},error:null}}catch(i){if(Te(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(e){try{let t;if("email"in e){const{email:i,password:a,options:o}=e;t=await Fe(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:fw})}else if("phone"in e){const{phone:i,password:a,options:o}=e;t=await Fe(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:fw})}else throw new Of("You must provide either an email or phone number and a password");const{data:s,error:r}=t;return r?{data:{user:null,session:null},error:r}:!s||!s.session||!s.user?{data:{user:null,session:null},error:new Lf}:(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:r})}catch(t){if(Te(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,s,r,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(s=e.options)===null||s===void 0?void 0:s.scopes,queryParams:(r=e.options)===null||r===void 0?void 0:r.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;if(t==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}async signInWithSolana(e){var t,s,r,i,a,o,c,d,h,f,m,p;let g,y;if("message"in e)g=e.message,y=e.signature;else{const{chain:N,wallet:b,statement:x,options:_}=e;let w;if(On())if(typeof b=="object")w=b;else{const C=window;if("solana"in C&&typeof C.solana=="object"&&("signIn"in C.solana&&typeof C.solana.signIn=="function"||"signMessage"in C.solana&&typeof C.solana.signMessage=="function"))w=C.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof b!="object"||!(_!=null&&_.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");w=b}const k=new URL((t=_==null?void 0:_.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in w&&w.signIn){const C=await w.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},_==null?void 0:_.signInWithSolana),{version:"1",domain:k.host,uri:k.href}),x?{statement:x}:null));let T;if(Array.isArray(C)&&C[0]&&typeof C[0]=="object")T=C[0];else if(C&&typeof C=="object"&&"signedMessage"in C&&"signature"in C)T=C;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in T&&"signature"in T&&(typeof T.signedMessage=="string"||T.signedMessage instanceof Uint8Array)&&T.signature instanceof Uint8Array)g=typeof T.signedMessage=="string"?T.signedMessage:new TextDecoder().decode(T.signedMessage),y=T.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in w)||typeof w.signMessage!="function"||!("publicKey"in w)||typeof w!="object"||!w.publicKey||!("toBase58"in w.publicKey)||typeof w.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");g=[`${k.host} wants you to sign in with your Solana account:`,w.publicKey.toBase58(),...x?["",x,""]:[""],"Version: 1",`URI: ${k.href}`,`Issued At: ${(r=(s=_==null?void 0:_.signInWithSolana)===null||s===void 0?void 0:s.issuedAt)!==null&&r!==void 0?r:new Date().toISOString()}`,...!((i=_==null?void 0:_.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${_.signInWithSolana.notBefore}`]:[],...!((a=_==null?void 0:_.signInWithSolana)===null||a===void 0)&&a.expirationTime?[`Expiration Time: ${_.signInWithSolana.expirationTime}`]:[],...!((o=_==null?void 0:_.signInWithSolana)===null||o===void 0)&&o.chainId?[`Chain ID: ${_.signInWithSolana.chainId}`]:[],...!((c=_==null?void 0:_.signInWithSolana)===null||c===void 0)&&c.nonce?[`Nonce: ${_.signInWithSolana.nonce}`]:[],...!((d=_==null?void 0:_.signInWithSolana)===null||d===void 0)&&d.requestId?[`Request ID: ${_.signInWithSolana.requestId}`]:[],...!((f=(h=_==null?void 0:_.signInWithSolana)===null||h===void 0?void 0:h.resources)===null||f===void 0)&&f.length?["Resources",..._.signInWithSolana.resources.map(T=>`- ${T}`)]:[]].join(`
`);const C=await w.signMessage(new TextEncoder().encode(g),"utf8");if(!C||!(C instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");y=C}}try{const{data:N,error:b}=await Fe(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:g,signature:Xj(y)},!((m=e.options)===null||m===void 0)&&m.captchaToken?{gotrue_meta_security:{captcha_token:(p=e.options)===null||p===void 0?void 0:p.captchaToken}}:null),xform:Lr});if(b)throw b;return!N||!N.session||!N.user?{data:{user:null,session:null},error:new Lf}:(N.session&&(await this._saveSession(N.session),await this._notifyAllSubscribers("SIGNED_IN",N.session)),{data:Object.assign({},N),error:b})}catch(N){if(Te(N))return{data:{user:null,session:null},error:N};throw N}}async _exchangeCodeForSession(e){const t=await Oa(this.storage,`${this.storageKey}-code-verifier`),[s,r]=(t??"").split("/");try{const{data:i,error:a}=await Fe(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:Lr});if(await Ti(this.storage,`${this.storageKey}-code-verifier`),a)throw a;return!i||!i.session||!i.user?{data:{user:null,session:null,redirectType:null},error:new Lf}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign(Object.assign({},i),{redirectType:r??null}),error:a})}catch(i){if(Te(i))return{data:{user:null,session:null,redirectType:null},error:i};throw i}}async signInWithIdToken(e){try{const{options:t,provider:s,token:r,access_token:i,nonce:a}=e,o=await Fe(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:r,access_token:i,nonce:a,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:Lr}),{data:c,error:d}=o;return d?{data:{user:null,session:null},error:d}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new Lf}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:d})}catch(t){if(Te(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,s,r,i,a;try{if("email"in e){const{email:o,options:c}=e;let d=null,h=null;this.flowType==="pkce"&&([d,h]=await vl(this.storage,this.storageKey));const{error:f}=await Fe(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:o,data:(t=c==null?void 0:c.data)!==null&&t!==void 0?t:{},create_user:(s=c==null?void 0:c.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},code_challenge:d,code_challenge_method:h},redirectTo:c==null?void 0:c.emailRedirectTo});return{data:{user:null,session:null},error:f}}if("phone"in e){const{phone:o,options:c}=e,{data:d,error:h}=await Fe(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:o,data:(r=c==null?void 0:c.data)!==null&&r!==void 0?r:{},create_user:(i=c==null?void 0:c.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},channel:(a=c==null?void 0:c.channel)!==null&&a!==void 0?a:"sms"}});return{data:{user:null,session:null,messageId:d==null?void 0:d.message_id},error:h}}throw new Of("You must provide either an email or phone number.")}catch(o){if(Te(o))return{data:{user:null,session:null},error:o};throw o}}async verifyOtp(e){var t,s;try{let r,i;"options"in e&&(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo,i=(s=e.options)===null||s===void 0?void 0:s.captchaToken);const{data:a,error:o}=await Fe(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:r,xform:Lr});if(o)throw o;if(!a)throw new Error("An error occurred on token verification.");const c=a.session,d=a.user;return c!=null&&c.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),{data:{user:d,session:c},error:null}}catch(r){if(Te(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithSSO(e){var t,s,r;try{let i=null,a=null;return this.flowType==="pkce"&&([i,a]=await vl(this.storage,this.storageKey)),await Fe(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&s!==void 0?s:void 0}),!((r=e==null?void 0:e.options)===null||r===void 0)&&r.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:a}),headers:this.headers,xform:p2})}catch(i){if(Te(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new Ri;const{error:r}=await Fe(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:r}})}catch(e){if(Te(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:s,type:r,options:i}=e,{error:a}=await Fe(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:r,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:a}}else if("phone"in e){const{phone:s,type:r,options:i}=e,{data:a,error:o}=await Fe(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:r,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:a==null?void 0:a.message_id},error:o}}throw new Of("You must provide either an email or phone number and a type")}catch(t){if(Te(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const s=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),r=(async()=>(await s,await t()))();return this.pendingInLock.push((async()=>{try{await r}catch{}})()),r}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const s=t();for(this.pendingInLock.push((async()=>{try{await s}catch{}})()),await s;this.pendingInLock.length;){const r=[...this.pendingInLock];await Promise.all(r),this.pendingInLock.splice(0,r.length)}return await s}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await Oa(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const s=e.expires_at?e.expires_at*1e3-Date.now()<Fg:!1;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.userStorage){const a=await Oa(this.userStorage,this.storageKey+"-user");a!=null&&a.user?e.user=a.user:e.user=Ug()}if(this.storage.isServer&&e.user){let a=this.suppressGetSessionWarning;e=new Proxy(e,{get:(c,d,h)=>(!a&&d==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),a=!0,this.suppressGetSessionWarning=!0),Reflect.get(c,d,h))})}return{data:{session:e},error:null}}const{session:r,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{session:null},error:i}:{data:{session:r},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await Fe(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Oi}):await this._useSession(async t=>{var s,r,i;const{data:a,error:o}=t;if(o)throw o;return!(!((s=a.session)===null||s===void 0)&&s.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Ri}:await Fe(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(r=a.session)===null||r===void 0?void 0:r.access_token)!==null&&i!==void 0?i:void 0,xform:Oi})})}catch(t){if(Te(t))return Uj(t)&&(await this._removeSession(),await Ti(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async s=>{const{data:r,error:i}=s;if(i)throw i;if(!r.session)throw new Ri;const a=r.session;let o=null,c=null;this.flowType==="pkce"&&e.email!=null&&([o,c]=await vl(this.storage,this.storageKey));const{data:d,error:h}=await Fe(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:o,code_challenge_method:c}),jwt:a.access_token,xform:Oi});if(h)throw h;return a.user=d.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),{data:{user:a.user},error:null}})}catch(s){if(Te(s))return{data:{user:null},error:s};throw s}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Ri;const t=Date.now()/1e3;let s=t,r=!0,i=null;const{payload:a}=Bg(e.access_token);if(a.exp&&(s=a.exp,r=s<=t),r){const{session:o,error:c}=await this._callRefreshToken(e.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!o)return{data:{user:null,session:null},error:null};i=o}else{const{data:o,error:c}=await this._getUser(e.access_token);if(c)throw c;i={access_token:e.access_token,refresh_token:e.refresh_token,user:o.user,token_type:"bearer",expires_in:s-t,expires_at:s},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(t){if(Te(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var s;if(!e){const{data:a,error:o}=t;if(o)throw o;e=(s=a.session)!==null&&s!==void 0?s:void 0}if(!(e!=null&&e.refresh_token))throw new Ri;const{session:r,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:r?{data:{user:r.user,session:r},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(Te(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!On())throw new Ff("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Ff(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new aw("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Ff("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new aw("No code detected.");const{data:x,error:_}=await this._exchangeCodeForSession(e.code);if(_)throw _;const w=new URL(window.location.href);return w.searchParams.delete("code"),window.history.replaceState(window.history.state,"",w.toString()),{data:{session:x.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:r,access_token:i,refresh_token:a,expires_in:o,expires_at:c,token_type:d}=e;if(!i||!o||!a||!d)throw new Ff("No session defined in URL");const h=Math.round(Date.now()/1e3),f=parseInt(o);let m=h+f;c&&(m=parseInt(c));const p=m-h;p*1e3<=_l&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${p}s, should have been closer to ${f}s`);const g=m-f;h-g>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",g,m,h):h-g<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",g,m,h);const{data:y,error:N}=await this._getUser(i);if(N)throw N;const b={provider_token:s,provider_refresh_token:r,access_token:i,expires_in:f,expires_at:m,refresh_token:a,token_type:d,user:y.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:b,redirectType:e.type},error:null}}catch(s){if(Te(s))return{data:{session:null,redirectType:null},error:s};throw s}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await Oa(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var s;const{data:r,error:i}=t;if(i)return{error:i};const a=(s=r.session)===null||s===void 0?void 0:s.access_token;if(a){const{error:o}=await this.admin.signOut(a,e);if(o&&!(Bj(o)&&(o.status===404||o.status===401||o.status===403)))return{error:o}}return e!=="others"&&(await this._removeSession(),await Ti(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=Jj(),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession(async t=>{var s,r;try{const{data:{session:i},error:a}=t;if(a)throw a;await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,t={}){let s=null,r=null;this.flowType==="pkce"&&([s,r]=await vl(this.storage,this.storageKey,!0));try{return await Fe(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:r,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(Te(i))return{data:null,error:i};throw i}}async getUserIdentities(){var e;try{const{data:t,error:s}=await this.getUser();if(s)throw s;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(Te(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:s,error:r}=await this._useSession(async i=>{var a,o,c,d,h;const{data:f,error:m}=i;if(m)throw m;const p=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(a=e.options)===null||a===void 0?void 0:a.redirectTo,scopes:(o=e.options)===null||o===void 0?void 0:o.scopes,queryParams:(c=e.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await Fe(this.fetch,"GET",p,{headers:this.headers,jwt:(h=(d=f.session)===null||d===void 0?void 0:d.access_token)!==null&&h!==void 0?h:void 0})});if(r)throw r;return On()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(s==null?void 0:s.url),{data:{provider:e.provider,url:s==null?void 0:s.url},error:null}}catch(s){if(Te(s))return{data:{provider:e.provider,url:null},error:s};throw s}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var s,r;const{data:i,error:a}=t;if(a)throw a;return await Fe(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(r=(s=i.session)===null||s===void 0?void 0:s.access_token)!==null&&r!==void 0?r:void 0})})}catch(t){if(Te(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const s=Date.now();return await t2(async r=>(r>0&&await e2(200*Math.pow(2,r-1)),this._debug(t,"refreshing attempt",r),await Fe(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Lr})),(r,i)=>{const a=200*Math.pow(2,r);return i&&$g(i)&&Date.now()+a-s<_l})}catch(s){if(this._debug(t,"error",s),Te(s))return{data:{session:null,user:null},error:s};throw s}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),On()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e,t;const s="#_recoverAndRefresh()";this._debug(s,"begin");try{const r=await Oa(this.storage,this.storageKey);if(r&&this.userStorage){let a=await Oa(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!a&&(a={user:r.user},await Sl(this.userStorage,this.storageKey+"-user",a)),r.user=(e=a==null?void 0:a.user)!==null&&e!==void 0?e:Ug()}else if(r&&!r.user&&!r.user){const a=await Oa(this.storage,this.storageKey+"-user");a&&(a!=null&&a.user)?(r.user=a.user,await Ti(this.storage,this.storageKey+"-user"),await Sl(this.storage,this.storageKey,r)):r.user=Ug()}if(this._debug(s,"session from storage",r),!this._isValidSession(r)){this._debug(s,"session is not valid"),r!==null&&await this._removeSession();return}const i=((t=r.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<Fg;if(this._debug(s,`session has${i?"":" not"} expired with margin of ${Fg}s`),i){if(this.autoRefreshToken&&r.refresh_token){const{error:a}=await this._callRefreshToken(r.refresh_token);a&&(console.error(a),$g(a)||(this._debug(s,"refresh failed with a non-retryable error, removing the session",a),await this._removeSession()))}}else if(r.user&&r.user.__isUserNotAvailableProxy===!0)try{const{data:a,error:o}=await this._getUser(r.access_token);!o&&(a!=null&&a.user)?(r.user=a.user,await this._saveSession(r),await this._notifyAllSubscribers("SIGNED_IN",r)):this._debug(s,"could not get user data, skipping SIGNED_IN notification")}catch(a){console.error("Error getting user data:",a),this._debug(s,"error getting user data, skipping SIGNED_IN notification",a)}else await this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){this._debug(s,"error",r),console.error(r);return}finally{this._debug(s,"end")}}async _callRefreshToken(e){var t,s;if(!e)throw new Ri;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const r=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(r,"begin");try{this.refreshingDeferred=new Qp;const{data:i,error:a}=await this._refreshAccessToken(e);if(a)throw a;if(!i.session)throw new Ri;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const o={session:i.session,error:null};return this.refreshingDeferred.resolve(o),o}catch(i){if(this._debug(r,"error",i),Te(i)){const a={session:null,error:i};return $g(i)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(a),a}throw(s=this.refreshingDeferred)===null||s===void 0||s.reject(i),i}finally{this.refreshingDeferred=null,this._debug(r,"end")}}async _notifyAllSubscribers(e,t,s=!0){const r=`#_notifyAllSubscribers(${e})`;this._debug(r,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});const i=[],a=Array.from(this.stateChangeEmitters.values()).map(async o=>{try{await o.callback(e,t)}catch(c){i.push(c)}});if(await Promise.all(a),i.length>0){for(let o=0;o<i.length;o+=1)console.error(i[o]);throw i[0]}}finally{this._debug(r,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),s=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!s&&t.user&&await Sl(this.userStorage,this.storageKey+"-user",{user:t.user});const r=Object.assign({},t);delete r.user;const i=dw(r);await Sl(this.storage,this.storageKey,i)}else{const r=dw(t);await Sl(this.storage,this.storageKey,r)}}async _removeSession(){this._debug("#_removeSession()"),await Ti(this.storage,this.storageKey),await Ti(this.storage,this.storageKey+"-code-verifier"),await Ti(this.storage,this.storageKey+"-user"),this.userStorage&&await Ti(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&On()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),_l);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:s}}=t;if(!s||!s.refresh_token||!s.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const r=Math.floor((s.expires_at*1e3-e)/_l);this._debug("#_autoRefreshTokenTick()",`access token expires in ${r} ticks, a tick lasts ${_l}ms, refresh threshold is ${Z0} ticks`),r<=Z0&&await this._callRefreshToken(s.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof A1)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!On()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,s){const r=[`provider=${encodeURIComponent(t)}`];if(s!=null&&s.redirectTo&&r.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),s!=null&&s.scopes&&r.push(`scopes=${encodeURIComponent(s.scopes)}`),this.flowType==="pkce"){const[i,a]=await vl(this.storage,this.storageKey),o=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(a)}`});r.push(o.toString())}if(s!=null&&s.queryParams){const i=new URLSearchParams(s.queryParams);r.push(i.toString())}return s!=null&&s.skipBrowserRedirect&&r.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${r.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var s;const{data:r,error:i}=t;return i?{data:null,error:i}:await Fe(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(s=r==null?void 0:r.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(Te(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var s,r;const{data:i,error:a}=t;if(a)return{data:null,error:a};const o=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:c,error:d}=await Fe(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token});return d?{data:null,error:d}:(e.factorType==="totp"&&(!((r=c==null?void 0:c.totp)===null||r===void 0)&&r.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),{data:c,error:null})})}catch(t){if(Te(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:r,error:i}=t;if(i)return{data:null,error:i};const{data:a,error:o}=await Fe(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(s=r==null?void 0:r.session)===null||s===void 0?void 0:s.access_token});return o?{data:null,error:o}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),{data:a,error:o})})}catch(t){if(Te(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:r,error:i}=t;return i?{data:null,error:i}:await Fe(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(s=r==null?void 0:r.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(Te(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:s}=await this._challenge({factorId:e.factorId});return s?{data:null,error:s}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const s=(e==null?void 0:e.factors)||[],r=s.filter(a=>a.factor_type==="totp"&&a.status==="verified"),i=s.filter(a=>a.factor_type==="phone"&&a.status==="verified");return{data:{all:s,totp:r,phone:i},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,s;const{data:{session:r},error:i}=e;if(i)return{data:null,error:i};if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:a}=Bg(r.access_token);let o=null;a.aal&&(o=a.aal);let c=o;((s=(t=r.user.factors)===null||t===void 0?void 0:t.filter(f=>f.status==="verified"))!==null&&s!==void 0?s:[]).length>0&&(c="aal2");const h=a.amr||[];return{data:{currentLevel:o,nextLevel:c,currentAuthenticationMethods:h},error:null}}))}async fetchJwk(e,t={keys:[]}){let s=t.keys.find(o=>o.kid===e);if(s)return s;const r=Date.now();if(s=this.jwks.keys.find(o=>o.kid===e),s&&this.jwks_cached_at+Fj>r)return s;const{data:i,error:a}=await Fe(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(a)throw a;return!i.keys||i.keys.length===0||(this.jwks=i,this.jwks_cached_at=r,s=i.keys.find(o=>o.kid===e),!s)?null:s}async getClaims(e,t={}){try{let s=e;if(!s){const{data:p,error:g}=await this.getSession();if(g||!p.session)return{data:null,error:g};s=p.session.access_token}const{header:r,payload:i,signature:a,raw:{header:o,payload:c}}=Bg(s);t!=null&&t.allowExpired||l2(i.exp);const d=!r.alg||r.alg.startsWith("HS")||!r.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(r.kid,t!=null&&t.keys?{keys:t.keys}:t==null?void 0:t.jwks);if(!d){const{error:p}=await this.getUser(s);if(p)throw p;return{data:{claims:i,header:r,signature:a},error:null}}const h=c2(r.alg),f=await crypto.subtle.importKey("jwk",d,h,!0,["verify"]);if(!await crypto.subtle.verify(h,f,a,Kj(`${o}.${c}`)))throw new sy("Invalid JWT signature");return{data:{claims:i,header:r,signature:a},error:null}}catch(s){if(Te(s))return{data:null,error:s};throw s}}}jd.nextInstanceID=0;const N2=jd;class k2 extends N2{constructor(e){super(e)}}var E2=function(n,e,t,s){function r(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(h){try{d(s.next(h))}catch(f){a(f)}}function c(h){try{d(s.throw(h))}catch(f){a(f)}}function d(h){h.done?i(h.value):r(h.value).then(o,c)}d((s=s.apply(n,e||[])).next())})};class C2{constructor(e,t,s){var r,i,a;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const o=Ij(e),c=new URL(o);this.realtimeUrl=new URL("realtime/v1",c),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",c),this.storageUrl=new URL("storage/v1",c),this.functionsUrl=new URL("functions/v1",c);const d=`sb-${c.hostname.split(".")[0]}-auth-token`,h={db:Aj,realtime:kj,auth:Object.assign(Object.assign({},Nj),{storageKey:d}),global:Sj},f=Pj(s??{},h);this.storageKey=(r=f.auth.storageKey)!==null&&r!==void 0?r:"",this.headers=(i=f.global.headers)!==null&&i!==void 0?i:{},f.accessToken?(this.accessToken=f.accessToken,this.auth=new Proxy({},{get:(m,p)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(p)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((a=f.auth)!==null&&a!==void 0?a:{},this.headers,f.global.fetch),this.fetch=Tj(t,this._getAccessToken.bind(this),f.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},f.realtime)),this.rest=new qC(new URL("rest/v1",c).href,{headers:this.headers,schema:f.db.schema,fetch:this.fetch}),this.storage=new xj(this.storageUrl.href,this.headers,this.fetch,s==null?void 0:s.storage),f.accessToken||this._listenForAuthEvents()}get functions(){return new _C(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return E2(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:s}=yield this.auth.getSession();return(t=(e=s.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:r,storageKey:i,flowType:a,lock:o,debug:c},d,h){const f={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new k2({url:this.authUrl.href,headers:Object.assign(Object.assign({},f),d),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:r,flowType:a,lock:o,debug:c,fetch:h,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new oj(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,s)=>{this._handleTokenChanged(t,"CLIENT",s==null?void 0:s.access_token)})}_handleTokenChanged(e,t,s){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==s?this.changedAccessToken=s:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const j2=(n,e,t)=>new C2(n,e,t);function T2(){if(typeof window<"u"||typeof process>"u")return!1;const n=process.version;if(n==null)return!1;const e=n.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}T2()&&console.warn("⚠️  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const R2="https://lkwrmqpmgkwyvykjqvel.supabase.co",I2="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imxrd3JtcXBtZ2t3eXZ5a2pxdmVsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYxNTE2NTUsImV4cCI6MjA3MTcyNzY1NX0.Q7XUj3hTLz0XdfnhsrrhrG9EetC7a_5F98nufecKx4Q",gw=async n=>{const{data:e,error:t}=await Ps.from("applications").select("*").eq("id",n).single();if(t)throw t;return e},Ps=j2(R2,I2),xb=async n=>{const{data:e,error:t}=await Ps.from("applications").insert([n]).select().single();if(t)throw t;return e},N1=async()=>{const{data:n,error:e}=await Ps.from("applications").select("*").order("created_at",{ascending:!1});if(e)throw e;return n},k1=async(n,e)=>{const{data:t,error:s}=await Ps.from("applications").update({...e,updated_at:new Date().toISOString()}).eq("id",n).select().single();if(s)throw s;return t},P2=async n=>{const{error:e}=await Ps.from("applications").delete().eq("id",n);if(e)throw e},wb=async()=>{const{data:n,error:e}=await Ps.from("lenders").select("*").order("name");if(e)throw e;return n},D2=async n=>{const{data:e,error:t}=await Ps.from("lenders").insert([n]).select().single();if(t)throw t;return e},M2=async(n,e)=>{const{data:t,error:s}=await Ps.from("lenders").update({...e,updated_at:new Date().toISOString()}).eq("id",n).select().single();if(s)throw s;return t},L2=async n=>{const{error:e}=await Ps.from("lenders").delete().eq("id",n);if(e)throw e},E1=async(n,e)=>{const t=e.map(i=>({application_id:n,lender_id:i,status:"pending"})),{data:s,error:r}=await Ps.from("lender_submissions").upsert(t,{onConflict:"application_id,lender_id",ignoreDuplicates:!0}).select();if(r)throw r;return s},ny=async n=>{const{data:e,error:t}=await Ps.from("lender_submissions").select(`
      *,
      lender:lenders(*)
    `).eq("application_id",n);if(t)throw t;return e},O2=async(n,e)=>{const{data:t,error:s}=await Ps.from("lender_submissions").update({...e,updated_at:new Date().toISOString()}).eq("id",n).select().single();if(s)throw s;return t},ry=async n=>{const{data:e,error:t}=await Ps.from("application_documents").select("*").eq("application_id",n).order("created_at",{ascending:!1});if(t)throw t;return e},yw=async n=>{const{error:e}=await Ps.from("application_documents").delete().eq("id",n);if(e)throw e},F2=async(n,e,t)=>{let s=Ps.from("application_documents").delete().eq("application_id",n).eq("statement_date",e);t&&(s=s.eq("file_name",t));const{error:r}=await s;if(r)throw r},$2=(n,e)=>n.map(t=>{let s=!0,r=100;return(e.requested_amount<t.min_amount||e.requested_amount>t.max_amount)&&(s=!1,r-=30),(e.credit_score<t.min_credit_score||e.credit_score>t.max_credit_score)&&(s=!1,r-=25),e.years_in_business<t.min_time_in_business&&(s=!1,r-=20),e.monthly_revenue<t.min_monthly_revenue&&(s=!1,r-=15),!t.industries.includes("All Industries")&&!t.industries.includes(e.industry)&&(r-=10),parseFloat(t.factor_rate.split(" - ")[0])<1.15&&(r+=5),(t.approval_time.includes("24 hours")||t.approval_time.includes("2 hours"))&&(r+=3),{...t,qualified:s,matchScore:Math.max(0,r)}});var ud={};ud.d=(n,e)=>{for(var t in e)ud.o(e,t)&&!ud.o(n,t)&&Object.defineProperty(n,t,{enumerable:!0,get:e[t]})};ud.o=(n,e)=>Object.prototype.hasOwnProperty.call(n,e);var ke=globalThis.pdfjsLib={};ud.d(ke,{AbortException:()=>Ca,AnnotationEditorLayer:()=>fv,AnnotationEditorParamsType:()=>Be,AnnotationEditorType:()=>Ie,AnnotationEditorUIManager:()=>cl,AnnotationLayer:()=>DR,AnnotationMode:()=>Fi,ColorPicker:()=>up,DOMSVGFactory:()=>Tb,DrawLayer:()=>gv,FeatureTest:()=>Cs,GlobalWorkerOptions:()=>gi,ImageKind:()=>sm,InvalidPDFException:()=>ay,MissingPDFException:()=>Td,OPS:()=>Bn,OutputScale:()=>ly,PDFDataRangeTransport:()=>jA,PDFDateString:()=>kb,PDFWorker:()=>Zl,PasswordResponses:()=>H2,PermissionFlag:()=>z2,PixelsPerInch:()=>ja,RenderingCancelledException:()=>Ab,TextLayer:()=>Rd,TouchManager:()=>lp,UnexpectedResponseException:()=>ip,Util:()=>ve,VerbosityLevel:()=>Zp,XfaLayer:()=>RA,build:()=>mR,createValidAbsoluteUrl:()=>G2,fetchData:()=>ng,getDocument:()=>iR,getFilenameFromUrl:()=>sT,getPdfFilenameFromUrl:()=>nT,getXfaPageViewport:()=>rT,isDataScheme:()=>rg,isPdfFile:()=>Nb,noContextMenu:()=>ar,normalizeUnicode:()=>Z2,setLayerDimensions:()=>ll,shadow:()=>Le,stopEvent:()=>dn,version:()=>fR});const ys=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),C1=[1,0,0,1,0,0],iy=[.001,0,0,.001,0,0],B2=1e7,Hg=1.35,ln={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},Fi={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},U2="pdfjs_internal_editor_",Ie={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15},Be={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35,DRAW_STEP:41},z2={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},ls={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},sm={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},Dt={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},Eu={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},Zp={ERRORS:0,WARNINGS:1,INFOS:5},Bn={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93},H2={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let eg=Zp.WARNINGS;function q2(n){Number.isInteger(n)&&(eg=n)}function W2(){return eg}function tg(n){eg>=Zp.INFOS&&console.log(`Info: ${n}`)}function Pe(n){eg>=Zp.WARNINGS&&console.log(`Warning: ${n}`)}function st(n){throw new Error(n)}function Rt(n,e){n||st(e)}function V2(n){switch(n==null?void 0:n.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function G2(n,e=null,t=null){if(!n)return null;try{if(t&&typeof n=="string"){if(t.addDefaultProtocol&&n.startsWith("www.")){const r=n.match(/\./g);(r==null?void 0:r.length)>=2&&(n=`http://${n}`)}if(t.tryConvertEncoding)try{n=Q2(n)}catch{}}const s=e?new URL(n,e):new URL(n);if(V2(s))return s}catch{}return null}function Le(n,e,t,s=!1){return Object.defineProperty(n,e,{value:t,enumerable:!s,configurable:!0,writable:!1}),t}const Ma=function(){function e(t,s){this.message=t,this.name=s}return e.prototype=new Error,e.constructor=e,e}();class vw extends Ma{constructor(e,t){super(e,"PasswordException"),this.code=t}}class qg extends Ma{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}}class ay extends Ma{constructor(e){super(e,"InvalidPDFException")}}class Td extends Ma{constructor(e){super(e,"MissingPDFException")}}class ip extends Ma{constructor(e,t){super(e,"UnexpectedResponseException"),this.status=t}}class K2 extends Ma{constructor(e){super(e,"FormatError")}}class Ca extends Ma{constructor(e){super(e,"AbortException")}}function j1(n){(typeof n!="object"||(n==null?void 0:n.length)===void 0)&&st("Invalid argument for bytesToString");const e=n.length,t=8192;if(e<t)return String.fromCharCode.apply(null,n);const s=[];for(let r=0;r<e;r+=t){const i=Math.min(r+t,e),a=n.subarray(r,i);s.push(String.fromCharCode.apply(null,a))}return s.join("")}function sg(n){typeof n!="string"&&st("Invalid argument for stringToBytes");const e=n.length,t=new Uint8Array(e);for(let s=0;s<e;++s)t[s]=n.charCodeAt(s)&255;return t}function X2(n){return String.fromCharCode(n>>24&255,n>>16&255,n>>8&255,n&255)}function _b(n){const e=Object.create(null);for(const[t,s]of n)e[t]=s;return e}function Y2(){const n=new Uint8Array(4);return n[0]=1,new Uint32Array(n.buffer,0,1)[0]===1}function J2(){try{return new Function(""),!0}catch{return!1}}class Cs{static get isLittleEndian(){return Le(this,"isLittleEndian",Y2())}static get isEvalSupported(){return Le(this,"isEvalSupported",J2())}static get isOffscreenCanvasSupported(){return Le(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return Le(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get platform(){return typeof navigator<"u"&&typeof(navigator==null?void 0:navigator.platform)=="string"?Le(this,"platform",{isMac:navigator.platform.includes("Mac"),isWindows:navigator.platform.includes("Win"),isFirefox:typeof(navigator==null?void 0:navigator.userAgent)=="string"&&navigator.userAgent.includes("Firefox")}):Le(this,"platform",{isMac:!1,isWindows:!1,isFirefox:!1})}static get isCSSRoundSupported(){var e,t;return Le(this,"isCSSRoundSupported",(t=(e=globalThis.CSS)==null?void 0:e.supports)==null?void 0:t.call(e,"width: round(1.5px, 1px)"))}}const Wg=Array.from(Array(256).keys(),n=>n.toString(16).padStart(2,"0"));var xi,nm,oy;class ve{static makeHexColor(e,t,s){return`#${Wg[e]}${Wg[t]}${Wg[s]}`}static scaleMinMax(e,t){let s;e[0]?(e[0]<0&&(s=t[0],t[0]=t[2],t[2]=s),t[0]*=e[0],t[2]*=e[0],e[3]<0&&(s=t[1],t[1]=t[3],t[3]=s),t[1]*=e[3],t[3]*=e[3]):(s=t[0],t[0]=t[1],t[1]=s,s=t[2],t[2]=t[3],t[3]=s,e[1]<0&&(s=t[1],t[1]=t[3],t[3]=s),t[1]*=e[1],t[3]*=e[1],e[2]<0&&(s=t[0],t[0]=t[2],t[2]=s),t[0]*=e[2],t[2]*=e[2]),t[0]+=e[4],t[1]+=e[5],t[2]+=e[4],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static applyTransform(e,t){const s=e[0]*t[0]+e[1]*t[2]+t[4],r=e[0]*t[1]+e[1]*t[3]+t[5];return[s,r]}static applyInverseTransform(e,t){const s=t[0]*t[3]-t[1]*t[2],r=(e[0]*t[3]-e[1]*t[2]+t[2]*t[5]-t[4]*t[3])/s,i=(-e[0]*t[1]+e[1]*t[0]+t[4]*t[1]-t[5]*t[0])/s;return[r,i]}static getAxialAlignedBoundingBox(e,t){const s=this.applyTransform(e,t),r=this.applyTransform(e.slice(2,4),t),i=this.applyTransform([e[0],e[3]],t),a=this.applyTransform([e[2],e[1]],t);return[Math.min(s[0],r[0],i[0],a[0]),Math.min(s[1],r[1],i[1],a[1]),Math.max(s[0],r[0],i[0],a[0]),Math.max(s[1],r[1],i[1],a[1])]}static inverseTransform(e){const t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e){const t=[e[0],e[2],e[1],e[3]],s=e[0]*t[0]+e[1]*t[2],r=e[0]*t[1]+e[1]*t[3],i=e[2]*t[0]+e[3]*t[2],a=e[2]*t[1]+e[3]*t[3],o=(s+a)/2,c=Math.sqrt((s+a)**2-4*(s*a-i*r))/2,d=o+c||1,h=o-c||1;return[Math.sqrt(d),Math.sqrt(h)]}static normalizeRect(e){const t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){const s=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),r=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(s>r)return null;const i=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),a=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return i>a?null:[s,i,r,a]}static bezierBoundingBox(e,t,s,r,i,a,o,c,d){return d?(d[0]=Math.min(d[0],e,o),d[1]=Math.min(d[1],t,c),d[2]=Math.max(d[2],e,o),d[3]=Math.max(d[3],t,c)):d=[Math.min(e,o),Math.min(t,c),Math.max(e,o),Math.max(t,c)],A(this,xi,oy).call(this,e,s,i,o,t,r,a,c,3*(-e+3*(s-i)+o),6*(e-2*s+i),3*(s-e),d),A(this,xi,oy).call(this,e,s,i,o,t,r,a,c,3*(-t+3*(r-a)+c),6*(t-2*r+a),3*(r-t),d),d}}xi=new WeakSet,nm=function(e,t,s,r,i,a,o,c,d,h){if(d<=0||d>=1)return;const f=1-d,m=d*d,p=m*d,g=f*(f*(f*e+3*d*t)+3*m*s)+p*r,y=f*(f*(f*i+3*d*a)+3*m*o)+p*c;h[0]=Math.min(h[0],g),h[1]=Math.min(h[1],y),h[2]=Math.max(h[2],g),h[3]=Math.max(h[3],y)},oy=function(e,t,s,r,i,a,o,c,d,h,f,m){if(Math.abs(d)<1e-12){Math.abs(h)>=1e-12&&A(this,xi,nm).call(this,e,t,s,r,i,a,o,c,-f/h,m);return}const p=h**2-4*f*d;if(p<0)return;const g=Math.sqrt(p),y=2*d;A(this,xi,nm).call(this,e,t,s,r,i,a,o,c,(-h+g)/y,m),A(this,xi,nm).call(this,e,t,s,r,i,a,o,c,(-h-g)/y,m)},S(ve,xi);function Q2(n){return decodeURIComponent(escape(n))}let Vg=null,bw=null;function Z2(n){return Vg||(Vg=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,bw=new Map([["ﬅ","ſt"]])),n.replaceAll(Vg,(e,t,s)=>t?t.normalize("NFKC"):bw.get(s))}function eT(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const n=new Uint8Array(32);return crypto.getRandomValues(n),j1(n)}const Sb="pdfjs_internal_id_";function tT(n){return Uint8Array.prototype.toBase64?n.toBase64():btoa(j1(n))}typeof Promise.try!="function"&&(Promise.try=function(n,...e){return new Promise(t=>{t(n(...e))})});const Or="http://www.w3.org/2000/svg",Wa=class Wa{};xe(Wa,"CSS",96),xe(Wa,"PDF",72),xe(Wa,"PDF_TO_CSS_UNITS",Wa.CSS/Wa.PDF);let ja=Wa;async function ng(n,e="text"){if(Lu(n,document.baseURI)){const t=await fetch(n);if(!t.ok)throw new Error(t.statusText);switch(e){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"json":return t.json()}return t.text()}return new Promise((t,s)=>{const r=new XMLHttpRequest;r.open("GET",n,!0),r.responseType=e,r.onreadystatechange=()=>{if(r.readyState===XMLHttpRequest.DONE){if(r.status===200||r.status===0){switch(e){case"arraybuffer":case"blob":case"json":t(r.response);return}t(r.responseText);return}s(new Error(r.statusText))}},r.send(null)})}class ff{constructor({viewBox:e,userUnit:t,scale:s,rotation:r,offsetX:i=0,offsetY:a=0,dontFlip:o=!1}){this.viewBox=e,this.userUnit=t,this.scale=s,this.rotation=r,this.offsetX=i,this.offsetY=a,s*=t;const c=(e[2]+e[0])/2,d=(e[3]+e[1])/2;let h,f,m,p;switch(r%=360,r<0&&(r+=360),r){case 180:h=-1,f=0,m=0,p=1;break;case 90:h=0,f=1,m=1,p=0;break;case 270:h=0,f=-1,m=-1,p=0;break;case 0:h=1,f=0,m=0,p=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}o&&(m=-m,p=-p);let g,y,N,b;h===0?(g=Math.abs(d-e[1])*s+i,y=Math.abs(c-e[0])*s+a,N=(e[3]-e[1])*s,b=(e[2]-e[0])*s):(g=Math.abs(c-e[0])*s+i,y=Math.abs(d-e[1])*s+a,N=(e[2]-e[0])*s,b=(e[3]-e[1])*s),this.transform=[h*s,f*s,m*s,p*s,g-h*s*c-m*s*d,y-f*s*c-p*s*d],this.width=N,this.height=b}get rawDims(){const{userUnit:e,viewBox:t}=this,s=t.map(r=>r*e);return Le(this,"rawDims",{pageWidth:s[2]-s[0],pageHeight:s[3]-s[1],pageX:s[0],pageY:s[1]})}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:s=this.offsetX,offsetY:r=this.offsetY,dontFlip:i=!1}={}){return new ff({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:e,rotation:t,offsetX:s,offsetY:r,dontFlip:i})}convertToViewportPoint(e,t){return ve.applyTransform([e,t],this.transform)}convertToViewportRectangle(e){const t=ve.applyTransform([e[0],e[1]],this.transform),s=ve.applyTransform([e[2],e[3]],this.transform);return[t[0],t[1],s[0],s[1]]}convertToPdfPoint(e,t){return ve.applyInverseTransform([e,t],this.transform)}}class Ab extends Ma{constructor(e,t=0){super(e,"RenderingCancelledException"),this.extraDelay=t}}function rg(n){const e=n.length;let t=0;for(;t<e&&n[t].trim()==="";)t++;return n.substring(t,t+5).toLowerCase()==="data:"}function Nb(n){return typeof n=="string"&&/\.pdf$/i.test(n)}function sT(n){return[n]=n.split(/[#?]/,1),n.substring(n.lastIndexOf("/")+1)}function nT(n,e="document.pdf"){if(typeof n!="string")return e;if(rg(n))return Pe('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),e;const t=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,s=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,r=t.exec(n);let i=s.exec(r[1])||s.exec(r[2])||s.exec(r[3]);if(i&&(i=i[0],i.includes("%")))try{i=s.exec(decodeURIComponent(i))[0]}catch{}return i||e}class xw{constructor(){xe(this,"started",Object.create(null));xe(this,"times",[])}time(e){e in this.started&&Pe(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||Pe(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){const e=[];let t=0;for(const{name:s}of this.times)t=Math.max(s.length,t);for(const{name:s,start:r,end:i}of this.times)e.push(`${s.padEnd(t)} ${i-r}ms
`);return e.join("")}}function Lu(n,e){try{const{protocol:t}=e?new URL(n,e):new URL(n);return t==="http:"||t==="https:"}catch{return!1}}function ar(n){n.preventDefault()}function dn(n){n.preventDefault(),n.stopPropagation()}var Pd;class kb{static toDateObject(e){if(!e||typeof e!="string")return null;l(this,Pd)||v(this,Pd,new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const t=l(this,Pd).exec(e);if(!t)return null;const s=parseInt(t[1],10);let r=parseInt(t[2],10);r=r>=1&&r<=12?r-1:0;let i=parseInt(t[3],10);i=i>=1&&i<=31?i:1;let a=parseInt(t[4],10);a=a>=0&&a<=23?a:0;let o=parseInt(t[5],10);o=o>=0&&o<=59?o:0;let c=parseInt(t[6],10);c=c>=0&&c<=59?c:0;const d=t[7]||"Z";let h=parseInt(t[8],10);h=h>=0&&h<=23?h:0;let f=parseInt(t[9],10)||0;return f=f>=0&&f<=59?f:0,d==="-"?(a+=h,o+=f):d==="+"&&(a-=h,o-=f),new Date(Date.UTC(s,r,i,a,o,c))}}Pd=new WeakMap,S(kb,Pd);function rT(n,{scale:e=1,rotation:t=0}){const{width:s,height:r}=n.attributes.style,i=[0,0,parseInt(s),parseInt(r)];return new ff({viewBox:i,userUnit:1,scale:e,rotation:t})}function Eb(n){if(n.startsWith("#")){const e=parseInt(n.slice(1),16);return[(e&16711680)>>16,(e&65280)>>8,e&255]}return n.startsWith("rgb(")?n.slice(4,-1).split(",").map(e=>parseInt(e)):n.startsWith("rgba(")?n.slice(5,-1).split(",").map(e=>parseInt(e)).slice(0,3):(Pe(`Not a valid color format: "${n}"`),[0,0,0])}function iT(n){const e=document.createElement("span");e.style.visibility="hidden",document.body.append(e);for(const t of n.keys()){e.style.color=t;const s=window.getComputedStyle(e).color;n.set(t,Eb(s))}e.remove()}function ht(n){const{a:e,b:t,c:s,d:r,e:i,f:a}=n.getTransform();return[e,t,s,r,i,a]}function cr(n){const{a:e,b:t,c:s,d:r,e:i,f:a}=n.getTransform().invertSelf();return[e,t,s,r,i,a]}function ll(n,e,t=!1,s=!0){if(e instanceof ff){const{pageWidth:r,pageHeight:i}=e.rawDims,{style:a}=n,o=Cs.isCSSRoundSupported,c=`var(--scale-factor) * ${r}px`,d=`var(--scale-factor) * ${i}px`,h=o?`round(down, ${c}, var(--scale-round-x, 1px))`:`calc(${c})`,f=o?`round(down, ${d}, var(--scale-round-y, 1px))`:`calc(${d})`;!t||e.rotation%180===0?(a.width=h,a.height=f):(a.width=f,a.height=h)}s&&n.setAttribute("data-main-rotation",e.rotation)}class ly{constructor(){const e=window.devicePixelRatio||1;this.sx=e,this.sy=e}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}}var $i,Ya,Un,Ja,Dd,Md,fp,T1,js,R1,I1,rm,P1,uy;const zr=class zr{constructor(e){S(this,js);S(this,$i,null);S(this,Ya,null);S(this,Un);S(this,Ja,null);S(this,Dd,null);v(this,Un,e),l(zr,Md)||v(zr,Md,Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button"}))}render(){const e=v(this,$i,document.createElement("div"));e.classList.add("editToolbar","hidden"),e.setAttribute("role","toolbar");const t=l(this,Un)._uiManager._signal;e.addEventListener("contextmenu",ar,{signal:t}),e.addEventListener("pointerdown",A(zr,fp,T1),{signal:t});const s=v(this,Ja,document.createElement("div"));s.className="buttons",e.append(s);const r=l(this,Un).toolbarPosition;if(r){const{style:i}=e,a=l(this,Un)._uiManager.direction==="ltr"?1-r[0]:r[0];i.insetInlineEnd=`${100*a}%`,i.top=`calc(${100*r[1]}% + var(--editor-toolbar-vert-offset))`}return A(this,js,P1).call(this),e}get div(){return l(this,$i)}hide(){var e;l(this,$i).classList.add("hidden"),(e=l(this,Ya))==null||e.hideDropdown()}show(){var e;l(this,$i).classList.remove("hidden"),(e=l(this,Dd))==null||e.shown()}async addAltText(e){const t=await e.render();A(this,js,rm).call(this,t),l(this,Ja).prepend(t,l(this,js,uy)),v(this,Dd,e)}addColorPicker(e){v(this,Ya,e);const t=e.renderButton();A(this,js,rm).call(this,t),l(this,Ja).prepend(t,l(this,js,uy))}remove(){var e;l(this,$i).remove(),(e=l(this,Ya))==null||e.destroy(),v(this,Ya,null)}};$i=new WeakMap,Ya=new WeakMap,Un=new WeakMap,Ja=new WeakMap,Dd=new WeakMap,Md=new WeakMap,fp=new WeakSet,T1=function(e){e.stopPropagation()},js=new WeakSet,R1=function(e){l(this,Un)._focusEventsAllowed=!1,dn(e)},I1=function(e){l(this,Un)._focusEventsAllowed=!0,dn(e)},rm=function(e){const t=l(this,Un)._uiManager._signal;e.addEventListener("focusin",A(this,js,R1).bind(this),{capture:!0,signal:t}),e.addEventListener("focusout",A(this,js,I1).bind(this),{capture:!0,signal:t}),e.addEventListener("contextmenu",ar,{signal:t})},P1=function(){const{editorType:e,_uiManager:t}=l(this,Un),s=document.createElement("button");s.className="delete",s.tabIndex=0,s.setAttribute("data-l10n-id",l(zr,Md)[e]),A(this,js,rm).call(this,s),s.addEventListener("click",r=>{t.delete()},{signal:t._signal}),l(this,Ja).append(s)},uy=function(){const e=document.createElement("div");return e.className="divider",e},S(zr,fp),S(zr,Md,null);let cy=zr;var Ld,Qa,Za,Ta,D1,M1,L1;class aT{constructor(e){S(this,Ta);S(this,Ld,null);S(this,Qa,null);S(this,Za);v(this,Za,e)}show(e,t,s){const[r,i]=A(this,Ta,M1).call(this,t,s),{style:a}=l(this,Qa)||v(this,Qa,A(this,Ta,D1).call(this));e.append(l(this,Qa)),a.insetInlineEnd=`${100*r}%`,a.top=`calc(${100*i}% + var(--editor-toolbar-vert-offset))`}hide(){l(this,Qa).remove()}}Ld=new WeakMap,Qa=new WeakMap,Za=new WeakMap,Ta=new WeakSet,D1=function(){const e=v(this,Qa,document.createElement("div"));e.className="editToolbar",e.setAttribute("role","toolbar"),e.addEventListener("contextmenu",ar,{signal:l(this,Za)._signal});const t=v(this,Ld,document.createElement("div"));return t.className="buttons",e.append(t),A(this,Ta,L1).call(this),e},M1=function(e,t){let s=0,r=0;for(const i of e){const a=i.y+i.height;if(a<s)continue;const o=i.x+(t?i.width:0);if(a>s){r=o,s=a;continue}t?o>r&&(r=o):o<r&&(r=o)}return[t?1-r:r,s]},L1=function(){const e=document.createElement("button");e.className="highlightButton",e.tabIndex=0,e.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");const t=document.createElement("span");e.append(t),t.className="visuallyHidden",t.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");const s=l(this,Za)._signal;e.addEventListener("contextmenu",ar,{signal:s}),e.addEventListener("click",()=>{l(this,Za).highlightSelection("floating_button")},{signal:s}),l(this,Ld).append(e)};function ap(n,e,t){for(const s of t)e.addEventListener(s,n[s].bind(n))}var mp;class oT{constructor(){S(this,mp,0)}get id(){return`${U2}${bs(this,mp)._++}`}}mp=new WeakMap;var ec,Od,ds,tc,im;const Ib=class Ib{constructor(){S(this,tc);S(this,ec,eT());S(this,Od,0);S(this,ds,null)}static get _isSVGFittingCanvas(){const e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',s=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),r=new Image;r.src=e;const i=r.decode().then(()=>(s.drawImage(r,0,0,1,1,0,0,1,3),new Uint32Array(s.getImageData(0,0,1,1).data.buffer)[0]===0));return Le(this,"_isSVGFittingCanvas",i)}async getFromFile(e){const{lastModified:t,name:s,size:r,type:i}=e;return A(this,tc,im).call(this,`${t}_${s}_${r}_${i}`,e)}async getFromUrl(e){return A(this,tc,im).call(this,e,e)}async getFromBlob(e,t){const s=await t;return A(this,tc,im).call(this,e,s)}async getFromId(e){l(this,ds)||v(this,ds,new Map);const t=l(this,ds).get(e);if(!t)return null;if(t.bitmap)return t.refCounter+=1,t;if(t.file)return this.getFromFile(t.file);if(t.blobPromise){const{blobPromise:s}=t;return delete t.blobPromise,this.getFromBlob(t.id,s)}return this.getFromUrl(t.url)}getFromCanvas(e,t){l(this,ds)||v(this,ds,new Map);let s=l(this,ds).get(e);if(s!=null&&s.bitmap)return s.refCounter+=1,s;const r=new OffscreenCanvas(t.width,t.height);return r.getContext("2d").drawImage(t,0,0),s={bitmap:r.transferToImageBitmap(),id:`image_${l(this,ec)}_${bs(this,Od)._++}`,refCounter:1,isSvg:!1},l(this,ds).set(e,s),l(this,ds).set(s.id,s),s}getSvgUrl(e){const t=l(this,ds).get(e);return t!=null&&t.isSvg?t.svgUrl:null}deleteId(e){var r;l(this,ds)||v(this,ds,new Map);const t=l(this,ds).get(e);if(!t||(t.refCounter-=1,t.refCounter!==0))return;const{bitmap:s}=t;if(!t.url&&!t.file){const i=new OffscreenCanvas(s.width,s.height);i.getContext("bitmaprenderer").transferFromImageBitmap(s),t.blobPromise=i.convertToBlob()}(r=s.close)==null||r.call(s),t.bitmap=null}isValidId(e){return e.startsWith(`image_${l(this,ec)}_`)}};ec=new WeakMap,Od=new WeakMap,ds=new WeakMap,tc=new WeakSet,im=async function(e,t){l(this,ds)||v(this,ds,new Map);let s=l(this,ds).get(e);if(s===null)return null;if(s!=null&&s.bitmap)return s.refCounter+=1,s;try{s||(s={bitmap:null,id:`image_${l(this,ec)}_${bs(this,Od)._++}`,refCounter:0,isSvg:!1});let r;if(typeof t=="string"?(s.url=t,r=await ng(t,"blob")):t instanceof File?r=s.file=t:t instanceof Blob&&(r=t),r.type==="image/svg+xml"){const i=Ib._isSVGFittingCanvas,a=new FileReader,o=new Image,c=new Promise((d,h)=>{o.onload=()=>{s.bitmap=o,s.isSvg=!0,d()},a.onload=async()=>{const f=s.svgUrl=a.result;o.src=await i?`${f}#svgView(preserveAspectRatio(none))`:f},o.onerror=a.onerror=h});a.readAsDataURL(r),await c}else s.bitmap=await createImageBitmap(r);s.refCounter=1}catch(r){Pe(r),s=null}return l(this,ds).set(e,s),s&&l(this,ds).set(s.id,s),s};let dy=Ib;var At,Bi,Fd,pt;class lT{constructor(e=128){S(this,At,[]);S(this,Bi,!1);S(this,Fd);S(this,pt,-1);v(this,Fd,e)}add({cmd:e,undo:t,post:s,mustExec:r,type:i=NaN,overwriteIfSameType:a=!1,keepUndo:o=!1}){if(r&&e(),l(this,Bi))return;const c={cmd:e,undo:t,post:s,type:i};if(l(this,pt)===-1){l(this,At).length>0&&(l(this,At).length=0),v(this,pt,0),l(this,At).push(c);return}if(a&&l(this,At)[l(this,pt)].type===i){o&&(c.undo=l(this,At)[l(this,pt)].undo),l(this,At)[l(this,pt)]=c;return}const d=l(this,pt)+1;d===l(this,Fd)?l(this,At).splice(0,1):(v(this,pt,d),d<l(this,At).length&&l(this,At).splice(d)),l(this,At).push(c)}undo(){if(l(this,pt)===-1)return;v(this,Bi,!0);const{undo:e,post:t}=l(this,At)[l(this,pt)];e(),t==null||t(),v(this,Bi,!1),v(this,pt,l(this,pt)-1)}redo(){if(l(this,pt)<l(this,At).length-1){v(this,pt,l(this,pt)+1),v(this,Bi,!0);const{cmd:e,post:t}=l(this,At)[l(this,pt)];e(),t==null||t(),v(this,Bi,!1)}}hasSomethingToUndo(){return l(this,pt)!==-1}hasSomethingToRedo(){return l(this,pt)<l(this,At).length-1}cleanType(e){if(l(this,pt)!==-1){for(let t=l(this,pt);t>=0;t--)if(l(this,At)[t].type!==e){l(this,At).splice(t+1,l(this,pt)-t),v(this,pt,t);return}l(this,At).length=0,v(this,pt,-1)}}destroy(){v(this,At,null)}}At=new WeakMap,Bi=new WeakMap,Fd=new WeakMap,pt=new WeakMap;var pp,O1;class mf{constructor(e){S(this,pp);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:t}=Cs.platform;for(const[s,r,i={}]of e)for(const a of s){const o=a.startsWith("mac+");t&&o?(this.callbacks.set(a.slice(4),{callback:r,options:i}),this.allKeys.add(a.split("+").at(-1))):!t&&!o&&(this.callbacks.set(a,{callback:r,options:i}),this.allKeys.add(a.split("+").at(-1)))}}exec(e,t){if(!this.allKeys.has(t.key))return;const s=this.callbacks.get(A(this,pp,O1).call(this,t));if(!s)return;const{callback:r,options:{bubbles:i=!1,args:a=[],checker:o=null}}=s;o&&!o(e,t)||(r.bind(e,...a,t)(),i||dn(t))}}pp=new WeakSet,O1=function(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);const t=this.buffer.join("+");return this.buffer.length=0,t};const gp=class gp{get _colors(){const e=new Map([["CanvasText",null],["Canvas",null]]);return iT(e),Le(this,"_colors",e)}convert(e){const t=Eb(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(const[s,r]of this._colors)if(r.every((i,a)=>i===t[a]))return gp._colorsMapping.get(s);return t}getHexCode(e){const t=this._colors.get(e);return t?ve.makeHexColor(...t):e}};xe(gp,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let hy=gp;var sc,Xs,Ot,Jt,nc,Wr,rc,bn,Ui,eo,ic,to,mr,zn,so,$d,Bd,ac,Ud,pr,zi,oc,Hi,gr,yp,qi,zd,Wi,no,Hd,qd,Ht,Ke,Vr,ro,Wd,Vd,Vi,yr,Gr,Gd,xn,re,am,fy,F1,$1,om,B1,U1,z1,my,H1,py,gy,q1,ws,Fr,W1,V1,yy,G1,Ou,vy;const ql=class ql{constructor(e,t,s,r,i,a,o,c,d,h,f,m,p){S(this,re);S(this,sc,new AbortController);S(this,Xs,null);S(this,Ot,new Map);S(this,Jt,new Map);S(this,nc,null);S(this,Wr,null);S(this,rc,null);S(this,bn,new lT);S(this,Ui,null);S(this,eo,null);S(this,ic,0);S(this,to,new Set);S(this,mr,null);S(this,zn,null);S(this,so,new Set);xe(this,"_editorUndoBar",null);S(this,$d,!1);S(this,Bd,!1);S(this,ac,!1);S(this,Ud,null);S(this,pr,null);S(this,zi,null);S(this,oc,null);S(this,Hi,!1);S(this,gr,null);S(this,yp,new oT);S(this,qi,!1);S(this,zd,!1);S(this,Wi,null);S(this,no,null);S(this,Hd,null);S(this,qd,null);S(this,Ht,Ie.NONE);S(this,Ke,new Set);S(this,Vr,null);S(this,ro,null);S(this,Wd,null);S(this,Vd,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1});S(this,Vi,[0,0]);S(this,yr,null);S(this,Gr,null);S(this,Gd,null);S(this,xn,null);const g=this._signal=l(this,sc).signal;v(this,Gr,e),v(this,Gd,t),v(this,nc,s),this._eventBus=r,r._on("editingaction",this.onEditingAction.bind(this),{signal:g}),r._on("pagechanging",this.onPageChanging.bind(this),{signal:g}),r._on("scalechanging",this.onScaleChanging.bind(this),{signal:g}),r._on("rotationchanging",this.onRotationChanging.bind(this),{signal:g}),r._on("setpreference",this.onSetPreference.bind(this),{signal:g}),r._on("switchannotationeditorparams",y=>this.updateParams(y.type,y.value),{signal:g}),A(this,re,B1).call(this),A(this,re,q1).call(this),A(this,re,my).call(this),v(this,Wr,i.annotationStorage),v(this,Ud,i.filterFactory),v(this,ro,a),v(this,oc,o||null),v(this,$d,c),v(this,Bd,d),v(this,ac,h),v(this,qd,f||null),this.viewParameters={realScale:ja.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=m||null,this._supportsPinchToZoom=p!==!1}static get _keyboardManager(){const e=ql.prototype,t=a=>l(a,Gr).contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&a.hasSomethingToControl(),s=(a,{target:o})=>{if(o instanceof HTMLInputElement){const{type:c}=o;return c!=="text"&&c!=="number"}return!0},r=this.TRANSLATE_SMALL,i=this.TRANSLATE_BIG;return Le(this,"_keyboardManager",new mf([[["ctrl+a","mac+meta+a"],e.selectAll,{checker:s}],[["ctrl+z","mac+meta+z"],e.undo,{checker:s}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo,{checker:s}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete,{checker:s}],[["Enter","mac+Enter"],e.addNewEditorFromKeyboard,{checker:(a,{target:o})=>!(o instanceof HTMLButtonElement)&&l(a,Gr).contains(o)&&!a.isEnterHandled}],[[" ","mac+ "],e.addNewEditorFromKeyboard,{checker:(a,{target:o})=>!(o instanceof HTMLButtonElement)&&l(a,Gr).contains(document.activeElement)}],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-r,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-i,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[r,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[i,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-r],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-i],checker:t}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,r],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,i],checker:t}]]))}destroy(){var e,t,s,r,i;(e=l(this,xn))==null||e.resolve(),v(this,xn,null),(t=l(this,sc))==null||t.abort(),v(this,sc,null),this._signal=null;for(const a of l(this,Jt).values())a.destroy();l(this,Jt).clear(),l(this,Ot).clear(),l(this,so).clear(),v(this,Xs,null),l(this,Ke).clear(),l(this,bn).destroy(),(s=l(this,nc))==null||s.destroy(),(r=l(this,gr))==null||r.hide(),v(this,gr,null),l(this,pr)&&(clearTimeout(l(this,pr)),v(this,pr,null)),l(this,yr)&&(clearTimeout(l(this,yr)),v(this,yr,null)),(i=this._editorUndoBar)==null||i.destroy()}combinedSignal(e){return AbortSignal.any([this._signal,e.signal])}get mlManager(){return l(this,qd)}get useNewAltTextFlow(){return l(this,Bd)}get useNewAltTextWhenAddingImage(){return l(this,ac)}get hcmFilter(){return Le(this,"hcmFilter",l(this,ro)?l(this,Ud).addHCMFilter(l(this,ro).foreground,l(this,ro).background):"none")}get direction(){return Le(this,"direction",getComputedStyle(l(this,Gr)).direction)}get highlightColors(){return Le(this,"highlightColors",l(this,oc)?new Map(l(this,oc).split(",").map(e=>e.split("=").map(t=>t.trim()))):null)}get highlightColorNames(){return Le(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,e=>e.reverse())):null)}setCurrentDrawingSession(e){e?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),v(this,eo,e)}setMainHighlightColorPicker(e){v(this,Hd,e)}editAltText(e,t=!1){var s;(s=l(this,nc))==null||s.editAltText(this,e,t)}switchToMode(e,t){this._eventBus.on("annotationeditormodechanged",t,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:e})}setPreference(e,t){this._eventBus.dispatch("setpreference",{source:this,name:e,value:t})}onSetPreference({name:e,value:t}){switch(e){case"enableNewAltTextWhenAddingImage":v(this,ac,t);break}}onPageChanging({pageNumber:e}){v(this,ic,e-1)}focusMainContainer(){l(this,Gr).focus()}findParent(e,t){for(const s of l(this,Jt).values()){const{x:r,y:i,width:a,height:o}=s.div.getBoundingClientRect();if(e>=r&&e<=r+a&&t>=i&&t<=i+o)return s}return null}disableUserSelect(e=!1){l(this,Gd).classList.toggle("noUserSelect",e)}addShouldRescale(e){l(this,so).add(e)}removeShouldRescale(e){l(this,so).delete(e)}onScaleChanging({scale:e}){var t;this.commitOrRemove(),this.viewParameters.realScale=e*ja.PDF_TO_CSS_UNITS;for(const s of l(this,so))s.onScaleChanging();(t=l(this,eo))==null||t.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}highlightSelection(e=""){const t=document.getSelection();if(!t||t.isCollapsed)return;const{anchorNode:s,anchorOffset:r,focusNode:i,focusOffset:a}=t,o=t.toString(),d=A(this,re,am).call(this,t).closest(".textLayer"),h=this.getSelectionBoxes(d);if(!h)return;t.empty();const f=A(this,re,fy).call(this,d),m=l(this,Ht)===Ie.NONE,p=()=>{f==null||f.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:e,boxes:h,anchorNode:s,anchorOffset:r,focusNode:i,focusOffset:a,text:o}),m&&this.showAllEditors("highlight",!0,!0)};if(m){this.switchToMode(Ie.HIGHLIGHT,p);return}p()}addToAnnotationStorage(e){!e.isEmpty()&&l(this,Wr)&&!l(this,Wr).has(e.id)&&l(this,Wr).setValue(e.id,e)}blur(){if(this.isShiftKeyDown=!1,l(this,Hi)&&(v(this,Hi,!1),A(this,re,om).call(this,"main_toolbar")),!this.hasSelection)return;const{activeElement:e}=document;for(const t of l(this,Ke))if(t.div.contains(e)){v(this,no,[t,e]),t._focusEventsAllowed=!1;break}}focus(){if(!l(this,no))return;const[e,t]=l(this,no);v(this,no,null),t.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this._signal}),t.focus()}addEditListeners(){A(this,re,my).call(this),A(this,re,py).call(this)}removeEditListeners(){A(this,re,H1).call(this),A(this,re,gy).call(this)}dragOver(e){for(const{type:t}of e.dataTransfer.items)for(const s of l(this,zn))if(s.isHandlingMimeForPasting(t)){e.dataTransfer.dropEffect="copy",e.preventDefault();return}}drop(e){for(const t of e.dataTransfer.items)for(const s of l(this,zn))if(s.isHandlingMimeForPasting(t.type)){s.paste(t,this.currentLayer),e.preventDefault();return}}copy(e){var s;if(e.preventDefault(),(s=l(this,Xs))==null||s.commitOrRemove(),!this.hasSelection)return;const t=[];for(const r of l(this,Ke)){const i=r.serialize(!0);i&&t.push(i)}t.length!==0&&e.clipboardData.setData("application/pdfjs",JSON.stringify(t))}cut(e){this.copy(e),this.delete()}async paste(e){e.preventDefault();const{clipboardData:t}=e;for(const i of t.items)for(const a of l(this,zn))if(a.isHandlingMimeForPasting(i.type)){a.paste(i,this.currentLayer);return}let s=t.getData("application/pdfjs");if(!s)return;try{s=JSON.parse(s)}catch(i){Pe(`paste: "${i.message}".`);return}if(!Array.isArray(s))return;this.unselectAll();const r=this.currentLayer;try{const i=[];for(const c of s){const d=await r.deserialize(c);if(!d)return;i.push(d)}const a=()=>{for(const c of i)A(this,re,yy).call(this,c);A(this,re,vy).call(this,i)},o=()=>{for(const c of i)c.remove()};this.addCommands({cmd:a,undo:o,mustExec:!0})}catch(i){Pe(`paste: "${i.message}".`)}}keydown(e){!this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!0),l(this,Ht)!==Ie.NONE&&!this.isEditorHandlingKeyboard&&ql._keyboardManager.exec(this,e)}keyup(e){this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!1,l(this,Hi)&&(v(this,Hi,!1),A(this,re,om).call(this,"main_toolbar")))}onEditingAction({name:e}){switch(e){case"undo":case"redo":case"delete":case"selectAll":this[e]();break;case"highlightSelection":this.highlightSelection("context_menu");break}}setEditingState(e){e?(A(this,re,U1).call(this),A(this,re,py).call(this),A(this,re,ws).call(this,{isEditing:l(this,Ht)!==Ie.NONE,isEmpty:A(this,re,Ou).call(this),hasSomethingToUndo:l(this,bn).hasSomethingToUndo(),hasSomethingToRedo:l(this,bn).hasSomethingToRedo(),hasSelectedEditor:!1})):(A(this,re,z1).call(this),A(this,re,gy).call(this),A(this,re,ws).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!l(this,zn)){v(this,zn,e);for(const t of l(this,zn))A(this,re,Fr).call(this,t.defaultPropertiesToUpdate)}}getId(){return l(this,yp).id}get currentLayer(){return l(this,Jt).get(l(this,ic))}getLayer(e){return l(this,Jt).get(e)}get currentPageIndex(){return l(this,ic)}addLayer(e){l(this,Jt).set(e.pageIndex,e),l(this,qi)?e.enable():e.disable()}removeLayer(e){l(this,Jt).delete(e.pageIndex)}async updateMode(e,t=null,s=!1){var r;if(l(this,Ht)!==e&&!(l(this,xn)&&(await l(this,xn).promise,!l(this,xn)))){if(v(this,xn,Promise.withResolvers()),v(this,Ht,e),e===Ie.NONE){this.setEditingState(!1),A(this,re,V1).call(this),(r=this._editorUndoBar)==null||r.hide(),l(this,xn).resolve();return}this.setEditingState(!0),await A(this,re,W1).call(this),this.unselectAll();for(const i of l(this,Jt).values())i.updateMode(e);if(!t){s&&this.addNewEditorFromKeyboard(),l(this,xn).resolve();return}for(const i of l(this,Ot).values())i.annotationElementId===t?(this.setSelected(i),i.enterInEditMode()):i.unselect();l(this,xn).resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(e){e!==l(this,Ht)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:e})}updateParams(e,t){var s;if(l(this,zn)){switch(e){case Be.CREATE:this.currentLayer.addNewEditor();return;case Be.HIGHLIGHT_DEFAULT_COLOR:(s=l(this,Hd))==null||s.updateColor(t);break;case Be.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(l(this,Wd)||v(this,Wd,new Map)).set(e,t),this.showAllEditors("highlight",t);break}for(const r of l(this,Ke))r.updateParams(e,t);for(const r of l(this,zn))r.updateDefaultParams(e,t)}}showAllEditors(e,t,s=!1){var i;for(const a of l(this,Ot).values())a.editorType===e&&a.show(t);(((i=l(this,Wd))==null?void 0:i.get(Be.HIGHLIGHT_SHOW_ALL))??!0)!==t&&A(this,re,Fr).call(this,[[Be.HIGHLIGHT_SHOW_ALL,t]])}enableWaiting(e=!1){if(l(this,zd)!==e){v(this,zd,e);for(const t of l(this,Jt).values())e?t.disableClick():t.enableClick(),t.div.classList.toggle("waiting",e)}}getEditors(e){const t=[];for(const s of l(this,Ot).values())s.pageIndex===e&&t.push(s);return t}getEditor(e){return l(this,Ot).get(e)}addEditor(e){l(this,Ot).set(e.id,e)}removeEditor(e){var t;e.div.contains(document.activeElement)&&(l(this,pr)&&clearTimeout(l(this,pr)),v(this,pr,setTimeout(()=>{this.focusMainContainer(),v(this,pr,null)},0))),l(this,Ot).delete(e.id),this.unselect(e),(!e.annotationElementId||!l(this,to).has(e.annotationElementId))&&((t=l(this,Wr))==null||t.remove(e.id))}addDeletedAnnotationElement(e){l(this,to).add(e.annotationElementId),this.addChangedExistingAnnotation(e),e.deleted=!0}isDeletedAnnotationElement(e){return l(this,to).has(e)}removeDeletedAnnotationElement(e){l(this,to).delete(e.annotationElementId),this.removeChangedExistingAnnotation(e),e.deleted=!1}setActiveEditor(e){l(this,Xs)!==e&&(v(this,Xs,e),e&&A(this,re,Fr).call(this,e.propertiesToUpdate))}updateUI(e){l(this,re,G1)===e&&A(this,re,Fr).call(this,e.propertiesToUpdate)}updateUIForDefaultProperties(e){A(this,re,Fr).call(this,e.defaultPropertiesToUpdate)}toggleSelected(e){if(l(this,Ke).has(e)){l(this,Ke).delete(e),e.unselect(),A(this,re,ws).call(this,{hasSelectedEditor:this.hasSelection});return}l(this,Ke).add(e),e.select(),A(this,re,Fr).call(this,e.propertiesToUpdate),A(this,re,ws).call(this,{hasSelectedEditor:!0})}setSelected(e){var t;(t=l(this,eo))==null||t.commitOrRemove();for(const s of l(this,Ke))s!==e&&s.unselect();l(this,Ke).clear(),l(this,Ke).add(e),e.select(),A(this,re,Fr).call(this,e.propertiesToUpdate),A(this,re,ws).call(this,{hasSelectedEditor:!0})}isSelected(e){return l(this,Ke).has(e)}get firstSelectedEditor(){return l(this,Ke).values().next().value}unselect(e){e.unselect(),l(this,Ke).delete(e),A(this,re,ws).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return l(this,Ke).size!==0}get isEnterHandled(){return l(this,Ke).size===1&&this.firstSelectedEditor.isEnterHandled}undo(){var e;l(this,bn).undo(),A(this,re,ws).call(this,{hasSomethingToUndo:l(this,bn).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:A(this,re,Ou).call(this)}),(e=this._editorUndoBar)==null||e.hide()}redo(){l(this,bn).redo(),A(this,re,ws).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:l(this,bn).hasSomethingToRedo(),isEmpty:A(this,re,Ou).call(this)})}addCommands(e){l(this,bn).add(e),A(this,re,ws).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:A(this,re,Ou).call(this)})}cleanUndoStack(e){l(this,bn).cleanType(e)}delete(){var i;this.commitOrRemove();const e=(i=this.currentLayer)==null?void 0:i.endDrawingSession(!0);if(!this.hasSelection&&!e)return;const t=e?[e]:[...l(this,Ke)],s=()=>{var a;(a=this._editorUndoBar)==null||a.show(r,t.length===1?t[0].editorType:t.length);for(const o of t)o.remove()},r=()=>{for(const a of t)A(this,re,yy).call(this,a)};this.addCommands({cmd:s,undo:r,mustExec:!0})}commitOrRemove(){var e;(e=l(this,Xs))==null||e.commitOrRemove()}hasSomethingToControl(){return l(this,Xs)||this.hasSelection}selectAll(){for(const e of l(this,Ke))e.commit();A(this,re,vy).call(this,l(this,Ot).values())}unselectAll(){var e;if(!(l(this,Xs)&&(l(this,Xs).commitOrRemove(),l(this,Ht)!==Ie.NONE))&&!((e=l(this,eo))!=null&&e.commitOrRemove())&&this.hasSelection){for(const t of l(this,Ke))t.unselect();l(this,Ke).clear(),A(this,re,ws).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(e,t,s=!1){if(s||this.commitOrRemove(),!this.hasSelection)return;l(this,Vi)[0]+=e,l(this,Vi)[1]+=t;const[r,i]=l(this,Vi),a=[...l(this,Ke)],o=1e3;l(this,yr)&&clearTimeout(l(this,yr)),v(this,yr,setTimeout(()=>{v(this,yr,null),l(this,Vi)[0]=l(this,Vi)[1]=0,this.addCommands({cmd:()=>{for(const c of a)l(this,Ot).has(c.id)&&c.translateInPage(r,i)},undo:()=>{for(const c of a)l(this,Ot).has(c.id)&&c.translateInPage(-r,-i)},mustExec:!1})},o));for(const c of a)c.translateInPage(e,t)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),v(this,mr,new Map);for(const e of l(this,Ke))l(this,mr).set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!l(this,mr))return!1;this.disableUserSelect(!1);const e=l(this,mr);v(this,mr,null);let t=!1;for(const[{x:r,y:i,pageIndex:a},o]of e)o.newX=r,o.newY=i,o.newPageIndex=a,t||(t=r!==o.savedX||i!==o.savedY||a!==o.savedPageIndex);if(!t)return!1;const s=(r,i,a,o)=>{if(l(this,Ot).has(r.id)){const c=l(this,Jt).get(o);c?r._setParentAndPosition(c,i,a):(r.pageIndex=o,r.x=i,r.y=a)}};return this.addCommands({cmd:()=>{for(const[r,{newX:i,newY:a,newPageIndex:o}]of e)s(r,i,a,o)},undo:()=>{for(const[r,{savedX:i,savedY:a,savedPageIndex:o}]of e)s(r,i,a,o)},mustExec:!0}),!0}dragSelectedEditors(e,t){if(l(this,mr))for(const s of l(this,mr).keys())s.drag(e,t)}rebuild(e){if(e.parent===null){const t=this.getLayer(e.pageIndex);t?(t.changeParent(e),t.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}get isEditorHandlingKeyboard(){var e;return((e=this.getActive())==null?void 0:e.shouldGetKeyboardEvents())||l(this,Ke).size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(e){return l(this,Xs)===e}getActive(){return l(this,Xs)}getMode(){return l(this,Ht)}get imageManager(){return Le(this,"imageManager",new dy)}getSelectionBoxes(e){if(!e)return null;const t=document.getSelection();for(let d=0,h=t.rangeCount;d<h;d++)if(!e.contains(t.getRangeAt(d).commonAncestorContainer))return null;const{x:s,y:r,width:i,height:a}=e.getBoundingClientRect();let o;switch(e.getAttribute("data-main-rotation")){case"90":o=(d,h,f,m)=>({x:(h-r)/a,y:1-(d+f-s)/i,width:m/a,height:f/i});break;case"180":o=(d,h,f,m)=>({x:1-(d+f-s)/i,y:1-(h+m-r)/a,width:f/i,height:m/a});break;case"270":o=(d,h,f,m)=>({x:1-(h+m-r)/a,y:(d-s)/i,width:m/a,height:f/i});break;default:o=(d,h,f,m)=>({x:(d-s)/i,y:(h-r)/a,width:f/i,height:m/a});break}const c=[];for(let d=0,h=t.rangeCount;d<h;d++){const f=t.getRangeAt(d);if(!f.collapsed)for(const{x:m,y:p,width:g,height:y}of f.getClientRects())g===0||y===0||c.push(o(m,p,g,y))}return c.length===0?null:c}addChangedExistingAnnotation({annotationElementId:e,id:t}){(l(this,rc)||v(this,rc,new Map)).set(e,t)}removeChangedExistingAnnotation({annotationElementId:e}){var t;(t=l(this,rc))==null||t.delete(e)}renderAnnotationElement(e){var r;const t=(r=l(this,rc))==null?void 0:r.get(e.data.id);if(!t)return;const s=l(this,Wr).getRawValue(t);s&&(l(this,Ht)===Ie.NONE&&!s.hasBeenModified||s.renderAnnotationElement(e))}};sc=new WeakMap,Xs=new WeakMap,Ot=new WeakMap,Jt=new WeakMap,nc=new WeakMap,Wr=new WeakMap,rc=new WeakMap,bn=new WeakMap,Ui=new WeakMap,eo=new WeakMap,ic=new WeakMap,to=new WeakMap,mr=new WeakMap,zn=new WeakMap,so=new WeakMap,$d=new WeakMap,Bd=new WeakMap,ac=new WeakMap,Ud=new WeakMap,pr=new WeakMap,zi=new WeakMap,oc=new WeakMap,Hi=new WeakMap,gr=new WeakMap,yp=new WeakMap,qi=new WeakMap,zd=new WeakMap,Wi=new WeakMap,no=new WeakMap,Hd=new WeakMap,qd=new WeakMap,Ht=new WeakMap,Ke=new WeakMap,Vr=new WeakMap,ro=new WeakMap,Wd=new WeakMap,Vd=new WeakMap,Vi=new WeakMap,yr=new WeakMap,Gr=new WeakMap,Gd=new WeakMap,xn=new WeakMap,re=new WeakSet,am=function({anchorNode:e}){return e.nodeType===Node.TEXT_NODE?e.parentElement:e},fy=function(e){const{currentLayer:t}=this;if(t.hasTextLayer(e))return t;for(const s of l(this,Jt).values())if(s.hasTextLayer(e))return s;return null},F1=function(){const e=document.getSelection();if(!e||e.isCollapsed)return;const s=A(this,re,am).call(this,e).closest(".textLayer"),r=this.getSelectionBoxes(s);r&&(l(this,gr)||v(this,gr,new aT(this)),l(this,gr).show(s,r,this.direction==="ltr"))},$1=function(){var i,a,o;const e=document.getSelection();if(!e||e.isCollapsed){l(this,Vr)&&((i=l(this,gr))==null||i.hide(),v(this,Vr,null),A(this,re,ws).call(this,{hasSelectedText:!1}));return}const{anchorNode:t}=e;if(t===l(this,Vr))return;const r=A(this,re,am).call(this,e).closest(".textLayer");if(!r){l(this,Vr)&&((a=l(this,gr))==null||a.hide(),v(this,Vr,null),A(this,re,ws).call(this,{hasSelectedText:!1}));return}if((o=l(this,gr))==null||o.hide(),v(this,Vr,t),A(this,re,ws).call(this,{hasSelectedText:!0}),!(l(this,Ht)!==Ie.HIGHLIGHT&&l(this,Ht)!==Ie.NONE)&&(l(this,Ht)===Ie.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),v(this,Hi,this.isShiftKeyDown),!this.isShiftKeyDown)){const c=l(this,Ht)===Ie.HIGHLIGHT?A(this,re,fy).call(this,r):null;c==null||c.toggleDrawing();const d=new AbortController,h=this.combinedSignal(d),f=m=>{m.type==="pointerup"&&m.button!==0||(d.abort(),c==null||c.toggleDrawing(!0),m.type==="pointerup"&&A(this,re,om).call(this,"main_toolbar"))};window.addEventListener("pointerup",f,{signal:h}),window.addEventListener("blur",f,{signal:h})}},om=function(e=""){l(this,Ht)===Ie.HIGHLIGHT?this.highlightSelection(e):l(this,$d)&&A(this,re,F1).call(this)},B1=function(){document.addEventListener("selectionchange",A(this,re,$1).bind(this),{signal:this._signal})},U1=function(){if(l(this,zi))return;v(this,zi,new AbortController);const e=this.combinedSignal(l(this,zi));window.addEventListener("focus",this.focus.bind(this),{signal:e}),window.addEventListener("blur",this.blur.bind(this),{signal:e})},z1=function(){var e;(e=l(this,zi))==null||e.abort(),v(this,zi,null)},my=function(){if(l(this,Wi))return;v(this,Wi,new AbortController);const e=this.combinedSignal(l(this,Wi));window.addEventListener("keydown",this.keydown.bind(this),{signal:e}),window.addEventListener("keyup",this.keyup.bind(this),{signal:e})},H1=function(){var e;(e=l(this,Wi))==null||e.abort(),v(this,Wi,null)},py=function(){if(l(this,Ui))return;v(this,Ui,new AbortController);const e=this.combinedSignal(l(this,Ui));document.addEventListener("copy",this.copy.bind(this),{signal:e}),document.addEventListener("cut",this.cut.bind(this),{signal:e}),document.addEventListener("paste",this.paste.bind(this),{signal:e})},gy=function(){var e;(e=l(this,Ui))==null||e.abort(),v(this,Ui,null)},q1=function(){const e=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:e}),document.addEventListener("drop",this.drop.bind(this),{signal:e})},ws=function(e){Object.entries(e).some(([s,r])=>l(this,Vd)[s]!==r)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(l(this,Vd),e)}),l(this,Ht)===Ie.HIGHLIGHT&&e.hasSelectedEditor===!1&&A(this,re,Fr).call(this,[[Be.HIGHLIGHT_FREE,!0]]))},Fr=function(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})},W1=async function(){if(!l(this,qi)){v(this,qi,!0);const e=[];for(const t of l(this,Jt).values())e.push(t.enable());await Promise.all(e);for(const t of l(this,Ot).values())t.enable()}},V1=function(){if(this.unselectAll(),l(this,qi)){v(this,qi,!1);for(const e of l(this,Jt).values())e.disable();for(const e of l(this,Ot).values())e.disable()}},yy=function(e){const t=l(this,Jt).get(e.pageIndex);t?t.addOrRebuild(e):(this.addEditor(e),this.addToAnnotationStorage(e))},G1=function(){let e=null;for(e of l(this,Ke));return e},Ou=function(){if(l(this,Ot).size===0)return!0;if(l(this,Ot).size===1)for(const e of l(this,Ot).values())return e.isEmpty();return!1},vy=function(e){for(const t of l(this,Ke))t.unselect();l(this,Ke).clear();for(const t of e)t.isEmpty()||(l(this,Ke).add(t),t.select());A(this,re,ws).call(this,{hasSelectedEditor:this.hasSelection})},xe(ql,"TRANSLATE_SMALL",1),xe(ql,"TRANSLATE_BIG",10);let cl=ql;var qt,vr,Hn,lc,br,Ys,cc,xr,Os,Kr,io,wr,Gi,sr,Fu,lm;const _s=class _s{constructor(e){S(this,sr);S(this,qt,null);S(this,vr,!1);S(this,Hn,null);S(this,lc,null);S(this,br,null);S(this,Ys,null);S(this,cc,!1);S(this,xr,null);S(this,Os,null);S(this,Kr,null);S(this,io,null);S(this,wr,!1);v(this,Os,e),v(this,wr,e._uiManager.useNewAltTextFlow),l(_s,Gi)||v(_s,Gi,Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"}))}static initialize(e){_s._l10n??(_s._l10n=e)}async render(){const e=v(this,Hn,document.createElement("button"));e.className="altText",e.tabIndex="0";const t=v(this,lc,document.createElement("span"));e.append(t),l(this,wr)?(e.classList.add("new"),e.setAttribute("data-l10n-id",l(_s,Gi).missing),t.setAttribute("data-l10n-id",l(_s,Gi)["missing-label"])):(e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const s=l(this,Os)._uiManager._signal;e.addEventListener("contextmenu",ar,{signal:s}),e.addEventListener("pointerdown",i=>i.stopPropagation(),{signal:s});const r=i=>{i.preventDefault(),l(this,Os)._uiManager.editAltText(l(this,Os)),l(this,wr)&&l(this,Os)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:l(this,sr,Fu)}})};return e.addEventListener("click",r,{capture:!0,signal:s}),e.addEventListener("keydown",i=>{i.target===e&&i.key==="Enter"&&(v(this,cc,!0),r(i))},{signal:s}),await A(this,sr,lm).call(this),e}finish(){l(this,Hn)&&(l(this,Hn).focus({focusVisible:l(this,cc)}),v(this,cc,!1))}isEmpty(){return l(this,wr)?l(this,qt)===null:!l(this,qt)&&!l(this,vr)}hasData(){return l(this,wr)?l(this,qt)!==null||!!l(this,Kr):this.isEmpty()}get guessedText(){return l(this,Kr)}async setGuessedText(e){l(this,qt)===null&&(v(this,Kr,e),v(this,io,await _s._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:e})),A(this,sr,lm).call(this))}toggleAltTextBadge(e=!1){var t;if(!l(this,wr)||l(this,qt)){(t=l(this,xr))==null||t.remove(),v(this,xr,null);return}if(!l(this,xr)){const s=v(this,xr,document.createElement("div"));s.className="noAltTextBadge",l(this,Os).div.append(s)}l(this,xr).classList.toggle("hidden",!e)}serialize(e){let t=l(this,qt);return!e&&l(this,Kr)===t&&(t=l(this,io)),{altText:t,decorative:l(this,vr),guessedText:l(this,Kr),textWithDisclaimer:l(this,io)}}get data(){return{altText:l(this,qt),decorative:l(this,vr)}}set data({altText:e,decorative:t,guessedText:s,textWithDisclaimer:r,cancel:i=!1}){s&&(v(this,Kr,s),v(this,io,r)),!(l(this,qt)===e&&l(this,vr)===t)&&(i||(v(this,qt,e),v(this,vr,t)),A(this,sr,lm).call(this))}toggle(e=!1){l(this,Hn)&&(!e&&l(this,Ys)&&(clearTimeout(l(this,Ys)),v(this,Ys,null)),l(this,Hn).disabled=!e)}shown(){l(this,Os)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:l(this,sr,Fu)}})}destroy(){var e,t;(e=l(this,Hn))==null||e.remove(),v(this,Hn,null),v(this,lc,null),v(this,br,null),(t=l(this,xr))==null||t.remove(),v(this,xr,null)}};qt=new WeakMap,vr=new WeakMap,Hn=new WeakMap,lc=new WeakMap,br=new WeakMap,Ys=new WeakMap,cc=new WeakMap,xr=new WeakMap,Os=new WeakMap,Kr=new WeakMap,io=new WeakMap,wr=new WeakMap,Gi=new WeakMap,sr=new WeakSet,Fu=function(){return l(this,qt)&&"added"||l(this,qt)===null&&this.guessedText&&"review"||"missing"},lm=async function(){var r,i,a;const e=l(this,Hn);if(!e)return;if(l(this,wr)){if(e.classList.toggle("done",!!l(this,qt)),e.setAttribute("data-l10n-id",l(_s,Gi)[l(this,sr,Fu)]),(r=l(this,lc))==null||r.setAttribute("data-l10n-id",l(_s,Gi)[`${l(this,sr,Fu)}-label`]),!l(this,qt)){(i=l(this,br))==null||i.remove();return}}else{if(!l(this,qt)&&!l(this,vr)){e.classList.remove("done"),(a=l(this,br))==null||a.remove();return}e.classList.add("done"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let t=l(this,br);if(!t){v(this,br,t=document.createElement("span")),t.className="tooltip",t.setAttribute("role","tooltip"),t.id=`alt-text-tooltip-${l(this,Os).id}`;const o=100,c=l(this,Os)._uiManager._signal;c.addEventListener("abort",()=>{clearTimeout(l(this,Ys)),v(this,Ys,null)},{once:!0}),e.addEventListener("mouseenter",()=>{v(this,Ys,setTimeout(()=>{v(this,Ys,null),l(this,br).classList.add("show"),l(this,Os)._reportTelemetry({action:"alt_text_tooltip"})},o))},{signal:c}),e.addEventListener("mouseleave",()=>{var d;l(this,Ys)&&(clearTimeout(l(this,Ys)),v(this,Ys,null)),(d=l(this,br))==null||d.classList.remove("show")},{signal:c})}l(this,vr)?t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(t.removeAttribute("data-l10n-id"),t.textContent=l(this,qt)),t.parentNode||e.append(t);const s=l(this,Os).getImageForAltText();s==null||s.setAttribute("aria-describedby",t.id)},S(_s,Gi,null),xe(_s,"_l10n",null);let op=_s;var Kd,ao,Xd,Yd,Jd,Qd,Zd,uc,Xr,oo,Ki,ki,K1,X1,by;const Pb=class Pb{constructor({container:e,isPinchingDisabled:t=null,isPinchingStopped:s=null,onPinchStart:r=null,onPinching:i=null,onPinchEnd:a=null,signal:o}){S(this,ki);S(this,Kd);S(this,ao,!1);S(this,Xd,null);S(this,Yd);S(this,Jd);S(this,Qd);S(this,Zd);S(this,uc);S(this,Xr,null);S(this,oo);S(this,Ki,null);v(this,Kd,e),v(this,Xd,s),v(this,Yd,t),v(this,Jd,r),v(this,Qd,i),v(this,Zd,a),v(this,oo,new AbortController),v(this,uc,AbortSignal.any([o,l(this,oo).signal])),e.addEventListener("touchstart",A(this,ki,K1).bind(this),{passive:!1,signal:l(this,uc)})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return Le(this,"MIN_TOUCH_DISTANCE_TO_PINCH",35/(window.devicePixelRatio||1))}destroy(){var e;(e=l(this,oo))==null||e.abort(),v(this,oo,null)}};Kd=new WeakMap,ao=new WeakMap,Xd=new WeakMap,Yd=new WeakMap,Jd=new WeakMap,Qd=new WeakMap,Zd=new WeakMap,uc=new WeakMap,Xr=new WeakMap,oo=new WeakMap,Ki=new WeakMap,ki=new WeakSet,K1=function(e){var r,i,a;if((r=l(this,Yd))!=null&&r.call(this)||e.touches.length<2)return;if(!l(this,Ki)){v(this,Ki,new AbortController);const o=AbortSignal.any([l(this,uc),l(this,Ki).signal]),c=l(this,Kd),d={signal:o,passive:!1};c.addEventListener("touchmove",A(this,ki,X1).bind(this),d),c.addEventListener("touchend",A(this,ki,by).bind(this),d),c.addEventListener("touchcancel",A(this,ki,by).bind(this),d),(i=l(this,Jd))==null||i.call(this)}if(dn(e),e.touches.length!==2||(a=l(this,Xd))!=null&&a.call(this)){v(this,Xr,null);return}let[t,s]=e.touches;t.identifier>s.identifier&&([t,s]=[s,t]),v(this,Xr,{touch0X:t.screenX,touch0Y:t.screenY,touch1X:s.screenX,touch1Y:s.screenY})},X1=function(e){var w;if(!l(this,Xr)||e.touches.length!==2)return;let[t,s]=e.touches;t.identifier>s.identifier&&([t,s]=[s,t]);const{screenX:r,screenY:i}=t,{screenX:a,screenY:o}=s,c=l(this,Xr),{touch0X:d,touch0Y:h,touch1X:f,touch1Y:m}=c,p=f-d,g=m-h,y=a-r,N=o-i,b=Math.hypot(y,N)||1,x=Math.hypot(p,g)||1;if(!l(this,ao)&&Math.abs(x-b)<=Pb.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(c.touch0X=r,c.touch0Y=i,c.touch1X=a,c.touch1Y=o,e.preventDefault(),!l(this,ao)){v(this,ao,!0);return}const _=[(r+a)/2,(i+o)/2];(w=l(this,Qd))==null||w.call(this,_,x,b)},by=function(e){var t;l(this,Ki).abort(),v(this,Ki,null),(t=l(this,Zd))==null||t.call(this),l(this,Xr)&&(e.preventDefault(),v(this,Xr,null),v(this,ao,!1))};let lp=Pb;var lo,qn,lt,dc,Xi,eh,co,Qt,uo,Yr,Yi,th,ho,Js,sh,fo,Jr,_r,hc,fc,wn,mo,nh,vp,we,xy,rh,wy,cm,Y1,J1,_y,um,Sy,Q1,Z1,eA,Ay,tA,Ny,sA,nA,rA,ky,$u;const De=class De{constructor(e){S(this,we);S(this,lo,null);S(this,qn,null);S(this,lt,null);S(this,dc,!1);S(this,Xi,null);S(this,eh,"");S(this,co,!1);S(this,Qt,null);S(this,uo,null);S(this,Yr,null);S(this,Yi,null);S(this,th,"");S(this,ho,!1);S(this,Js,null);S(this,sh,!1);S(this,fo,!1);S(this,Jr,!1);S(this,_r,null);S(this,hc,0);S(this,fc,0);S(this,wn,null);S(this,mo,null);xe(this,"_editToolbar",null);xe(this,"_initialOptions",Object.create(null));xe(this,"_initialData",null);xe(this,"_isVisible",!0);xe(this,"_uiManager",null);xe(this,"_focusEventsAllowed",!0);S(this,nh,!1);S(this,vp,De._zIndex++);this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null;const{rotation:t,rawDims:{pageWidth:s,pageHeight:r,pageX:i,pageY:a}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[s,r],this.pageTranslation=[i,a];const[o,c]=this.parentDimensions;this.x=e.x/o,this.y=e.y/c,this.isAttachedToDOM=!1,this.deleted=!1}static get _resizerKeyboardManager(){const e=De.prototype._resizeWithKeyboard,t=cl.TRANSLATE_SMALL,s=cl.TRANSLATE_BIG;return Le(this,"_resizerKeyboardManager",new mf([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-t,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-s,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[t,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[s,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-t]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-s]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,t]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,s]}],[["Escape","mac+Escape"],De.prototype._stopResizingWithKeyboard]]))}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get isDrawer(){return!1}static get _defaultLineColor(){return Le(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(e){const t=new cT({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(e,t){if(De._l10n??(De._l10n=e),De._l10nResizer||(De._l10nResizer=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"})),De._borderLineWidth!==-1)return;const s=getComputedStyle(document.documentElement);De._borderLineWidth=parseFloat(s.getPropertyValue("--outline-width"))||0}static updateDefaultParams(e,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(e){return!1}static paste(e,t){st("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return l(this,nh)}set _isDraggable(e){var t;v(this,nh,e),(t=this.div)==null||t.classList.toggle("draggable",e)}get isEnterHandled(){return!0}center(){const[e,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(e*2),this.y+=this.width*e/(t*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(e*2),this.y-=this.width*e/(t*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=l(this,vp)}setParent(e){e!==null?(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions):A(this,we,$u).call(this),this.parent=e}focusin(e){this._focusEventsAllowed&&(l(this,ho)?v(this,ho,!1):this.parent.setSelected(this))}focusout(e){var s;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;const t=e.relatedTarget;t!=null&&t.closest(`#${this.id}`)||(e.preventDefault(),(s=this.parent)!=null&&s.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(e,t,s,r){const[i,a]=this.parentDimensions;[s,r]=this.screenToPageTranslation(s,r),this.x=(e+s)/i,this.y=(t+r)/a,this.fixAndSetPosition()}translate(e,t){A(this,we,xy).call(this,this.parentDimensions,e,t)}translateInPage(e,t){l(this,Js)||v(this,Js,[this.x,this.y,this.width,this.height]),A(this,we,xy).call(this,this.pageDimensions,e,t),this.div.scrollIntoView({block:"nearest"})}drag(e,t){l(this,Js)||v(this,Js,[this.x,this.y,this.width,this.height]);const{div:s,parentDimensions:[r,i]}=this;if(this.x+=e/r,this.y+=t/i,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:f,y:m}=this.div.getBoundingClientRect();this.parent.findNewParent(this,f,m)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:a,y:o}=this;const[c,d]=this.getBaseTranslation();a+=c,o+=d;const{style:h}=s;h.left=`${(100*a).toFixed(2)}%`,h.top=`${(100*o).toFixed(2)}%`,this._onTranslating(a,o),s.scrollIntoView({block:"nearest"})}_onTranslating(e,t){}_onTranslated(e,t){}get _hasBeenMoved(){return!!l(this,Js)&&(l(this,Js)[0]!==this.x||l(this,Js)[1]!==this.y)}get _hasBeenResized(){return!!l(this,Js)&&(l(this,Js)[2]!==this.width||l(this,Js)[3]!==this.height)}getBaseTranslation(){const[e,t]=this.parentDimensions,{_borderLineWidth:s}=De,r=s/e,i=s/t;switch(this.rotation){case 90:return[-r,i];case 180:return[r,i];case 270:return[r,-i];default:return[-r,-i]}}get _mustFixPosition(){return!0}fixAndSetPosition(e=this.rotation){const{div:{style:t},pageDimensions:[s,r]}=this;let{x:i,y:a,width:o,height:c}=this;if(o*=s,c*=r,i*=s,a*=r,this._mustFixPosition)switch(e){case 0:i=Math.max(0,Math.min(s-o,i)),a=Math.max(0,Math.min(r-c,a));break;case 90:i=Math.max(0,Math.min(s-c,i)),a=Math.min(r,Math.max(o,a));break;case 180:i=Math.min(s,Math.max(o,i)),a=Math.min(r,Math.max(c,a));break;case 270:i=Math.min(s,Math.max(c,i)),a=Math.max(0,Math.min(r-o,a));break}this.x=i/=s,this.y=a/=r;const[d,h]=this.getBaseTranslation();i+=d,a+=h,t.left=`${(100*i).toFixed(2)}%`,t.top=`${(100*a).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(e,t){var s;return A(s=De,rh,wy).call(s,e,t,this.parentRotation)}pageTranslationToScreen(e,t){var s;return A(s=De,rh,wy).call(s,e,t,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:e,pageDimensions:[t,s]}=this;return[t*e,s*e]}setDims(e,t){const[s,r]=this.parentDimensions,{style:i}=this.div;i.width=`${(100*e/s).toFixed(2)}%`,l(this,co)||(i.height=`${(100*t/r).toFixed(2)}%`)}fixDims(){const{style:e}=this.div,{height:t,width:s}=e,r=s.endsWith("%"),i=!l(this,co)&&t.endsWith("%");if(r&&i)return;const[a,o]=this.parentDimensions;r||(e.width=`${(100*parseFloat(s)/a).toFixed(2)}%`),!l(this,co)&&!i&&(e.height=`${(100*parseFloat(t)/o).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}_onResized(){}static _round(e){return Math.round(e*1e4)/1e4}_onResizing(){}altTextFinish(){var e;(e=l(this,lt))==null||e.finish()}async addEditToolbar(){return this._editToolbar||l(this,fo)?this._editToolbar:(this._editToolbar=new cy(this),this.div.append(this._editToolbar.render()),l(this,lt)&&await this._editToolbar.addAltText(l(this,lt)),this._editToolbar)}removeEditToolbar(){var e;this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,(e=l(this,lt))==null||e.destroy())}addContainer(e){var s;const t=(s=this._editToolbar)==null?void 0:s.div;t?t.before(e):this.div.append(e)}getClientDimensions(){return this.div.getBoundingClientRect()}async addAltTextButton(){l(this,lt)||(op.initialize(De._l10n),v(this,lt,new op(this)),l(this,lo)&&(l(this,lt).data=l(this,lo),v(this,lo,null)),await this.addEditToolbar())}get altTextData(){var e;return(e=l(this,lt))==null?void 0:e.data}set altTextData(e){l(this,lt)&&(l(this,lt).data=e)}get guessedAltText(){var e;return(e=l(this,lt))==null?void 0:e.guessedText}async setGuessedAltText(e){var t;await((t=l(this,lt))==null?void 0:t.setGuessedText(e))}serializeAltText(e){var t;return(t=l(this,lt))==null?void 0:t.serialize(e)}hasAltText(){return!!l(this,lt)&&!l(this,lt).isEmpty()}hasAltTextData(){var e;return((e=l(this,lt))==null?void 0:e.hasData())??!1}render(){var i;this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.tabIndex=l(this,dc)?-1:0,this._isVisible||this.div.classList.add("hidden"),this.setInForeground(),A(this,we,Ny).call(this);const[e,t]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*t/e).toFixed(2)}%`,this.div.style.maxHeight=`${(100*e/t).toFixed(2)}%`);const[s,r]=this.getInitialTranslation();return this.translate(s,r),ap(this,this.div,["pointerdown"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(l(this,mo)||v(this,mo,new lp({container:this.div,isPinchingDisabled:()=>!this.isSelected,onPinchStart:A(this,we,Q1).bind(this),onPinching:A(this,we,Z1).bind(this),onPinchEnd:A(this,we,eA).bind(this),signal:this._uiManager._signal}))),(i=this._uiManager._editorUndoBar)==null||i.hide(),this.div}pointerdown(e){const{isMac:t}=Cs.platform;if(e.button!==0||e.ctrlKey&&t){e.preventDefault();return}if(v(this,ho,!0),this._isDraggable){A(this,we,tA).call(this,e);return}A(this,we,Ay).call(this,e)}get isSelected(){return this._uiManager.isSelected(this)}_onStartDragging(){}_onStopDragging(){}moveInDOM(){l(this,_r)&&clearTimeout(l(this,_r)),v(this,_r,setTimeout(()=>{var e;v(this,_r,null),(e=this.parent)==null||e.moveEditorInDOM(this)},0))}_setParentAndPosition(e,t,s){e.changeParent(this),this.x=t,this.y=s,this.fixAndSetPosition(),this._onTranslated()}getRect(e,t,s=this.rotation){const r=this.parentScale,[i,a]=this.pageDimensions,[o,c]=this.pageTranslation,d=e/r,h=t/r,f=this.x*i,m=this.y*a,p=this.width*i,g=this.height*a;switch(s){case 0:return[f+d+o,a-m-h-g+c,f+d+p+o,a-m-h+c];case 90:return[f+h+o,a-m+d+c,f+h+g+o,a-m+d+p+c];case 180:return[f-d-p+o,a-m+h+c,f-d+o,a-m+h+g+c];case 270:return[f-h-g+o,a-m-d-p+c,f-h+o,a-m-d+c];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){const[s,r,i,a]=e,o=i-s,c=a-r;switch(this.rotation){case 0:return[s,t-a,o,c];case 90:return[s,t-r,c,o];case 180:return[i,t-r,o,c];case 270:return[i,t-a,c,o];default:throw new Error("Invalid rotation")}}onceAdded(e){}isEmpty(){return!1}enableEditMode(){v(this,fo,!0)}disableEditMode(){v(this,fo,!1)}isInEditMode(){return l(this,fo)}shouldGetKeyboardEvents(){return l(this,Jr)}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:e,left:t,bottom:s,right:r}=this.getClientDimensions(),{innerHeight:i,innerWidth:a}=window;return t<a&&r>0&&e<i&&s>0}rebuild(){A(this,we,Ny).call(this)}rotate(e){}resize(){}serializeDeleted(){var e;return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:((e=this._initialData)==null?void 0:e.popupRef)||""}}serialize(e=!1,t=null){st("An editor must be serializable")}static async deserialize(e,t,s){const r=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:s});r.rotation=e.rotation,v(r,lo,e.accessibilityData);const[i,a]=r.pageDimensions,[o,c,d,h]=r.getRectInCurrentCoords(e.rect,a);return r.x=o/i,r.y=c/a,r.width=d/i,r.height=h/a,r}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){var e,t;if((e=l(this,Yi))==null||e.abort(),v(this,Yi,null),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),l(this,_r)&&(clearTimeout(l(this,_r)),v(this,_r,null)),A(this,we,$u).call(this),this.removeEditToolbar(),l(this,wn)){for(const s of l(this,wn).values())clearTimeout(s);v(this,wn,null)}this.parent=null,(t=l(this,mo))==null||t.destroy(),v(this,mo,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(A(this,we,Y1).call(this),l(this,Qt).classList.remove("hidden"),ap(this,this.div,["keydown"]))}get toolbarPosition(){return null}keydown(e){if(!this.isResizable||e.target!==this.div||e.key!=="Enter")return;this._uiManager.setSelected(this),v(this,Yr,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const t=l(this,Qt).children;if(!l(this,qn)){v(this,qn,Array.from(t));const a=A(this,we,sA).bind(this),o=A(this,we,nA).bind(this),c=this._uiManager._signal;for(const d of l(this,qn)){const h=d.getAttribute("data-resizer-name");d.setAttribute("role","spinbutton"),d.addEventListener("keydown",a,{signal:c}),d.addEventListener("blur",o,{signal:c}),d.addEventListener("focus",A(this,we,rA).bind(this,h),{signal:c}),d.setAttribute("data-l10n-id",De._l10nResizer[h])}}const s=l(this,qn)[0];let r=0;for(const a of t){if(a===s)break;r++}const i=(360-this.rotation+this.parentRotation)%360/90*(l(this,qn).length/4);if(i!==r){if(i<r)for(let o=0;o<r-i;o++)l(this,Qt).append(l(this,Qt).firstChild);else if(i>r)for(let o=0;o<i-r;o++)l(this,Qt).firstChild.before(l(this,Qt).lastChild);let a=0;for(const o of t){const d=l(this,qn)[a++].getAttribute("data-resizer-name");o.setAttribute("data-l10n-id",De._l10nResizer[d])}}A(this,we,ky).call(this,0),v(this,Jr,!0),l(this,Qt).firstChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}_resizeWithKeyboard(e,t){l(this,Jr)&&A(this,we,Sy).call(this,l(this,th),{deltaX:e,deltaY:t,fromKeyboard:!0})}_stopResizingWithKeyboard(){A(this,we,$u).call(this),this.div.focus()}select(){var e,t,s;if(this.makeResizable(),(e=this.div)==null||e.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{var r,i;(r=this.div)!=null&&r.classList.contains("selectedEditor")&&((i=this._editToolbar)==null||i.show())});return}(t=this._editToolbar)==null||t.show(),(s=l(this,lt))==null||s.toggleAltTextBadge(!1)}unselect(){var e,t,s,r,i;(e=l(this,Qt))==null||e.classList.add("hidden"),(t=this.div)==null||t.classList.remove("selectedEditor"),(s=this.div)!=null&&s.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),(r=this._editToolbar)==null||r.hide(),(i=l(this,lt))==null||i.toggleAltTextBadge(!0)}updateParams(e,t){}disableEditing(){}enableEditing(){}enterInEditMode(){}getImageForAltText(){return null}get contentDiv(){return this.div}get isEditing(){return l(this,sh)}set isEditing(e){v(this,sh,e),this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(e,t){v(this,co,!0);const s=e/t,{style:r}=this.div;r.aspectRatio=s,r.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(e,t=!1){if(t){l(this,wn)||v(this,wn,new Map);const{action:s}=e;let r=l(this,wn).get(s);r&&clearTimeout(r),r=setTimeout(()=>{this._reportTelemetry(e),l(this,wn).delete(s),l(this,wn).size===0&&v(this,wn,null)},De._telemetryTimeout),l(this,wn).set(s,r);return}e.type||(e.type=this.editorType),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})}show(e=this._isVisible){this.div.classList.toggle("hidden",!e),this._isVisible=e}enable(){this.div&&(this.div.tabIndex=0),v(this,dc,!1)}disable(){this.div&&(this.div.tabIndex=-1),v(this,dc,!0)}renderAnnotationElement(e){let t=e.container.querySelector(".annotationContent");if(!t)t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),e.container.prepend(t);else if(t.nodeName==="CANVAS"){const s=t;t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),s.before(t)}return t}resetAnnotationElement(e){const{firstChild:t}=e.container;(t==null?void 0:t.nodeName)==="DIV"&&t.classList.contains("annotationContent")&&t.remove()}};lo=new WeakMap,qn=new WeakMap,lt=new WeakMap,dc=new WeakMap,Xi=new WeakMap,eh=new WeakMap,co=new WeakMap,Qt=new WeakMap,uo=new WeakMap,Yr=new WeakMap,Yi=new WeakMap,th=new WeakMap,ho=new WeakMap,Js=new WeakMap,sh=new WeakMap,fo=new WeakMap,Jr=new WeakMap,_r=new WeakMap,hc=new WeakMap,fc=new WeakMap,wn=new WeakMap,mo=new WeakMap,nh=new WeakMap,vp=new WeakMap,we=new WeakSet,xy=function([e,t],s,r){[s,r]=this.screenToPageTranslation(s,r),this.x+=s/e,this.y+=r/t,this._onTranslating(this.x,this.y),this.fixAndSetPosition()},rh=new WeakSet,wy=function(e,t,s){switch(s){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}},cm=function(e){switch(e){case 90:{const[t,s]=this.pageDimensions;return[0,-t/s,s/t,0]}case 180:return[-1,0,0,-1];case 270:{const[t,s]=this.pageDimensions;return[0,t/s,-s/t,0]}default:return[1,0,0,1]}},Y1=function(){if(l(this,Qt))return;v(this,Qt,document.createElement("div")),l(this,Qt).classList.add("resizers");const e=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],t=this._uiManager._signal;for(const s of e){const r=document.createElement("div");l(this,Qt).append(r),r.classList.add("resizer",s),r.setAttribute("data-resizer-name",s),r.addEventListener("pointerdown",A(this,we,J1).bind(this,s),{signal:t}),r.addEventListener("contextmenu",ar,{signal:t}),r.tabIndex=-1}this.div.prepend(l(this,Qt))},J1=function(e,t){var h;t.preventDefault();const{isMac:s}=Cs.platform;if(t.button!==0||t.ctrlKey&&s)return;(h=l(this,lt))==null||h.toggle(!1);const r=this._isDraggable;this._isDraggable=!1,v(this,uo,[t.screenX,t.screenY]);const i=new AbortController,a=this._uiManager.combinedSignal(i);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",A(this,we,Sy).bind(this,e),{passive:!0,capture:!0,signal:a}),window.addEventListener("touchmove",dn,{passive:!1,signal:a}),window.addEventListener("contextmenu",ar,{signal:a}),v(this,Yr,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const o=this.parent.div.style.cursor,c=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;const d=()=>{var f;i.abort(),this.parent.togglePointerEvents(!0),(f=l(this,lt))==null||f.toggle(!0),this._isDraggable=r,this.parent.div.style.cursor=o,this.div.style.cursor=c,A(this,we,um).call(this)};window.addEventListener("pointerup",d,{signal:a}),window.addEventListener("blur",d,{signal:a})},_y=function(e,t,s,r){this.width=s,this.height=r,this.x=e,this.y=t;const[i,a]=this.parentDimensions;this.setDims(i*s,a*r),this.fixAndSetPosition(),this._onResized()},um=function(){if(!l(this,Yr))return;const{savedX:e,savedY:t,savedWidth:s,savedHeight:r}=l(this,Yr);v(this,Yr,null);const i=this.x,a=this.y,o=this.width,c=this.height;i===e&&a===t&&o===s&&c===r||this.addCommands({cmd:A(this,we,_y).bind(this,i,a,o,c),undo:A(this,we,_y).bind(this,e,t,s,r),mustExec:!0})},Sy=function(e,t){const[s,r]=this.parentDimensions,i=this.x,a=this.y,o=this.width,c=this.height,d=De.MIN_SIZE/s,h=De.MIN_SIZE/r,f=A(this,we,cm).call(this,this.rotation),m=(P,se)=>[f[0]*P+f[2]*se,f[1]*P+f[3]*se],p=A(this,we,cm).call(this,360-this.rotation),g=(P,se)=>[p[0]*P+p[2]*se,p[1]*P+p[3]*se];let y,N,b=!1,x=!1;switch(e){case"topLeft":b=!0,y=(P,se)=>[0,0],N=(P,se)=>[P,se];break;case"topMiddle":y=(P,se)=>[P/2,0],N=(P,se)=>[P/2,se];break;case"topRight":b=!0,y=(P,se)=>[P,0],N=(P,se)=>[0,se];break;case"middleRight":x=!0,y=(P,se)=>[P,se/2],N=(P,se)=>[0,se/2];break;case"bottomRight":b=!0,y=(P,se)=>[P,se],N=(P,se)=>[0,0];break;case"bottomMiddle":y=(P,se)=>[P/2,se],N=(P,se)=>[P/2,0];break;case"bottomLeft":b=!0,y=(P,se)=>[0,se],N=(P,se)=>[P,0];break;case"middleLeft":x=!0,y=(P,se)=>[0,se/2],N=(P,se)=>[P,se/2];break}const _=y(o,c),w=N(o,c);let k=m(...w);const C=De._round(i+k[0]),T=De._round(a+k[1]);let D=1,B=1,ee,M;if(t.fromKeyboard)({deltaX:ee,deltaY:M}=t);else{const{screenX:P,screenY:se}=t,[F,W]=l(this,uo);[ee,M]=this.screenToPageTranslation(P-F,se-W),l(this,uo)[0]=P,l(this,uo)[1]=se}if([ee,M]=g(ee/s,M/r),b){const P=Math.hypot(o,c);D=B=Math.max(Math.min(Math.hypot(w[0]-_[0]-ee,w[1]-_[1]-M)/P,1/o,1/c),d/o,h/c)}else x?D=Math.max(d,Math.min(1,Math.abs(w[0]-_[0]-ee)))/o:B=Math.max(h,Math.min(1,Math.abs(w[1]-_[1]-M)))/c;const E=De._round(o*D),$=De._round(c*B);k=m(...N(E,$));const ie=C-k[0],pe=T-k[1];l(this,Js)||v(this,Js,[this.x,this.y,this.width,this.height]),this.width=E,this.height=$,this.x=ie,this.y=pe,this.setDims(s*E,r*$),this.fixAndSetPosition(),this._onResizing()},Q1=function(){var e;v(this,Yr,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height}),(e=l(this,lt))==null||e.toggle(!1),this.parent.togglePointerEvents(!1)},Z1=function(e,t,s){let i=.7*(s/t)+1-.7;if(i===1)return;const a=A(this,we,cm).call(this,this.rotation),o=(C,T)=>[a[0]*C+a[2]*T,a[1]*C+a[3]*T],[c,d]=this.parentDimensions,h=this.x,f=this.y,m=this.width,p=this.height,g=De.MIN_SIZE/c,y=De.MIN_SIZE/d;i=Math.max(Math.min(i,1/m,1/p),g/m,y/p);const N=De._round(m*i),b=De._round(p*i);if(N===m&&b===p)return;l(this,Js)||v(this,Js,[h,f,m,p]);const x=o(m/2,p/2),_=De._round(h+x[0]),w=De._round(f+x[1]),k=o(N/2,b/2);this.x=_-k[0],this.y=w-k[1],this.width=N,this.height=b,this.setDims(c*N,d*b),this.fixAndSetPosition(),this._onResizing()},eA=function(){var e;(e=l(this,lt))==null||e.toggle(!0),this.parent.togglePointerEvents(!0),A(this,we,um).call(this)},Ay=function(e){const{isMac:t}=Cs.platform;e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this)},tA=function(e){const{isSelected:t}=this;this._uiManager.setUpDragSession();let s=!1;const r=new AbortController,i=this._uiManager.combinedSignal(r),a={capture:!0,passive:!1,signal:i},o=d=>{r.abort(),v(this,Xi,null),v(this,ho,!1),this._uiManager.endDragSession()||A(this,we,Ay).call(this,d),s&&this._onStopDragging()};t&&(v(this,hc,e.clientX),v(this,fc,e.clientY),v(this,Xi,e.pointerId),v(this,eh,e.pointerType),window.addEventListener("pointermove",d=>{s||(s=!0,this._onStartDragging());const{clientX:h,clientY:f,pointerId:m}=d;if(m!==l(this,Xi)){dn(d);return}const[p,g]=this.screenToPageTranslation(h-l(this,hc),f-l(this,fc));v(this,hc,h),v(this,fc,f),this._uiManager.dragSelectedEditors(p,g)},a),window.addEventListener("touchmove",dn,a),window.addEventListener("pointerdown",d=>{d.pointerType===l(this,eh)&&(l(this,mo)||d.isPrimary)&&o(d),dn(d)},a));const c=d=>{if(!l(this,Xi)||l(this,Xi)===d.pointerId){o(d);return}dn(d)};window.addEventListener("pointerup",c,{signal:i}),window.addEventListener("blur",c,{signal:i})},Ny=function(){if(l(this,Yi)||!this.div)return;v(this,Yi,new AbortController);const e=this._uiManager.combinedSignal(l(this,Yi));this.div.addEventListener("focusin",this.focusin.bind(this),{signal:e}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:e})},sA=function(e){De._resizerKeyboardManager.exec(this,e)},nA=function(e){var t;l(this,Jr)&&((t=e.relatedTarget)==null?void 0:t.parentNode)!==l(this,Qt)&&A(this,we,$u).call(this)},rA=function(e){v(this,th,l(this,Jr)?e:"")},ky=function(e){if(l(this,qn))for(const t of l(this,qn))t.tabIndex=e},$u=function(){v(this,Jr,!1),A(this,we,ky).call(this,-1),A(this,we,um).call(this)},S(De,rh),xe(De,"_l10n",null),xe(De,"_l10nResizer",null),xe(De,"_borderLineWidth",-1),xe(De,"_colorManager",new hy),xe(De,"_zIndex",1),xe(De,"_telemetryTimeout",1e3);let vt=De;class cT extends vt{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const ww=3285377520,vn=4294901760,ur=65535;class iA{constructor(e){this.h1=e?e&4294967295:ww,this.h2=e?e&4294967295:ww}update(e){let t,s;if(typeof e=="string"){t=new Uint8Array(e.length*2),s=0;for(let y=0,N=e.length;y<N;y++){const b=e.charCodeAt(y);b<=255?t[s++]=b:(t[s++]=b>>>8,t[s++]=b&255)}}else if(ArrayBuffer.isView(e))t=e.slice(),s=t.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const r=s>>2,i=s-r*4,a=new Uint32Array(t.buffer,0,r);let o=0,c=0,d=this.h1,h=this.h2;const f=3432918353,m=461845907,p=f&ur,g=m&ur;for(let y=0;y<r;y++)y&1?(o=a[y],o=o*f&vn|o*p&ur,o=o<<15|o>>>17,o=o*m&vn|o*g&ur,d^=o,d=d<<13|d>>>19,d=d*5+3864292196):(c=a[y],c=c*f&vn|c*p&ur,c=c<<15|c>>>17,c=c*m&vn|c*g&ur,h^=c,h=h<<13|h>>>19,h=h*5+3864292196);switch(o=0,i){case 3:o^=t[r*4+2]<<16;case 2:o^=t[r*4+1]<<8;case 1:o^=t[r*4],o=o*f&vn|o*p&ur,o=o<<15|o>>>17,o=o*m&vn|o*g&ur,r&1?d^=o:h^=o}this.h1=d,this.h2=h}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=e*3981806797&vn|e*36045&ur,t=t*4283543511&vn|((t<<16|e>>>16)*2950163797&vn)>>>16,e^=t>>>1,e=e*444984403&vn|e*60499&ur,t=t*3301882366&vn|((t<<16|e>>>16)*3120437893&vn)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}}const Ey=Object.freeze({map:null,hash:"",transfer:void 0});var po,go,Wt,bp,aA;class Cb{constructor(){S(this,bp);S(this,po,!1);S(this,go,null);S(this,Wt,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){const s=l(this,Wt).get(e);return s===void 0?t:Object.assign(t,s)}getRawValue(e){return l(this,Wt).get(e)}remove(e){if(l(this,Wt).delete(e),l(this,Wt).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const t of l(this,Wt).values())if(t instanceof vt)return;this.onAnnotationEditor(null)}}setValue(e,t){const s=l(this,Wt).get(e);let r=!1;if(s!==void 0)for(const[i,a]of Object.entries(t))s[i]!==a&&(r=!0,s[i]=a);else r=!0,l(this,Wt).set(e,t);r&&A(this,bp,aA).call(this),t instanceof vt&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(t.constructor._type)}has(e){return l(this,Wt).has(e)}getAll(){return l(this,Wt).size>0?_b(l(this,Wt)):null}setAll(e){for(const[t,s]of Object.entries(e))this.setValue(t,s)}get size(){return l(this,Wt).size}resetModified(){l(this,po)&&(v(this,po,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new oA(this)}get serializable(){if(l(this,Wt).size===0)return Ey;const e=new Map,t=new iA,s=[],r=Object.create(null);let i=!1;for(const[a,o]of l(this,Wt)){const c=o instanceof vt?o.serialize(!1,r):o;c&&(e.set(a,c),t.update(`${a}:${JSON.stringify(c)}`),i||(i=!!c.bitmap))}if(i)for(const a of e.values())a.bitmap&&s.push(a.bitmap);return e.size>0?{map:e,hash:t.hexdigest(),transfer:s}:Ey}get editorStats(){let e=null;const t=new Map;for(const s of l(this,Wt).values()){if(!(s instanceof vt))continue;const r=s.telemetryFinalData;if(!r)continue;const{type:i}=r;t.has(i)||t.set(i,Object.getPrototypeOf(s).constructor),e||(e=Object.create(null));const a=e[i]||(e[i]=new Map);for(const[o,c]of Object.entries(r)){if(o==="type")continue;let d=a.get(o);d||(d=new Map,a.set(o,d));const h=d.get(c)??0;d.set(c,h+1)}}for(const[s,r]of t)e[s]=r.computeTelemetryFinalData(e[s]);return e}resetModifiedIds(){v(this,go,null)}get modifiedIds(){if(l(this,go))return l(this,go);const e=[];for(const t of l(this,Wt).values())!(t instanceof vt)||!t.annotationElementId||!t.serialize()||e.push(t.annotationElementId);return v(this,go,{ids:new Set(e),hash:e.join(",")})}}po=new WeakMap,go=new WeakMap,Wt=new WeakMap,bp=new WeakSet,aA=function(){l(this,po)||(v(this,po,!0),typeof this.onSetModified=="function"&&this.onSetModified())};var ih;class oA extends Cb{constructor(t){super();S(this,ih);const{map:s,hash:r,transfer:i}=t.serializable,a=structuredClone(s,i?{transfer:i}:null);v(this,ih,{map:a,hash:r,transfer:i})}get print(){st("Should not call PrintAnnotationStorage.print")}get serializable(){return l(this,ih)}get modifiedIds(){return Le(this,"modifiedIds",{ids:new Set,hash:""})}}ih=new WeakMap;var mc;class uT{constructor({ownerDocument:e=globalThis.document,styleElement:t=null}){S(this,mc,new Set);this._document=e,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(const e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),l(this,mc).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:e,_inspectFont:t}){if(!(!e||l(this,mc).has(e.loadedName))){if(Rt(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:s,src:r,style:i}=e,a=new FontFace(s,r,i);this.addNativeFontFace(a);try{await a.load(),l(this,mc).add(s),t==null||t(e)}catch{Pe(`Cannot load system font: ${e.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(a)}return}st("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(e){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo){await this.loadSystemFont(e);return}if(this.isFontLoadingAPISupported){const s=e.createNativeFontFace();if(s){this.addNativeFontFace(s);try{await s.loaded}catch(r){throw Pe(`Failed to load font '${s.family}': '${r}'.`),e.disableFontFace=!0,r}}return}const t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;await new Promise(s=>{const r=this._queueLoadingCallback(s);this._prepareFontLoadEvent(e,r)})}}get isFontLoadingAPISupported(){var t;const e=!!((t=this._document)!=null&&t.fonts);return Le(this,"isFontLoadingAPISupported",e)}get isSyncFontLoadingSupported(){let e=!1;return(ys||typeof navigator<"u"&&typeof(navigator==null?void 0:navigator.userAgent)=="string"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(e=!0),Le(this,"isSyncFontLoadingSupported",e)}_queueLoadingCallback(e){function t(){for(Rt(!r.done,"completeRequest() cannot be called twice."),r.done=!0;s.length>0&&s[0].done;){const i=s.shift();setTimeout(i.callback,0)}}const{loadingRequests:s}=this,r={done:!1,complete:t,callback:e};return s.push(r),r}get _loadTestFont(){const e=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return Le(this,"_loadTestFont",e)}_prepareFontLoadEvent(e,t){function s(w,k){return w.charCodeAt(k)<<24|w.charCodeAt(k+1)<<16|w.charCodeAt(k+2)<<8|w.charCodeAt(k+3)&255}function r(w,k,C,T){const D=w.substring(0,k),B=w.substring(k+C);return D+T+B}let i,a;const o=this._document.createElement("canvas");o.width=1,o.height=1;const c=o.getContext("2d");let d=0;function h(w,k){if(++d>30){Pe("Load test font never loaded."),k();return}if(c.font="30px "+w,c.fillText(".",0,20),c.getImageData(0,0,1,1).data[3]>0){k();return}setTimeout(h.bind(null,w,k))}const f=`lt${Date.now()}${this.loadTestFontId++}`;let m=this._loadTestFont;m=r(m,976,f.length,f);const g=16,y=1482184792;let N=s(m,g);for(i=0,a=f.length-3;i<a;i+=4)N=N-y+s(f,i)|0;i<f.length&&(N=N-y+s(f+"XXX",i)|0),m=r(m,g,4,X2(N));const b=`url(data:font/opentype;base64,${btoa(m)});`,x=`@font-face {font-family:"${f}";src:${b}}`;this.insertRule(x);const _=this._document.createElement("div");_.style.visibility="hidden",_.style.width=_.style.height="10px",_.style.position="absolute",_.style.top=_.style.left="0px";for(const w of[e.loadedName,f]){const k=this._document.createElement("span");k.textContent="Hi",k.style.fontFamily=w,_.append(k)}this._document.body.append(_),h(f,()=>{_.remove(),t.complete()})}}mc=new WeakMap;class dT{constructor(e,{disableFontFace:t=!1,fontExtraProperties:s=!1,inspectFont:r=null}){this.compiledGlyphs=Object.create(null);for(const i in e)this[i]=e[i];this.disableFontFace=t===!0,this.fontExtraProperties=s===!0,this._inspectFont=r}createNativeFontFace(){var t;if(!this.data||this.disableFontFace)return null;let e;if(!this.cssFontInfo)e=new FontFace(this.loadedName,this.data,{});else{const s={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(s.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,s)}return(t=this._inspectFont)==null||t.call(this,this),e}createFontFaceRule(){var s;if(!this.data||this.disableFontFace)return null;const e=`url(data:${this.mimetype};base64,${tT(this.data)});`;let t;if(!this.cssFontInfo)t=`@font-face {font-family:"${this.loadedName}";src:${e}}`;else{let r=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(r+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),t=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${r}src:${e}}`}return(s=this._inspectFont)==null||s.call(this,this,e),t}getPathGenerator(e,t){if(this.compiledGlyphs[t]!==void 0)return this.compiledGlyphs[t];const s=this.loadedName+"_path_"+t;let r;try{r=e.get(s)}catch(a){Pe(`getPathGenerator - ignoring character: "${a}".`)}const i=new Path2D(r||"");return this.fontExtraProperties||e.delete(s),this.compiledGlyphs[t]=i}}const $f={DATA:1,ERROR:2},jt={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function _w(){}function Ms(n){if(n instanceof Ca||n instanceof ay||n instanceof Td||n instanceof vw||n instanceof ip||n instanceof qg)return n;switch(n instanceof Error||typeof n=="object"&&n!==null||st('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),n.name){case"AbortException":return new Ca(n.message);case"InvalidPDFException":return new ay(n.message);case"MissingPDFException":return new Td(n.message);case"PasswordException":return new vw(n.message,n.code);case"UnexpectedResponseException":return new ip(n.message,n.status);case"UnknownErrorException":return new qg(n.message,n.details)}return new qg(n.message,n.toString())}var pc,In,lA,cA,uA,dm;class Bu{constructor(e,t,s){S(this,In);S(this,pc,new AbortController);this.sourceName=e,this.targetName=t,this.comObj=s,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),s.addEventListener("message",A(this,In,lA).bind(this),{signal:l(this,pc).signal})}on(e,t){const s=this.actionHandler;if(s[e])throw new Error(`There is already an actionName called "${e}"`);s[e]=t}send(e,t,s){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},s)}sendWithPromise(e,t,s){const r=this.callbackId++,i=Promise.withResolvers();this.callbackCapabilities[r]=i;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:r,data:t},s)}catch(a){i.reject(a)}return i.promise}sendWithStream(e,t,s,r){const i=this.streamId++,a=this.sourceName,o=this.targetName,c=this.comObj;return new ReadableStream({start:d=>{const h=Promise.withResolvers();return this.streamControllers[i]={controller:d,startCall:h,pullCall:null,cancelCall:null,isClosed:!1},c.postMessage({sourceName:a,targetName:o,action:e,streamId:i,data:t,desiredSize:d.desiredSize},r),h.promise},pull:d=>{const h=Promise.withResolvers();return this.streamControllers[i].pullCall=h,c.postMessage({sourceName:a,targetName:o,stream:jt.PULL,streamId:i,desiredSize:d.desiredSize}),h.promise},cancel:d=>{Rt(d instanceof Error,"cancel must have a valid reason");const h=Promise.withResolvers();return this.streamControllers[i].cancelCall=h,this.streamControllers[i].isClosed=!0,c.postMessage({sourceName:a,targetName:o,stream:jt.CANCEL,streamId:i,reason:Ms(d)}),h.promise}},s)}destroy(){var e;(e=l(this,pc))==null||e.abort(),v(this,pc,null)}}pc=new WeakMap,In=new WeakSet,lA=function({data:e}){if(e.targetName!==this.sourceName)return;if(e.stream){A(this,In,uA).call(this,e);return}if(e.callback){const s=e.callbackId,r=this.callbackCapabilities[s];if(!r)throw new Error(`Cannot resolve callback ${s}`);if(delete this.callbackCapabilities[s],e.callback===$f.DATA)r.resolve(e.data);else if(e.callback===$f.ERROR)r.reject(Ms(e.reason));else throw new Error("Unexpected callback case");return}const t=this.actionHandler[e.action];if(!t)throw new Error(`Unknown action from worker: ${e.action}`);if(e.callbackId){const s=this.sourceName,r=e.sourceName,i=this.comObj;Promise.try(t,e.data).then(function(a){i.postMessage({sourceName:s,targetName:r,callback:$f.DATA,callbackId:e.callbackId,data:a})},function(a){i.postMessage({sourceName:s,targetName:r,callback:$f.ERROR,callbackId:e.callbackId,reason:Ms(a)})});return}if(e.streamId){A(this,In,cA).call(this,e);return}t(e.data)},cA=function(e){const t=e.streamId,s=this.sourceName,r=e.sourceName,i=this.comObj,a=this,o=this.actionHandler[e.action],c={enqueue(d,h=1,f){if(this.isCancelled)return;const m=this.desiredSize;this.desiredSize-=h,m>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),i.postMessage({sourceName:s,targetName:r,stream:jt.ENQUEUE,streamId:t,chunk:d},f)},close(){this.isCancelled||(this.isCancelled=!0,i.postMessage({sourceName:s,targetName:r,stream:jt.CLOSE,streamId:t}),delete a.streamSinks[t])},error(d){Rt(d instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,i.postMessage({sourceName:s,targetName:r,stream:jt.ERROR,streamId:t,reason:Ms(d)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};c.sinkCapability.resolve(),c.ready=c.sinkCapability.promise,this.streamSinks[t]=c,Promise.try(o,e.data,c).then(function(){i.postMessage({sourceName:s,targetName:r,stream:jt.START_COMPLETE,streamId:t,success:!0})},function(d){i.postMessage({sourceName:s,targetName:r,stream:jt.START_COMPLETE,streamId:t,reason:Ms(d)})})},uA=function(e){const t=e.streamId,s=this.sourceName,r=e.sourceName,i=this.comObj,a=this.streamControllers[t],o=this.streamSinks[t];switch(e.stream){case jt.START_COMPLETE:e.success?a.startCall.resolve():a.startCall.reject(Ms(e.reason));break;case jt.PULL_COMPLETE:e.success?a.pullCall.resolve():a.pullCall.reject(Ms(e.reason));break;case jt.PULL:if(!o){i.postMessage({sourceName:s,targetName:r,stream:jt.PULL_COMPLETE,streamId:t,success:!0});break}o.desiredSize<=0&&e.desiredSize>0&&o.sinkCapability.resolve(),o.desiredSize=e.desiredSize,Promise.try(o.onPull||_w).then(function(){i.postMessage({sourceName:s,targetName:r,stream:jt.PULL_COMPLETE,streamId:t,success:!0})},function(d){i.postMessage({sourceName:s,targetName:r,stream:jt.PULL_COMPLETE,streamId:t,reason:Ms(d)})});break;case jt.ENQUEUE:if(Rt(a,"enqueue should have stream controller"),a.isClosed)break;a.controller.enqueue(e.chunk);break;case jt.CLOSE:if(Rt(a,"close should have stream controller"),a.isClosed)break;a.isClosed=!0,a.controller.close(),A(this,In,dm).call(this,a,t);break;case jt.ERROR:Rt(a,"error should have stream controller"),a.controller.error(Ms(e.reason)),A(this,In,dm).call(this,a,t);break;case jt.CANCEL_COMPLETE:e.success?a.cancelCall.resolve():a.cancelCall.reject(Ms(e.reason)),A(this,In,dm).call(this,a,t);break;case jt.CANCEL:if(!o)break;const c=Ms(e.reason);Promise.try(o.onCancel||_w,c).then(function(){i.postMessage({sourceName:s,targetName:r,stream:jt.CANCEL_COMPLETE,streamId:t,success:!0})},function(d){i.postMessage({sourceName:s,targetName:r,stream:jt.CANCEL_COMPLETE,streamId:t,reason:Ms(d)})}),o.sinkCapability.reject(c),o.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}},dm=async function(e,t){var s,r,i;await Promise.allSettled([(s=e.startCall)==null?void 0:s.promise,(r=e.pullCall)==null?void 0:r.promise,(i=e.cancelCall)==null?void 0:i.promise]),delete this.streamControllers[t]};var ah;class dA{constructor({enableHWA:e=!1}){S(this,ah,!1);v(this,ah,e)}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");const s=this._createCanvas(e,t);return{canvas:s,context:s.getContext("2d",{willReadFrequently:!l(this,ah)})}}reset(e,t,s){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||s<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=s}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){st("Abstract method `_createCanvas` called.")}}ah=new WeakMap;class hT extends dA{constructor({ownerDocument:e=globalThis.document,enableHWA:t=!1}){super({enableHWA:t}),this._document=e}_createCanvas(e,t){const s=this._document.createElement("canvas");return s.width=e,s.height=t,s}}class hA{constructor({baseUrl:e=null,isCompressed:t=!0}){this.baseUrl=e,this.isCompressed=t}async fetch({name:e}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!e)throw new Error("CMap name must be specified.");const t=this.baseUrl+e+(this.isCompressed?".bcmap":"");return this._fetch(t).then(s=>({cMapData:s,isCompressed:this.isCompressed})).catch(s=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${t}`)})}async _fetch(e){st("Abstract method `_fetch` called.")}}class fA extends hA{async _fetch(e){const t=await ng(e,this.isCompressed?"arraybuffer":"text");return t instanceof ArrayBuffer?new Uint8Array(t):sg(t)}}class mA{addFilter(e){return"none"}addHCMFilter(e,t){return"none"}addAlphaFilter(e){return"none"}addLuminosityFilter(e){return"none"}addHighlightHCMFilter(e,t,s,r,i){return"none"}destroy(e=!1){}}var yo,gc,Qr,Zr,hs,vo,bo,oe,cs,Uu,Al,hm,Nl,pA,Cy,kl,zu,Hu,jy,qu;class fT extends mA{constructor({docId:t,ownerDocument:s=globalThis.document}){super();S(this,oe);S(this,yo);S(this,gc);S(this,Qr);S(this,Zr);S(this,hs);S(this,vo);S(this,bo,0);v(this,Zr,t),v(this,hs,s)}addFilter(t){if(!t)return"none";let s=l(this,oe,cs).get(t);if(s)return s;const[r,i,a]=A(this,oe,hm).call(this,t),o=t.length===1?r:`${r}${i}${a}`;if(s=l(this,oe,cs).get(o),s)return l(this,oe,cs).set(t,s),s;const c=`g_${l(this,Zr)}_transfer_map_${bs(this,bo)._++}`,d=A(this,oe,Nl).call(this,c);l(this,oe,cs).set(t,d),l(this,oe,cs).set(o,d);const h=A(this,oe,kl).call(this,c);return A(this,oe,Hu).call(this,r,i,a,h),d}addHCMFilter(t,s){var g;const r=`${t}-${s}`,i="base";let a=l(this,oe,Uu).get(i);if((a==null?void 0:a.key)===r||(a?((g=a.filter)==null||g.remove(),a.key=r,a.url="none",a.filter=null):(a={key:r,url:"none",filter:null},l(this,oe,Uu).set(i,a)),!t||!s))return a.url;const o=A(this,oe,qu).call(this,t);t=ve.makeHexColor(...o);const c=A(this,oe,qu).call(this,s);if(s=ve.makeHexColor(...c),l(this,oe,Al).style.color="",t==="#000000"&&s==="#ffffff"||t===s)return a.url;const d=new Array(256);for(let y=0;y<=255;y++){const N=y/255;d[y]=N<=.03928?N/12.92:((N+.055)/1.055)**2.4}const h=d.join(","),f=`g_${l(this,Zr)}_hcm_filter`,m=a.filter=A(this,oe,kl).call(this,f);A(this,oe,Hu).call(this,h,h,h,m),A(this,oe,Cy).call(this,m);const p=(y,N)=>{const b=o[y]/255,x=c[y]/255,_=new Array(N+1);for(let w=0;w<=N;w++)_[w]=b+w/N*(x-b);return _.join(",")};return A(this,oe,Hu).call(this,p(0,5),p(1,5),p(2,5),m),a.url=A(this,oe,Nl).call(this,f),a.url}addAlphaFilter(t){let s=l(this,oe,cs).get(t);if(s)return s;const[r]=A(this,oe,hm).call(this,[t]),i=`alpha_${r}`;if(s=l(this,oe,cs).get(i),s)return l(this,oe,cs).set(t,s),s;const a=`g_${l(this,Zr)}_alpha_map_${bs(this,bo)._++}`,o=A(this,oe,Nl).call(this,a);l(this,oe,cs).set(t,o),l(this,oe,cs).set(i,o);const c=A(this,oe,kl).call(this,a);return A(this,oe,jy).call(this,r,c),o}addLuminosityFilter(t){let s=l(this,oe,cs).get(t||"luminosity");if(s)return s;let r,i;if(t?([r]=A(this,oe,hm).call(this,[t]),i=`luminosity_${r}`):i="luminosity",s=l(this,oe,cs).get(i),s)return l(this,oe,cs).set(t,s),s;const a=`g_${l(this,Zr)}_luminosity_map_${bs(this,bo)._++}`,o=A(this,oe,Nl).call(this,a);l(this,oe,cs).set(t,o),l(this,oe,cs).set(i,o);const c=A(this,oe,kl).call(this,a);return A(this,oe,pA).call(this,c),t&&A(this,oe,jy).call(this,r,c),o}addHighlightHCMFilter(t,s,r,i,a){var x;const o=`${s}-${r}-${i}-${a}`;let c=l(this,oe,Uu).get(t);if((c==null?void 0:c.key)===o||(c?((x=c.filter)==null||x.remove(),c.key=o,c.url="none",c.filter=null):(c={key:o,url:"none",filter:null},l(this,oe,Uu).set(t,c)),!s||!r))return c.url;const[d,h]=[s,r].map(A(this,oe,qu).bind(this));let f=Math.round(.2126*d[0]+.7152*d[1]+.0722*d[2]),m=Math.round(.2126*h[0]+.7152*h[1]+.0722*h[2]),[p,g]=[i,a].map(A(this,oe,qu).bind(this));m<f&&([f,m,p,g]=[m,f,g,p]),l(this,oe,Al).style.color="";const y=(_,w,k)=>{const C=new Array(256),T=(m-f)/k,D=_/255,B=(w-_)/(255*k);let ee=0;for(let M=0;M<=k;M++){const E=Math.round(f+M*T),$=D+M*B;for(let ie=ee;ie<=E;ie++)C[ie]=$;ee=E+1}for(let M=ee;M<256;M++)C[M]=C[ee-1];return C.join(",")},N=`g_${l(this,Zr)}_hcm_${t}_filter`,b=c.filter=A(this,oe,kl).call(this,N);return A(this,oe,Cy).call(this,b),A(this,oe,Hu).call(this,y(p[0],g[0],5),y(p[1],g[1],5),y(p[2],g[2],5),b),c.url=A(this,oe,Nl).call(this,N),c.url}destroy(t=!1){var s,r,i,a;t&&((s=l(this,vo))!=null&&s.size)||((r=l(this,Qr))==null||r.parentNode.parentNode.remove(),v(this,Qr,null),(i=l(this,gc))==null||i.clear(),v(this,gc,null),(a=l(this,vo))==null||a.clear(),v(this,vo,null),v(this,bo,0))}}yo=new WeakMap,gc=new WeakMap,Qr=new WeakMap,Zr=new WeakMap,hs=new WeakMap,vo=new WeakMap,bo=new WeakMap,oe=new WeakSet,cs=function(){return l(this,gc)||v(this,gc,new Map)},Uu=function(){return l(this,vo)||v(this,vo,new Map)},Al=function(){if(!l(this,Qr)){const t=l(this,hs).createElement("div"),{style:s}=t;s.visibility="hidden",s.contain="strict",s.width=s.height=0,s.position="absolute",s.top=s.left=0,s.zIndex=-1;const r=l(this,hs).createElementNS(Or,"svg");r.setAttribute("width",0),r.setAttribute("height",0),v(this,Qr,l(this,hs).createElementNS(Or,"defs")),t.append(r),r.append(l(this,Qr)),l(this,hs).body.append(t)}return l(this,Qr)},hm=function(t){if(t.length===1){const d=t[0],h=new Array(256);for(let m=0;m<256;m++)h[m]=d[m]/255;const f=h.join(",");return[f,f,f]}const[s,r,i]=t,a=new Array(256),o=new Array(256),c=new Array(256);for(let d=0;d<256;d++)a[d]=s[d]/255,o[d]=r[d]/255,c[d]=i[d]/255;return[a.join(","),o.join(","),c.join(",")]},Nl=function(t){if(l(this,yo)===void 0){v(this,yo,"");const s=l(this,hs).URL;s!==l(this,hs).baseURI&&(rg(s)?Pe('#createUrl: ignore "data:"-URL for performance reasons.'):v(this,yo,s.split("#",1)[0]))}return`url(${l(this,yo)}#${t})`},pA=function(t){const s=l(this,hs).createElementNS(Or,"feColorMatrix");s.setAttribute("type","matrix"),s.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(s)},Cy=function(t){const s=l(this,hs).createElementNS(Or,"feColorMatrix");s.setAttribute("type","matrix"),s.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(s)},kl=function(t){const s=l(this,hs).createElementNS(Or,"filter");return s.setAttribute("color-interpolation-filters","sRGB"),s.setAttribute("id",t),l(this,oe,Al).append(s),s},zu=function(t,s,r){const i=l(this,hs).createElementNS(Or,s);i.setAttribute("type","discrete"),i.setAttribute("tableValues",r),t.append(i)},Hu=function(t,s,r,i){const a=l(this,hs).createElementNS(Or,"feComponentTransfer");i.append(a),A(this,oe,zu).call(this,a,"feFuncR",t),A(this,oe,zu).call(this,a,"feFuncG",s),A(this,oe,zu).call(this,a,"feFuncB",r)},jy=function(t,s){const r=l(this,hs).createElementNS(Or,"feComponentTransfer");s.append(r),A(this,oe,zu).call(this,r,"feFuncA",t)},qu=function(t){return l(this,oe,Al).style.color=t,Eb(getComputedStyle(l(this,oe,Al)).getPropertyValue("color"))};class gA{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!e)throw new Error("Font filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(s=>{throw new Error(`Unable to load font data at: ${t}`)})}async _fetch(e){st("Abstract method `_fetch` called.")}}class yA extends gA{async _fetch(e){const t=await ng(e,"arraybuffer");return new Uint8Array(t)}}ys&&Pe("Please use the `legacy` build in Node.js environments.");async function vA(n){const t=await process.getBuiltinModule("fs").promises.readFile(n);return new Uint8Array(t)}class mT extends mA{}class pT extends dA{_createCanvas(e,t){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(e,t)}}class gT extends hA{async _fetch(e){return vA(e)}}class yT extends gA{async _fetch(e){return vA(e)}}const ps={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function Ty(n,e){if(!e)return;const t=e[2]-e[0],s=e[3]-e[1],r=new Path2D;r.rect(e[0],e[1],t,s),n.clip(r)}class jb{getPattern(){st("Abstract method `getPattern` called.")}}class vT extends jb{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let t;this._type==="axial"?t=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(t=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const s of this._colorStops)t.addColorStop(s[0],s[1]);return t}getPattern(e,t,s,r){let i;if(r===ps.STROKE||r===ps.FILL){const a=t.current.getClippedPathBoundingBox(r,ht(e))||[0,0,0,0],o=Math.ceil(a[2]-a[0])||1,c=Math.ceil(a[3]-a[1])||1,d=t.cachedCanvases.getCanvas("pattern",o,c),h=d.context;h.clearRect(0,0,h.canvas.width,h.canvas.height),h.beginPath(),h.rect(0,0,h.canvas.width,h.canvas.height),h.translate(-a[0],-a[1]),s=ve.transform(s,[1,0,0,1,a[0],a[1]]),h.transform(...t.baseTransform),this.matrix&&h.transform(...this.matrix),Ty(h,this._bbox),h.fillStyle=this._createGradient(h),h.fill(),i=e.createPattern(d.canvas,"no-repeat");const f=new DOMMatrix(s);i.setTransform(f)}else Ty(e,this._bbox),i=this._createGradient(e);return i}}function Gg(n,e,t,s,r,i,a,o){const c=e.coords,d=e.colors,h=n.data,f=n.width*4;let m;c[t+1]>c[s+1]&&(m=t,t=s,s=m,m=i,i=a,a=m),c[s+1]>c[r+1]&&(m=s,s=r,r=m,m=a,a=o,o=m),c[t+1]>c[s+1]&&(m=t,t=s,s=m,m=i,i=a,a=m);const p=(c[t]+e.offsetX)*e.scaleX,g=(c[t+1]+e.offsetY)*e.scaleY,y=(c[s]+e.offsetX)*e.scaleX,N=(c[s+1]+e.offsetY)*e.scaleY,b=(c[r]+e.offsetX)*e.scaleX,x=(c[r+1]+e.offsetY)*e.scaleY;if(g>=x)return;const _=d[i],w=d[i+1],k=d[i+2],C=d[a],T=d[a+1],D=d[a+2],B=d[o],ee=d[o+1],M=d[o+2],E=Math.round(g),$=Math.round(x);let ie,pe,P,se,F,W,ne,be;for(let _e=E;_e<=$;_e++){if(_e<N){const Q=_e<g?0:(g-_e)/(g-N);ie=p-(p-y)*Q,pe=_-(_-C)*Q,P=w-(w-T)*Q,se=k-(k-D)*Q}else{let Q;_e>x?Q=1:N===x?Q=0:Q=(N-_e)/(N-x),ie=y-(y-b)*Q,pe=C-(C-B)*Q,P=T-(T-ee)*Q,se=D-(D-M)*Q}let Oe;_e<g?Oe=0:_e>x?Oe=1:Oe=(g-_e)/(g-x),F=p-(p-b)*Oe,W=_-(_-B)*Oe,ne=w-(w-ee)*Oe,be=k-(k-M)*Oe;const et=Math.round(Math.min(ie,F)),qe=Math.round(Math.max(ie,F));let Se=f*_e+et*4;for(let Q=et;Q<=qe;Q++)Oe=(ie-Q)/(ie-F),Oe<0?Oe=0:Oe>1&&(Oe=1),h[Se++]=pe-(pe-W)*Oe|0,h[Se++]=P-(P-ne)*Oe|0,h[Se++]=se-(se-be)*Oe|0,h[Se++]=255}}function bT(n,e,t){const s=e.coords,r=e.colors;let i,a;switch(e.type){case"lattice":const o=e.verticesPerRow,c=Math.floor(s.length/o)-1,d=o-1;for(i=0;i<c;i++){let h=i*o;for(let f=0;f<d;f++,h++)Gg(n,t,s[h],s[h+1],s[h+o],r[h],r[h+1],r[h+o]),Gg(n,t,s[h+o+1],s[h+1],s[h+o],r[h+o+1],r[h+1],r[h+o])}break;case"triangles":for(i=0,a=s.length;i<a;i+=3)Gg(n,t,s[i],s[i+1],s[i+2],r[i],r[i+1],r[i+2]);break;default:throw new Error("illegal figure")}}class xT extends jb{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[7],this._background=e[8],this.matrix=null}_createMeshCanvas(e,t,s){const o=Math.floor(this._bounds[0]),c=Math.floor(this._bounds[1]),d=Math.ceil(this._bounds[2])-o,h=Math.ceil(this._bounds[3])-c,f=Math.min(Math.ceil(Math.abs(d*e[0]*1.1)),3e3),m=Math.min(Math.ceil(Math.abs(h*e[1]*1.1)),3e3),p=d/f,g=h/m,y={coords:this._coords,colors:this._colors,offsetX:-o,offsetY:-c,scaleX:1/p,scaleY:1/g},N=f+2*2,b=m+2*2,x=s.getCanvas("mesh",N,b),_=x.context,w=_.createImageData(f,m);if(t){const C=w.data;for(let T=0,D=C.length;T<D;T+=4)C[T]=t[0],C[T+1]=t[1],C[T+2]=t[2],C[T+3]=255}for(const C of this._figures)bT(w,C,y);return _.putImageData(w,2,2),{canvas:x.canvas,offsetX:o-2*p,offsetY:c-2*g,scaleX:p,scaleY:g}}getPattern(e,t,s,r){Ty(e,this._bbox);let i;if(r===ps.SHADING)i=ve.singularValueDecompose2dScale(ht(e));else if(i=ve.singularValueDecompose2dScale(t.baseTransform),this.matrix){const o=ve.singularValueDecompose2dScale(this.matrix);i=[i[0]*o[0],i[1]*o[1]]}const a=this._createMeshCanvas(i,r===ps.SHADING?null:this._background,t.cachedCanvases);return r!==ps.SHADING&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(a.offsetX,a.offsetY),e.scale(a.scaleX,a.scaleY),e.createPattern(a.canvas,"no-repeat")}}class wT extends jb{getPattern(){return"hotpink"}}function _T(n){switch(n[0]){case"RadialAxial":return new vT(n);case"Mesh":return new xT(n);case"Dummy":return new wT}throw new Error(`Unknown IR type: ${n[0]}`)}const Sw={COLORED:1,UNCOLORED:2},xp=class xp{constructor(e,t,s,r,i){this.operatorList=e[2],this.matrix=e[3],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.color=t,this.ctx=s,this.canvasGraphicsFactory=r,this.baseTransform=i}createPatternCanvas(e){const{bbox:t,operatorList:s,paintType:r,tilingType:i,color:a,canvasGraphicsFactory:o}=this;let{xstep:c,ystep:d}=this;c=Math.abs(c),d=Math.abs(d),tg("TilingType: "+i);const h=t[0],f=t[1],m=t[2],p=t[3],g=m-h,y=p-f,N=ve.singularValueDecompose2dScale(this.matrix),b=ve.singularValueDecompose2dScale(this.baseTransform),x=N[0]*b[0],_=N[1]*b[1];let w=g,k=y,C=!1,T=!1;const D=Math.ceil(c*x),B=Math.ceil(d*_),ee=Math.ceil(g*x),M=Math.ceil(y*_);D>=ee?w=c:C=!0,B>=M?k=d:T=!0;const E=this.getSizeAndScale(w,this.ctx.canvas.width,x),$=this.getSizeAndScale(k,this.ctx.canvas.height,_),ie=e.cachedCanvases.getCanvas("pattern",E.size,$.size),pe=ie.context,P=o.createCanvasGraphics(pe);if(P.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(P,r,a),pe.translate(-E.scale*h,-$.scale*f),P.transform(E.scale,0,0,$.scale,0,0),pe.save(),this.clipBbox(P,h,f,m,p),P.baseTransform=ht(P.ctx),P.executeOperatorList(s),P.endDrawing(),pe.restore(),C||T){const se=ie.canvas;C&&(w=c),T&&(k=d);const F=this.getSizeAndScale(w,this.ctx.canvas.width,x),W=this.getSizeAndScale(k,this.ctx.canvas.height,_),ne=F.size,be=W.size,_e=e.cachedCanvases.getCanvas("pattern-workaround",ne,be),Oe=_e.context,et=C?Math.floor(g/c):0,qe=T?Math.floor(y/d):0;for(let Se=0;Se<=et;Se++)for(let Q=0;Q<=qe;Q++)Oe.drawImage(se,ne*Se,be*Q,ne,be,0,0,ne,be);return{canvas:_e.canvas,scaleX:F.scale,scaleY:W.scale,offsetX:h,offsetY:f}}return{canvas:ie.canvas,scaleX:E.scale,scaleY:$.scale,offsetX:h,offsetY:f}}getSizeAndScale(e,t,s){const r=Math.max(xp.MAX_PATTERN_SIZE,t);let i=Math.ceil(e*s);return i>=r?i=r:s=i/e,{scale:s,size:i}}clipBbox(e,t,s,r,i){const a=r-t,o=i-s;e.ctx.rect(t,s,a,o),e.current.updateRectMinMax(ht(e.ctx),[t,s,r,i]),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,t,s){const r=e.ctx,i=e.current;switch(t){case Sw.COLORED:const a=this.ctx;r.fillStyle=a.fillStyle,r.strokeStyle=a.strokeStyle,i.fillColor=a.fillStyle,i.strokeColor=a.strokeStyle;break;case Sw.UNCOLORED:const o=ve.makeHexColor(s[0],s[1],s[2]);r.fillStyle=o,r.strokeStyle=o,i.fillColor=o,i.strokeColor=o;break;default:throw new K2(`Unsupported paint type: ${t}`)}}getPattern(e,t,s,r){let i=s;r!==ps.SHADING&&(i=ve.transform(i,t.baseTransform),this.matrix&&(i=ve.transform(i,this.matrix)));const a=this.createPatternCanvas(t);let o=new DOMMatrix(i);o=o.translate(a.offsetX,a.offsetY),o=o.scale(1/a.scaleX,1/a.scaleY);const c=e.createPattern(a.canvas,"repeat");return c.setTransform(o),c}};xe(xp,"MAX_PATTERN_SIZE",3e3);let Ry=xp;function ST({src:n,srcPos:e=0,dest:t,width:s,height:r,nonBlackColor:i=4294967295,inverseDecode:a=!1}){const o=Cs.isLittleEndian?4278190080:255,[c,d]=a?[i,o]:[o,i],h=s>>3,f=s&7,m=n.length;t=new Uint32Array(t.buffer);let p=0;for(let g=0;g<r;g++){for(const N=e+h;e<N;e++){const b=e<m?n[e]:255;t[p++]=b&128?d:c,t[p++]=b&64?d:c,t[p++]=b&32?d:c,t[p++]=b&16?d:c,t[p++]=b&8?d:c,t[p++]=b&4?d:c,t[p++]=b&2?d:c,t[p++]=b&1?d:c}if(f===0)continue;const y=e<m?n[e++]:255;for(let N=0;N<f;N++)t[p++]=y&1<<7-N?d:c}return{srcPos:e,destPos:p}}const Aw=16,Nw=100,AT=15,kw=10,Ew=1e3,Bs=16;function NT(n,e){if(n._removeMirroring)throw new Error("Context is already forwarding operations.");n.__originalSave=n.save,n.__originalRestore=n.restore,n.__originalRotate=n.rotate,n.__originalScale=n.scale,n.__originalTranslate=n.translate,n.__originalTransform=n.transform,n.__originalSetTransform=n.setTransform,n.__originalResetTransform=n.resetTransform,n.__originalClip=n.clip,n.__originalMoveTo=n.moveTo,n.__originalLineTo=n.lineTo,n.__originalBezierCurveTo=n.bezierCurveTo,n.__originalRect=n.rect,n.__originalClosePath=n.closePath,n.__originalBeginPath=n.beginPath,n._removeMirroring=()=>{n.save=n.__originalSave,n.restore=n.__originalRestore,n.rotate=n.__originalRotate,n.scale=n.__originalScale,n.translate=n.__originalTranslate,n.transform=n.__originalTransform,n.setTransform=n.__originalSetTransform,n.resetTransform=n.__originalResetTransform,n.clip=n.__originalClip,n.moveTo=n.__originalMoveTo,n.lineTo=n.__originalLineTo,n.bezierCurveTo=n.__originalBezierCurveTo,n.rect=n.__originalRect,n.closePath=n.__originalClosePath,n.beginPath=n.__originalBeginPath,delete n._removeMirroring},n.save=function(){e.save(),this.__originalSave()},n.restore=function(){e.restore(),this.__originalRestore()},n.translate=function(s,r){e.translate(s,r),this.__originalTranslate(s,r)},n.scale=function(s,r){e.scale(s,r),this.__originalScale(s,r)},n.transform=function(s,r,i,a,o,c){e.transform(s,r,i,a,o,c),this.__originalTransform(s,r,i,a,o,c)},n.setTransform=function(s,r,i,a,o,c){e.setTransform(s,r,i,a,o,c),this.__originalSetTransform(s,r,i,a,o,c)},n.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},n.rotate=function(s){e.rotate(s),this.__originalRotate(s)},n.clip=function(s){e.clip(s),this.__originalClip(s)},n.moveTo=function(t,s){e.moveTo(t,s),this.__originalMoveTo(t,s)},n.lineTo=function(t,s){e.lineTo(t,s),this.__originalLineTo(t,s)},n.bezierCurveTo=function(t,s,r,i,a,o){e.bezierCurveTo(t,s,r,i,a,o),this.__originalBezierCurveTo(t,s,r,i,a,o)},n.rect=function(t,s,r,i){e.rect(t,s,r,i),this.__originalRect(t,s,r,i)},n.closePath=function(){e.closePath(),this.__originalClosePath()},n.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}class kT{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,s){let r;return this.cache[e]!==void 0?(r=this.cache[e],this.canvasFactory.reset(r,t,s)):(r=this.canvasFactory.create(t,s),this.cache[e]=r),r}delete(e){delete this.cache[e]}clear(){for(const e in this.cache){const t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}}function Bf(n,e,t,s,r,i,a,o,c,d){const[h,f,m,p,g,y]=ht(n);if(f===0&&m===0){const x=a*h+g,_=Math.round(x),w=o*p+y,k=Math.round(w),C=(a+c)*h+g,T=Math.abs(Math.round(C)-_)||1,D=(o+d)*p+y,B=Math.abs(Math.round(D)-k)||1;return n.setTransform(Math.sign(h),0,0,Math.sign(p),_,k),n.drawImage(e,t,s,r,i,0,0,T,B),n.setTransform(h,f,m,p,g,y),[T,B]}if(h===0&&p===0){const x=o*m+g,_=Math.round(x),w=a*f+y,k=Math.round(w),C=(o+d)*m+g,T=Math.abs(Math.round(C)-_)||1,D=(a+c)*f+y,B=Math.abs(Math.round(D)-k)||1;return n.setTransform(0,Math.sign(f),Math.sign(m),0,_,k),n.drawImage(e,t,s,r,i,0,0,B,T),n.setTransform(h,f,m,p,g,y),[B,T]}n.drawImage(e,t,s,r,i,a,o,c,d);const N=Math.hypot(h,f),b=Math.hypot(m,p);return[N*c,b*d]}function ET(n){const{width:e,height:t}=n;if(e>Ew||t>Ew)return null;const s=1e3,r=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),i=e+1;let a=new Uint8Array(i*(t+1)),o,c,d;const h=e+7&-8;let f=new Uint8Array(h*t),m=0;for(const b of n.data){let x=128;for(;x>0;)f[m++]=b&x?0:255,x>>=1}let p=0;for(m=0,f[m]!==0&&(a[0]=1,++p),c=1;c<e;c++)f[m]!==f[m+1]&&(a[c]=f[m]?2:1,++p),m++;for(f[m]!==0&&(a[c]=2,++p),o=1;o<t;o++){m=o*h,d=o*i,f[m-h]!==f[m]&&(a[d]=f[m]?1:8,++p);let b=(f[m]?4:0)+(f[m-h]?8:0);for(c=1;c<e;c++)b=(b>>2)+(f[m+1]?4:0)+(f[m-h+1]?8:0),r[b]&&(a[d+c]=r[b],++p),m++;if(f[m-h]!==f[m]&&(a[d+c]=f[m]?2:4,++p),p>s)return null}for(m=h*(t-1),d=o*i,f[m]!==0&&(a[d]=8,++p),c=1;c<e;c++)f[m]!==f[m+1]&&(a[d+c]=f[m]?4:8,++p),m++;if(f[m]!==0&&(a[d+c]=4,++p),p>s)return null;const g=new Int32Array([0,i,-1,0,-i,0,0,0,1]),y=new Path2D;for(o=0;p&&o<=t;o++){let b=o*i;const x=b+e;for(;b<x&&!a[b];)b++;if(b===x)continue;y.moveTo(b%i,o);const _=b;let w=a[b];do{const k=g[w];do b+=k;while(!a[b]);const C=a[b];C!==5&&C!==10?(w=C,a[b]=0):(w=C&51*w>>4,a[b]&=w>>2|w<<2),y.lineTo(b%i,b/i|0),a[b]||--p}while(_!==b);--o}return f=null,a=null,function(b){b.save(),b.scale(1/e,-1/t),b.translate(0,-t),b.fill(y),b.beginPath(),b.restore()}}class Cw{constructor(e,t){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=C1,this.textMatrixScale=1,this.fontMatrix=iy,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=ls.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.patternStroke=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,e,t])}clone(){const e=Object.create(this);return e.clipBox=this.clipBox.slice(),e}setCurrentPoint(e,t){this.x=e,this.y=t}updatePathMinMax(e,t,s){[t,s]=ve.applyTransform([t,s],e),this.minX=Math.min(this.minX,t),this.minY=Math.min(this.minY,s),this.maxX=Math.max(this.maxX,t),this.maxY=Math.max(this.maxY,s)}updateRectMinMax(e,t){const s=ve.applyTransform(t,e),r=ve.applyTransform(t.slice(2),e),i=ve.applyTransform([t[0],t[3]],e),a=ve.applyTransform([t[2],t[1]],e);this.minX=Math.min(this.minX,s[0],r[0],i[0],a[0]),this.minY=Math.min(this.minY,s[1],r[1],i[1],a[1]),this.maxX=Math.max(this.maxX,s[0],r[0],i[0],a[0]),this.maxY=Math.max(this.maxY,s[1],r[1],i[1],a[1])}updateScalingPathMinMax(e,t){ve.scaleMinMax(e,t),this.minX=Math.min(this.minX,t[0]),this.minY=Math.min(this.minY,t[1]),this.maxX=Math.max(this.maxX,t[2]),this.maxY=Math.max(this.maxY,t[3])}updateCurvePathMinMax(e,t,s,r,i,a,o,c,d,h){const f=ve.bezierBoundingBox(t,s,r,i,a,o,c,d,h);h||this.updateRectMinMax(e,f)}getPathBoundingBox(e=ps.FILL,t=null){const s=[this.minX,this.minY,this.maxX,this.maxY];if(e===ps.STROKE){t||st("Stroke bounding box must include transform.");const r=ve.singularValueDecompose2dScale(t),i=r[0]*this.lineWidth/2,a=r[1]*this.lineWidth/2;s[0]-=i,s[1]-=a,s[2]+=i,s[3]+=a}return s}updateClipFromPath(){const e=ve.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(e){this.clipBox=e,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(e=ps.FILL,t=null){return ve.intersect(this.clipBox,this.getPathBoundingBox(e,t))}}function jw(n,e){if(e instanceof ImageData){n.putImageData(e,0,0);return}const t=e.height,s=e.width,r=t%Bs,i=(t-r)/Bs,a=r===0?i:i+1,o=n.createImageData(s,Bs);let c=0,d;const h=e.data,f=o.data;let m,p,g,y;if(e.kind===sm.GRAYSCALE_1BPP){const N=h.byteLength,b=new Uint32Array(f.buffer,0,f.byteLength>>2),x=b.length,_=s+7>>3,w=4294967295,k=Cs.isLittleEndian?4278190080:255;for(m=0;m<a;m++){for(g=m<i?Bs:r,d=0,p=0;p<g;p++){const C=N-c;let T=0;const D=C>_?s:C*8-7,B=D&-8;let ee=0,M=0;for(;T<B;T+=8)M=h[c++],b[d++]=M&128?w:k,b[d++]=M&64?w:k,b[d++]=M&32?w:k,b[d++]=M&16?w:k,b[d++]=M&8?w:k,b[d++]=M&4?w:k,b[d++]=M&2?w:k,b[d++]=M&1?w:k;for(;T<D;T++)ee===0&&(M=h[c++],ee=128),b[d++]=M&ee?w:k,ee>>=1}for(;d<x;)b[d++]=0;n.putImageData(o,0,m*Bs)}}else if(e.kind===sm.RGBA_32BPP){for(p=0,y=s*Bs*4,m=0;m<i;m++)f.set(h.subarray(c,c+y)),c+=y,n.putImageData(o,0,p),p+=Bs;m<a&&(y=s*r*4,f.set(h.subarray(c,c+y)),n.putImageData(o,0,p))}else if(e.kind===sm.RGB_24BPP)for(g=Bs,y=s*g,m=0;m<a;m++){for(m>=i&&(g=r,y=s*g),d=0,p=y;p--;)f[d++]=h[c++],f[d++]=h[c++],f[d++]=h[c++],f[d++]=255;n.putImageData(o,0,m*Bs)}else throw new Error(`bad image kind: ${e.kind}`)}function Tw(n,e){if(e.bitmap){n.drawImage(e.bitmap,0,0);return}const t=e.height,s=e.width,r=t%Bs,i=(t-r)/Bs,a=r===0?i:i+1,o=n.createImageData(s,Bs);let c=0;const d=e.data,h=o.data;for(let f=0;f<a;f++){const m=f<i?Bs:r;({srcPos:c}=ST({src:d,srcPos:c,dest:h,width:s,height:m,nonBlackColor:0})),n.putImageData(o,0,f*Bs)}}function Cu(n,e){const t=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const s of t)n[s]!==void 0&&(e[s]=n[s]);n.setLineDash!==void 0&&(e.setLineDash(n.getLineDash()),e.lineDashOffset=n.lineDashOffset)}function Uf(n){if(n.strokeStyle=n.fillStyle="#000000",n.fillRule="nonzero",n.globalAlpha=1,n.lineWidth=1,n.lineCap="butt",n.lineJoin="miter",n.miterLimit=10,n.globalCompositeOperation="source-over",n.font="10px sans-serif",n.setLineDash!==void 0&&(n.setLineDash([]),n.lineDashOffset=0),!ys){const{filter:e}=n;e!=="none"&&e!==""&&(n.filter="none")}}function Rw(n,e){if(e)return!0;const t=ve.singularValueDecompose2dScale(n);t[0]=Math.fround(t[0]),t[1]=Math.fround(t[1]);const s=Math.fround((globalThis.devicePixelRatio||1)*ja.PDF_TO_CSS_UNITS);return t[0]<=s&&t[1]<=s}const CT=["butt","round","square"],jT=["miter","round","bevel"],TT={},Iw={};var or,Iy,Py,Dy;const Db=class Db{constructor(e,t,s,r,i,{optionalContentConfig:a,markedContentStack:o=null},c,d){S(this,or);this.ctx=e,this.current=new Cw(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=s,this.canvasFactory=r,this.filterFactory=i,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=o||[],this.optionalContentConfig=a,this.cachedCanvases=new kT(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=c,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=d,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(e,t=null){return typeof e=="string"?e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e):t}beginDrawing({transform:e,viewport:t,transparency:s=!1,background:r=null}){const i=this.ctx.canvas.width,a=this.ctx.canvas.height,o=this.ctx.fillStyle;if(this.ctx.fillStyle=r||"#ffffff",this.ctx.fillRect(0,0,i,a),this.ctx.fillStyle=o,s){const c=this.cachedCanvases.getCanvas("transparent",i,a);this.compositeCtx=this.ctx,this.transparentCanvas=c.canvas,this.ctx=c.context,this.ctx.save(),this.ctx.transform(...ht(this.compositeCtx))}this.ctx.save(),Uf(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...t.transform),this.viewportScale=t.scale,this.baseTransform=ht(this.ctx)}executeOperatorList(e,t,s,r){const i=e.argsArray,a=e.fnArray;let o=t||0;const c=i.length;if(c===o)return o;const d=c-o>kw&&typeof s=="function",h=d?Date.now()+AT:0;let f=0;const m=this.commonObjs,p=this.objs;let g;for(;;){if(r!==void 0&&o===r.nextBreakPoint)return r.breakIt(o,s),o;if(g=a[o],g!==Bn.dependency)this[g].apply(this,i[o]);else for(const y of i[o]){const N=y.startsWith("g_")?m:p;if(!N.has(y))return N.get(y,s),o}if(o++,o===c)return o;if(d&&++f>kw){if(Date.now()>h)return s(),o;f=0}}}endDrawing(){A(this,or,Iy).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const e of this._cachedBitmapsMap.values()){for(const t of e.values())typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),A(this,or,Py).call(this)}_scaleImage(e,t){const s=e.width??e.displayWidth,r=e.height??e.displayHeight;let i=Math.max(Math.hypot(t[0],t[1]),1),a=Math.max(Math.hypot(t[2],t[3]),1),o=s,c=r,d="prescale1",h,f;for(;i>2&&o>1||a>2&&c>1;){let m=o,p=c;i>2&&o>1&&(m=o>=16384?Math.floor(o/2)-1||1:Math.ceil(o/2),i/=o/m),a>2&&c>1&&(p=c>=16384?Math.floor(c/2)-1||1:Math.ceil(c)/2,a/=c/p),h=this.cachedCanvases.getCanvas(d,m,p),f=h.context,f.clearRect(0,0,m,p),f.drawImage(e,0,0,o,c,0,0,m,p),e=h.canvas,o=m,c=p,d=d==="prescale1"?"prescale2":"prescale1"}return{img:e,paintWidth:o,paintHeight:c}}_createMaskCanvas(e){const t=this.ctx,{width:s,height:r}=e,i=this.current.fillColor,a=this.current.patternFill,o=ht(t);let c,d,h,f;if((e.bitmap||e.data)&&e.count>1){const D=e.bitmap||e.data.buffer;d=JSON.stringify(a?o:[o.slice(0,4),i]),c=this._cachedBitmapsMap.get(D),c||(c=new Map,this._cachedBitmapsMap.set(D,c));const B=c.get(d);if(B&&!a){const ee=Math.round(Math.min(o[0],o[2])+o[4]),M=Math.round(Math.min(o[1],o[3])+o[5]);return{canvas:B,offsetX:ee,offsetY:M}}h=B}h||(f=this.cachedCanvases.getCanvas("maskCanvas",s,r),Tw(f.context,e));let m=ve.transform(o,[1/s,0,0,-1/r,0,0]);m=ve.transform(m,[1,0,0,1,0,-r]);const[p,g,y,N]=ve.getAxialAlignedBoundingBox([0,0,s,r],m),b=Math.round(y-p)||1,x=Math.round(N-g)||1,_=this.cachedCanvases.getCanvas("fillCanvas",b,x),w=_.context,k=p,C=g;w.translate(-k,-C),w.transform(...m),h||(h=this._scaleImage(f.canvas,cr(w)),h=h.img,c&&a&&c.set(d,h)),w.imageSmoothingEnabled=Rw(ht(w),e.interpolate),Bf(w,h,0,0,h.width,h.height,0,0,s,r),w.globalCompositeOperation="source-in";const T=ve.transform(cr(w),[1,0,0,1,-k,-C]);return w.fillStyle=a?i.getPattern(t,this,T,ps.FILL):i,w.fillRect(0,0,s,r),c&&!a&&(this.cachedCanvases.delete("fillCanvas"),c.set(d,_.canvas)),{canvas:_.canvas,offsetX:Math.round(k),offsetY:Math.round(C)}}setLineWidth(e){e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(e){this.ctx.lineCap=CT[e]}setLineJoin(e){this.ctx.lineJoin=jT[e]}setMiterLimit(e){this.ctx.miterLimit=e}setDash(e,t){const s=this.ctx;s.setLineDash!==void 0&&(s.setLineDash(e),s.lineDashOffset=t)}setRenderingIntent(e){}setFlatness(e){}setGState(e){for(const[t,s]of e)switch(t){case"LW":this.setLineWidth(s);break;case"LC":this.setLineCap(s);break;case"LJ":this.setLineJoin(s);break;case"ML":this.setMiterLimit(s);break;case"D":this.setDash(s[0],s[1]);break;case"RI":this.setRenderingIntent(s);break;case"FL":this.setFlatness(s);break;case"Font":this.setFont(s[0],s[1]);break;case"CA":this.current.strokeAlpha=s;break;case"ca":this.current.fillAlpha=s,this.ctx.globalAlpha=s;break;case"BM":this.ctx.globalCompositeOperation=s;break;case"SMask":this.current.activeSMask=s?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(s);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const e=this.ctx.canvas.width,t=this.ctx.canvas.height,s="smaskGroupAt"+this.groupLevel,r=this.cachedCanvases.getCanvas(s,e,t);this.suspendedCtx=this.ctx,this.ctx=r.context;const i=this.ctx;i.setTransform(...ht(this.suspendedCtx)),Cu(this.suspendedCtx,i),NT(i,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),Cu(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const t=this.current.activeSMask,s=this.suspendedCtx;this.composeSMask(s,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(e,t,s,r){const i=r[0],a=r[1],o=r[2]-i,c=r[3]-a;o===0||c===0||(this.genericComposeSMask(t.context,s,o,c,t.subtype,t.backdrop,t.transferMap,i,a,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(s.canvas,0,0),e.restore())}genericComposeSMask(e,t,s,r,i,a,o,c,d,h,f){let m=e.canvas,p=c-h,g=d-f;if(a){const N=ve.makeHexColor(...a);if(p<0||g<0||p+s>m.width||g+r>m.height){const b=this.cachedCanvases.getCanvas("maskExtension",s,r),x=b.context;x.drawImage(m,-p,-g),x.globalCompositeOperation="destination-atop",x.fillStyle=N,x.fillRect(0,0,s,r),x.globalCompositeOperation="source-over",m=b.canvas,p=g=0}else{e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0);const b=new Path2D;b.rect(p,g,s,r),e.clip(b),e.globalCompositeOperation="destination-atop",e.fillStyle=N,e.fillRect(p,g,s,r),e.restore()}}t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0),i==="Alpha"&&o?t.filter=this.filterFactory.addAlphaFilter(o):i==="Luminosity"&&(t.filter=this.filterFactory.addLuminosityFilter(o));const y=new Path2D;y.rect(c,d,s,r),t.clip(y),t.globalCompositeOperation="destination-in",t.drawImage(m,p,g,s,r,c,d,s,r),t.restore()}save(){this.inSMaskMode?(Cu(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const e=this.current;this.stateStack.push(e),this.current=e.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),Cu(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(e,t,s,r,i,a){this.ctx.transform(e,t,s,r,i,a),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,t,s){const r=this.ctx,i=this.current;let a=i.x,o=i.y,c,d;const h=ht(r),f=h[0]===0&&h[3]===0||h[1]===0&&h[2]===0,m=f?s.slice(0):null;for(let p=0,g=0,y=e.length;p<y;p++)switch(e[p]|0){case Bn.rectangle:a=t[g++],o=t[g++];const N=t[g++],b=t[g++],x=a+N,_=o+b;r.moveTo(a,o),N===0||b===0?r.lineTo(x,_):(r.lineTo(x,o),r.lineTo(x,_),r.lineTo(a,_)),f||i.updateRectMinMax(h,[a,o,x,_]),r.closePath();break;case Bn.moveTo:a=t[g++],o=t[g++],r.moveTo(a,o),f||i.updatePathMinMax(h,a,o);break;case Bn.lineTo:a=t[g++],o=t[g++],r.lineTo(a,o),f||i.updatePathMinMax(h,a,o);break;case Bn.curveTo:c=a,d=o,a=t[g+4],o=t[g+5],r.bezierCurveTo(t[g],t[g+1],t[g+2],t[g+3],a,o),i.updateCurvePathMinMax(h,c,d,t[g],t[g+1],t[g+2],t[g+3],a,o,m),g+=6;break;case Bn.curveTo2:c=a,d=o,r.bezierCurveTo(a,o,t[g],t[g+1],t[g+2],t[g+3]),i.updateCurvePathMinMax(h,c,d,a,o,t[g],t[g+1],t[g+2],t[g+3],m),a=t[g+2],o=t[g+3],g+=4;break;case Bn.curveTo3:c=a,d=o,a=t[g+2],o=t[g+3],r.bezierCurveTo(t[g],t[g+1],a,o,a,o),i.updateCurvePathMinMax(h,c,d,t[g],t[g+1],a,o,a,o,m),g+=4;break;case Bn.closePath:r.closePath();break}f&&i.updateScalingPathMinMax(h,m),i.setCurrentPoint(a,o)}closePath(){this.ctx.closePath()}stroke(e=!0){const t=this.ctx,s=this.current.strokeColor;t.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof s=="object"&&(s!=null&&s.getPattern)?(t.save(),t.strokeStyle=s.getPattern(t,this,cr(t),ps.STROKE),this.rescaleAndStroke(!1),t.restore()):this.rescaleAndStroke(!0)),e&&this.consumePath(this.current.getClippedPathBoundingBox()),t.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(e=!0){const t=this.ctx,s=this.current.fillColor,r=this.current.patternFill;let i=!1;r&&(t.save(),t.fillStyle=s.getPattern(t,this,cr(t),ps.FILL),i=!0);const a=this.current.getClippedPathBoundingBox();this.contentVisible&&a!==null&&(this.pendingEOFill?(t.fill("evenodd"),this.pendingEOFill=!1):t.fill()),i&&t.restore(),e&&this.consumePath(a)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=TT}eoClip(){this.pendingClip=Iw}beginText(){this.current.textMatrix=C1,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const e=this.pendingTextPaths,t=this.ctx;if(e===void 0){t.beginPath();return}const s=new Path2D,r=t.getTransform().invertSelf();for(const{transform:i,x:a,y:o,fontSize:c,path:d}of e)s.addPath(d,new DOMMatrix(i).preMultiplySelf(r).translate(a,o).scale(c,-c));t.clip(s),t.beginPath(),delete this.pendingTextPaths}setCharSpacing(e){this.current.charSpacing=e}setWordSpacing(e){this.current.wordSpacing=e}setHScale(e){this.current.textHScale=e/100}setLeading(e){this.current.leading=-e}setFont(e,t){var h;const s=this.commonObjs.get(e),r=this.current;if(!s)throw new Error(`Can't find font for ${e}`);if(r.fontMatrix=s.fontMatrix||iy,(r.fontMatrix[0]===0||r.fontMatrix[3]===0)&&Pe("Invalid font matrix for font "+e),t<0?(t=-t,r.fontDirection=-1):r.fontDirection=1,this.current.font=s,this.current.fontSize=t,s.isType3Font)return;const i=s.loadedName||"sans-serif",a=((h=s.systemFontInfo)==null?void 0:h.css)||`"${i}", ${s.fallbackName}`;let o="normal";s.black?o="900":s.bold&&(o="bold");const c=s.italic?"italic":"normal";let d=t;t<Aw?d=Aw:t>Nw&&(d=Nw),this.current.fontSizeScale=t/d,this.ctx.font=`${c} ${o} ${d}px ${a}`}setTextRenderingMode(e){this.current.textRenderingMode=e}setTextRise(e){this.current.textRise=e}moveText(e,t){this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=t}setLeadingMoveText(e,t){this.setLeading(-t),this.moveText(e,t)}setTextMatrix(e,t,s,r,i,a){this.current.textMatrix=[e,t,s,r,i,a],this.current.textMatrixScale=Math.hypot(e,t),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(e,t,s,r,i){const a=this.ctx,o=this.current,c=o.font,d=o.textRenderingMode,h=o.fontSize/o.fontSizeScale,f=d&ls.FILL_STROKE_MASK,m=!!(d&ls.ADD_TO_PATH_FLAG),p=o.patternFill&&!c.missingFile,g=o.patternStroke&&!c.missingFile;let y;if((c.disableFontFace||m||p||g)&&(y=c.getPathGenerator(this.commonObjs,e)),c.disableFontFace||p||g){if(a.save(),a.translate(t,s),a.scale(h,-h),f===ls.FILL||f===ls.FILL_STROKE)if(r){const N=a.getTransform();a.setTransform(...r),a.fill(A(this,or,Dy).call(this,y,N,r))}else a.fill(y);if(f===ls.STROKE||f===ls.FILL_STROKE)if(i){const N=a.getTransform();a.setTransform(...i),a.stroke(A(this,or,Dy).call(this,y,N,i))}else a.lineWidth/=h,a.stroke(y);a.restore()}else(f===ls.FILL||f===ls.FILL_STROKE)&&a.fillText(e,t,s),(f===ls.STROKE||f===ls.FILL_STROKE)&&a.strokeText(e,t,s);m&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:ht(a),x:t,y:s,fontSize:h,path:y})}get isFontSubpixelAAEnabled(){const{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);const t=e.getImageData(0,0,10,10).data;let s=!1;for(let r=3;r<t.length;r+=4)if(t[r]>0&&t[r]<255){s=!0;break}return Le(this,"isFontSubpixelAAEnabled",s)}showText(e){const t=this.current,s=t.font;if(s.isType3Font)return this.showType3Text(e);const r=t.fontSize;if(r===0)return;const i=this.ctx,a=t.fontSizeScale,o=t.charSpacing,c=t.wordSpacing,d=t.fontDirection,h=t.textHScale*d,f=e.length,m=s.vertical,p=m?1:-1,g=s.defaultVMetrics,y=r*t.fontMatrix[0],N=t.textRenderingMode===ls.FILL&&!s.disableFontFace&&!t.patternFill;i.save(),i.transform(...t.textMatrix),i.translate(t.x,t.y+t.textRise),d>0?i.scale(h,-1):i.scale(h,1);let b,x;if(t.patternFill){i.save();const T=t.fillColor.getPattern(i,this,cr(i),ps.FILL);b=ht(i),i.restore(),i.fillStyle=T}if(t.patternStroke){i.save();const T=t.strokeColor.getPattern(i,this,cr(i),ps.STROKE);x=ht(i),i.restore(),i.strokeStyle=T}let _=t.lineWidth;const w=t.textMatrixScale;if(w===0||_===0){const T=t.textRenderingMode&ls.FILL_STROKE_MASK;(T===ls.STROKE||T===ls.FILL_STROKE)&&(_=this.getSinglePixelWidth())}else _/=w;if(a!==1&&(i.scale(a,a),_/=a),i.lineWidth=_,s.isInvalidPDFjsFont){const T=[];let D=0;for(const B of e)T.push(B.unicode),D+=B.width;i.fillText(T.join(""),0,0),t.x+=D*y*h,i.restore(),this.compose();return}let k=0,C;for(C=0;C<f;++C){const T=e[C];if(typeof T=="number"){k+=p*T*r/1e3;continue}let D=!1;const B=(T.isSpace?c:0)+o,ee=T.fontChar,M=T.accent;let E,$,ie=T.width;if(m){const P=T.vmetric||g,se=-(T.vmetric?P[1]:ie*.5)*y,F=P[2]*y;ie=P?-P[0]:ie,E=se/a,$=(k+F)/a}else E=k/a,$=0;if(s.remeasure&&ie>0){const P=i.measureText(ee).width*1e3/r*a;if(ie<P&&this.isFontSubpixelAAEnabled){const se=ie/P;D=!0,i.save(),i.scale(se,1),E/=se}else ie!==P&&(E+=(ie-P)/2e3*r/a)}if(this.contentVisible&&(T.isInFont||s.missingFile)){if(N&&!M)i.fillText(ee,E,$);else if(this.paintChar(ee,E,$,b,x),M){const P=E+r*M.offset.x/a,se=$-r*M.offset.y/a;this.paintChar(M.fontChar,P,se,b,x)}}const pe=m?ie*y-B*d:ie*y+B*d;k+=pe,D&&i.restore()}m?t.y-=k:t.x+=k*h,i.restore(),this.compose()}showType3Text(e){const t=this.ctx,s=this.current,r=s.font,i=s.fontSize,a=s.fontDirection,o=r.vertical?1:-1,c=s.charSpacing,d=s.wordSpacing,h=s.textHScale*a,f=s.fontMatrix||iy,m=e.length,p=s.textRenderingMode===ls.INVISIBLE;let g,y,N,b;if(!(p||i===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,t.save(),t.transform(...s.textMatrix),t.translate(s.x,s.y),t.scale(h,a),g=0;g<m;++g){if(y=e[g],typeof y=="number"){b=o*y*i/1e3,this.ctx.translate(b,0),s.x+=b*h;continue}const x=(y.isSpace?d:0)+c,_=r.charProcOperatorList[y.operatorListId];if(!_){Pe(`Type3 character "${y.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=y,this.save(),t.scale(i,i),t.transform(...f),this.executeOperatorList(_),this.restore()),N=ve.applyTransform([y.width,0],f)[0]*i+x,t.translate(N,0),s.x+=N*h}t.restore(),this.processingType3=null}}setCharWidth(e,t){}setCharWidthAndBounds(e,t,s,r,i,a){this.ctx.rect(s,r,i-s,a-r),this.ctx.clip(),this.endPath()}getColorN_Pattern(e){let t;if(e[0]==="TilingPattern"){const s=e[1],r=this.baseTransform||ht(this.ctx),i={createCanvasGraphics:a=>new Db(a,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};t=new Ry(e,s,this.ctx,i,r)}else t=this._getPattern(e[1],e[2]);return t}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments),this.current.patternStroke=!0}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(e,t,s){this.ctx.strokeStyle=this.current.strokeColor=ve.makeHexColor(e,t,s),this.current.patternStroke=!1}setStrokeTransparent(){this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(e,t,s){this.ctx.fillStyle=this.current.fillColor=ve.makeHexColor(e,t,s),this.current.patternFill=!1}setFillTransparent(){this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(e,t=null){let s;return this.cachedPatterns.has(e)?s=this.cachedPatterns.get(e):(s=_T(this.getObject(e)),this.cachedPatterns.set(e,s)),t&&(s.matrix=t),s}shadingFill(e){if(!this.contentVisible)return;const t=this.ctx;this.save();const s=this._getPattern(e);t.fillStyle=s.getPattern(t,this,cr(t),ps.SHADING);const r=cr(t);if(r){const{width:i,height:a}=t.canvas,[o,c,d,h]=ve.getAxialAlignedBoundingBox([0,0,i,a],r);this.ctx.fillRect(o,c,d-o,h-c)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){st("Should not call beginInlineImage")}beginImageData(){st("Should not call beginImageData")}paintFormXObjectBegin(e,t){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),e&&this.transform(...e),this.baseTransform=ht(this.ctx),t)){const s=t[2]-t[0],r=t[3]-t[1];this.ctx.rect(t[0],t[1],s,r),this.current.updateRectMinMax(ht(this.ctx),t),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const t=this.ctx;e.isolated||tg("TODO: Support non-isolated groups."),e.knockout&&Pe("Knockout groups not supported.");const s=ht(t);if(e.matrix&&t.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let r=ve.getAxialAlignedBoundingBox(e.bbox,ht(t));const i=[0,0,t.canvas.width,t.canvas.height];r=ve.intersect(r,i)||[0,0,0,0];const a=Math.floor(r[0]),o=Math.floor(r[1]),c=Math.max(Math.ceil(r[2])-a,1),d=Math.max(Math.ceil(r[3])-o,1);this.current.startNewPathAndClipBox([0,0,c,d]);let h="groupAt"+this.groupLevel;e.smask&&(h+="_smask_"+this.smaskCounter++%2);const f=this.cachedCanvases.getCanvas(h,c,d),m=f.context;m.translate(-a,-o),m.transform(...s),e.smask?this.smaskStack.push({canvas:f.canvas,context:m,offsetX:a,offsetY:o,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}):(t.setTransform(1,0,0,1,0,0),t.translate(a,o),t.save()),Cu(t,m),this.ctx=m,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(t),this.groupLevel++}endGroup(e){if(!this.contentVisible)return;this.groupLevel--;const t=this.ctx,s=this.groupStack.pop();if(this.ctx=s,this.ctx.imageSmoothingEnabled=!1,e.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const r=ht(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...r);const i=ve.getAxialAlignedBoundingBox([0,0,t.canvas.width,t.canvas.height],r);this.ctx.drawImage(t.canvas,0,0),this.ctx.restore(),this.compose(i)}}beginAnnotation(e,t,s,r,i){if(A(this,or,Iy).call(this),Uf(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),t){const a=t[2]-t[0],o=t[3]-t[1];if(i&&this.annotationCanvasMap){s=s.slice(),s[4]-=t[0],s[5]-=t[1],t=t.slice(),t[0]=t[1]=0,t[2]=a,t[3]=o;const[c,d]=ve.singularValueDecompose2dScale(ht(this.ctx)),{viewportScale:h}=this,f=Math.ceil(a*this.outputScaleX*h),m=Math.ceil(o*this.outputScaleY*h);this.annotationCanvas=this.canvasFactory.create(f,m);const{canvas:p,context:g}=this.annotationCanvas;this.annotationCanvasMap.set(e,p),this.annotationCanvas.savedCtx=this.ctx,this.ctx=g,this.ctx.save(),this.ctx.setTransform(c,0,0,-d,0,o*d),Uf(this.ctx)}else Uf(this.ctx),this.endPath(),this.ctx.rect(t[0],t[1],a,o),this.ctx.clip(),this.ctx.beginPath()}this.current=new Cw(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...s),this.transform(...r)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),A(this,or,Py).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e){if(!this.contentVisible)return;const t=e.count;e=this.getObject(e.data,e),e.count=t;const s=this.ctx,r=this.processingType3;if(r&&(r.compiled===void 0&&(r.compiled=ET(e)),r.compiled)){r.compiled(s);return}const i=this._createMaskCanvas(e),a=i.canvas;s.save(),s.setTransform(1,0,0,1,0,0),s.drawImage(a,i.offsetX,i.offsetY),s.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t,s=0,r=0,i,a){if(!this.contentVisible)return;e=this.getObject(e.data,e);const o=this.ctx;o.save();const c=ht(o);o.transform(t,s,r,i,0,0);const d=this._createMaskCanvas(e);o.setTransform(1,0,0,1,d.offsetX-c[4],d.offsetY-c[5]);for(let h=0,f=a.length;h<f;h+=2){const m=ve.transform(c,[t,s,r,i,a[h],a[h+1]]),[p,g]=ve.applyTransform([0,0],m);o.drawImage(d.canvas,p,g)}o.restore(),this.compose()}paintImageMaskXObjectGroup(e){if(!this.contentVisible)return;const t=this.ctx,s=this.current.fillColor,r=this.current.patternFill;for(const i of e){const{data:a,width:o,height:c,transform:d}=i,h=this.cachedCanvases.getCanvas("maskCanvas",o,c),f=h.context;f.save();const m=this.getObject(a,i);Tw(f,m),f.globalCompositeOperation="source-in",f.fillStyle=r?s.getPattern(f,this,cr(t),ps.FILL):s,f.fillRect(0,0,o,c),f.restore(),t.save(),t.transform(...d),t.scale(1,-1),Bf(t,h.canvas,0,0,o,c,0,-1,1,1),t.restore()}this.compose()}paintImageXObject(e){if(!this.contentVisible)return;const t=this.getObject(e);if(!t){Pe("Dependent image isn't ready yet");return}this.paintInlineImageXObject(t)}paintImageXObjectRepeat(e,t,s,r){if(!this.contentVisible)return;const i=this.getObject(e);if(!i){Pe("Dependent image isn't ready yet");return}const a=i.width,o=i.height,c=[];for(let d=0,h=r.length;d<h;d+=2)c.push({transform:[t,0,0,s,r[d],r[d+1]],x:0,y:0,w:a,h:o});this.paintInlineImageXObjectGroup(i,c)}applyTransferMapsToCanvas(e){return this.current.transferMaps!=="none"&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if(this.current.transferMaps==="none")return e.bitmap;const{bitmap:t,width:s,height:r}=e,i=this.cachedCanvases.getCanvas("inlineImage",s,r),a=i.context;return a.filter=this.current.transferMaps,a.drawImage(t,0,0),a.filter="none",i.canvas}paintInlineImageXObject(e){if(!this.contentVisible)return;const t=e.width,s=e.height,r=this.ctx;if(this.save(),!ys){const{filter:o}=r;o!=="none"&&o!==""&&(r.filter="none")}r.scale(1/t,-1/s);let i;if(e.bitmap)i=this.applyTransferMapsToBitmap(e);else if(typeof HTMLElement=="function"&&e instanceof HTMLElement||!e.data)i=e;else{const c=this.cachedCanvases.getCanvas("inlineImage",t,s).context;jw(c,e),i=this.applyTransferMapsToCanvas(c)}const a=this._scaleImage(i,cr(r));r.imageSmoothingEnabled=Rw(ht(r),e.interpolate),Bf(r,a.img,0,0,a.paintWidth,a.paintHeight,0,-s,t,s),this.compose(),this.restore()}paintInlineImageXObjectGroup(e,t){if(!this.contentVisible)return;const s=this.ctx;let r;if(e.bitmap)r=e.bitmap;else{const i=e.width,a=e.height,c=this.cachedCanvases.getCanvas("inlineImage",i,a).context;jw(c,e),r=this.applyTransferMapsToCanvas(c)}for(const i of t)s.save(),s.transform(...i.transform),s.scale(1,-1),Bf(s,r,i.x,i.y,i.w,i.h,0,-1,1,1),s.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e){}markPointProps(e,t){}beginMarkedContent(e){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t){e==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(t)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(e){const t=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(e);const s=this.ctx;this.pendingClip&&(t||(this.pendingClip===Iw?s.clip("evenodd"):s.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),s.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const e=ht(this.ctx);if(e[1]===0&&e[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{const t=Math.abs(e[0]*e[3]-e[2]*e[1]),s=Math.hypot(e[0],e[2]),r=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(s,r)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:e}=this.current,{a:t,b:s,c:r,d:i}=this.ctx.getTransform();let a,o;if(s===0&&r===0){const c=Math.abs(t),d=Math.abs(i);if(c===d)if(e===0)a=o=1/c;else{const h=c*e;a=o=h<1?1/h:1}else if(e===0)a=1/c,o=1/d;else{const h=c*e,f=d*e;a=h<1?1/h:1,o=f<1?1/f:1}}else{const c=Math.abs(t*i-s*r),d=Math.hypot(t,s),h=Math.hypot(r,i);if(e===0)a=h/c,o=d/c;else{const f=e*c;a=h>f?h/f:1,o=d>f?d/f:1}}this._cachedScaleForStroking[0]=a,this._cachedScaleForStroking[1]=o}return this._cachedScaleForStroking}rescaleAndStroke(e){const{ctx:t}=this,{lineWidth:s}=this.current,[r,i]=this.getScaleForStroking();if(t.lineWidth=s||1,r===1&&i===1){t.stroke();return}const a=t.getLineDash();if(e&&t.save(),t.scale(r,i),a.length>0){const o=Math.max(r,i);t.setLineDash(a.map(c=>c/o)),t.lineDashOffset/=o}t.stroke(),e&&t.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}};or=new WeakSet,Iy=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},Py=function(){if(this.pageColors){const e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(e!=="none"){const t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}},Dy=function(e,t,s){const r=new Path2D;return r.addPath(e,new DOMMatrix(s).invertSelf().multiplySelf(t)),r};let Ql=Db;for(const n in Bn)Ql.prototype[n]!==void 0&&(Ql.prototype[Bn[n]]=Ql.prototype[n]);var oh,lh;class gi{static get workerPort(){return l(this,oh)}static set workerPort(e){if(!(typeof Worker<"u"&&e instanceof Worker)&&e!==null)throw new Error("Invalid `workerPort` type.");v(this,oh,e)}static get workerSrc(){return l(this,lh)}static set workerSrc(e){if(typeof e!="string")throw new Error("Invalid `workerSrc` type.");v(this,lh,e)}}oh=new WeakMap,lh=new WeakMap,S(gi,oh,null),S(gi,lh,"");var xo,ch;class RT{constructor({parsedData:e,rawData:t}){S(this,xo);S(this,ch);v(this,xo,e),v(this,ch,t)}getRaw(){return l(this,ch)}get(e){return l(this,xo).get(e)??null}getAll(){return _b(l(this,xo))}has(e){return l(this,xo).has(e)}}xo=new WeakMap,ch=new WeakMap;const El=Symbol("INTERNAL");var uh,dh,hh,yc;class IT{constructor(e,{name:t,intent:s,usage:r,rbGroups:i}){S(this,uh,!1);S(this,dh,!1);S(this,hh,!1);S(this,yc,!0);v(this,uh,!!(e&ln.DISPLAY)),v(this,dh,!!(e&ln.PRINT)),this.name=t,this.intent=s,this.usage=r,this.rbGroups=i}get visible(){if(l(this,hh))return l(this,yc);if(!l(this,yc))return!1;const{print:e,view:t}=this.usage;return l(this,uh)?(t==null?void 0:t.viewState)!=="OFF":l(this,dh)?(e==null?void 0:e.printState)!=="OFF":!0}_setVisible(e,t,s=!1){e!==El&&st("Internal method `_setVisible` called."),v(this,hh,s),v(this,yc,t)}}uh=new WeakMap,dh=new WeakMap,hh=new WeakMap,yc=new WeakMap;var Ji,Xe,vc,bc,fh,My;class PT{constructor(e,t=ln.DISPLAY){S(this,fh);S(this,Ji,null);S(this,Xe,new Map);S(this,vc,null);S(this,bc,null);if(this.renderingIntent=t,this.name=null,this.creator=null,e!==null){this.name=e.name,this.creator=e.creator,v(this,bc,e.order);for(const s of e.groups)l(this,Xe).set(s.id,new IT(t,s));if(e.baseState==="OFF")for(const s of l(this,Xe).values())s._setVisible(El,!1);for(const s of e.on)l(this,Xe).get(s)._setVisible(El,!0);for(const s of e.off)l(this,Xe).get(s)._setVisible(El,!1);v(this,vc,this.getHash())}}isVisible(e){if(l(this,Xe).size===0)return!0;if(!e)return tg("Optional content group not defined."),!0;if(e.type==="OCG")return l(this,Xe).has(e.id)?l(this,Xe).get(e.id).visible:(Pe(`Optional content group not found: ${e.id}`),!0);if(e.type==="OCMD"){if(e.expression)return A(this,fh,My).call(this,e.expression);if(!e.policy||e.policy==="AnyOn"){for(const t of e.ids){if(!l(this,Xe).has(t))return Pe(`Optional content group not found: ${t}`),!0;if(l(this,Xe).get(t).visible)return!0}return!1}else if(e.policy==="AllOn"){for(const t of e.ids){if(!l(this,Xe).has(t))return Pe(`Optional content group not found: ${t}`),!0;if(!l(this,Xe).get(t).visible)return!1}return!0}else if(e.policy==="AnyOff"){for(const t of e.ids){if(!l(this,Xe).has(t))return Pe(`Optional content group not found: ${t}`),!0;if(!l(this,Xe).get(t).visible)return!0}return!1}else if(e.policy==="AllOff"){for(const t of e.ids){if(!l(this,Xe).has(t))return Pe(`Optional content group not found: ${t}`),!0;if(l(this,Xe).get(t).visible)return!1}return!0}return Pe(`Unknown optional content policy ${e.policy}.`),!0}return Pe(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0,s=!0){var i;const r=l(this,Xe).get(e);if(!r){Pe(`Optional content group not found: ${e}`);return}if(s&&t&&r.rbGroups.length)for(const a of r.rbGroups)for(const o of a)o!==e&&((i=l(this,Xe).get(o))==null||i._setVisible(El,!1,!0));r._setVisible(El,!!t,!0),v(this,Ji,null)}setOCGState({state:e,preserveRB:t}){let s;for(const r of e){switch(r){case"ON":case"OFF":case"Toggle":s=r;continue}const i=l(this,Xe).get(r);if(i)switch(s){case"ON":this.setVisibility(r,!0,t);break;case"OFF":this.setVisibility(r,!1,t);break;case"Toggle":this.setVisibility(r,!i.visible,t);break}}v(this,Ji,null)}get hasInitialVisibility(){return l(this,vc)===null||this.getHash()===l(this,vc)}getOrder(){return l(this,Xe).size?l(this,bc)?l(this,bc).slice():[...l(this,Xe).keys()]:null}getGroups(){return l(this,Xe).size>0?_b(l(this,Xe)):null}getGroup(e){return l(this,Xe).get(e)||null}getHash(){if(l(this,Ji)!==null)return l(this,Ji);const e=new iA;for(const[t,s]of l(this,Xe))e.update(`${t}:${s.visible}`);return v(this,Ji,e.hexdigest())}}Ji=new WeakMap,Xe=new WeakMap,vc=new WeakMap,bc=new WeakMap,fh=new WeakSet,My=function(e){const t=e.length;if(t<2)return!0;const s=e[0];for(let r=1;r<t;r++){const i=e[r];let a;if(Array.isArray(i))a=A(this,fh,My).call(this,i);else if(l(this,Xe).has(i))a=l(this,Xe).get(i).visible;else return Pe(`Optional content group not found: ${i}`),!0;switch(s){case"And":if(!a)return!1;break;case"Or":if(a)return!0;break;case"Not":return!a;default:return!0}}return s==="And"};class DT{constructor(e,{disableRange:t=!1,disableStream:s=!1}){Rt(e,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:r,initialData:i,progressiveDone:a,contentDispositionFilename:o}=e;if(this._queuedChunks=[],this._progressiveDone=a,this._contentDispositionFilename=o,(i==null?void 0:i.length)>0){const c=i instanceof Uint8Array&&i.byteLength===i.buffer.byteLength?i.buffer:new Uint8Array(i).buffer;this._queuedChunks.push(c)}this._pdfDataRangeTransport=e,this._isStreamingSupported=!s,this._isRangeSupported=!t,this._contentLength=r,this._fullRequestReader=null,this._rangeReaders=[],e.addRangeListener((c,d)=>{this._onReceiveData({begin:c,chunk:d})}),e.addProgressListener((c,d)=>{this._onProgress({loaded:c,total:d})}),e.addProgressiveReadListener(c=>{this._onReceiveData({chunk:c})}),e.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),e.transportReady()}_onReceiveData({begin:e,chunk:t}){const s=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;if(e===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(s):this._queuedChunks.push(s);else{const r=this._rangeReaders.some(function(i){return i._begin!==e?!1:(i._enqueue(s),!0)});Rt(r,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}_onProgress(e){var t,s,r,i;e.total===void 0?(s=(t=this._rangeReaders[0])==null?void 0:t.onProgress)==null||s.call(t,{loaded:e.loaded}):(i=(r=this._fullRequestReader)==null?void 0:r.onProgress)==null||i.call(r,{loaded:e.loaded,total:e.total})}_onProgressiveDone(){var e;(e=this._fullRequestReader)==null||e.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){const t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){Rt(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const e=this._queuedChunks;return this._queuedChunks=null,new MT(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const s=new LT(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(s),s}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const s of this._rangeReaders.slice(0))s.cancel(e);this._pdfDataRangeTransport.abort()}}class MT{constructor(e,t,s=!1,r=null){this._stream=e,this._done=s||!1,this._filename=Nb(r)?r:null,this._queuedChunks=t||[],this._loaded=0;for(const i of this._queuedChunks)this._loaded+=i.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class LT{constructor(e,t,s){this._stream=e,this._begin=t,this._end=s,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(this._requests.length===0)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function OT(n){let e=!0,t=s("filename\\*","i").exec(n);if(t){t=t[1];let h=o(t);return h=unescape(h),h=c(h),h=d(h),i(h)}if(t=a(n),t){const h=d(t);return i(h)}if(t=s("filename","i").exec(n),t){t=t[1];let h=o(t);return h=d(h),i(h)}function s(h,f){return new RegExp("(?:^|;)\\s*"+h+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',f)}function r(h,f){if(h){if(!/^[\x00-\xFF]+$/.test(f))return f;try{const m=new TextDecoder(h,{fatal:!0}),p=sg(f);f=m.decode(p),e=!1}catch{}}return f}function i(h){return e&&/[\x80-\xff]/.test(h)&&(h=r("utf-8",h),e&&(h=r("iso-8859-1",h))),h}function a(h){const f=[];let m;const p=s("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(m=p.exec(h))!==null;){let[,y,N,b]=m;if(y=parseInt(y,10),y in f){if(y===0)break;continue}f[y]=[N,b]}const g=[];for(let y=0;y<f.length&&y in f;++y){let[N,b]=f[y];b=o(b),N&&(b=unescape(b),y===0&&(b=c(b))),g.push(b)}return g.join("")}function o(h){if(h.startsWith('"')){const f=h.slice(1).split('\\"');for(let m=0;m<f.length;++m){const p=f[m].indexOf('"');p!==-1&&(f[m]=f[m].slice(0,p),f.length=m+1),f[m]=f[m].replaceAll(/\\(.)/g,"$1")}h=f.join('"')}return h}function c(h){const f=h.indexOf("'");if(f===-1)return h;const m=h.slice(0,f),g=h.slice(f+1).replace(/^[^']*'/,"");return r(m,g)}function d(h){return!h.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(h)?h:h.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(f,m,p,g){if(p==="q"||p==="Q")return g=g.replaceAll("_"," "),g=g.replaceAll(/=([0-9a-fA-F]{2})/g,function(y,N){return String.fromCharCode(parseInt(N,16))}),r(m,g);try{g=atob(g)}catch{}return r(m,g)})}return""}function bA(n,e){const t=new Headers;if(!n||!e||typeof e!="object")return t;for(const s in e){const r=e[s];r!==void 0&&t.append(s,r)}return t}function ig(n){try{return new URL(n).origin}catch{}return null}function xA({responseHeaders:n,isHttp:e,rangeChunkSize:t,disableRange:s}){const r={allowRangeRequests:!1,suggestedLength:void 0},i=parseInt(n.get("Content-Length"),10);return!Number.isInteger(i)||(r.suggestedLength=i,i<=2*t)||s||!e||n.get("Accept-Ranges")!=="bytes"||(n.get("Content-Encoding")||"identity")!=="identity"||(r.allowRangeRequests=!0),r}function wA(n){const e=n.get("Content-Disposition");if(e){let t=OT(e);if(t.includes("%"))try{t=decodeURIComponent(t)}catch{}if(Nb(t))return t}return null}function ag(n,e){return n===404||n===0&&e.startsWith("file:")?new Td('Missing PDF "'+e+'".'):new ip(`Unexpected server response (${n}) while retrieving PDF "${e}".`,n)}function _A(n){return n===200||n===206}function SA(n,e,t){return{method:"GET",headers:n,signal:t.signal,mode:"cors",credentials:e?"include":"same-origin",redirect:"follow"}}function AA(n){return n instanceof Uint8Array?n.buffer:n instanceof ArrayBuffer?n:(Pe(`getArrayBuffer - unexpected data format: ${n}`),new Uint8Array(n).buffer)}class Pw{constructor(e){xe(this,"_responseOrigin",null);this.source=e,this.isHttp=/^https?:/i.test(e.url),this.headers=bA(this.isHttp,e.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}getFullReader(){return Rt(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new FT(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const s=new $T(this,e,t);return this._rangeRequestReaders.push(s),s}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const s of this._rangeRequestReaders.slice(0))s.cancel(e)}}class FT{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;const t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange;const s=new Headers(e.headers),r=t.url;fetch(r,SA(s,this._withCredentials,this._abortController)).then(i=>{if(e._responseOrigin=ig(i.url),!_A(i.status))throw ag(i.status,r);this._reader=i.body.getReader(),this._headersCapability.resolve();const a=i.headers,{allowRangeRequests:o,suggestedLength:c}=xA({responseHeaders:a,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=o,this._contentLength=c||this._contentLength,this._filename=wA(a),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new Ca("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;await this._headersCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded,total:this._contentLength}),{value:AA(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}}class $T{constructor(e,t,s){this._stream=e,this._reader=null,this._loaded=0;const r=e.source;this._withCredentials=r.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!r.disableStream,this._abortController=new AbortController;const i=new Headers(e.headers);i.append("Range",`bytes=${t}-${s-1}`);const a=r.url;fetch(a,SA(i,this._withCredentials,this._abortController)).then(o=>{const c=ig(o.url);if(c!==e._responseOrigin)throw new Error(`Expected range response-origin "${c}" to match "${e._responseOrigin}".`);if(!_A(o.status))throw ag(o.status,a);this._readCapability.resolve(),this._reader=o.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;await this._readCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded}),{value:AA(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}}const Kg=200,Xg=206;function BT(n){const e=n.response;return typeof e!="string"?e:sg(e).buffer}class UT{constructor({url:e,httpHeaders:t,withCredentials:s}){xe(this,"_responseOrigin",null);this.url=e,this.isHttp=/^https?:/i.test(e),this.headers=bA(this.isHttp,t),this.withCredentials=s||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(e){const t=new XMLHttpRequest,s=this.currXhrId++,r=this.pendingRequests[s]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(const[i,a]of this.headers)t.setRequestHeader(i,a);return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),r.expectedStatus=Xg):r.expectedStatus=Kg,t.responseType="arraybuffer",Rt(e.onError,"Expected `onError` callback to be provided."),t.onerror=()=>{e.onError(t.status)},t.onreadystatechange=this.onStateChange.bind(this,s),t.onprogress=this.onProgress.bind(this,s),r.onHeadersReceived=e.onHeadersReceived,r.onDone=e.onDone,r.onError=e.onError,r.onProgress=e.onProgress,t.send(null),s}onProgress(e,t){var r;const s=this.pendingRequests[e];s&&((r=s.onProgress)==null||r.call(s,t))}onStateChange(e,t){const s=this.pendingRequests[e];if(!s)return;const r=s.xhr;if(r.readyState>=2&&s.onHeadersReceived&&(s.onHeadersReceived(),delete s.onHeadersReceived),r.readyState!==4||!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],r.status===0&&this.isHttp){s.onError(r.status);return}const i=r.status||Kg;if(!(i===Kg&&s.expectedStatus===Xg)&&i!==s.expectedStatus){s.onError(r.status);return}const o=BT(r);if(i===Xg){const c=r.getResponseHeader("Content-Range"),d=/bytes (\d+)-(\d+)\/(\d+)/.exec(c);d?s.onDone({begin:parseInt(d[1],10),chunk:o}):(Pe('Missing or invalid "Content-Range" header.'),s.onError(0))}else o?s.onDone({begin:0,chunk:o}):s.onError(r.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){const t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}}class zT{constructor(e){this._source=e,this._manager=new UT(e),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){const t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return Rt(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new HT(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){const s=new qT(this._manager,e,t);return s.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(s),s}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const s of this._rangeRequestReaders.slice(0))s.cancel(e)}}class HT{constructor(e,t){this._manager=e,this._url=t.url,this._fullRequestId=e.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const e=this._fullRequestId,t=this._manager.getRequestXhr(e);this._manager._responseOrigin=ig(t.responseURL);const s=t.getAllResponseHeaders(),r=new Headers(s?s.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(o=>{const[c,...d]=o.split(": ");return[c,d.join(": ")]}):[]),{allowRangeRequests:i,suggestedLength:a}=xA({responseHeaders:r,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});i&&(this._isRangeSupported=!0),this._contentLength=a||this._contentLength,this._filename=wA(r),this._isRangeSupported&&this._manager.abortRequest(e),this._headersCapability.resolve()}_onDone(e){if(e&&(this._requests.length>0?this._requests.shift().resolve({value:e.chunk,done:!1}):this._cachedChunks.push(e.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){this._storedError=ag(e,this._url),this._headersCapability.reject(this._storedError);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){var t;(t=this.onProgress)==null||t.call(this,{loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._headersCapability.reject(e);for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class qT{constructor(e,t,s){this._manager=e,this._url=e.url,this._requestId=e.request({begin:t,end:s,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){var t;const e=ig((t=this._manager.getRequestXhr(this._requestId))==null?void 0:t.responseURL);e!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${e}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){var e;(e=this.onClosed)==null||e.call(this,this)}_onDone(e){const t=e.chunk;this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0;for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){this._storedError??(this._storedError=ag(e,this._url));for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){var t;this.isStreamingSupported||(t=this.onProgress)==null||t.call(this,{loaded:e.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const WT=/^[a-z][a-z0-9\-+.]+:/i;function VT(n){if(WT.test(n))return new URL(n);const e=process.getBuiltinModule("url");return new URL(e.pathToFileURL(n))}class GT{constructor(e){this.source=e,this.url=VT(e.url),Rt(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}getFullReader(){return Rt(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new KT(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const s=new XT(this,e,t);return this._rangeRequestReaders.push(s),s}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const s of this._rangeRequestReaders.slice(0))s.cancel(e)}}class KT{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;const t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const s=process.getBuiltinModule("fs");s.promises.lstat(this._url).then(r=>{this._contentLength=r.size,this._setReadableStream(s.createReadStream(this._url)),this._headersCapability.resolve()},r=>{r.code==="ENOENT"&&(r=new Td(`Missing PDF "${this._url}".`)),this._storedError=r,this._headersCapability.reject(r)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new Ca("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class XT{constructor(e,t,s){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const r=e.source;this._isStreamingSupported=!r.disableStream;const i=process.getBuiltinModule("fs");this._setReadableStream(i.createReadStream(this._url,{start:t,end:s-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const YT=1e5,Ds=30,JT=.8;var Bw,Qi,Fs,mh,ph,wo,ei,gh,yh,_o,xc,wc,Zi,_c,vh,Sc,So,bh,xh,Ao,No,wh,ea,Ac,Ei,NA,kA,Ly,mn,fm,Oy,EA,CA;const Lt=class Lt{constructor({textContentSource:e,container:t,viewport:s}){S(this,Ei);S(this,Qi,Promise.withResolvers());S(this,Fs,null);S(this,mh,!1);S(this,ph,!!((Bw=globalThis.FontInspector)!=null&&Bw.enabled));S(this,wo,null);S(this,ei,null);S(this,gh,0);S(this,yh,0);S(this,_o,null);S(this,xc,null);S(this,wc,0);S(this,Zi,0);S(this,_c,Object.create(null));S(this,vh,[]);S(this,Sc,null);S(this,So,[]);S(this,bh,new WeakMap);S(this,xh,null);var c;if(e instanceof ReadableStream)v(this,Sc,e);else if(typeof e=="object")v(this,Sc,new ReadableStream({start(d){d.enqueue(e),d.close()}}));else throw new Error('No "textContentSource" parameter specified.');v(this,Fs,v(this,xc,t)),v(this,Zi,s.scale*(globalThis.devicePixelRatio||1)),v(this,wc,s.rotation),v(this,ei,{div:null,properties:null,ctx:null});const{pageWidth:r,pageHeight:i,pageX:a,pageY:o}=s.rawDims;v(this,xh,[1,0,0,-1,-a,o+i]),v(this,yh,r),v(this,gh,i),A(c=Lt,mn,EA).call(c),ll(t,s),l(this,Qi).promise.finally(()=>{l(Lt,Ac).delete(this),v(this,ei,null),v(this,_c,null)}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:e,isFirefox:t}=Cs.platform;return Le(this,"fontFamilyMap",new Map([["sans-serif",`${e&&t?"Calibri, ":""}sans-serif`],["monospace",`${e&&t?"Lucida Console, ":""}monospace`]]))}render(){const e=()=>{l(this,_o).read().then(({value:t,done:s})=>{if(s){l(this,Qi).resolve();return}l(this,wo)??v(this,wo,t.lang),Object.assign(l(this,_c),t.styles),A(this,Ei,NA).call(this,t.items),e()},l(this,Qi).reject)};return v(this,_o,l(this,Sc).getReader()),l(Lt,Ac).add(this),e(),l(this,Qi).promise}update({viewport:e,onBefore:t=null}){var i;const s=e.scale*(globalThis.devicePixelRatio||1),r=e.rotation;if(r!==l(this,wc)&&(t==null||t(),v(this,wc,r),ll(l(this,xc),{rotation:r})),s!==l(this,Zi)){t==null||t(),v(this,Zi,s);const a={div:null,properties:null,ctx:A(i=Lt,mn,fm).call(i,l(this,wo))};for(const o of l(this,So))a.properties=l(this,bh).get(o),a.div=o,A(this,Ei,Ly).call(this,a)}}cancel(){var t;const e=new Ca("TextLayer task cancelled.");(t=l(this,_o))==null||t.cancel(e).catch(()=>{}),v(this,_o,null),l(this,Qi).reject(e)}get textDivs(){return l(this,So)}get textContentItemsStr(){return l(this,vh)}static cleanup(){if(!(l(this,Ac).size>0)){l(this,Ao).clear();for(const{canvas:e}of l(this,No).values())e.remove();l(this,No).clear()}}};Qi=new WeakMap,Fs=new WeakMap,mh=new WeakMap,ph=new WeakMap,wo=new WeakMap,ei=new WeakMap,gh=new WeakMap,yh=new WeakMap,_o=new WeakMap,xc=new WeakMap,wc=new WeakMap,Zi=new WeakMap,_c=new WeakMap,vh=new WeakMap,Sc=new WeakMap,So=new WeakMap,bh=new WeakMap,xh=new WeakMap,Ao=new WeakMap,No=new WeakMap,wh=new WeakMap,ea=new WeakMap,Ac=new WeakMap,Ei=new WeakSet,NA=function(e){var r,i;if(l(this,mh))return;(i=l(this,ei)).ctx??(i.ctx=A(r=Lt,mn,fm).call(r,l(this,wo)));const t=l(this,So),s=l(this,vh);for(const a of e){if(t.length>YT){Pe("Ignoring additional textDivs for performance reasons."),v(this,mh,!0);return}if(a.str===void 0){if(a.type==="beginMarkedContentProps"||a.type==="beginMarkedContent"){const o=l(this,Fs);v(this,Fs,document.createElement("span")),l(this,Fs).classList.add("markedContent"),a.id!==null&&l(this,Fs).setAttribute("id",`${a.id}`),o.append(l(this,Fs))}else a.type==="endMarkedContent"&&v(this,Fs,l(this,Fs).parentNode);continue}s.push(a.str),A(this,Ei,kA).call(this,a)}},kA=function(e){var y;const t=document.createElement("span"),s={angle:0,canvasWidth:0,hasText:e.str!=="",hasEOL:e.hasEOL,fontSize:0};l(this,So).push(t);const r=ve.transform(l(this,xh),e.transform);let i=Math.atan2(r[1],r[0]);const a=l(this,_c)[e.fontName];a.vertical&&(i+=Math.PI/2);let o=l(this,ph)&&a.fontSubstitution||a.fontFamily;o=Lt.fontFamilyMap.get(o)||o;const c=Math.hypot(r[2],r[3]),d=c*A(y=Lt,mn,CA).call(y,o,l(this,wo));let h,f;i===0?(h=r[4],f=r[5]-d):(h=r[4]+d*Math.sin(i),f=r[5]-d*Math.cos(i));const m="calc(var(--scale-factor)*",p=t.style;l(this,Fs)===l(this,xc)?(p.left=`${(100*h/l(this,yh)).toFixed(2)}%`,p.top=`${(100*f/l(this,gh)).toFixed(2)}%`):(p.left=`${m}${h.toFixed(2)}px)`,p.top=`${m}${f.toFixed(2)}px)`),p.fontSize=`${m}${(l(Lt,ea)*c).toFixed(2)}px)`,p.fontFamily=o,s.fontSize=c,t.setAttribute("role","presentation"),t.textContent=e.str,t.dir=e.dir,l(this,ph)&&(t.dataset.fontName=a.fontSubstitutionLoadedName||e.fontName),i!==0&&(s.angle=i*(180/Math.PI));let g=!1;if(e.str.length>1)g=!0;else if(e.str!==" "&&e.transform[0]!==e.transform[3]){const N=Math.abs(e.transform[0]),b=Math.abs(e.transform[3]);N!==b&&Math.max(N,b)/Math.min(N,b)>1.5&&(g=!0)}if(g&&(s.canvasWidth=a.vertical?e.height:e.width),l(this,bh).set(t,s),l(this,ei).div=t,l(this,ei).properties=s,A(this,Ei,Ly).call(this,l(this,ei)),s.hasText&&l(this,Fs).append(t),s.hasEOL){const N=document.createElement("br");N.setAttribute("role","presentation"),l(this,Fs).append(N)}},Ly=function(e){var o;const{div:t,properties:s,ctx:r}=e,{style:i}=t;let a="";if(l(Lt,ea)>1&&(a=`scale(${1/l(Lt,ea)})`),s.canvasWidth!==0&&s.hasText){const{fontFamily:c}=i,{canvasWidth:d,fontSize:h}=s;A(o=Lt,mn,Oy).call(o,r,h*l(this,Zi),c);const{width:f}=r.measureText(t.textContent);f>0&&(a=`scaleX(${d*l(this,Zi)/f}) ${a}`)}s.angle!==0&&(a=`rotate(${s.angle}deg) ${a}`),a.length>0&&(i.transform=a)},mn=new WeakSet,fm=function(e=null){let t=l(this,No).get(e||(e=""));if(!t){const s=document.createElement("canvas");s.className="hiddenCanvasElement",s.lang=e,document.body.append(s),t=s.getContext("2d",{alpha:!1,willReadFrequently:!0}),l(this,No).set(e,t),l(this,wh).set(t,{size:0,family:""})}return t},Oy=function(e,t,s){const r=l(this,wh).get(e);t===r.size&&s===r.family||(e.font=`${t}px ${s}`,r.size=t,r.family=s)},EA=function(){if(l(this,ea)!==null)return;const e=document.createElement("div");e.style.opacity=0,e.style.lineHeight=1,e.style.fontSize="1px",e.style.position="absolute",e.textContent="X",document.body.append(e),v(this,ea,e.getBoundingClientRect().height),e.remove()},CA=function(e,t){const s=l(this,Ao).get(e);if(s)return s;const r=A(this,mn,fm).call(this,t);r.canvas.width=r.canvas.height=Ds,A(this,mn,Oy).call(this,r,Ds,e);const i=r.measureText("");let a=i.fontBoundingBoxAscent,o=Math.abs(i.fontBoundingBoxDescent);if(a){const h=a/(a+o);return l(this,Ao).set(e,h),r.canvas.width=r.canvas.height=0,h}r.strokeStyle="red",r.clearRect(0,0,Ds,Ds),r.strokeText("g",0,0);let c=r.getImageData(0,0,Ds,Ds).data;o=0;for(let h=c.length-1-3;h>=0;h-=4)if(c[h]>0){o=Math.ceil(h/4/Ds);break}r.clearRect(0,0,Ds,Ds),r.strokeText("A",0,Ds),c=r.getImageData(0,0,Ds,Ds).data,a=0;for(let h=0,f=c.length;h<f;h+=4)if(c[h]>0){a=Ds-Math.floor(h/4/Ds);break}r.canvas.width=r.canvas.height=0;const d=a?a/(a+o):JT;return l(this,Ao).set(e,d),d},S(Lt,mn),S(Lt,Ao,new Map),S(Lt,No,new Map),S(Lt,wh,new WeakMap),S(Lt,ea,null),S(Lt,Ac,new Set);let Rd=Lt;class Id{static textContent(e){const t=[],s={items:t,styles:Object.create(null)};function r(i){var c;if(!i)return;let a=null;const o=i.name;if(o==="#text")a=i.value;else if(Id.shouldBuildText(o))(c=i==null?void 0:i.attributes)!=null&&c.textContent?a=i.attributes.textContent:i.value&&(a=i.value);else return;if(a!==null&&t.push({str:a}),!!i.children)for(const d of i.children)r(d)}return r(e),s}static shouldBuildText(e){return!(e==="textarea"||e==="input"||e==="option"||e==="select")}}const QT=65536,ZT=100,eR=5e3,tR=ys?pT:hT,sR=ys?gT:fA,nR=ys?mT:fT,rR=ys?yT:yA;function iR(n={}){typeof n=="string"||n instanceof URL?n={url:n}:(n instanceof ArrayBuffer||ArrayBuffer.isView(n))&&(n={data:n});const e=new Fy,{docId:t}=e,s=n.url?aR(n.url):null,r=n.data?oR(n.data):null,i=n.httpHeaders||null,a=n.withCredentials===!0,o=n.password??null,c=n.range instanceof jA?n.range:null,d=Number.isInteger(n.rangeChunkSize)&&n.rangeChunkSize>0?n.rangeChunkSize:QT;let h=n.worker instanceof Zl?n.worker:null;const f=n.verbosity,m=typeof n.docBaseUrl=="string"&&!rg(n.docBaseUrl)?n.docBaseUrl:null,p=typeof n.cMapUrl=="string"?n.cMapUrl:null,g=n.cMapPacked!==!1,y=n.CMapReaderFactory||sR,N=typeof n.standardFontDataUrl=="string"?n.standardFontDataUrl:null,b=n.StandardFontDataFactory||rR,x=n.stopAtErrors!==!0,_=Number.isInteger(n.maxImageSize)&&n.maxImageSize>-1?n.maxImageSize:-1,w=n.isEvalSupported!==!1,k=typeof n.isOffscreenCanvasSupported=="boolean"?n.isOffscreenCanvasSupported:!ys,C=typeof n.isImageDecoderSupported=="boolean"?n.isImageDecoderSupported:!ys&&(Cs.platform.isFirefox||!globalThis.chrome),T=Number.isInteger(n.canvasMaxAreaInBytes)?n.canvasMaxAreaInBytes:-1,D=typeof n.disableFontFace=="boolean"?n.disableFontFace:ys,B=n.fontExtraProperties===!0,ee=n.enableXfa===!0,M=n.ownerDocument||globalThis.document,E=n.disableRange===!0,$=n.disableStream===!0,ie=n.disableAutoFetch===!0,pe=n.pdfBug===!0,P=n.CanvasFactory||tR,se=n.FilterFactory||nR,F=n.enableHWA===!0,W=c?c.length:n.length??NaN,ne=typeof n.useSystemFonts=="boolean"?n.useSystemFonts:!ys&&!D,be=typeof n.useWorkerFetch=="boolean"?n.useWorkerFetch:y===fA&&b===yA&&p&&N&&Lu(p,document.baseURI)&&Lu(N,document.baseURI),_e=null;q2(f);const Oe={canvasFactory:new P({ownerDocument:M,enableHWA:F}),filterFactory:new se({docId:t,ownerDocument:M}),cMapReaderFactory:be?null:new y({baseUrl:p,isCompressed:g}),standardFontDataFactory:be?null:new b({baseUrl:N})};if(!h){const Se={verbosity:f,port:gi.workerPort};h=Se.port?Zl.fromPort(Se):new Zl(Se),e._worker=h}const et={docId:t,apiVersion:"4.10.38",data:r,password:o,disableAutoFetch:ie,rangeChunkSize:d,length:W,docBaseUrl:m,enableXfa:ee,evaluatorOptions:{maxImageSize:_,disableFontFace:D,ignoreErrors:x,isEvalSupported:w,isOffscreenCanvasSupported:k,isImageDecoderSupported:C,canvasMaxAreaInBytes:T,fontExtraProperties:B,useSystemFonts:ne,cMapUrl:be?p:null,standardFontDataUrl:be?N:null}},qe={disableFontFace:D,fontExtraProperties:B,ownerDocument:M,pdfBug:pe,styleElement:_e,loadingParams:{disableAutoFetch:ie,enableXfa:ee}};return h.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");if(h.destroyed)throw new Error("Worker was destroyed");const Se=h.messageHandler.sendWithPromise("GetDocRequest",et,r?[r.buffer]:null);let Q;if(c)Q=new DT(c,{disableRange:E,disableStream:$});else if(!r){if(!s)throw new Error("getDocument - no `url` parameter provided.");let Ve;if(ys)if(Lu(s)){if(typeof fetch>"u"||typeof Response>"u"||!("body"in Response.prototype))throw new Error("getDocument - the Fetch API was disabled in Node.js, see `--no-experimental-fetch`.");Ve=Pw}else Ve=GT;else Ve=Lu(s)?Pw:zT;Q=new Ve({url:s,length:W,httpHeaders:i,withCredentials:a,rangeChunkSize:d,disableRange:E,disableStream:$})}return Se.then(Ve=>{if(e.destroyed)throw new Error("Loading aborted");if(h.destroyed)throw new Error("Worker was destroyed");const H=new Bu(t,Ve,h.port),j=new dR(H,e,Q,qe,Oe);e._transport=j,H.send("Ready",null)})}).catch(e._capability.reject),e}function aR(n){if(n instanceof URL)return n.href;try{return new URL(n,window.location).href}catch{if(ys&&typeof n=="string")return n}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function oR(n){if(ys&&typeof Buffer<"u"&&n instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(n instanceof Uint8Array&&n.byteLength===n.buffer.byteLength)return n;if(typeof n=="string")return sg(n);if(n instanceof ArrayBuffer||ArrayBuffer.isView(n)||typeof n=="object"&&!isNaN(n==null?void 0:n.length))return new Uint8Array(n);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function Dw(n){return typeof n=="object"&&Number.isInteger(n==null?void 0:n.num)&&n.num>=0&&Number.isInteger(n==null?void 0:n.gen)&&n.gen>=0}var wp;const _p=class _p{constructor(){this._capability=Promise.withResolvers(),this._transport=null,this._worker=null,this.docId=`d${bs(_p,wp)._++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){var e,t,s,r;this.destroyed=!0;try{(e=this._worker)!=null&&e.port&&(this._worker._pendingDestroy=!0),await((t=this._transport)==null?void 0:t.destroy())}catch(i){throw(s=this._worker)!=null&&s.port&&delete this._worker._pendingDestroy,i}this._transport=null,(r=this._worker)==null||r.destroy(),this._worker=null}};wp=new WeakMap,S(_p,wp,0);let Fy=_p;class jA{constructor(e,t,s=!1,r=null){this.length=e,this.initialData=t,this.progressiveDone=s,this.contentDispositionFilename=r,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=Promise.withResolvers()}addRangeListener(e){this._rangeListeners.push(e)}addProgressListener(e){this._progressListeners.push(e)}addProgressiveReadListener(e){this._progressiveReadListeners.push(e)}addProgressiveDoneListener(e){this._progressiveDoneListeners.push(e)}onDataRange(e,t){for(const s of this._rangeListeners)s(e,t)}onDataProgress(e,t){this._readyCapability.promise.then(()=>{for(const s of this._progressListeners)s(e,t)})}onDataProgressiveRead(e){this._readyCapability.promise.then(()=>{for(const t of this._progressiveReadListeners)t(e)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const e of this._progressiveDoneListeners)e()})}transportReady(){this._readyCapability.resolve()}requestDataRange(e,t){st("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class lR{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return Le(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getOptionalContentConfig(t)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(e){return this._transport.cachedPageNumber(e)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}var ta,ti,Cn,Cl,mm;class cR{constructor(e,t,s,r=!1){S(this,Cn);S(this,ta,null);S(this,ti,!1);this._pageIndex=e,this._pageInfo=t,this._transport=s,this._stats=r?new xw:null,this._pdfBug=r,this.commonObjs=s.commonObjs,this.objs=new TA,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:s=0,offsetY:r=0,dontFlip:i=!1}={}){return new ff({viewBox:this.view,userUnit:this.userUnit,scale:e,rotation:t,offsetX:s,offsetY:r,dontFlip:i})}getAnnotations({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return Le(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var e;return((e=this._transport._htmlForXfa)==null?void 0:e.children[this._pageIndex])||null}render({canvasContext:e,viewport:t,intent:s="display",annotationMode:r=Fi.ENABLE,transform:i=null,background:a=null,optionalContentConfigPromise:o=null,annotationCanvasMap:c=null,pageColors:d=null,printAnnotationStorage:h=null,isEditing:f=!1}){var w,k;(w=this._stats)==null||w.time("Overall");const m=this._transport.getRenderingIntent(s,r,h,f),{renderingIntent:p,cacheKey:g}=m;v(this,ti,!1),A(this,Cn,mm).call(this),o||(o=this._transport.getOptionalContentConfig(p));let y=this._intentStates.get(g);y||(y=Object.create(null),this._intentStates.set(g,y)),y.streamReaderCancelTimeout&&(clearTimeout(y.streamReaderCancelTimeout),y.streamReaderCancelTimeout=null);const N=!!(p&ln.PRINT);y.displayReadyCapability||(y.displayReadyCapability=Promise.withResolvers(),y.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(k=this._stats)==null||k.time("Page Request"),this._pumpOperatorList(m));const b=C=>{var T;y.renderTasks.delete(x),(this._maybeCleanupAfterRender||N)&&v(this,ti,!0),A(this,Cn,Cl).call(this,!N),C?(x.capability.reject(C),this._abortOperatorList({intentState:y,reason:C instanceof Error?C:new Error(C)})):x.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),(T=globalThis.Stats)!=null&&T.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},x=new By({callback:b,params:{canvasContext:e,viewport:t,transform:i,background:a},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:c,operatorList:y.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!N,pdfBug:this._pdfBug,pageColors:d});(y.renderTasks||(y.renderTasks=new Set)).add(x);const _=x.task;return Promise.all([y.displayReadyCapability.promise,o]).then(([C,T])=>{var D;if(this.destroyed){b();return}if((D=this._stats)==null||D.time("Rendering"),!(T.renderingIntent&p))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");x.initializeGraphics({transparency:C,optionalContentConfig:T}),x.operatorListChanged()}).catch(b),_}getOperatorList({intent:e="display",annotationMode:t=Fi.ENABLE,printAnnotationStorage:s=null,isEditing:r=!1}={}){var d;function i(){o.operatorList.lastChunk&&(o.opListReadCapability.resolve(o.operatorList),o.renderTasks.delete(c))}const a=this._transport.getRenderingIntent(e,t,s,r,!0);let o=this._intentStates.get(a.cacheKey);o||(o=Object.create(null),this._intentStates.set(a.cacheKey,o));let c;return o.opListReadCapability||(c=Object.create(null),c.operatorListChanged=i,o.opListReadCapability=Promise.withResolvers(),(o.renderTasks||(o.renderTasks=new Set)).add(c),o.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(d=this._stats)==null||d.time("Page Request"),this._pumpOperatorList(a)),o.opListReadCapability.promise}streamTextContent({includeMarkedContent:e=!1,disableNormalization:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:e===!0,disableNormalization:t===!0},{highWaterMark:100,size(r){return r.items.length}})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then(s=>Id.textContent(s));const t=this.streamTextContent(e);return new Promise(function(s,r){function i(){a.read().then(function({value:c,done:d}){if(d){s(o);return}o.lang??(o.lang=c.lang),Object.assign(o.styles,c.styles),o.items.push(...c.items),i()},r)}const a=t.getReader(),o={items:[],styles:Object.create(null),lang:null};i()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const e=[];for(const t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(const s of t.renderTasks)e.push(s.completed),s.cancel();return this.objs.clear(),v(this,ti,!1),A(this,Cn,mm).call(this),Promise.all(e)}cleanup(e=!1){v(this,ti,!0);const t=A(this,Cn,Cl).call(this,!1);return e&&t&&this._stats&&(this._stats=new xw),t}_startRenderPage(e,t){var r,i;const s=this._intentStates.get(t);s&&((r=this._stats)==null||r.timeEnd("Page Request"),(i=s.displayReadyCapability)==null||i.resolve(e))}_renderPageChunk(e,t){for(let s=0,r=e.length;s<r;s++)t.operatorList.fnArray.push(e.fnArray[s]),t.operatorList.argsArray.push(e.argsArray[s]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(const s of t.renderTasks)s.operatorListChanged();e.lastChunk&&A(this,Cn,Cl).call(this,!0)}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageSerializable:s,modifiedIds:r}){const{map:i,transfer:a}=s,c=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:i,modifiedIds:r},a).getReader(),d=this._intentStates.get(t);d.streamReader=c;const h=()=>{c.read().then(({value:f,done:m})=>{if(m){d.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(f,d),h())},f=>{if(d.streamReader=null,!this._transport.destroyed){if(d.operatorList){d.operatorList.lastChunk=!0;for(const m of d.renderTasks)m.operatorListChanged();A(this,Cn,Cl).call(this,!0)}if(d.displayReadyCapability)d.displayReadyCapability.reject(f);else if(d.opListReadCapability)d.opListReadCapability.reject(f);else throw f}})};h()}_abortOperatorList({intentState:e,reason:t,force:s=!1}){if(e.streamReader){if(e.streamReaderCancelTimeout&&(clearTimeout(e.streamReaderCancelTimeout),e.streamReaderCancelTimeout=null),!s){if(e.renderTasks.size>0)return;if(t instanceof Ab){let r=ZT;t.extraDelay>0&&t.extraDelay<1e3&&(r+=t.extraDelay),e.streamReaderCancelTimeout=setTimeout(()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:t,force:!0})},r);return}}if(e.streamReader.cancel(new Ca(t.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(const[r,i]of this._intentStates)if(i===e){this._intentStates.delete(r);break}this.cleanup()}}}get stats(){return this._stats}}ta=new WeakMap,ti=new WeakMap,Cn=new WeakSet,Cl=function(e=!1){if(A(this,Cn,mm).call(this),!l(this,ti)||this.destroyed)return!1;if(e)return v(this,ta,setTimeout(()=>{v(this,ta,null),A(this,Cn,Cl).call(this,!1)},eR)),!1;for(const{renderTasks:t,operatorList:s}of this._intentStates.values())if(t.size>0||!s.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),v(this,ti,!1),!0},mm=function(){l(this,ta)&&(clearTimeout(l(this,ta)),v(this,ta,null))};var si,Sp;class uR{constructor(){S(this,si,new Map);S(this,Sp,Promise.resolve())}postMessage(e,t){const s={data:structuredClone(e,t?{transfer:t}:null)};l(this,Sp).then(()=>{for(const[r]of l(this,si))r.call(this,s)})}addEventListener(e,t,s=null){let r=null;if((s==null?void 0:s.signal)instanceof AbortSignal){const{signal:i}=s;if(i.aborted){Pe("LoopbackPort - cannot use an `aborted` signal.");return}const a=()=>this.removeEventListener(e,t);r=()=>i.removeEventListener("abort",a),i.addEventListener("abort",a)}l(this,si).set(t,r)}removeEventListener(e,t){const s=l(this,si).get(t);s==null||s(),l(this,si).delete(t)}terminate(){for(const[,e]of l(this,si))e==null||e();l(this,si).clear()}}si=new WeakMap,Sp=new WeakMap;var Ap,ko,Eo,Nc,pm,kc,gm;const dt=class dt{constructor({name:e=null,port:t=null,verbosity:s=W2()}={}){S(this,Nc);var r;if(this.name=e,this.destroyed=!1,this.verbosity=s,this._readyCapability=Promise.withResolvers(),this._port=null,this._webWorker=null,this._messageHandler=null,t){if((r=l(dt,Eo))!=null&&r.has(t))throw new Error("Cannot use more than one PDFWorker per port.");(l(dt,Eo)||v(dt,Eo,new WeakMap)).set(t,this),this._initializeFromPort(t);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(e){this._port=e,this._messageHandler=new Bu("main","worker",e),this._messageHandler.on("ready",function(){}),A(this,Nc,pm).call(this)}_initialize(){if(l(dt,ko)||l(dt,kc,gm)){this._setupFakeWorker();return}let{workerSrc:e}=dt;try{dt._isSameOrigin(window.location.href,e)||(e=dt._createCDNWrapper(new URL(e,window.location).href));const t=new Worker(e,{type:"module"}),s=new Bu("main","worker",t),r=()=>{i.abort(),s.destroy(),t.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},i=new AbortController;t.addEventListener("error",()=>{this._webWorker||r()},{signal:i.signal}),s.on("test",o=>{if(i.abort(),this.destroyed||!o){r();return}this._messageHandler=s,this._port=t,this._webWorker=t,A(this,Nc,pm).call(this)}),s.on("ready",o=>{if(i.abort(),this.destroyed){r();return}try{a()}catch{this._setupFakeWorker()}});const a=()=>{const o=new Uint8Array;s.send("test",o,[o.buffer])};a();return}catch{tg("The worker has been disabled.")}this._setupFakeWorker()}_setupFakeWorker(){l(dt,ko)||(Pe("Setting up fake worker."),v(dt,ko,!0)),dt._setupFakeWorkerGlobal.then(e=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const t=new uR;this._port=t;const s=`fake${bs(dt,Ap)._++}`,r=new Bu(s+"_worker",s,t);e.setup(r,t),this._messageHandler=new Bu(s,s+"_worker",t),A(this,Nc,pm).call(this)}).catch(e=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${e.message}".`))})}destroy(){var e,t,s;this.destroyed=!0,(e=this._webWorker)==null||e.terminate(),this._webWorker=null,(t=l(dt,Eo))==null||t.delete(this._port),this._port=null,(s=this._messageHandler)==null||s.destroy(),this._messageHandler=null}static fromPort(e){var s;if(!(e!=null&&e.port))throw new Error("PDFWorker.fromPort - invalid method signature.");const t=(s=l(this,Eo))==null?void 0:s.get(e.port);if(t){if(t._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return t}return new dt(e)}static get workerSrc(){if(gi.workerSrc)return gi.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return Le(this,"_setupFakeWorkerGlobal",(async()=>l(this,kc,gm)?l(this,kc,gm):(await import(this.workerSrc)).WorkerMessageHandler)())}};Ap=new WeakMap,ko=new WeakMap,Eo=new WeakMap,Nc=new WeakSet,pm=function(){this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})},kc=new WeakSet,gm=function(){var e;try{return((e=globalThis.pdfjsWorker)==null?void 0:e.WorkerMessageHandler)||null}catch{return null}},S(dt,kc),S(dt,Ap,0),S(dt,ko,!1),S(dt,Eo),ys&&(v(dt,ko,!0),gi.workerSrc||(gi.workerSrc="./pdf.worker.mjs")),dt._isSameOrigin=(e,t)=>{let s;try{if(s=new URL(e),!s.origin||s.origin==="null")return!1}catch{return!1}const r=new URL(t,s);return s.origin===r.origin},dt._createCDNWrapper=e=>{const t=`await import("${e}");`;return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))};let Zl=dt;var ni,Sr,Ec,Cc,ri,Co,Wu;class dR{constructor(e,t,s,r,i){S(this,Co);S(this,ni,new Map);S(this,Sr,new Map);S(this,Ec,new Map);S(this,Cc,new Map);S(this,ri,null);this.messageHandler=e,this.loadingTask=t,this.commonObjs=new TA,this.fontLoader=new uT({ownerDocument:r.ownerDocument,styleElement:r.styleElement}),this.loadingParams=r.loadingParams,this._params=r,this.canvasFactory=i.canvasFactory,this.filterFactory=i.filterFactory,this.cMapReaderFactory=i.cMapReaderFactory,this.standardFontDataFactory=i.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=s,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}get annotationStorage(){return Le(this,"annotationStorage",new Cb)}getRenderingIntent(e,t=Fi.ENABLE,s=null,r=!1,i=!1){let a=ln.DISPLAY,o=Ey;switch(e){case"any":a=ln.ANY;break;case"display":break;case"print":a=ln.PRINT;break;default:Pe(`getRenderingIntent - invalid intent: ${e}`)}const c=a&ln.PRINT&&s instanceof oA?s:this.annotationStorage;switch(t){case Fi.DISABLE:a+=ln.ANNOTATIONS_DISABLE;break;case Fi.ENABLE:break;case Fi.ENABLE_FORMS:a+=ln.ANNOTATIONS_FORMS;break;case Fi.ENABLE_STORAGE:a+=ln.ANNOTATIONS_STORAGE,o=c.serializable;break;default:Pe(`getRenderingIntent - invalid annotationMode: ${t}`)}r&&(a+=ln.IS_EDITING),i&&(a+=ln.OPLIST);const{ids:d,hash:h}=c.modifiedIds,f=[a,o.hash,h];return{renderingIntent:a,cacheKey:f.join("_"),annotationStorageSerializable:o,modifiedIds:d}}destroy(){var s;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),(s=l(this,ri))==null||s.reject(new Error("Worker was destroyed during onPassword callback"));const e=[];for(const r of l(this,Sr).values())e.push(r._destroy());l(this,Sr).clear(),l(this,Ec).clear(),l(this,Cc).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then(()=>{var r,i;this.commonObjs.clear(),this.fontLoader.clear(),l(this,ni).clear(),this.filterFactory.destroy(),Rd.cleanup(),(r=this._networkStream)==null||r.cancelAllRequests(new Ca("Worker was terminated.")),(i=this.messageHandler)==null||i.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:e,loadingTask:t}=this;e.on("GetReader",(s,r)=>{Rt(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=i=>{this._lastProgress={loaded:i.loaded,total:i.total}},r.onPull=()=>{this._fullReader.read().then(function({value:i,done:a}){if(a){r.close();return}Rt(i instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),r.enqueue(new Uint8Array(i),1,[i])}).catch(i=>{r.error(i)})},r.onCancel=i=>{this._fullReader.cancel(i),r.ready.catch(a=>{if(!this.destroyed)throw a})}}),e.on("ReaderHeadersReady",async s=>{var o;await this._fullReader.headersReady;const{isStreamingSupported:r,isRangeSupported:i,contentLength:a}=this._fullReader;return(!r||!i)&&(this._lastProgress&&((o=t.onProgress)==null||o.call(t,this._lastProgress)),this._fullReader.onProgress=c=>{var d;(d=t.onProgress)==null||d.call(t,{loaded:c.loaded,total:c.total})}),{isStreamingSupported:r,isRangeSupported:i,contentLength:a}}),e.on("GetRangeReader",(s,r)=>{Rt(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const i=this._networkStream.getRangeReader(s.begin,s.end);if(!i){r.close();return}r.onPull=()=>{i.read().then(function({value:a,done:o}){if(o){r.close();return}Rt(a instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),r.enqueue(new Uint8Array(a),1,[a])}).catch(a=>{r.error(a)})},r.onCancel=a=>{i.cancel(a),r.ready.catch(o=>{if(!this.destroyed)throw o})}}),e.on("GetDoc",({pdfInfo:s})=>{this._numPages=s.numPages,this._htmlForXfa=s.htmlForXfa,delete s.htmlForXfa,t._capability.resolve(new lR(s,this))}),e.on("DocException",s=>{t._capability.reject(Ms(s))}),e.on("PasswordRequest",s=>{v(this,ri,Promise.withResolvers());try{if(!t.onPassword)throw Ms(s);const r=i=>{i instanceof Error?l(this,ri).reject(i):l(this,ri).resolve({password:i})};t.onPassword(r,s.code)}catch(r){l(this,ri).reject(r)}return l(this,ri).promise}),e.on("DataLoaded",s=>{var r;(r=t.onProgress)==null||r.call(t,{loaded:s.length,total:s.length}),this.downloadInfoCapability.resolve(s)}),e.on("StartRenderPage",s=>{if(this.destroyed)return;l(this,Sr).get(s.pageIndex)._startRenderPage(s.transparency,s.cacheKey)}),e.on("commonobj",([s,r,i])=>{var a;if(this.destroyed||this.commonObjs.has(s))return null;switch(r){case"Font":const{disableFontFace:o,fontExtraProperties:c,pdfBug:d}=this._params;if("error"in i){const p=i.error;Pe(`Error during font loading: ${p}`),this.commonObjs.resolve(s,p);break}const h=d&&((a=globalThis.FontInspector)!=null&&a.enabled)?(p,g)=>globalThis.FontInspector.fontAdded(p,g):null,f=new dT(i,{disableFontFace:o,fontExtraProperties:c,inspectFont:h});this.fontLoader.bind(f).catch(()=>e.sendWithPromise("FontFallback",{id:s})).finally(()=>{!c&&f.data&&(f.data=null),this.commonObjs.resolve(s,f)});break;case"CopyLocalImage":const{imageRef:m}=i;Rt(m,"The imageRef must be defined.");for(const p of l(this,Sr).values())for(const[,g]of p.objs)if((g==null?void 0:g.ref)===m)return g.dataLen?(this.commonObjs.resolve(s,structuredClone(g)),g.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(s,i);break;default:throw new Error(`Got unknown common object type ${r}`)}return null}),e.on("obj",([s,r,i,a])=>{var c;if(this.destroyed)return;const o=l(this,Sr).get(r);if(!o.objs.has(s)){if(o._intentStates.size===0){(c=a==null?void 0:a.bitmap)==null||c.close();return}switch(i){case"Image":o.objs.resolve(s,a),(a==null?void 0:a.dataLen)>B2&&(o._maybeCleanupAfterRender=!0);break;case"Pattern":o.objs.resolve(s,a);break;default:throw new Error(`Got unknown object type ${i}`)}}}),e.on("DocProgress",s=>{var r;this.destroyed||(r=t.onProgress)==null||r.call(t,{loaded:s.loaded,total:s.total})}),e.on("FetchBuiltInCMap",async s=>{if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.cMapReaderFactory)throw new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter.");return this.cMapReaderFactory.fetch(s)}),e.on("FetchStandardFontData",async s=>{if(this.destroyed)throw new Error("Worker was destroyed.");if(!this.standardFontDataFactory)throw new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.");return this.standardFontDataFactory.fetch(s)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var s;this.annotationStorage.size<=0&&Pe("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:e,transfer:t}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:e,filename:((s=this._fullReader)==null?void 0:s.filename)??null},t).finally(()=>{this.annotationStorage.resetModified()})}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));const t=e-1,s=l(this,Ec).get(t);if(s)return s;const r=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then(i=>{if(this.destroyed)throw new Error("Transport destroyed");i.refStr&&l(this,Cc).set(i.refStr,e);const a=new cR(t,i,this,this._params.pdfBug);return l(this,Sr).set(t,a),a});return l(this,Ec).set(t,r),r}getPageIndex(e){return Dw(e)?this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}getFieldObjects(){return A(this,Co,Wu).call(this,"GetFieldObjects")}hasJSActions(){return A(this,Co,Wu).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return typeof e!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return A(this,Co,Wu).call(this,"GetDocJSActions")}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(e){return A(this,Co,Wu).call(this,"GetOptionalContentConfig").then(t=>new PT(t,e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const e="GetMetadata",t=l(this,ni).get(e);if(t)return t;const s=this.messageHandler.sendWithPromise(e,null).then(r=>{var i,a;return{info:r[0],metadata:r[1]?new RT(r[1]):null,contentDispositionFilename:((i=this._fullReader)==null?void 0:i.filename)??null,contentLength:((a=this._fullReader)==null?void 0:a.contentLength)??null}});return l(this,ni).set(e,s),s}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(e=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const t of l(this,Sr).values())if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),l(this,ni).clear(),this.filterFactory.destroy(!0),Rd.cleanup()}}cachedPageNumber(e){if(!Dw(e))return null;const t=e.gen===0?`${e.num}R`:`${e.num}R${e.gen}`;return l(this,Cc).get(t)??null}}ni=new WeakMap,Sr=new WeakMap,Ec=new WeakMap,Cc=new WeakMap,ri=new WeakMap,Co=new WeakSet,Wu=function(e,t=null){const s=l(this,ni).get(e);if(s)return s;const r=this.messageHandler.sendWithPromise(e,t);return l(this,ni).set(e,r),r};const ju=Symbol("INITIAL_DATA");var Qs,_h,$y;class TA{constructor(){S(this,_h);S(this,Qs,Object.create(null))}get(e,t=null){if(t){const r=A(this,_h,$y).call(this,e);return r.promise.then(()=>t(r.data)),null}const s=l(this,Qs)[e];if(!s||s.data===ju)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return s.data}has(e){const t=l(this,Qs)[e];return!!t&&t.data!==ju}delete(e){const t=l(this,Qs)[e];return!t||t.data===ju?!1:(delete l(this,Qs)[e],!0)}resolve(e,t=null){const s=A(this,_h,$y).call(this,e);s.data=t,s.resolve()}clear(){var e;for(const t in l(this,Qs)){const{data:s}=l(this,Qs)[t];(e=s==null?void 0:s.bitmap)==null||e.close()}v(this,Qs,Object.create(null))}*[Symbol.iterator](){for(const e in l(this,Qs)){const{data:t}=l(this,Qs)[e];t!==ju&&(yield[e,t])}}}Qs=new WeakMap,_h=new WeakSet,$y=function(e){var t;return(t=l(this,Qs))[e]||(t[e]={...Promise.withResolvers(),data:ju})};var sa;class hR{constructor(e){S(this,sa,null);v(this,sa,e),this.onContinue=null}get promise(){return l(this,sa).capability.promise}cancel(e=0){l(this,sa).cancel(null,e)}get separateAnnots(){const{separateAnnots:e}=l(this,sa).operatorList;if(!e)return!1;const{annotationCanvasMap:t}=l(this,sa);return e.form||e.canvas&&(t==null?void 0:t.size)>0}}sa=new WeakMap;var na,jo;const Va=class Va{constructor({callback:e,params:t,objs:s,commonObjs:r,annotationCanvasMap:i,operatorList:a,pageIndex:o,canvasFactory:c,filterFactory:d,useRequestAnimationFrame:h=!1,pdfBug:f=!1,pageColors:m=null}){S(this,na,null);this.callback=e,this.params=t,this.objs=s,this.commonObjs=r,this.annotationCanvasMap=i,this.operatorListIdx=null,this.operatorList=a,this._pageIndex=o,this.canvasFactory=c,this.filterFactory=d,this._pdfBug=f,this.pageColors=m,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=h===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new hR(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){var o,c;if(this.cancelled)return;if(this._canvas){if(l(Va,jo).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");l(Va,jo).add(this._canvas)}this._pdfBug&&((o=globalThis.StepperManager)!=null&&o.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:s,viewport:r,transform:i,background:a}=this.params;this.gfx=new Ql(s,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:t},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:i,viewport:r,transparency:e,background:a}),this.operatorListIdx=0,this.graphicsReady=!0,(c=this.graphicsReadyCallback)==null||c.call(this)}cancel(e=null,t=0){var s;this.running=!1,this.cancelled=!0,(s=this.gfx)==null||s.endDrawing(),l(this,na)&&(window.cancelAnimationFrame(l(this,na)),v(this,na,null)),l(Va,jo).delete(this._canvas),this.callback(e||new Ab(`Rendering cancelled, page ${this._pageIndex+1}`,t))}operatorListChanged(){var e;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(e=this.stepper)==null||e.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?v(this,na,window.requestAnimationFrame(()=>{v(this,na,null),this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),l(Va,jo).delete(this._canvas),this.callback())))}};na=new WeakMap,jo=new WeakMap,S(Va,jo,new WeakSet);let By=Va;const fR="4.10.38",mR="f9bea397f";function Mw(n){return Math.floor(Math.max(0,Math.min(1,n))*255).toString(16).padStart(2,"0")}function Tu(n){return Math.max(0,Math.min(255,255*n))}class Lw{static CMYK_G([e,t,s,r]){return["G",1-Math.min(1,.3*e+.59*s+.11*t+r)]}static G_CMYK([e]){return["CMYK",0,0,0,1-e]}static G_RGB([e]){return["RGB",e,e,e]}static G_rgb([e]){return e=Tu(e),[e,e,e]}static G_HTML([e]){const t=Mw(e);return`#${t}${t}${t}`}static RGB_G([e,t,s]){return["G",.3*e+.59*t+.11*s]}static RGB_rgb(e){return e.map(Tu)}static RGB_HTML(e){return`#${e.map(Mw).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([e,t,s,r]){return["RGB",1-Math.min(1,e+r),1-Math.min(1,s+r),1-Math.min(1,t+r)]}static CMYK_rgb([e,t,s,r]){return[Tu(1-Math.min(1,e+r)),Tu(1-Math.min(1,s+r)),Tu(1-Math.min(1,t+r))]}static CMYK_HTML(e){const t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK([e,t,s]){const r=1-e,i=1-t,a=1-s,o=Math.min(r,i,a);return["CMYK",r,i,a,o]}}class pR{create(e,t,s=!1){if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");const r=this._createSVG("svg:svg");return r.setAttribute("version","1.1"),s||(r.setAttribute("width",`${e}px`),r.setAttribute("height",`${t}px`)),r.setAttribute("preserveAspectRatio","none"),r.setAttribute("viewBox",`0 0 ${e} ${t}`),r}createElement(e){if(typeof e!="string")throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){st("Abstract method `_createSVG` called.")}}class Tb extends pR{_createSVG(e){return document.createElementNS(Or,e)}}class RA{static setupStorage(e,t,s,r,i){const a=r.getValue(t,{value:null});switch(s.name){case"textarea":if(a.value!==null&&(e.textContent=a.value),i==="print")break;e.addEventListener("input",o=>{r.setValue(t,{value:o.target.value})});break;case"input":if(s.attributes.type==="radio"||s.attributes.type==="checkbox"){if(a.value===s.attributes.xfaOn?e.setAttribute("checked",!0):a.value===s.attributes.xfaOff&&e.removeAttribute("checked"),i==="print")break;e.addEventListener("change",o=>{r.setValue(t,{value:o.target.checked?o.target.getAttribute("xfaOn"):o.target.getAttribute("xfaOff")})})}else{if(a.value!==null&&e.setAttribute("value",a.value),i==="print")break;e.addEventListener("input",o=>{r.setValue(t,{value:o.target.value})})}break;case"select":if(a.value!==null){e.setAttribute("value",a.value);for(const o of s.children)o.attributes.value===a.value?o.attributes.selected=!0:o.attributes.hasOwnProperty("selected")&&delete o.attributes.selected}e.addEventListener("input",o=>{const c=o.target.options,d=c.selectedIndex===-1?"":c[c.selectedIndex].value;r.setValue(t,{value:d})});break}}static setAttributes({html:e,element:t,storage:s=null,intent:r,linkService:i}){const{attributes:a}=t,o=e instanceof HTMLAnchorElement;a.type==="radio"&&(a.name=`${a.name}-${r}`);for(const[c,d]of Object.entries(a))if(d!=null)switch(c){case"class":d.length&&e.setAttribute(c,d.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",d);break;case"style":Object.assign(e.style,d);break;case"textContent":e.textContent=d;break;default:(!o||c!=="href"&&c!=="newWindow")&&e.setAttribute(c,d)}o&&i.addLinkAttributes(e,a.href,a.newWindow),s&&a.dataId&&this.setupStorage(e,a.dataId,t,s)}static render(e){var f,m;const t=e.annotationStorage,s=e.linkService,r=e.xfaHtml,i=e.intent||"display",a=document.createElement(r.name);r.attributes&&this.setAttributes({html:a,element:r,intent:i,linkService:s});const o=i!=="richText",c=e.div;if(c.append(a),e.viewport){const p=`matrix(${e.viewport.transform.join(",")})`;c.style.transform=p}o&&c.setAttribute("class","xfaLayer xfaFont");const d=[];if(r.children.length===0){if(r.value){const p=document.createTextNode(r.value);a.append(p),o&&Id.shouldBuildText(r.name)&&d.push(p)}return{textDivs:d}}const h=[[r,-1,a]];for(;h.length>0;){const[p,g,y]=h.at(-1);if(g+1===p.children.length){h.pop();continue}const N=p.children[++h.at(-1)[1]];if(N===null)continue;const{name:b}=N;if(b==="#text"){const _=document.createTextNode(N.value);d.push(_),y.append(_);continue}const x=(f=N==null?void 0:N.attributes)!=null&&f.xmlns?document.createElementNS(N.attributes.xmlns,b):document.createElement(b);if(y.append(x),N.attributes&&this.setAttributes({html:x,element:N,storage:t,intent:i,linkService:s}),((m=N.children)==null?void 0:m.length)>0)h.push([N,-1,x]);else if(N.value){const _=document.createTextNode(N.value);o&&Id.shouldBuildText(b)&&d.push(_),x.append(_)}}for(const p of c.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))p.setAttribute("readOnly",!0);return{textDivs:d}}static update(e){const t=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=t,e.div.hidden=!1}}const pf=1e3,gR=9,ul=new WeakSet;function Na(n){return{width:n[2]-n[0],height:n[3]-n[1]}}class yR{static create(e){switch(e.data.annotationType){case Dt.LINK:return new IA(e);case Dt.TEXT:return new vR(e);case Dt.WIDGET:switch(e.data.fieldType){case"Tx":return new bR(e);case"Btn":return e.data.radioButton?new MA(e):e.data.checkBox?new wR(e):new _R(e);case"Ch":return new SR(e);case"Sig":return new xR(e)}return new pl(e);case Dt.POPUP:return new zy(e);case Dt.FREETEXT:return new BA(e);case Dt.LINE:return new NR(e);case Dt.SQUARE:return new kR(e);case Dt.CIRCLE:return new ER(e);case Dt.POLYLINE:return new UA(e);case Dt.CARET:return new jR(e);case Dt.INK:return new Rb(e);case Dt.POLYGON:return new CR(e);case Dt.HIGHLIGHT:return new zA(e);case Dt.UNDERLINE:return new TR(e);case Dt.SQUIGGLY:return new RR(e);case Dt.STRIKEOUT:return new IR(e);case Dt.STAMP:return new HA(e);case Dt.FILEATTACHMENT:return new PR(e);default:return new Et(e)}}}var To,jc,Tc,Sh,Uy;const Mb=class Mb{constructor(e,{isRenderable:t=!1,ignoreBorder:s=!1,createQuadrilaterals:r=!1}={}){S(this,Sh);S(this,To,null);S(this,jc,!1);S(this,Tc,null);this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,t&&(this.container=this._createContainer(s)),r&&this._createQuadrilaterals()}static _hasPopupData({titleObj:e,contentsObj:t,richText:s}){return!!(e!=null&&e.str||t!=null&&t.str||s!=null&&s.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return Mb._hasPopupData(this.data)}updateEdited(e){var s;if(!this.container)return;l(this,To)||v(this,To,{rect:this.data.rect.slice(0)});const{rect:t}=e;t&&A(this,Sh,Uy).call(this,t),(s=l(this,Tc))==null||s.popup.updateEdited(e)}resetEdited(){var e;l(this,To)&&(A(this,Sh,Uy).call(this,l(this,To).rect),(e=l(this,Tc))==null||e.popup.resetEdited(),v(this,To,null))}_createContainer(e){const{data:t,parent:{page:s,viewport:r}}=this,i=document.createElement("section");i.setAttribute("data-annotation-id",t.id),this instanceof pl||(i.tabIndex=pf);const{style:a}=i;if(a.zIndex=this.parent.zIndex++,t.alternativeText&&(i.title=t.alternativeText),t.noRotate&&i.classList.add("norotate"),!t.rect||this instanceof zy){const{rotation:y}=t;return!t.hasOwnCanvas&&y!==0&&this.setRotation(y,i),i}const{width:o,height:c}=Na(t.rect);if(!e&&t.borderStyle.width>0){a.borderWidth=`${t.borderStyle.width}px`;const y=t.borderStyle.horizontalCornerRadius,N=t.borderStyle.verticalCornerRadius;if(y>0||N>0){const x=`calc(${y}px * var(--scale-factor)) / calc(${N}px * var(--scale-factor))`;a.borderRadius=x}else if(this instanceof MA){const x=`calc(${o}px * var(--scale-factor)) / calc(${c}px * var(--scale-factor))`;a.borderRadius=x}switch(t.borderStyle.style){case Eu.SOLID:a.borderStyle="solid";break;case Eu.DASHED:a.borderStyle="dashed";break;case Eu.BEVELED:Pe("Unimplemented border style: beveled");break;case Eu.INSET:Pe("Unimplemented border style: inset");break;case Eu.UNDERLINE:a.borderBottomStyle="solid";break}const b=t.borderColor||null;b?(v(this,jc,!0),a.borderColor=ve.makeHexColor(b[0]|0,b[1]|0,b[2]|0)):a.borderWidth=0}const d=ve.normalizeRect([t.rect[0],s.view[3]-t.rect[1]+s.view[1],t.rect[2],s.view[3]-t.rect[3]+s.view[1]]),{pageWidth:h,pageHeight:f,pageX:m,pageY:p}=r.rawDims;a.left=`${100*(d[0]-m)/h}%`,a.top=`${100*(d[1]-p)/f}%`;const{rotation:g}=t;return t.hasOwnCanvas||g===0?(a.width=`${100*o/h}%`,a.height=`${100*c/f}%`):this.setRotation(g,i),i}setRotation(e,t=this.container){if(!this.data.rect)return;const{pageWidth:s,pageHeight:r}=this.parent.viewport.rawDims,{width:i,height:a}=Na(this.data.rect);let o,c;e%180===0?(o=100*i/s,c=100*a/r):(o=100*a/s,c=100*i/r),t.style.width=`${o}%`,t.style.height=`${c}%`,t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){const e=(t,s,r)=>{const i=r.detail[t],a=i[0],o=i.slice(1);r.target.style[s]=Lw[`${a}_HTML`](o),this.annotationStorage.setValue(this.data.id,{[s]:Lw[`${a}_rgb`](o)})};return Le(this,"_commonActions",{display:t=>{const{display:s}=t.detail,r=s%2===1;this.container.style.visibility=r?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:r,noPrint:s===1||s===2})},print:t=>{this.annotationStorage.setValue(this.data.id,{noPrint:!t.detail.print})},hidden:t=>{const{hidden:s}=t.detail;this.container.style.visibility=s?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:s,noView:s})},focus:t=>{setTimeout(()=>t.target.focus({preventScroll:!1}),0)},userName:t=>{t.target.title=t.detail.userName},readonly:t=>{t.target.disabled=t.detail.readonly},required:t=>{this._setRequired(t.target,t.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:t=>{const s=t.detail.rotation;this.setRotation(s),this.annotationStorage.setValue(this.data.id,{rotation:s})}})}_dispatchEventFromSandbox(e,t){const s=this._commonActions;for(const r of Object.keys(t.detail)){const i=e[r]||s[r];i==null||i(t)}}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;const t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;const s=this._commonActions;for(const[r,i]of Object.entries(t)){const a=s[r];if(a){const o={detail:{[r]:i},target:e};a(o),delete t[r]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:e}=this.data;if(!e)return;const[t,s,r,i]=this.data.rect.map(y=>Math.fround(y));if(e.length===8){const[y,N,b,x]=e.subarray(2,6);if(r===y&&i===N&&t===b&&s===x)return}const{style:a}=this.container;let o;if(l(this,jc)){const{borderColor:y,borderWidth:N}=a;a.borderWidth=0,o=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${y}" stroke-width="${N}">`],this.container.classList.add("hasBorder")}const c=r-t,d=i-s,{svgFactory:h}=this,f=h.createElement("svg");f.classList.add("quadrilateralsContainer"),f.setAttribute("width",0),f.setAttribute("height",0);const m=h.createElement("defs");f.append(m);const p=h.createElement("clipPath"),g=`clippath_${this.data.id}`;p.setAttribute("id",g),p.setAttribute("clipPathUnits","objectBoundingBox"),m.append(p);for(let y=2,N=e.length;y<N;y+=8){const b=e[y],x=e[y+1],_=e[y+2],w=e[y+3],k=h.createElement("rect"),C=(_-t)/c,T=(i-x)/d,D=(b-_)/c,B=(x-w)/d;k.setAttribute("x",C),k.setAttribute("y",T),k.setAttribute("width",D),k.setAttribute("height",B),p.append(k),o==null||o.push(`<rect vector-effect="non-scaling-stroke" x="${C}" y="${T}" width="${D}" height="${B}"/>`)}l(this,jc)&&(o.push("</g></svg>')"),a.backgroundImage=o.join("")),this.container.append(f),this.container.style.clipPath=`url(#${g})`}_createPopup(){const{data:e}=this,t=v(this,Tc,new zy({data:{color:e.color,titleObj:e.titleObj,modificationDate:e.modificationDate,contentsObj:e.contentsObj,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation},parent:this.parent,elements:[this]}));this.parent.div.append(t.render())}render(){st("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,t=null){const s=[];if(this._fieldObjects){const r=this._fieldObjects[e];if(r)for(const{page:i,id:a,exportValues:o}of r){if(i===-1||a===t)continue;const c=typeof o=="string"?o:null,d=document.querySelector(`[data-element-id="${a}"]`);if(d&&!ul.has(d)){Pe(`_getElementsByName - element not allowed: ${a}`);continue}s.push({id:a,exportValue:c,domElement:d})}return s}for(const r of document.getElementsByName(e)){const{exportValue:i}=r,a=r.getAttribute("data-element-id");a!==t&&ul.has(r)&&s.push({id:a,exportValue:i,domElement:r})}return s}show(){var e;this.container&&(this.container.hidden=!1),(e=this.popup)==null||e.maybeShow()}hide(){var e;this.container&&(this.container.hidden=!0),(e=this.popup)==null||e.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(const t of e)t.classList.add("highlightArea");else e.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:e,data:{id:t}}=this;this.container.addEventListener("dblclick",()=>{var s;(s=this.linkService.eventBus)==null||s.dispatch("switchannotationeditormode",{source:this,mode:e,editId:t})})}};To=new WeakMap,jc=new WeakMap,Tc=new WeakMap,Sh=new WeakSet,Uy=function(e){const{container:{style:t},data:{rect:s,rotation:r},parent:{viewport:{rawDims:{pageWidth:i,pageHeight:a,pageX:o,pageY:c}}}}=this;s==null||s.splice(0,4,...e);const{width:d,height:h}=Na(e);t.left=`${100*(e[0]-o)/i}%`,t.top=`${100*(a-e[3]+c)/a}%`,r===0?(t.width=`${100*d/i}%`,t.height=`${100*h/a}%`):this.setRotation(r)};let Et=Mb;var un,Ua,PA,DA;class IA extends Et{constructor(t,s=null){super(t,{isRenderable:!0,ignoreBorder:!!(s!=null&&s.ignoreBorder),createQuadrilaterals:!0});S(this,un);this.isTooltipOnly=t.data.isTooltipOnly}render(){const{data:t,linkService:s}=this,r=document.createElement("a");r.setAttribute("data-element-id",t.id);let i=!1;return t.url?(s.addLinkAttributes(r,t.url,t.newWindow),i=!0):t.action?(this._bindNamedAction(r,t.action),i=!0):t.attachment?(A(this,un,PA).call(this,r,t.attachment,t.attachmentDest),i=!0):t.setOCGState?(A(this,un,DA).call(this,r,t.setOCGState),i=!0):t.dest?(this._bindLink(r,t.dest),i=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(r,t),i=!0),t.resetForm?(this._bindResetFormAction(r,t.resetForm),i=!0):this.isTooltipOnly&&!i&&(this._bindLink(r,""),i=!0)),this.container.classList.add("linkAnnotation"),i&&this.container.append(r),this.container}_bindLink(t,s){t.href=this.linkService.getDestinationHash(s),t.onclick=()=>(s&&this.linkService.goToDestination(s),!1),(s||s==="")&&A(this,un,Ua).call(this)}_bindNamedAction(t,s){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(s),!1),A(this,un,Ua).call(this)}_bindJSAction(t,s){t.href=this.linkService.getAnchorUrl("");const r=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const i of Object.keys(s.actions)){const a=r.get(i);a&&(t[a]=()=>{var o;return(o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:s.id,name:i}}),!1})}t.onclick||(t.onclick=()=>!1),A(this,un,Ua).call(this)}_bindResetFormAction(t,s){const r=t.onclick;if(r||(t.href=this.linkService.getAnchorUrl("")),A(this,un,Ua).call(this),!this._fieldObjects){Pe('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),r||(t.onclick=()=>!1);return}t.onclick=()=>{var f;r==null||r();const{fields:i,refs:a,include:o}=s,c=[];if(i.length!==0||a.length!==0){const m=new Set(a);for(const p of i){const g=this._fieldObjects[p]||[];for(const{id:y}of g)m.add(y)}for(const p of Object.values(this._fieldObjects))for(const g of p)m.has(g.id)===o&&c.push(g)}else for(const m of Object.values(this._fieldObjects))c.push(...m);const d=this.annotationStorage,h=[];for(const m of c){const{id:p}=m;switch(h.push(p),m.type){case"text":{const y=m.defaultValue||"";d.setValue(p,{value:y});break}case"checkbox":case"radiobutton":{const y=m.defaultValue===m.exportValues;d.setValue(p,{value:y});break}case"combobox":case"listbox":{const y=m.defaultValue||"";d.setValue(p,{value:y});break}default:continue}const g=document.querySelector(`[data-element-id="${p}"]`);if(g){if(!ul.has(g)){Pe(`_bindResetFormAction - element not allowed: ${p}`);continue}}else continue;g.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((f=this.linkService.eventBus)==null||f.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:h,name:"ResetForm"}})),!1}}}un=new WeakSet,Ua=function(){this.container.setAttribute("data-internal-link","")},PA=function(t,s,r=null){t.href=this.linkService.getAnchorUrl(""),s.description&&(t.title=s.description),t.onclick=()=>{var i;return(i=this.downloadManager)==null||i.openOrDownloadData(s.content,s.filename,r),!1},A(this,un,Ua).call(this)},DA=function(t,s){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(s),!1),A(this,un,Ua).call(this)};class vR extends Et{constructor(e){super(e,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),e.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(e),this.container}}class pl extends Et{render(){return this.container}showElementAndHideCanvas(e){var t;this.data.hasOwnCanvas&&(((t=e.previousSibling)==null?void 0:t.nodeName)==="CANVAS"&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){return Cs.platform.isMac?e.metaKey:e.ctrlKey}_setEventListener(e,t,s,r,i){s.includes("mouse")?e.addEventListener(s,a=>{var o;(o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:r,value:i(a),shift:a.shiftKey,modifier:this._getKeyModifier(a)}})}):e.addEventListener(s,a=>{var o;if(s==="blur"){if(!t.focused||!a.relatedTarget)return;t.focused=!1}else if(s==="focus"){if(t.focused)return;t.focused=!0}i&&((o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:r,value:i(a)}}))})}_setEventListeners(e,t,s,r){var i,a,o;for(const[c,d]of s)(d==="Action"||(i=this.data.actions)!=null&&i[d])&&((d==="Focus"||d==="Blur")&&(t||(t={focused:!1})),this._setEventListener(e,t,c,d,r),d==="Focus"&&!((a=this.data.actions)!=null&&a.Blur)?this._setEventListener(e,t,"blur","Blur",null):d==="Blur"&&!((o=this.data.actions)!=null&&o.Focus)&&this._setEventListener(e,t,"focus","Focus",null))}_setBackgroundColor(e){const t=this.data.backgroundColor||null;e.style.backgroundColor=t===null?"transparent":ve.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){const t=["left","center","right"],{fontColor:s}=this.data.defaultAppearanceData,r=this.data.defaultAppearanceData.fontSize||gR,i=e.style;let a;const o=2,c=d=>Math.round(10*d)/10;if(this.data.multiLine){const d=Math.abs(this.data.rect[3]-this.data.rect[1]-o),h=Math.round(d/(Hg*r))||1,f=d/h;a=Math.min(r,c(f/Hg))}else{const d=Math.abs(this.data.rect[3]-this.data.rect[1]-o);a=Math.min(r,c(d/Hg))}i.fontSize=`calc(${a}px * var(--scale-factor))`,i.color=ve.makeHexColor(s[0],s[1],s[2]),this.data.textAlignment!==null&&(i.textAlign=t[this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}}class bR extends pl{constructor(e){const t=e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue;super(e,{isRenderable:t})}setPropertyOnSiblings(e,t,s,r){const i=this.annotationStorage;for(const a of this._getElementsByName(e.name,e.id))a.domElement&&(a.domElement[t]=s),i.setValue(a.id,{[r]:s})}render(){var r,i;const e=this.annotationStorage,t=this.data.id;this.container.classList.add("textWidgetAnnotation");let s=null;if(this.renderForms){const a=e.getValue(t,{value:this.data.fieldValue});let o=a.value||"";const c=e.getValue(t,{charLimit:this.data.maxLen}).charLimit;c&&o.length>c&&(o=o.slice(0,c));let d=a.formattedValue||((r=this.data.textContent)==null?void 0:r.join(`
`))||null;d&&this.data.comb&&(d=d.replaceAll(/\s+/g,""));const h={userValue:o,formattedValue:d,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(s=document.createElement("textarea"),s.textContent=d??o,this.data.doNotScroll&&(s.style.overflowY="hidden")):(s=document.createElement("input"),s.type="text",s.setAttribute("value",d??o),this.data.doNotScroll&&(s.style.overflowX="hidden")),this.data.hasOwnCanvas&&(s.hidden=!0),ul.add(s),s.setAttribute("data-element-id",t),s.disabled=this.data.readOnly,s.name=this.data.fieldName,s.tabIndex=pf,this._setRequired(s,this.data.required),c&&(s.maxLength=c),s.addEventListener("input",m=>{e.setValue(t,{value:m.target.value}),this.setPropertyOnSiblings(s,"value",m.target.value,"value"),h.formattedValue=null}),s.addEventListener("resetform",m=>{const p=this.data.defaultFieldValue??"";s.value=h.userValue=p,h.formattedValue=null});let f=m=>{const{formattedValue:p}=h;p!=null&&(m.target.value=p),m.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){s.addEventListener("focus",p=>{var y;if(h.focused)return;const{target:g}=p;h.userValue&&(g.value=h.userValue),h.lastCommittedValue=g.value,h.commitKey=1,(y=this.data.actions)!=null&&y.Focus||(h.focused=!0)}),s.addEventListener("updatefromsandbox",p=>{this.showElementAndHideCanvas(p.target);const g={value(y){h.userValue=y.detail.value??"",e.setValue(t,{value:h.userValue.toString()}),y.target.value=h.userValue},formattedValue(y){const{formattedValue:N}=y.detail;h.formattedValue=N,N!=null&&y.target!==document.activeElement&&(y.target.value=N),e.setValue(t,{formattedValue:N})},selRange(y){y.target.setSelectionRange(...y.detail.selRange)},charLimit:y=>{var _;const{charLimit:N}=y.detail,{target:b}=y;if(N===0){b.removeAttribute("maxLength");return}b.setAttribute("maxLength",N);let x=h.userValue;!x||x.length<=N||(x=x.slice(0,N),b.value=h.userValue=x,e.setValue(t,{value:x}),(_=this.linkService.eventBus)==null||_.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:x,willCommit:!0,commitKey:1,selStart:b.selectionStart,selEnd:b.selectionEnd}}))}};this._dispatchEventFromSandbox(g,p)}),s.addEventListener("keydown",p=>{var N;h.commitKey=1;let g=-1;if(p.key==="Escape"?g=0:p.key==="Enter"&&!this.data.multiLine?g=2:p.key==="Tab"&&(h.commitKey=3),g===-1)return;const{value:y}=p.target;h.lastCommittedValue!==y&&(h.lastCommittedValue=y,h.userValue=y,(N=this.linkService.eventBus)==null||N.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:y,willCommit:!0,commitKey:g,selStart:p.target.selectionStart,selEnd:p.target.selectionEnd}}))});const m=f;f=null,s.addEventListener("blur",p=>{var y,N;if(!h.focused||!p.relatedTarget)return;(y=this.data.actions)!=null&&y.Blur||(h.focused=!1);const{value:g}=p.target;h.userValue=g,h.lastCommittedValue!==g&&((N=this.linkService.eventBus)==null||N.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:g,willCommit:!0,commitKey:h.commitKey,selStart:p.target.selectionStart,selEnd:p.target.selectionEnd}})),m(p)}),(i=this.data.actions)!=null&&i.Keystroke&&s.addEventListener("beforeinput",p=>{var k;h.lastCommittedValue=null;const{data:g,target:y}=p,{value:N,selectionStart:b,selectionEnd:x}=y;let _=b,w=x;switch(p.inputType){case"deleteWordBackward":{const C=N.substring(0,b).match(/\w*[^\w]*$/);C&&(_-=C[0].length);break}case"deleteWordForward":{const C=N.substring(b).match(/^[^\w]*\w*/);C&&(w+=C[0].length);break}case"deleteContentBackward":b===x&&(_-=1);break;case"deleteContentForward":b===x&&(w+=1);break}p.preventDefault(),(k=this.linkService.eventBus)==null||k.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:N,change:g||"",willCommit:!1,selStart:_,selEnd:w}})}),this._setEventListeners(s,h,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],p=>p.target.value)}if(f&&s.addEventListener("blur",f),this.data.comb){const p=(this.data.rect[2]-this.data.rect[0])/c;s.classList.add("comb"),s.style.letterSpacing=`calc(${p}px * var(--scale-factor) - 1ch)`}}else s=document.createElement("div"),s.textContent=this.data.fieldValue,s.style.verticalAlign="middle",s.style.display="table-cell",this.data.hasOwnCanvas&&(s.hidden=!0);return this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class xR extends pl{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}}class wR extends pl{constructor(e){super(e,{isRenderable:e.renderForms})}render(){const e=this.annotationStorage,t=this.data,s=t.id;let r=e.getValue(s,{value:t.exportValue===t.fieldValue}).value;typeof r=="string"&&(r=r!=="Off",e.setValue(s,{value:r})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const i=document.createElement("input");return ul.add(i),i.setAttribute("data-element-id",s),i.disabled=t.readOnly,this._setRequired(i,this.data.required),i.type="checkbox",i.name=t.fieldName,r&&i.setAttribute("checked",!0),i.setAttribute("exportValue",t.exportValue),i.tabIndex=pf,i.addEventListener("change",a=>{const{name:o,checked:c}=a.target;for(const d of this._getElementsByName(o,s)){const h=c&&d.exportValue===t.exportValue;d.domElement&&(d.domElement.checked=h),e.setValue(d.id,{value:h})}e.setValue(s,{value:c})}),i.addEventListener("resetform",a=>{const o=t.defaultFieldValue||"Off";a.target.checked=o===t.exportValue}),this.enableScripting&&this.hasJSActions&&(i.addEventListener("updatefromsandbox",a=>{const o={value(c){c.target.checked=c.detail.value!=="Off",e.setValue(s,{value:c.target.checked})}};this._dispatchEventFromSandbox(o,a)}),this._setEventListeners(i,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class MA extends pl{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const e=this.annotationStorage,t=this.data,s=t.id;let r=e.getValue(s,{value:t.fieldValue===t.buttonValue}).value;if(typeof r=="string"&&(r=r!==t.buttonValue,e.setValue(s,{value:r})),r)for(const a of this._getElementsByName(t.fieldName,s))e.setValue(a.id,{value:!1});const i=document.createElement("input");if(ul.add(i),i.setAttribute("data-element-id",s),i.disabled=t.readOnly,this._setRequired(i,this.data.required),i.type="radio",i.name=t.fieldName,r&&i.setAttribute("checked",!0),i.tabIndex=pf,i.addEventListener("change",a=>{const{name:o,checked:c}=a.target;for(const d of this._getElementsByName(o,s))e.setValue(d.id,{value:!1});e.setValue(s,{value:c})}),i.addEventListener("resetform",a=>{const o=t.defaultFieldValue;a.target.checked=o!=null&&o===t.buttonValue}),this.enableScripting&&this.hasJSActions){const a=t.buttonValue;i.addEventListener("updatefromsandbox",o=>{const c={value:d=>{const h=a===d.detail.value;for(const f of this._getElementsByName(d.target.name)){const m=h&&f.id===s;f.domElement&&(f.domElement.checked=m),e.setValue(f.id,{value:m})}}};this._dispatchEventFromSandbox(c,o)}),this._setEventListeners(i,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.checked)}return this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class _R extends IA{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){const e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton");const t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",s=>{this._dispatchEventFromSandbox({},s)})),e}}class SR extends pl{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const e=this.annotationStorage,t=this.data.id,s=e.getValue(t,{value:this.data.fieldValue}),r=document.createElement("select");ul.add(r),r.setAttribute("data-element-id",t),r.disabled=this.data.readOnly,this._setRequired(r,this.data.required),r.name=this.data.fieldName,r.tabIndex=pf;let i=this.data.combo&&this.data.options.length>0;this.data.combo||(r.size=this.data.options.length,this.data.multiSelect&&(r.multiple=!0)),r.addEventListener("resetform",h=>{const f=this.data.defaultFieldValue;for(const m of r.options)m.selected=m.value===f});for(const h of this.data.options){const f=document.createElement("option");f.textContent=h.displayValue,f.value=h.exportValue,s.value.includes(h.exportValue)&&(f.setAttribute("selected",!0),i=!1),r.append(f)}let a=null;if(i){const h=document.createElement("option");h.value=" ",h.setAttribute("hidden",!0),h.setAttribute("selected",!0),r.prepend(h),a=()=>{h.remove(),r.removeEventListener("input",a),a=null},r.addEventListener("input",a)}const o=h=>{const f=h?"value":"textContent",{options:m,multiple:p}=r;return p?Array.prototype.filter.call(m,g=>g.selected).map(g=>g[f]):m.selectedIndex===-1?null:m[m.selectedIndex][f]};let c=o(!1);const d=h=>{const f=h.target.options;return Array.prototype.map.call(f,m=>({displayValue:m.textContent,exportValue:m.value}))};return this.enableScripting&&this.hasJSActions?(r.addEventListener("updatefromsandbox",h=>{const f={value(m){a==null||a();const p=m.detail.value,g=new Set(Array.isArray(p)?p:[p]);for(const y of r.options)y.selected=g.has(y.value);e.setValue(t,{value:o(!0)}),c=o(!1)},multipleSelection(m){r.multiple=!0},remove(m){const p=r.options,g=m.detail.remove;p[g].selected=!1,r.remove(g),p.length>0&&Array.prototype.findIndex.call(p,N=>N.selected)===-1&&(p[0].selected=!0),e.setValue(t,{value:o(!0),items:d(m)}),c=o(!1)},clear(m){for(;r.length!==0;)r.remove(0);e.setValue(t,{value:null,items:[]}),c=o(!1)},insert(m){const{index:p,displayValue:g,exportValue:y}=m.detail.insert,N=r.children[p],b=document.createElement("option");b.textContent=g,b.value=y,N?N.before(b):r.append(b),e.setValue(t,{value:o(!0),items:d(m)}),c=o(!1)},items(m){const{items:p}=m.detail;for(;r.length!==0;)r.remove(0);for(const g of p){const{displayValue:y,exportValue:N}=g,b=document.createElement("option");b.textContent=y,b.value=N,r.append(b)}r.options.length>0&&(r.options[0].selected=!0),e.setValue(t,{value:o(!0),items:d(m)}),c=o(!1)},indices(m){const p=new Set(m.detail.indices);for(const g of m.target.options)g.selected=p.has(g.index);e.setValue(t,{value:o(!0)}),c=o(!1)},editable(m){m.target.disabled=!m.detail.editable}};this._dispatchEventFromSandbox(f,h)}),r.addEventListener("input",h=>{var p;const f=o(!0),m=o(!1);e.setValue(t,{value:f}),h.preventDefault(),(p=this.linkService.eventBus)==null||p.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:c,change:m,changeEx:f,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(r,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],h=>h.target.value)):r.addEventListener("input",function(h){e.setValue(t,{value:o(!0)})}),this.data.combo&&this._setTextStyle(r),this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class zy extends Et{constructor(e){const{data:t,elements:s}=e;super(e,{isRenderable:Et._hasPopupData(t)}),this.elements=s,this.popup=null}render(){this.container.classList.add("popupAnnotation");const e=this.popup=new AR({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),t=[];for(const s of this.elements)s.popup=e,s.container.ariaHasPopup="dialog",t.push(s.data.id),s.addHighlightArea();return this.container.setAttribute("aria-controls",t.map(s=>`${Sb}${s}`).join(",")),this.container}}var Rc,Np,kp,Ic,Ro,_t,ii,Pc,Ah,Nh,Dc,ai,Wn,oi,kh,li,Eh,Io,Po,Ze,ym,Hy,LA,OA,FA,$A,vm,bm,qy;class AR{constructor({container:e,color:t,elements:s,titleObj:r,modificationDate:i,contentsObj:a,richText:o,parent:c,rect:d,parentRect:h,open:f}){S(this,Ze);S(this,Rc,A(this,Ze,FA).bind(this));S(this,Np,A(this,Ze,qy).bind(this));S(this,kp,A(this,Ze,bm).bind(this));S(this,Ic,A(this,Ze,vm).bind(this));S(this,Ro,null);S(this,_t,null);S(this,ii,null);S(this,Pc,null);S(this,Ah,null);S(this,Nh,null);S(this,Dc,null);S(this,ai,!1);S(this,Wn,null);S(this,oi,null);S(this,kh,null);S(this,li,null);S(this,Eh,null);S(this,Io,null);S(this,Po,!1);var m;v(this,_t,e),v(this,Eh,r),v(this,ii,a),v(this,li,o),v(this,Nh,c),v(this,Ro,t),v(this,kh,d),v(this,Dc,h),v(this,Ah,s),v(this,Pc,kb.toDateObject(i)),this.trigger=s.flatMap(p=>p.getElementsToTriggerPopup());for(const p of this.trigger)p.addEventListener("click",l(this,Ic)),p.addEventListener("mouseenter",l(this,kp)),p.addEventListener("mouseleave",l(this,Np)),p.classList.add("popupTriggerArea");for(const p of s)(m=p.container)==null||m.addEventListener("keydown",l(this,Rc));l(this,_t).hidden=!0,f&&A(this,Ze,vm).call(this)}render(){if(l(this,Wn))return;const e=v(this,Wn,document.createElement("div"));if(e.className="popup",l(this,Ro)){const i=e.style.outlineColor=ve.makeHexColor(...l(this,Ro));CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?e.style.backgroundColor=`color-mix(in srgb, ${i} 30%, white)`:e.style.backgroundColor=ve.makeHexColor(...l(this,Ro).map(o=>Math.floor(.7*(255-o)+o)))}const t=document.createElement("span");t.className="header";const s=document.createElement("h1");if(t.append(s),{dir:s.dir,str:s.textContent}=l(this,Eh),e.append(t),l(this,Pc)){const i=document.createElement("span");i.classList.add("popupDate"),i.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),i.setAttribute("data-l10n-args",JSON.stringify({dateObj:l(this,Pc).valueOf()})),t.append(i)}const r=l(this,Ze,ym);if(r)RA.render({xfaHtml:r,intent:"richText",div:e}),e.lastChild.classList.add("richText","popupContent");else{const i=this._formatContents(l(this,ii));e.append(i)}l(this,_t).append(e)}_formatContents({str:e,dir:t}){const s=document.createElement("p");s.classList.add("popupContent"),s.dir=t;const r=e.split(/(?:\r\n?|\n)/);for(let i=0,a=r.length;i<a;++i){const o=r[i];s.append(document.createTextNode(o)),i<a-1&&s.append(document.createElement("br"))}return s}updateEdited({rect:e,popupContent:t}){var s;l(this,Io)||v(this,Io,{contentsObj:l(this,ii),richText:l(this,li)}),e&&v(this,oi,null),t&&(v(this,li,A(this,Ze,OA).call(this,t)),v(this,ii,null)),(s=l(this,Wn))==null||s.remove(),v(this,Wn,null)}resetEdited(){var e;l(this,Io)&&({contentsObj:bs(this,ii)._,richText:bs(this,li)._}=l(this,Io),v(this,Io,null),(e=l(this,Wn))==null||e.remove(),v(this,Wn,null),v(this,oi,null))}forceHide(){v(this,Po,this.isVisible),l(this,Po)&&(l(this,_t).hidden=!0)}maybeShow(){l(this,Po)&&(l(this,Wn)||A(this,Ze,bm).call(this),v(this,Po,!1),l(this,_t).hidden=!1)}get isVisible(){return l(this,_t).hidden===!1}}Rc=new WeakMap,Np=new WeakMap,kp=new WeakMap,Ic=new WeakMap,Ro=new WeakMap,_t=new WeakMap,ii=new WeakMap,Pc=new WeakMap,Ah=new WeakMap,Nh=new WeakMap,Dc=new WeakMap,ai=new WeakMap,Wn=new WeakMap,oi=new WeakMap,kh=new WeakMap,li=new WeakMap,Eh=new WeakMap,Io=new WeakMap,Po=new WeakMap,Ze=new WeakSet,ym=function(){const e=l(this,li),t=l(this,ii);return e!=null&&e.str&&(!(t!=null&&t.str)||t.str===e.str)&&l(this,li).html||null},Hy=function(){var e,t,s;return((s=(t=(e=l(this,Ze,ym))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:s.fontSize)||0},LA=function(){var e,t,s;return((s=(t=(e=l(this,Ze,ym))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:s.color)||null},OA=function(e){const t=[],s={str:e,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:t}]}},r={style:{color:l(this,Ze,LA),fontSize:l(this,Ze,Hy)?`calc(${l(this,Ze,Hy)}px * var(--scale-factor))`:""}};for(const i of e.split(`
`))t.push({name:"span",value:i,attributes:r});return s},FA=function(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||(e.key==="Enter"||e.key==="Escape"&&l(this,ai))&&A(this,Ze,vm).call(this)},$A=function(){if(l(this,oi)!==null)return;const{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:s,pageX:r,pageY:i}}}=l(this,Nh);let a=!!l(this,Dc),o=a?l(this,Dc):l(this,kh);for(const g of l(this,Ah))if(!o||ve.intersect(g.data.rect,o)!==null){o=g.data.rect,a=!0;break}const c=ve.normalizeRect([o[0],e[3]-o[1]+e[1],o[2],e[3]-o[3]+e[1]]),h=a?o[2]-o[0]+5:0,f=c[0]+h,m=c[1];v(this,oi,[100*(f-r)/t,100*(m-i)/s]);const{style:p}=l(this,_t);p.left=`${l(this,oi)[0]}%`,p.top=`${l(this,oi)[1]}%`},vm=function(){v(this,ai,!l(this,ai)),l(this,ai)?(A(this,Ze,bm).call(this),l(this,_t).addEventListener("click",l(this,Ic)),l(this,_t).addEventListener("keydown",l(this,Rc))):(A(this,Ze,qy).call(this),l(this,_t).removeEventListener("click",l(this,Ic)),l(this,_t).removeEventListener("keydown",l(this,Rc)))},bm=function(){l(this,Wn)||this.render(),this.isVisible?l(this,ai)&&l(this,_t).classList.add("focused"):(A(this,Ze,$A).call(this),l(this,_t).hidden=!1,l(this,_t).style.zIndex=parseInt(l(this,_t).style.zIndex)+1e3)},qy=function(){l(this,_t).classList.remove("focused"),!(l(this,ai)||!this.isVisible)&&(l(this,_t).hidden=!0,l(this,_t).style.zIndex=parseInt(l(this,_t).style.zIndex)-1e3)};class BA extends Et{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.textContent=e.data.textContent,this.textPosition=e.data.textPosition,this.annotationEditorType=Ie.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const e=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(const t of this.textContent){const s=document.createElement("span");s.textContent=t,e.append(s)}this.container.append(e)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}var Ch;class NR extends Et{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});S(this,Ch,null)}render(){this.container.classList.add("lineAnnotation");const t=this.data,{width:s,height:r}=Na(t.rect),i=this.svgFactory.create(s,r,!0),a=v(this,Ch,this.svgFactory.createElement("svg:line"));return a.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),a.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),a.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),a.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),a.setAttribute("stroke-width",t.borderStyle.width||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),i.append(a),this.container.append(i),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return l(this,Ch)}addHighlightArea(){this.container.classList.add("highlightArea")}}Ch=new WeakMap;var jh;class kR extends Et{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});S(this,jh,null)}render(){this.container.classList.add("squareAnnotation");const t=this.data,{width:s,height:r}=Na(t.rect),i=this.svgFactory.create(s,r,!0),a=t.borderStyle.width,o=v(this,jh,this.svgFactory.createElement("svg:rect"));return o.setAttribute("x",a/2),o.setAttribute("y",a/2),o.setAttribute("width",s-a),o.setAttribute("height",r-a),o.setAttribute("stroke-width",a||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),i.append(o),this.container.append(i),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return l(this,jh)}addHighlightArea(){this.container.classList.add("highlightArea")}}jh=new WeakMap;var Th;class ER extends Et{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});S(this,Th,null)}render(){this.container.classList.add("circleAnnotation");const t=this.data,{width:s,height:r}=Na(t.rect),i=this.svgFactory.create(s,r,!0),a=t.borderStyle.width,o=v(this,Th,this.svgFactory.createElement("svg:ellipse"));return o.setAttribute("cx",s/2),o.setAttribute("cy",r/2),o.setAttribute("rx",s/2-a/2),o.setAttribute("ry",r/2-a/2),o.setAttribute("stroke-width",a||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),i.append(o),this.container.append(i),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return l(this,Th)}addHighlightArea(){this.container.classList.add("highlightArea")}}Th=new WeakMap;var Rh;class UA extends Et{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});S(this,Rh,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,vertices:s,borderStyle:r,popupRef:i}}=this;if(!s)return this.container;const{width:a,height:o}=Na(t),c=this.svgFactory.create(a,o,!0);let d=[];for(let f=0,m=s.length;f<m;f+=2){const p=s[f]-t[0],g=t[3]-s[f+1];d.push(`${p},${g}`)}d=d.join(" ");const h=v(this,Rh,this.svgFactory.createElement(this.svgElementName));return h.setAttribute("points",d),h.setAttribute("stroke-width",r.width||1),h.setAttribute("stroke","transparent"),h.setAttribute("fill","transparent"),c.append(h),this.container.append(c),!i&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return l(this,Rh)}addHighlightArea(){this.container.classList.add("highlightArea")}}Rh=new WeakMap;class CR extends UA{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class jR extends Et{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}var Ih,Do,Ph,Wy;class Rb extends Et{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});S(this,Ph);S(this,Ih,null);S(this,Do,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?Ie.HIGHLIGHT:Ie.INK}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,rotation:s,inkLists:r,borderStyle:i,popupRef:a}}=this,{transform:o,width:c,height:d}=A(this,Ph,Wy).call(this,s,t),h=this.svgFactory.create(c,d,!0),f=v(this,Ih,this.svgFactory.createElement("svg:g"));h.append(f),f.setAttribute("stroke-width",i.width||1),f.setAttribute("stroke-linecap","round"),f.setAttribute("stroke-linejoin","round"),f.setAttribute("stroke-miterlimit",10),f.setAttribute("stroke","transparent"),f.setAttribute("fill","transparent"),f.setAttribute("transform",o);for(let m=0,p=r.length;m<p;m++){const g=this.svgFactory.createElement(this.svgElementName);l(this,Do).push(g),g.setAttribute("points",r[m].join(",")),f.append(g)}return!a&&this.hasPopupData&&this._createPopup(),this.container.append(h),this._editOnDoubleClick(),this.container}updateEdited(t){super.updateEdited(t);const{thickness:s,points:r,rect:i}=t,a=l(this,Ih);if(s>=0&&a.setAttribute("stroke-width",s||1),r)for(let o=0,c=l(this,Do).length;o<c;o++)l(this,Do)[o].setAttribute("points",r[o].join(","));if(i){const{transform:o,width:c,height:d}=A(this,Ph,Wy).call(this,this.data.rotation,i);a.parentElement.setAttribute("viewBox",`0 0 ${c} ${d}`),a.setAttribute("transform",o)}}getElementsToTriggerPopup(){return l(this,Do)}addHighlightArea(){this.container.classList.add("highlightArea")}}Ih=new WeakMap,Do=new WeakMap,Ph=new WeakSet,Wy=function(t,s){switch(t){case 90:return{transform:`rotate(90) translate(${-s[0]},${s[1]}) scale(1,-1)`,width:s[3]-s[1],height:s[2]-s[0]};case 180:return{transform:`rotate(180) translate(${-s[2]},${s[1]}) scale(1,-1)`,width:s[2]-s[0],height:s[3]-s[1]};case 270:return{transform:`rotate(270) translate(${-s[2]},${s[3]}) scale(1,-1)`,width:s[3]-s[1],height:s[2]-s[0]};default:return{transform:`translate(${-s[0]},${s[3]}) scale(1,-1)`,width:s[2]-s[0],height:s[3]-s[1]}}};class zA extends Et{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=Ie.HIGHLIGHT}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),this.container}}class TR extends Et{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class RR extends Et{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class IR extends Et{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class HA extends Et{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=Ie.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}var Dh,Mh,Vy;class PR extends Et{constructor(t){var r;super(t,{isRenderable:!0});S(this,Mh);S(this,Dh,null);const{file:s}=this.data;this.filename=s.filename,this.content=s.content,(r=this.linkService.eventBus)==null||r.dispatch("fileattachmentannotation",{source:this,...s})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:t,data:s}=this;let r;s.hasAppearance||s.fillAlpha===0?r=document.createElement("div"):(r=document.createElement("img"),r.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(s.name)?"paperclip":"pushpin"}.svg`,s.fillAlpha&&s.fillAlpha<1&&(r.style=`filter: opacity(${Math.round(s.fillAlpha*100)}%);`)),r.addEventListener("dblclick",A(this,Mh,Vy).bind(this)),v(this,Dh,r);const{isMac:i}=Cs.platform;return t.addEventListener("keydown",a=>{a.key==="Enter"&&(i?a.metaKey:a.ctrlKey)&&A(this,Mh,Vy).call(this)}),!s.popupRef&&this.hasPopupData?this._createPopup():r.classList.add("popupTriggerArea"),t.append(r),t}getElementsToTriggerPopup(){return l(this,Dh)}addHighlightArea(){this.container.classList.add("highlightArea")}}Dh=new WeakMap,Mh=new WeakSet,Vy=function(){var t;(t=this.downloadManager)==null||t.openOrDownloadData(this.content,this.filename)};var Lh,Mo,Lo,Oh,dl,qA,Gy;class DR{constructor({div:e,accessibilityManager:t,annotationCanvasMap:s,annotationEditorUIManager:r,page:i,viewport:a,structTreeLayer:o}){S(this,dl);S(this,Lh,null);S(this,Mo,null);S(this,Lo,new Map);S(this,Oh,null);this.div=e,v(this,Lh,t),v(this,Mo,s),v(this,Oh,o||null),this.page=i,this.viewport=a,this.zIndex=0,this._annotationEditorUIManager=r}hasEditableAnnotations(){return l(this,Lo).size>0}async render(e){var a;const{annotations:t}=e,s=this.div;ll(s,this.viewport);const r=new Map,i={data:null,layer:s,linkService:e.linkService,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:e.renderForms!==!1,svgFactory:new Tb,annotationStorage:e.annotationStorage||new Cb,enableScripting:e.enableScripting===!0,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(const o of t){if(o.noHTML)continue;const c=o.annotationType===Dt.POPUP;if(c){const f=r.get(o.id);if(!f)continue;i.elements=f}else{const{width:f,height:m}=Na(o.rect);if(f<=0||m<=0)continue}i.data=o;const d=yR.create(i);if(!d.isRenderable)continue;if(!c&&o.popupRef){const f=r.get(o.popupRef);f?f.push(d):r.set(o.popupRef,[d])}const h=d.render();o.hidden&&(h.style.visibility="hidden"),await A(this,dl,qA).call(this,h,o.id),d._isEditable&&(l(this,Lo).set(d.data.id,d),(a=this._annotationEditorUIManager)==null||a.renderAnnotationElement(d))}A(this,dl,Gy).call(this)}update({viewport:e}){const t=this.div;this.viewport=e,ll(t,{rotation:e.rotation}),A(this,dl,Gy).call(this),t.hidden=!1}getEditableAnnotations(){return Array.from(l(this,Lo).values())}getEditableAnnotation(e){return l(this,Lo).get(e)}}Lh=new WeakMap,Mo=new WeakMap,Lo=new WeakMap,Oh=new WeakMap,dl=new WeakSet,qA=async function(e,t){var a,o;const s=e.firstChild||e,r=s.id=`${Sb}${t}`,i=await((a=l(this,Oh))==null?void 0:a.getAriaAttributes(r));if(i)for(const[c,d]of i)s.setAttribute(c,d);this.div.append(e),(o=l(this,Lh))==null||o.moveElementInDOM(this.div,e,s,!1)},Gy=function(){if(!l(this,Mo))return;const e=this.div;for(const[t,s]of l(this,Mo)){const r=e.querySelector(`[data-annotation-id="${t}"]`);if(!r)continue;s.className="annotationContent";const{firstChild:i}=r;i?i.nodeName==="CANVAS"?i.replaceWith(s):i.classList.contains("annotationContent")?i.after(s):i.before(s):r.append(s)}l(this,Mo).clear()};const zf=/\r\n?|\n/g;var Vn,Zs,Fh,Oo,en,It,WA,VA,GA,xm,wi,wm,_m,KA,Xy,XA;const it=class it extends vt{constructor(t){super({...t,name:"freeTextEditor"});S(this,It);S(this,Vn);S(this,Zs,"");S(this,Fh,`${this.id}-editor`);S(this,Oo,null);S(this,en);v(this,Vn,t.color||it._defaultColor||vt._defaultLineColor),v(this,en,t.fontSize||it._defaultFontSize)}static get _keyboardManager(){const t=it.prototype,s=a=>a.isEmpty(),r=cl.TRANSLATE_SMALL,i=cl.TRANSLATE_BIG;return Le(this,"_keyboardManager",new mf([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-r,0],checker:s}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-i,0],checker:s}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[r,0],checker:s}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[i,0],checker:s}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-r],checker:s}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-i],checker:s}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,r],checker:s}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,i],checker:s}]]))}static initialize(t,s){vt.initialize(t,s);const r=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(r.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,s){switch(t){case Be.FREETEXT_SIZE:it._defaultFontSize=s;break;case Be.FREETEXT_COLOR:it._defaultColor=s;break}}updateParams(t,s){switch(t){case Be.FREETEXT_SIZE:A(this,It,WA).call(this,s);break;case Be.FREETEXT_COLOR:A(this,It,VA).call(this,s);break}}static get defaultPropertiesToUpdate(){return[[Be.FREETEXT_SIZE,it._defaultFontSize],[Be.FREETEXT_COLOR,it._defaultColor||vt._defaultLineColor]]}get propertiesToUpdate(){return[[Be.FREETEXT_SIZE,l(this,en)],[Be.FREETEXT_COLOR,l(this,Vn)]]}_translateEmpty(t,s){this._uiManager.translateSelectedEditors(t,s,!0)}getInitialTranslation(){const t=this.parentScale;return[-it._internalPadding*t,-(it._internalPadding+l(this,en))*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(this.isInEditMode())return;this.parent.setEditingState(!1),this.parent.updateToolbar(Ie.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),v(this,Oo,new AbortController);const t=this._uiManager.combinedSignal(l(this,Oo));this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t})}disableEditMode(){var t;this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",l(this,Fh)),this._isDraggable=!0,(t=l(this,Oo))==null||t.abort(),v(this,Oo,null),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"))}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(t){var s;this.width||(this.enableEditMode(),t&&this.editorDiv.focus(),(s=this._initialOptions)!=null&&s.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const t=l(this,Zs),s=v(this,Zs,A(this,It,GA).call(this).trimEnd());if(t===s)return;const r=i=>{if(v(this,Zs,i),!i){this.remove();return}A(this,It,_m).call(this),this._uiManager.rebuild(this),A(this,It,xm).call(this)};this.addCommands({cmd:()=>{r(s)},undo:()=>{r(t)},mustExec:!1}),A(this,It,xm).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(t){this.enterInEditMode()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){it._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let t,s;this.width&&(t=this.x,s=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",l(this,Fh)),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:r}=this.editorDiv;if(r.fontSize=`calc(${l(this,en)}px * var(--scale-factor))`,r.color=l(this,Vn),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),ap(this,this.div,["dblclick","keydown"]),this.width){const[i,a]=this.parentDimensions;if(this.annotationElementId){const{position:o}=this._initialData;let[c,d]=this.getInitialTranslation();[c,d]=this.pageTranslationToScreen(c,d);const[h,f]=this.pageDimensions,[m,p]=this.pageTranslation;let g,y;switch(this.rotation){case 0:g=t+(o[0]-m)/h,y=s+this.height-(o[1]-p)/f;break;case 90:g=t+(o[0]-m)/h,y=s-(o[1]-p)/f,[c,d]=[d,-c];break;case 180:g=t-this.width+(o[0]-m)/h,y=s-(o[1]-p)/f,[c,d]=[-c,-d];break;case 270:g=t+(o[0]-m-this.height*f)/h,y=s+(o[1]-p-this.width*h)/f,[c,d]=[-d,c];break}this.setAt(g*i,y*a,c,d)}else this.setAt(t*i,s*a,this.width*i,this.height*a);A(this,It,_m).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}editorDivPaste(t){var g,y,N;const s=t.clipboardData||window.clipboardData,{types:r}=s;if(r.length===1&&r[0]==="text/plain")return;t.preventDefault();const i=A(g=it,wi,Xy).call(g,s.getData("text")||"").replaceAll(zf,`
`);if(!i)return;const a=window.getSelection();if(!a.rangeCount)return;this.editorDiv.normalize(),a.deleteFromDocument();const o=a.getRangeAt(0);if(!i.includes(`
`)){o.insertNode(document.createTextNode(i)),this.editorDiv.normalize(),a.collapseToStart();return}const{startContainer:c,startOffset:d}=o,h=[],f=[];if(c.nodeType===Node.TEXT_NODE){const b=c.parentElement;if(f.push(c.nodeValue.slice(d).replaceAll(zf,"")),b!==this.editorDiv){let x=h;for(const _ of this.editorDiv.childNodes){if(_===b){x=f;continue}x.push(A(y=it,wi,wm).call(y,_))}}h.push(c.nodeValue.slice(0,d).replaceAll(zf,""))}else if(c===this.editorDiv){let b=h,x=0;for(const _ of this.editorDiv.childNodes)x++===d&&(b=f),b.push(A(N=it,wi,wm).call(N,_))}v(this,Zs,`${h.join(`
`)}${i}${f.join(`
`)}`),A(this,It,_m).call(this);const m=new Range;let p=h.reduce((b,x)=>b+x.length,0);for(const{firstChild:b}of this.editorDiv.childNodes)if(b.nodeType===Node.TEXT_NODE){const x=b.nodeValue.length;if(p<=x){m.setStart(b,p),m.setEnd(b,p);break}p-=x}a.removeAllRanges(),a.addRange(m)}get contentDiv(){return this.editorDiv}static async deserialize(t,s,r){var o;let i=null;if(t instanceof BA){const{data:{defaultAppearanceData:{fontSize:c,fontColor:d},rect:h,rotation:f,id:m,popupRef:p},textContent:g,textPosition:y,parent:{page:{pageNumber:N}}}=t;if(!g||g.length===0)return null;i=t={annotationType:Ie.FREETEXT,color:Array.from(d),fontSize:c,value:g.join(`
`),position:y,pageIndex:N-1,rect:h.slice(0),rotation:f,id:m,deleted:!1,popupRef:p}}const a=await super.deserialize(t,s,r);return v(a,en,t.fontSize),v(a,Vn,ve.makeHexColor(...t.color)),v(a,Zs,A(o=it,wi,Xy).call(o,t.value)),a.annotationElementId=t.id||null,a._initialData=i,a}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const s=it._internalPadding*this.parentScale,r=this.getRect(s,s),i=vt._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:l(this,Vn)),a={annotationType:Ie.FREETEXT,color:i,fontSize:l(this,en),value:A(this,It,KA).call(this),pageIndex:this.pageIndex,rect:r,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?a:this.annotationElementId&&!A(this,It,XA).call(this,a)?null:(a.id=this.annotationElementId,a)}renderAnnotationElement(t){const s=super.renderAnnotationElement(t);if(this.deleted)return s;const{style:r}=s;r.fontSize=`calc(${l(this,en)}px * var(--scale-factor))`,r.color=l(this,Vn),s.replaceChildren();for(const a of l(this,Zs).split(`
`)){const o=document.createElement("div");o.append(a?document.createTextNode(a):document.createElement("br")),s.append(o)}const i=it._internalPadding*this.parentScale;return t.updateEdited({rect:this.getRect(i,i),popupContent:l(this,Zs)}),s}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}};Vn=new WeakMap,Zs=new WeakMap,Fh=new WeakMap,Oo=new WeakMap,en=new WeakMap,It=new WeakSet,WA=function(t){const s=i=>{this.editorDiv.style.fontSize=`calc(${i}px * var(--scale-factor))`,this.translate(0,-(i-l(this,en))*this.parentScale),v(this,en,i),A(this,It,xm).call(this)},r=l(this,en);this.addCommands({cmd:s.bind(this,t),undo:s.bind(this,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Be.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},VA=function(t){const s=i=>{v(this,Vn,this.editorDiv.style.color=i)},r=l(this,Vn);this.addCommands({cmd:s.bind(this,t),undo:s.bind(this,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Be.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},GA=function(){var r;const t=[];this.editorDiv.normalize();let s=null;for(const i of this.editorDiv.childNodes)(s==null?void 0:s.nodeType)===Node.TEXT_NODE&&i.nodeName==="BR"||(t.push(A(r=it,wi,wm).call(r,i)),s=i);return t.join(`
`)},xm=function(){const[t,s]=this.parentDimensions;let r;if(this.isAttachedToDOM)r=this.div.getBoundingClientRect();else{const{currentLayer:i,div:a}=this,o=a.style.display,c=a.classList.contains("hidden");a.classList.remove("hidden"),a.style.display="hidden",i.div.append(this.div),r=a.getBoundingClientRect(),a.remove(),a.style.display=o,a.classList.toggle("hidden",c)}this.rotation%180===this.parentRotation%180?(this.width=r.width/t,this.height=r.height/s):(this.width=r.height/t,this.height=r.width/s),this.fixAndSetPosition()},wi=new WeakSet,wm=function(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(zf,"")},_m=function(){if(this.editorDiv.replaceChildren(),!!l(this,Zs))for(const t of l(this,Zs).split(`
`)){const s=document.createElement("div");s.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(s)}},KA=function(){return l(this,Zs).replaceAll(" "," ")},Xy=function(t){return t.replaceAll(" "," ")},XA=function(t){const{value:s,fontSize:r,color:i,pageIndex:a}=this._initialData;return this._hasBeenMoved||t.value!==s||t.fontSize!==r||t.color.some((o,c)=>o!==i[c])||t.pageIndex!==a},S(it,wi),xe(it,"_freeTextDefaultContent",""),xe(it,"_internalPadding",0),xe(it,"_defaultColor",null),xe(it,"_defaultFontSize",10),xe(it,"_type","freetext"),xe(it,"_editorType",Ie.FREETEXT);let Ky=it;class ue{toSVGPath(){st("Abstract method `toSVGPath` must be implemented.")}get box(){st("Abstract getter `box` must be implemented.")}serialize(e,t){st("Abstract method `serialize` must be implemented.")}static _rescale(e,t,s,r,i,a){a||(a=new Float32Array(e.length));for(let o=0,c=e.length;o<c;o+=2)a[o]=t+e[o]*r,a[o+1]=s+e[o+1]*i;return a}static _rescaleAndSwap(e,t,s,r,i,a){a||(a=new Float32Array(e.length));for(let o=0,c=e.length;o<c;o+=2)a[o]=t+e[o+1]*r,a[o+1]=s+e[o]*i;return a}static _translate(e,t,s,r){r||(r=new Float32Array(e.length));for(let i=0,a=e.length;i<a;i+=2)r[i]=t+e[i],r[i+1]=s+e[i+1];return r}static svgRound(e){return Math.round(e*1e4)}static _normalizePoint(e,t,s,r,i){switch(i){case 90:return[1-t/s,e/r];case 180:return[1-e/s,1-t/r];case 270:return[t/s,1-e/r];default:return[e/s,t/r]}}static _normalizePagePoint(e,t,s){switch(s){case 90:return[1-t,e];case 180:return[1-e,1-t];case 270:return[t,1-e];default:return[e,t]}}static createBezierPoints(e,t,s,r,i,a){return[(e+5*s)/6,(t+5*r)/6,(5*s+i)/6,(5*r+a)/6,(s+i)/2,(r+a)/2]}}xe(ue,"PRECISION",1e-4);var tn,Gn,Mc,Lc,Ar,Me,Fo,$o,$h,Bh,Oc,Fc,ra,Uh,Ep,Cp,zt,Vu,YA,JA,QA,ZA,eN,tN;const Hr=class Hr{constructor({x:e,y:t},s,r,i,a,o=0){S(this,zt);S(this,tn);S(this,Gn,[]);S(this,Mc);S(this,Lc);S(this,Ar,[]);S(this,Me,new Float32Array(18));S(this,Fo);S(this,$o);S(this,$h);S(this,Bh);S(this,Oc);S(this,Fc);S(this,ra,[]);v(this,tn,s),v(this,Fc,i*r),v(this,Lc,a),l(this,Me).set([NaN,NaN,NaN,NaN,e,t],6),v(this,Mc,o),v(this,Bh,l(Hr,Uh)*r),v(this,$h,l(Hr,Cp)*r),v(this,Oc,r),l(this,ra).push(e,t)}isEmpty(){return isNaN(l(this,Me)[8])}add({x:e,y:t}){var B;v(this,Fo,e),v(this,$o,t);const[s,r,i,a]=l(this,tn);let[o,c,d,h]=l(this,Me).subarray(8,12);const f=e-d,m=t-h,p=Math.hypot(f,m);if(p<l(this,$h))return!1;const g=p-l(this,Bh),y=g/p,N=y*f,b=y*m;let x=o,_=c;o=d,c=h,d+=N,h+=b,(B=l(this,ra))==null||B.push(e,t);const w=-b/g,k=N/g,C=w*l(this,Fc),T=k*l(this,Fc);return l(this,Me).set(l(this,Me).subarray(2,8),0),l(this,Me).set([d+C,h+T],4),l(this,Me).set(l(this,Me).subarray(14,18),12),l(this,Me).set([d-C,h-T],16),isNaN(l(this,Me)[6])?(l(this,Ar).length===0&&(l(this,Me).set([o+C,c+T],2),l(this,Ar).push(NaN,NaN,NaN,NaN,(o+C-s)/i,(c+T-r)/a),l(this,Me).set([o-C,c-T],14),l(this,Gn).push(NaN,NaN,NaN,NaN,(o-C-s)/i,(c-T-r)/a)),l(this,Me).set([x,_,o,c,d,h],6),!this.isEmpty()):(l(this,Me).set([x,_,o,c,d,h],6),Math.abs(Math.atan2(_-c,x-o)-Math.atan2(b,N))<Math.PI/2?([o,c,d,h]=l(this,Me).subarray(2,6),l(this,Ar).push(NaN,NaN,NaN,NaN,((o+d)/2-s)/i,((c+h)/2-r)/a),[o,c,x,_]=l(this,Me).subarray(14,18),l(this,Gn).push(NaN,NaN,NaN,NaN,((x+o)/2-s)/i,((_+c)/2-r)/a),!0):([x,_,o,c,d,h]=l(this,Me).subarray(0,6),l(this,Ar).push(((x+5*o)/6-s)/i,((_+5*c)/6-r)/a,((5*o+d)/6-s)/i,((5*c+h)/6-r)/a,((o+d)/2-s)/i,((c+h)/2-r)/a),[d,h,o,c,x,_]=l(this,Me).subarray(12,18),l(this,Gn).push(((x+5*o)/6-s)/i,((_+5*c)/6-r)/a,((5*o+d)/6-s)/i,((5*c+h)/6-r)/a,((o+d)/2-s)/i,((c+h)/2-r)/a),!0))}toSVGPath(){if(this.isEmpty())return"";const e=l(this,Ar),t=l(this,Gn);if(isNaN(l(this,Me)[6])&&!this.isEmpty())return A(this,zt,YA).call(this);const s=[];s.push(`M${e[4]} ${e[5]}`);for(let r=6;r<e.length;r+=6)isNaN(e[r])?s.push(`L${e[r+4]} ${e[r+5]}`):s.push(`C${e[r]} ${e[r+1]} ${e[r+2]} ${e[r+3]} ${e[r+4]} ${e[r+5]}`);A(this,zt,QA).call(this,s);for(let r=t.length-6;r>=6;r-=6)isNaN(t[r])?s.push(`L${t[r+4]} ${t[r+5]}`):s.push(`C${t[r]} ${t[r+1]} ${t[r+2]} ${t[r+3]} ${t[r+4]} ${t[r+5]}`);return A(this,zt,JA).call(this,s),s.join(" ")}newFreeDrawOutline(e,t,s,r,i,a){return new sN(e,t,s,r,i,a)}getOutlines(){var f;const e=l(this,Ar),t=l(this,Gn),s=l(this,Me),[r,i,a,o]=l(this,tn),c=new Float32Array((((f=l(this,ra))==null?void 0:f.length)??0)+2);for(let m=0,p=c.length-2;m<p;m+=2)c[m]=(l(this,ra)[m]-r)/a,c[m+1]=(l(this,ra)[m+1]-i)/o;if(c[c.length-2]=(l(this,Fo)-r)/a,c[c.length-1]=(l(this,$o)-i)/o,isNaN(s[6])&&!this.isEmpty())return A(this,zt,ZA).call(this,c);const d=new Float32Array(l(this,Ar).length+24+l(this,Gn).length);let h=e.length;for(let m=0;m<h;m+=2){if(isNaN(e[m])){d[m]=d[m+1]=NaN;continue}d[m]=e[m],d[m+1]=e[m+1]}h=A(this,zt,tN).call(this,d,h);for(let m=t.length-6;m>=6;m-=6)for(let p=0;p<6;p+=2){if(isNaN(t[m+p])){d[h]=d[h+1]=NaN,h+=2;continue}d[h]=t[m+p],d[h+1]=t[m+p+1],h+=2}return A(this,zt,eN).call(this,d,h),this.newFreeDrawOutline(d,c,l(this,tn),l(this,Oc),l(this,Mc),l(this,Lc))}};tn=new WeakMap,Gn=new WeakMap,Mc=new WeakMap,Lc=new WeakMap,Ar=new WeakMap,Me=new WeakMap,Fo=new WeakMap,$o=new WeakMap,$h=new WeakMap,Bh=new WeakMap,Oc=new WeakMap,Fc=new WeakMap,ra=new WeakMap,Uh=new WeakMap,Ep=new WeakMap,Cp=new WeakMap,zt=new WeakSet,Vu=function(){const e=l(this,Me).subarray(4,6),t=l(this,Me).subarray(16,18),[s,r,i,a]=l(this,tn);return[(l(this,Fo)+(e[0]-t[0])/2-s)/i,(l(this,$o)+(e[1]-t[1])/2-r)/a,(l(this,Fo)+(t[0]-e[0])/2-s)/i,(l(this,$o)+(t[1]-e[1])/2-r)/a]},YA=function(){const[e,t,s,r]=l(this,tn),[i,a,o,c]=A(this,zt,Vu).call(this);return`M${(l(this,Me)[2]-e)/s} ${(l(this,Me)[3]-t)/r} L${(l(this,Me)[4]-e)/s} ${(l(this,Me)[5]-t)/r} L${i} ${a} L${o} ${c} L${(l(this,Me)[16]-e)/s} ${(l(this,Me)[17]-t)/r} L${(l(this,Me)[14]-e)/s} ${(l(this,Me)[15]-t)/r} Z`},JA=function(e){const t=l(this,Gn);e.push(`L${t[4]} ${t[5]} Z`)},QA=function(e){const[t,s,r,i]=l(this,tn),a=l(this,Me).subarray(4,6),o=l(this,Me).subarray(16,18),[c,d,h,f]=A(this,zt,Vu).call(this);e.push(`L${(a[0]-t)/r} ${(a[1]-s)/i} L${c} ${d} L${h} ${f} L${(o[0]-t)/r} ${(o[1]-s)/i}`)},ZA=function(e){const t=l(this,Me),[s,r,i,a]=l(this,tn),[o,c,d,h]=A(this,zt,Vu).call(this),f=new Float32Array(36);return f.set([NaN,NaN,NaN,NaN,(t[2]-s)/i,(t[3]-r)/a,NaN,NaN,NaN,NaN,(t[4]-s)/i,(t[5]-r)/a,NaN,NaN,NaN,NaN,o,c,NaN,NaN,NaN,NaN,d,h,NaN,NaN,NaN,NaN,(t[16]-s)/i,(t[17]-r)/a,NaN,NaN,NaN,NaN,(t[14]-s)/i,(t[15]-r)/a],0),this.newFreeDrawOutline(f,e,l(this,tn),l(this,Oc),l(this,Mc),l(this,Lc))},eN=function(e,t){const s=l(this,Gn);return e.set([NaN,NaN,NaN,NaN,s[4],s[5]],t),t+=6},tN=function(e,t){const s=l(this,Me).subarray(4,6),r=l(this,Me).subarray(16,18),[i,a,o,c]=l(this,tn),[d,h,f,m]=A(this,zt,Vu).call(this);return e.set([NaN,NaN,NaN,NaN,(s[0]-i)/o,(s[1]-a)/c,NaN,NaN,NaN,NaN,d,h,NaN,NaN,NaN,NaN,f,m,NaN,NaN,NaN,NaN,(r[0]-i)/o,(r[1]-a)/c],t),t+=24},S(Hr,Uh,8),S(Hr,Ep,2),S(Hr,Cp,l(Hr,Uh)+l(Hr,Ep));let cp=Hr;var $c,Bo,ci,zh,sn,Hh,Nt,jp,nN;class sN extends ue{constructor(t,s,r,i,a,o){super();S(this,jp);S(this,$c);S(this,Bo,new Float32Array(4));S(this,ci);S(this,zh);S(this,sn);S(this,Hh);S(this,Nt);v(this,Nt,t),v(this,sn,s),v(this,$c,r),v(this,Hh,i),v(this,ci,a),v(this,zh,o),this.lastPoint=[NaN,NaN],A(this,jp,nN).call(this,o);const[c,d,h,f]=l(this,Bo);for(let m=0,p=t.length;m<p;m+=2)t[m]=(t[m]-c)/h,t[m+1]=(t[m+1]-d)/f;for(let m=0,p=s.length;m<p;m+=2)s[m]=(s[m]-c)/h,s[m+1]=(s[m+1]-d)/f}toSVGPath(){const t=[`M${l(this,Nt)[4]} ${l(this,Nt)[5]}`];for(let s=6,r=l(this,Nt).length;s<r;s+=6){if(isNaN(l(this,Nt)[s])){t.push(`L${l(this,Nt)[s+4]} ${l(this,Nt)[s+5]}`);continue}t.push(`C${l(this,Nt)[s]} ${l(this,Nt)[s+1]} ${l(this,Nt)[s+2]} ${l(this,Nt)[s+3]} ${l(this,Nt)[s+4]} ${l(this,Nt)[s+5]}`)}return t.push("Z"),t.join(" ")}serialize([t,s,r,i],a){const o=r-t,c=i-s;let d,h;switch(a){case 0:d=ue._rescale(l(this,Nt),t,i,o,-c),h=ue._rescale(l(this,sn),t,i,o,-c);break;case 90:d=ue._rescaleAndSwap(l(this,Nt),t,s,o,c),h=ue._rescaleAndSwap(l(this,sn),t,s,o,c);break;case 180:d=ue._rescale(l(this,Nt),r,s,-o,c),h=ue._rescale(l(this,sn),r,s,-o,c);break;case 270:d=ue._rescaleAndSwap(l(this,Nt),r,i,-o,-c),h=ue._rescaleAndSwap(l(this,sn),r,i,-o,-c);break}return{outline:Array.from(d),points:[Array.from(h)]}}get box(){return l(this,Bo)}newOutliner(t,s,r,i,a,o=0){return new cp(t,s,r,i,a,o)}getNewOutline(t,s){const[r,i,a,o]=l(this,Bo),[c,d,h,f]=l(this,$c),m=a*h,p=o*f,g=r*h+c,y=i*f+d,N=this.newOutliner({x:l(this,sn)[0]*m+g,y:l(this,sn)[1]*p+y},l(this,$c),l(this,Hh),t,l(this,zh),s??l(this,ci));for(let b=2;b<l(this,sn).length;b+=2)N.add({x:l(this,sn)[b]*m+g,y:l(this,sn)[b+1]*p+y});return N.getOutlines()}}$c=new WeakMap,Bo=new WeakMap,ci=new WeakMap,zh=new WeakMap,sn=new WeakMap,Hh=new WeakMap,Nt=new WeakMap,jp=new WeakSet,nN=function(t){const s=l(this,Nt);let r=s[4],i=s[5],a=r,o=i,c=r,d=i,h=r,f=i;const m=t?Math.max:Math.min;for(let g=6,y=s.length;g<y;g+=6){if(isNaN(s[g]))a=Math.min(a,s[g+4]),o=Math.min(o,s[g+5]),c=Math.max(c,s[g+4]),d=Math.max(d,s[g+5]),f<s[g+5]?(h=s[g+4],f=s[g+5]):f===s[g+5]&&(h=m(h,s[g+4]));else{const N=ve.bezierBoundingBox(r,i,...s.slice(g,g+6));a=Math.min(a,N[0]),o=Math.min(o,N[1]),c=Math.max(c,N[2]),d=Math.max(d,N[3]),f<N[3]?(h=N[2],f=N[3]):f===N[3]&&(h=m(h,N[2]))}r=s[g+4],i=s[g+5]}const p=l(this,Bo);p[0]=a-l(this,ci),p[1]=o-l(this,ci),p[2]=c-a+2*l(this,ci),p[3]=d-o+2*l(this,ci),this.lastPoint=[h,f]};var qh,Wh,ia,Kn,Ts,rN,Sm,iN,aN,Jy;class Yy{constructor(e,t=0,s=0,r=!0){S(this,Ts);S(this,qh);S(this,Wh);S(this,ia,[]);S(this,Kn,[]);let i=1/0,a=-1/0,o=1/0,c=-1/0;const h=10**-4;for(const{x:b,y:x,width:_,height:w}of e){const k=Math.floor((b-t)/h)*h,C=Math.ceil((b+_+t)/h)*h,T=Math.floor((x-t)/h)*h,D=Math.ceil((x+w+t)/h)*h,B=[k,T,D,!0],ee=[C,T,D,!1];l(this,ia).push(B,ee),i=Math.min(i,k),a=Math.max(a,C),o=Math.min(o,T),c=Math.max(c,D)}const f=a-i+2*s,m=c-o+2*s,p=i-s,g=o-s,y=l(this,ia).at(r?-1:-2),N=[y[0],y[2]];for(const b of l(this,ia)){const[x,_,w]=b;b[0]=(x-p)/f,b[1]=(_-g)/m,b[2]=(w-g)/m}v(this,qh,new Float32Array([p,g,f,m])),v(this,Wh,N)}getOutlines(){l(this,ia).sort((t,s)=>t[0]-s[0]||t[1]-s[1]||t[2]-s[2]);const e=[];for(const t of l(this,ia))t[3]?(e.push(...A(this,Ts,Jy).call(this,t)),A(this,Ts,iN).call(this,t)):(A(this,Ts,aN).call(this,t),e.push(...A(this,Ts,Jy).call(this,t)));return A(this,Ts,rN).call(this,e)}}qh=new WeakMap,Wh=new WeakMap,ia=new WeakMap,Kn=new WeakMap,Ts=new WeakSet,rN=function(e){const t=[],s=new Set;for(const a of e){const[o,c,d]=a;t.push([o,c,a],[o,d,a])}t.sort((a,o)=>a[1]-o[1]||a[0]-o[0]);for(let a=0,o=t.length;a<o;a+=2){const c=t[a][2],d=t[a+1][2];c.push(d),d.push(c),s.add(c),s.add(d)}const r=[];let i;for(;s.size>0;){const a=s.values().next().value;let[o,c,d,h,f]=a;s.delete(a);let m=o,p=c;for(i=[o,d],r.push(i);;){let g;if(s.has(h))g=h;else if(s.has(f))g=f;else break;s.delete(g),[o,c,d,h,f]=g,m!==o&&(i.push(m,p,o,p===c?c:d),m=o),p=p===c?d:c}i.push(m,p)}return new MR(r,l(this,qh),l(this,Wh))},Sm=function(e){const t=l(this,Kn);let s=0,r=t.length-1;for(;s<=r;){const i=s+r>>1,a=t[i][0];if(a===e)return i;a<e?s=i+1:r=i-1}return r+1},iN=function([,e,t]){const s=A(this,Ts,Sm).call(this,e);l(this,Kn).splice(s,0,[e,t])},aN=function([,e,t]){const s=A(this,Ts,Sm).call(this,e);for(let r=s;r<l(this,Kn).length;r++){const[i,a]=l(this,Kn)[r];if(i!==e)break;if(i===e&&a===t){l(this,Kn).splice(r,1);return}}for(let r=s-1;r>=0;r--){const[i,a]=l(this,Kn)[r];if(i!==e)break;if(i===e&&a===t){l(this,Kn).splice(r,1);return}}},Jy=function(e){const[t,s,r]=e,i=[[t,s,r]],a=A(this,Ts,Sm).call(this,r);for(let o=0;o<a;o++){const[c,d]=l(this,Kn)[o];for(let h=0,f=i.length;h<f;h++){const[,m,p]=i[h];if(!(d<=m||p<=c)){if(m>=c){if(p>d)i[h][1]=d;else{if(f===1)return[];i.splice(h,1),h--,f--}continue}i[h][2]=c,p>d&&i.push([t,d,p])}}}return i};var Vh,Bc;class MR extends ue{constructor(t,s,r){super();S(this,Vh);S(this,Bc);v(this,Bc,t),v(this,Vh,s),this.lastPoint=r}toSVGPath(){const t=[];for(const s of l(this,Bc)){let[r,i]=s;t.push(`M${r} ${i}`);for(let a=2;a<s.length;a+=2){const o=s[a],c=s[a+1];o===r?(t.push(`V${c}`),i=c):c===i&&(t.push(`H${o}`),r=o)}t.push("Z")}return t.join(" ")}serialize([t,s,r,i],a){const o=[],c=r-t,d=i-s;for(const h of l(this,Bc)){const f=new Array(h.length);for(let m=0;m<h.length;m+=2)f[m]=t+h[m]*c,f[m+1]=i-h[m+1]*d;o.push(f)}return o}get box(){return l(this,Vh)}get classNamesForOutlining(){return["highlightOutline"]}}Vh=new WeakMap,Bc=new WeakMap;class Qy extends cp{newFreeDrawOutline(e,t,s,r,i,a){return new LR(e,t,s,r,i,a)}}class LR extends sN{newOutliner(e,t,s,r,i,a=0){return new Qy(e,t,s,r,i,a)}}var Xn,Uo,Uc,Ft,Gh,zc,Kh,Xh,aa,Yn,Hc,Yh,Qe,Zy,ev,tv,za,oN,Ii;const Ls=class Ls{constructor({editor:e=null,uiManager:t=null}){S(this,Qe);S(this,Xn,null);S(this,Uo,null);S(this,Uc);S(this,Ft,null);S(this,Gh,!1);S(this,zc,!1);S(this,Kh,null);S(this,Xh);S(this,aa,null);S(this,Yn,null);S(this,Hc);var s;e?(v(this,zc,!1),v(this,Hc,Be.HIGHLIGHT_COLOR),v(this,Kh,e)):(v(this,zc,!0),v(this,Hc,Be.HIGHLIGHT_DEFAULT_COLOR)),v(this,Yn,(e==null?void 0:e._uiManager)||t),v(this,Xh,l(this,Yn)._eventBus),v(this,Uc,(e==null?void 0:e.color)||((s=l(this,Yn))==null?void 0:s.highlightColors.values().next().value)||"#FFFF98"),l(Ls,Yh)||v(Ls,Yh,Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"}))}static get _keyboardManager(){return Le(this,"_keyboardManager",new mf([[["Escape","mac+Escape"],Ls.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],Ls.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],Ls.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],Ls.prototype._moveToPrevious],[["Home","mac+Home"],Ls.prototype._moveToBeginning],[["End","mac+End"],Ls.prototype._moveToEnd]]))}renderButton(){const e=v(this,Xn,document.createElement("button"));e.className="colorPicker",e.tabIndex="0",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),e.setAttribute("aria-haspopup",!0);const t=l(this,Yn)._signal;e.addEventListener("click",A(this,Qe,za).bind(this),{signal:t}),e.addEventListener("keydown",A(this,Qe,tv).bind(this),{signal:t});const s=v(this,Uo,document.createElement("span"));return s.className="swatch",s.setAttribute("aria-hidden",!0),s.style.backgroundColor=l(this,Uc),e.append(s),e}renderMainDropdown(){const e=v(this,Ft,A(this,Qe,Zy).call(this));return e.setAttribute("aria-orientation","horizontal"),e.setAttribute("aria-labelledby","highlightColorPickerLabel"),e}_colorSelectFromKeyboard(e){if(e.target===l(this,Xn)){A(this,Qe,za).call(this,e);return}const t=e.target.getAttribute("data-color");t&&A(this,Qe,ev).call(this,t,e)}_moveToNext(e){var t,s;if(!l(this,Qe,Ii)){A(this,Qe,za).call(this,e);return}if(e.target===l(this,Xn)){(t=l(this,Ft).firstChild)==null||t.focus();return}(s=e.target.nextSibling)==null||s.focus()}_moveToPrevious(e){var t,s;if(e.target===((t=l(this,Ft))==null?void 0:t.firstChild)||e.target===l(this,Xn)){l(this,Qe,Ii)&&this._hideDropdownFromKeyboard();return}l(this,Qe,Ii)||A(this,Qe,za).call(this,e),(s=e.target.previousSibling)==null||s.focus()}_moveToBeginning(e){var t;if(!l(this,Qe,Ii)){A(this,Qe,za).call(this,e);return}(t=l(this,Ft).firstChild)==null||t.focus()}_moveToEnd(e){var t;if(!l(this,Qe,Ii)){A(this,Qe,za).call(this,e);return}(t=l(this,Ft).lastChild)==null||t.focus()}hideDropdown(){var e,t;(e=l(this,Ft))==null||e.classList.add("hidden"),(t=l(this,aa))==null||t.abort(),v(this,aa,null)}_hideDropdownFromKeyboard(){var e;if(!l(this,zc)){if(!l(this,Qe,Ii)){(e=l(this,Kh))==null||e.unselect();return}this.hideDropdown(),l(this,Xn).focus({preventScroll:!0,focusVisible:l(this,Gh)})}}updateColor(e){if(l(this,Uo)&&(l(this,Uo).style.backgroundColor=e),!l(this,Ft))return;const t=l(this,Yn).highlightColors.values();for(const s of l(this,Ft).children)s.setAttribute("aria-selected",t.next().value===e)}destroy(){var e,t;(e=l(this,Xn))==null||e.remove(),v(this,Xn,null),v(this,Uo,null),(t=l(this,Ft))==null||t.remove(),v(this,Ft,null)}};Xn=new WeakMap,Uo=new WeakMap,Uc=new WeakMap,Ft=new WeakMap,Gh=new WeakMap,zc=new WeakMap,Kh=new WeakMap,Xh=new WeakMap,aa=new WeakMap,Yn=new WeakMap,Hc=new WeakMap,Yh=new WeakMap,Qe=new WeakSet,Zy=function(){const e=document.createElement("div"),t=l(this,Yn)._signal;e.addEventListener("contextmenu",ar,{signal:t}),e.className="dropdown",e.role="listbox",e.setAttribute("aria-multiselectable",!1),e.setAttribute("aria-orientation","vertical"),e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");for(const[s,r]of l(this,Yn).highlightColors){const i=document.createElement("button");i.tabIndex="0",i.role="option",i.setAttribute("data-color",r),i.title=s,i.setAttribute("data-l10n-id",l(Ls,Yh)[s]);const a=document.createElement("span");i.append(a),a.className="swatch",a.style.backgroundColor=r,i.setAttribute("aria-selected",r===l(this,Uc)),i.addEventListener("click",A(this,Qe,ev).bind(this,r),{signal:t}),e.append(i)}return e.addEventListener("keydown",A(this,Qe,tv).bind(this),{signal:t}),e},ev=function(e,t){t.stopPropagation(),l(this,Xh).dispatch("switchannotationeditorparams",{source:this,type:l(this,Hc),value:e})},tv=function(e){Ls._keyboardManager.exec(this,e)},za=function(e){if(l(this,Qe,Ii)){this.hideDropdown();return}if(v(this,Gh,e.detail===0),l(this,aa)||(v(this,aa,new AbortController),window.addEventListener("pointerdown",A(this,Qe,oN).bind(this),{signal:l(this,Yn).combinedSignal(l(this,aa))})),l(this,Ft)){l(this,Ft).classList.remove("hidden");return}const t=v(this,Ft,A(this,Qe,Zy).call(this));l(this,Xn).append(t)},oN=function(e){var t;(t=l(this,Ft))!=null&&t.contains(e.target)||this.hideDropdown()},Ii=function(){return l(this,Ft)&&!l(this,Ft).classList.contains("hidden")},S(Ls,Yh,null);let up=Ls;var qc,Jh,ui,zo,Wc,$s,Qh,Zh,Ho,_n,nn,Zt,Vc,di,fs,Gc,Sn,ef,Re,sv,Am,lN,cN,uN,nv,Ha,jn,jl,dN,Nm,Gu,hN,fN,mN,pN,gN;const We=class We extends vt{constructor(t){super({...t,name:"highlightEditor"});S(this,Re);S(this,qc,null);S(this,Jh,0);S(this,ui);S(this,zo,null);S(this,Wc,null);S(this,$s,null);S(this,Qh,null);S(this,Zh,0);S(this,Ho,null);S(this,_n,null);S(this,nn,null);S(this,Zt,!1);S(this,Vc,null);S(this,di);S(this,fs,null);S(this,Gc,"");S(this,Sn);S(this,ef,"");this.color=t.color||We._defaultColor,v(this,Sn,t.thickness||We._defaultThickness),v(this,di,t.opacity||We._defaultOpacity),v(this,ui,t.boxes||null),v(this,ef,t.methodOfCreation||""),v(this,Gc,t.text||""),this._isDraggable=!1,t.highlightId>-1?(v(this,Zt,!0),A(this,Re,Am).call(this,t),A(this,Re,Ha).call(this)):l(this,ui)&&(v(this,qc,t.anchorNode),v(this,Jh,t.anchorOffset),v(this,Qh,t.focusNode),v(this,Zh,t.focusOffset),A(this,Re,sv).call(this),A(this,Re,Ha).call(this),this.rotate(this.rotation))}static get _keyboardManager(){const t=We.prototype;return Le(this,"_keyboardManager",new mf([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}get telemetryInitialData(){return{action:"added",type:l(this,Zt)?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:l(this,Sn),methodOfCreation:l(this,ef)}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}static initialize(t,s){var r;vt.initialize(t,s),We._defaultColor||(We._defaultColor=((r=s.highlightColors)==null?void 0:r.values().next().value)||"#fff066")}static updateDefaultParams(t,s){switch(t){case Be.HIGHLIGHT_DEFAULT_COLOR:We._defaultColor=s;break;case Be.HIGHLIGHT_THICKNESS:We._defaultThickness=s;break}}translateInPage(t,s){}get toolbarPosition(){return l(this,Vc)}updateParams(t,s){switch(t){case Be.HIGHLIGHT_COLOR:A(this,Re,lN).call(this,s);break;case Be.HIGHLIGHT_THICKNESS:A(this,Re,cN).call(this,s);break}}static get defaultPropertiesToUpdate(){return[[Be.HIGHLIGHT_DEFAULT_COLOR,We._defaultColor],[Be.HIGHLIGHT_THICKNESS,We._defaultThickness]]}get propertiesToUpdate(){return[[Be.HIGHLIGHT_COLOR,this.color||We._defaultColor],[Be.HIGHLIGHT_THICKNESS,l(this,Sn)||We._defaultThickness],[Be.HIGHLIGHT_FREE,l(this,Zt)]]}async addEditToolbar(){const t=await super.addEditToolbar();return t?(this._uiManager.highlightColors&&(v(this,Wc,new up({editor:this})),t.addColorPicker(l(this,Wc))),t):null}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(A(this,Re,Gu).call(this))}getBaseTranslation(){return[0,0]}getRect(t,s){return super.getRect(t,s,A(this,Re,Gu).call(this))}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),t&&this.div.focus()}remove(){A(this,Re,nv).call(this),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(A(this,Re,Ha).call(this),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var r;let s=!1;this.parent&&!t?A(this,Re,nv).call(this):t&&(A(this,Re,Ha).call(this,t),s=!this.parent&&((r=this.div)==null?void 0:r.classList.contains("selectedEditor"))),super.setParent(t),this.show(this._isVisible),s&&this.select()}rotate(t){var i,a,o;const{drawLayer:s}=this.parent;let r;l(this,Zt)?(t=(t-this.rotation+360)%360,r=A(i=We,jn,jl).call(i,l(this,_n).box,t)):r=A(a=We,jn,jl).call(a,[this.x,this.y,this.width,this.height],t),s.updateProperties(l(this,nn),{bbox:r,root:{"data-main-rotation":t}}),s.updateProperties(l(this,fs),{bbox:A(o=We,jn,jl).call(o,l(this,$s).box,t),root:{"data-main-rotation":t}})}render(){if(this.div)return this.div;const t=super.render();l(this,Gc)&&(t.setAttribute("aria-label",l(this,Gc)),t.setAttribute("role","mark")),l(this,Zt)?t.classList.add("free"):this.div.addEventListener("keydown",A(this,Re,dN).bind(this),{signal:this._uiManager._signal});const s=v(this,Ho,document.createElement("div"));t.append(s),s.setAttribute("aria-hidden","true"),s.className="internal",s.style.clipPath=l(this,zo);const[r,i]=this.parentDimensions;return this.setDims(this.width*r,this.height*i),ap(this,l(this,Ho),["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(l(this,fs),{rootClass:{hovered:!0}})}pointerleave(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(l(this,fs),{rootClass:{hovered:!1}})}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:A(this,Re,Nm).call(this,!0);break;case 1:case 3:A(this,Re,Nm).call(this,!1);break}}select(){var t;super.select(),l(this,fs)&&((t=this.parent)==null||t.drawLayer.updateProperties(l(this,fs),{rootClass:{hovered:!1,selected:!0}}))}unselect(){var t;super.unselect(),l(this,fs)&&((t=this.parent)==null||t.drawLayer.updateProperties(l(this,fs),{rootClass:{selected:!1}}),l(this,Zt)||A(this,Re,Nm).call(this,!1))}get _mustFixPosition(){return!l(this,Zt)}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.updateProperties(l(this,nn),{rootClass:{hidden:!t}}),this.parent.drawLayer.updateProperties(l(this,fs),{rootClass:{hidden:!t}}))}static startHighlighting(t,s,{target:r,x:i,y:a}){const{x:o,y:c,width:d,height:h}=r.getBoundingClientRect(),f=new AbortController,m=t.combinedSignal(f),p=g=>{f.abort(),A(this,jn,pN).call(this,t,g)};window.addEventListener("blur",p,{signal:m}),window.addEventListener("pointerup",p,{signal:m}),window.addEventListener("pointerdown",dn,{capture:!0,passive:!1,signal:m}),window.addEventListener("contextmenu",ar,{signal:m}),r.addEventListener("pointermove",A(this,jn,mN).bind(this,t),{signal:m}),this._freeHighlight=new Qy({x:i,y:a},[o,c,d,h],t.scale,this._defaultThickness/2,s,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static async deserialize(t,s,r){var y,N,b,x;let i=null;if(t instanceof zA){const{data:{quadPoints:_,rect:w,rotation:k,id:C,color:T,opacity:D,popupRef:B},parent:{page:{pageNumber:ee}}}=t;i=t={annotationType:Ie.HIGHLIGHT,color:Array.from(T),opacity:D,quadPoints:_,boxes:null,pageIndex:ee-1,rect:w.slice(0),rotation:k,id:C,deleted:!1,popupRef:B}}else if(t instanceof Rb){const{data:{inkLists:_,rect:w,rotation:k,id:C,color:T,borderStyle:{rawWidth:D},popupRef:B},parent:{page:{pageNumber:ee}}}=t;i=t={annotationType:Ie.HIGHLIGHT,color:Array.from(T),thickness:D,inkLists:_,boxes:null,pageIndex:ee-1,rect:w.slice(0),rotation:k,id:C,deleted:!1,popupRef:B}}const{color:a,quadPoints:o,inkLists:c,opacity:d}=t,h=await super.deserialize(t,s,r);h.color=ve.makeHexColor(...a),v(h,di,d||1),c&&v(h,Sn,t.thickness),h.annotationElementId=t.id||null,h._initialData=i;const[f,m]=h.pageDimensions,[p,g]=h.pageTranslation;if(o){const _=v(h,ui,[]);for(let w=0;w<o.length;w+=8)_.push({x:(o[w]-p)/f,y:1-(o[w+1]-g)/m,width:(o[w+2]-o[w])/f,height:(o[w+1]-o[w+5])/m});A(y=h,Re,sv).call(y),A(N=h,Re,Ha).call(N),h.rotate(h.rotation)}else if(c){v(h,Zt,!0);const _=c[0],w={x:_[0]-p,y:m-(_[1]-g)},k=new Qy(w,[0,0,f,m],1,l(h,Sn)/2,!0,.001);for(let D=0,B=_.length;D<B;D+=2)w.x=_[D]-p,w.y=m-(_[D+1]-g),k.add(w);const{id:C,clipPathId:T}=s.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:h.color,"fill-opacity":h._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:k.toSVGPath()}},!0,!0);A(b=h,Re,Am).call(b,{highlightOutlines:k.getOutlines(),highlightId:C,clipPathId:T}),A(x=h,Re,Ha).call(x)}return h}serialize(t=!1){if(this.isEmpty()||t)return null;if(this.deleted)return this.serializeDeleted();const s=this.getRect(0,0),r=vt._colorManager.convert(this.color),i={annotationType:Ie.HIGHLIGHT,color:r,opacity:l(this,di),thickness:l(this,Sn),quadPoints:A(this,Re,hN).call(this),outlines:A(this,Re,fN).call(this,s),pageIndex:this.pageIndex,rect:s,rotation:A(this,Re,Gu).call(this),structTreeParentId:this._structTreeParentId};return this.annotationElementId&&!A(this,Re,gN).call(this,i)?null:(i.id=this.annotationElementId,i)}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};qc=new WeakMap,Jh=new WeakMap,ui=new WeakMap,zo=new WeakMap,Wc=new WeakMap,$s=new WeakMap,Qh=new WeakMap,Zh=new WeakMap,Ho=new WeakMap,_n=new WeakMap,nn=new WeakMap,Zt=new WeakMap,Vc=new WeakMap,di=new WeakMap,fs=new WeakMap,Gc=new WeakMap,Sn=new WeakMap,ef=new WeakMap,Re=new WeakSet,sv=function(){const t=new Yy(l(this,ui),.001);v(this,_n,t.getOutlines()),[this.x,this.y,this.width,this.height]=l(this,_n).box;const s=new Yy(l(this,ui),.0025,.001,this._uiManager.direction==="ltr");v(this,$s,s.getOutlines());const{lastPoint:r}=l(this,$s);v(this,Vc,[(r[0]-this.x)/this.width,(r[1]-this.y)/this.height])},Am=function({highlightOutlines:t,highlightId:s,clipPathId:r}){var f,m;if(v(this,_n,t),v(this,$s,t.getNewOutline(l(this,Sn)/2+1.5,.0025)),s>=0)v(this,nn,s),v(this,zo,r),this.parent.drawLayer.finalizeDraw(s,{bbox:t.box,path:{d:t.toSVGPath()}}),v(this,fs,this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:l(this,$s).box,path:{d:l(this,$s).toSVGPath()}},!0));else if(this.parent){const p=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(l(this,nn),{bbox:A(f=We,jn,jl).call(f,l(this,_n).box,(p-this.rotation+360)%360),path:{d:t.toSVGPath()}}),this.parent.drawLayer.updateProperties(l(this,fs),{bbox:A(m=We,jn,jl).call(m,l(this,$s).box,p),path:{d:l(this,$s).toSVGPath()}})}const[a,o,c,d]=t.box;switch(this.rotation){case 0:this.x=a,this.y=o,this.width=c,this.height=d;break;case 90:{const[p,g]=this.parentDimensions;this.x=o,this.y=1-a,this.width=c*g/p,this.height=d*p/g;break}case 180:this.x=1-a,this.y=1-o,this.width=c,this.height=d;break;case 270:{const[p,g]=this.parentDimensions;this.x=1-o,this.y=a,this.width=c*g/p,this.height=d*p/g;break}}const{lastPoint:h}=l(this,$s);v(this,Vc,[(h[0]-a)/c,(h[1]-o)/d])},lN=function(t){const s=(a,o)=>{var c,d;this.color=a,v(this,di,o),(c=this.parent)==null||c.drawLayer.updateProperties(l(this,nn),{root:{fill:a,"fill-opacity":o}}),(d=l(this,Wc))==null||d.updateColor(a)},r=this.color,i=l(this,di);this.addCommands({cmd:s.bind(this,t,We._defaultOpacity),undo:s.bind(this,r,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Be.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(t)},!0)},cN=function(t){const s=l(this,Sn),r=i=>{v(this,Sn,i),A(this,Re,uN).call(this,i)};this.addCommands({cmd:r.bind(this,t),undo:r.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Be.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)},uN=function(t){if(!l(this,Zt))return;A(this,Re,Am).call(this,{highlightOutlines:l(this,_n).getNewOutline(t/2)}),this.fixAndSetPosition();const[s,r]=this.parentDimensions;this.setDims(this.width*s,this.height*r)},nv=function(){l(this,nn)===null||!this.parent||(this.parent.drawLayer.remove(l(this,nn)),v(this,nn,null),this.parent.drawLayer.remove(l(this,fs)),v(this,fs,null))},Ha=function(t=this.parent){l(this,nn)===null&&({id:bs(this,nn)._,clipPathId:bs(this,zo)._}=t.drawLayer.draw({bbox:l(this,_n).box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":l(this,di)},rootClass:{highlight:!0,free:l(this,Zt)},path:{d:l(this,_n).toSVGPath()}},!1,!0),v(this,fs,t.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:l(this,Zt)},bbox:l(this,$s).box,path:{d:l(this,$s).toSVGPath()}},l(this,Zt))),l(this,Ho)&&(l(this,Ho).style.clipPath=l(this,zo)))},jn=new WeakSet,jl=function([t,s,r,i],a){switch(a){case 90:return[1-s-i,t,i,r];case 180:return[1-t-r,1-s-i,r,i];case 270:return[s,1-t-r,i,r]}return[t,s,r,i]},dN=function(t){We._keyboardManager.exec(this,t)},Nm=function(t){if(!l(this,qc))return;const s=window.getSelection();t?s.setPosition(l(this,qc),l(this,Jh)):s.setPosition(l(this,Qh),l(this,Zh))},Gu=function(){return l(this,Zt)?this.rotation:0},hN=function(){if(l(this,Zt))return null;const[t,s]=this.pageDimensions,[r,i]=this.pageTranslation,a=l(this,ui),o=new Float32Array(a.length*8);let c=0;for(const{x:d,y:h,width:f,height:m}of a){const p=d*t+r,g=(1-h)*s+i;o[c]=o[c+4]=p,o[c+1]=o[c+3]=g,o[c+2]=o[c+6]=p+f*t,o[c+5]=o[c+7]=g-m*s,c+=8}return o},fN=function(t){return l(this,_n).serialize(t,A(this,Re,Gu).call(this))},mN=function(t,s){this._freeHighlight.add(s)&&t.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})},pN=function(t,s){this._freeHighlight.isEmpty()?t.drawLayer.remove(this._freeHighlightId):t.createAndAddNewEditor(s,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""},gN=function(t){const{color:s}=this._initialData;return t.color.some((r,i)=>r!==s[i])},S(We,jn),xe(We,"_defaultColor",null),xe(We,"_defaultOpacity",1),xe(We,"_defaultThickness",12),xe(We,"_type","highlight"),xe(We,"_editorType",Ie.HIGHLIGHT),xe(We,"_freeHighlightId",-1),xe(We,"_freeHighlight",null),xe(We,"_freeHighlightClipId","");let dp=We;var qo;class OR{constructor(){S(this,qo,Object.create(null))}updateProperty(e,t){this[e]=t,this.updateSVGProperty(e,t)}updateProperties(e){if(e)for(const[t,s]of Object.entries(e))this.updateProperty(t,s)}updateSVGProperty(e,t){l(this,qo)[e]=t}toSVGProperties(){const e=l(this,qo);return v(this,qo,Object.create(null)),{root:e}}reset(){v(this,qo,Object.create(null))}updateAll(e=this){this.updateProperties(e)}clone(){st("Not implemented")}}qo=new WeakMap;var rn,Kc,Vt,Wo,Vo,oa,la,ca,Go,ze,iv,av,ov,Ku,yN,km,Xu,Tl;const fe=class fe extends vt{constructor(t){super(t);S(this,ze);S(this,rn,null);S(this,Kc);xe(this,"_drawId",null);v(this,Kc,t.mustBeCommitted||!1),t.drawOutlines&&(A(this,ze,iv).call(this,t),A(this,ze,Ku).call(this))}static _mergeSVGProperties(t,s){const r=new Set(Object.keys(t));for(const[i,a]of Object.entries(s))r.has(i)?Object.assign(t[i],a):t[i]=a;return t}static getDefaultDrawingOptions(t){st("Not implemented")}static get typesMap(){st("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,s){const r=this.typesMap.get(t);r&&this._defaultDrawingOptions.updateProperty(r,s),this._currentParent&&(l(fe,Vt).updateProperty(r,s),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(t,s){const r=this.constructor.typesMap.get(t);r&&this._updateProperty(t,r,s)}static get defaultPropertiesToUpdate(){const t=[],s=this._defaultDrawingOptions;for(const[r,i]of this.typesMap)t.push([r,s[i]]);return t}get propertiesToUpdate(){const t=[],{_drawingOptions:s}=this;for(const[r,i]of this.constructor.typesMap)t.push([r,s[i]]);return t}_updateProperty(t,s,r){const i=this._drawingOptions,a=i[s],o=c=>{var h;i.updateProperty(s,c);const d=l(this,rn).updateProperty(s,c);d&&A(this,ze,Xu).call(this,d),(h=this.parent)==null||h.drawLayer.updateProperties(this._drawId,i.toSVGProperties())};this.addCommands({cmd:o.bind(this,r),undo:o.bind(this,a),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,fe._mergeSVGProperties(l(this,rn).getPathResizingSVGProperties(A(this,ze,km).call(this)),{bbox:A(this,ze,Tl).call(this)}))}_onResized(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,fe._mergeSVGProperties(l(this,rn).getPathResizedSVGProperties(A(this,ze,km).call(this)),{bbox:A(this,ze,Tl).call(this)}))}_onTranslating(t,s){var r;(r=this.parent)==null||r.drawLayer.updateProperties(this._drawId,{bbox:A(this,ze,Tl).call(this,t,s)})}_onTranslated(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,fe._mergeSVGProperties(l(this,rn).getPathTranslatedSVGProperties(A(this,ze,km).call(this),this.parentDimensions),{bbox:A(this,ze,Tl).call(this)}))}_onStartDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,l(this,Kc)&&(v(this,Kc,!1),this.commit(),this.parent.setSelected(this),t&&this.isOnScreen&&this.div.focus())}remove(){A(this,ze,ov).call(this),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(A(this,ze,Ku).call(this),A(this,ze,Xu).call(this,l(this,rn).box),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var r;let s=!1;this.parent&&!t?(this._uiManager.removeShouldRescale(this),A(this,ze,ov).call(this)):t&&(this._uiManager.addShouldRescale(this),A(this,ze,Ku).call(this,t),s=!this.parent&&((r=this.div)==null?void 0:r.classList.contains("selectedEditor"))),super.setParent(t),s&&this.select()}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,fe._mergeSVGProperties({bbox:A(this,ze,Tl).call(this)},l(this,rn).updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&A(this,ze,Xu).call(this,l(this,rn).updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;const t=super.render();t.classList.add("draw");const s=document.createElement("div");t.append(s),s.setAttribute("aria-hidden","true"),s.className="internal";const[r,i]=this.parentDimensions;return this.setDims(this.width*r,this.height*i),this._uiManager.addShouldRescale(this),this.disableEditing(),t}static createDrawerInstance(t,s,r,i,a){st("Not implemented")}static startDrawing(t,s,r,i){var N;const{target:a,offsetX:o,offsetY:c,pointerId:d,pointerType:h}=i;if(l(fe,la)&&l(fe,la)!==h)return;const{viewport:{rotation:f}}=t,{width:m,height:p}=a.getBoundingClientRect(),g=v(fe,Wo,new AbortController),y=t.combinedSignal(g);if(l(fe,oa)||v(fe,oa,d),l(fe,la)??v(fe,la,h),window.addEventListener("pointerup",b=>{var x;l(fe,oa)===b.pointerId?this._endDraw(b):(x=l(fe,ca))==null||x.delete(b.pointerId)},{signal:y}),window.addEventListener("pointercancel",b=>{var x;l(fe,oa)===b.pointerId?this._currentParent.endDrawingSession():(x=l(fe,ca))==null||x.delete(b.pointerId)},{signal:y}),window.addEventListener("pointerdown",b=>{l(fe,la)===b.pointerType&&((l(fe,ca)||v(fe,ca,new Set)).add(b.pointerId),l(fe,Vt).isCancellable()&&(l(fe,Vt).removeLastElement(),l(fe,Vt).isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:y}),window.addEventListener("contextmenu",ar,{signal:y}),a.addEventListener("pointermove",this._drawMove.bind(this),{signal:y}),a.addEventListener("touchmove",b=>{b.timeStamp===l(fe,Go)&&dn(b)},{signal:y}),t.toggleDrawing(),(N=s._editorUndoBar)==null||N.hide(),l(fe,Vt)){t.drawLayer.updateProperties(this._currentDrawId,l(fe,Vt).startNew(o,c,m,p,f));return}s.updateUIForDefaultProperties(this),v(fe,Vt,this.createDrawerInstance(o,c,m,p,f)),v(fe,Vo,this.getDefaultDrawingOptions()),this._currentParent=t,{id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(l(fe,Vo).toSVGProperties(),l(fe,Vt).defaultSVGProperties),!0,!1)}static _drawMove(t){var a;if(v(fe,Go,-1),!l(fe,Vt))return;const{offsetX:s,offsetY:r,pointerId:i}=t;if(l(fe,oa)===i){if(((a=l(fe,ca))==null?void 0:a.size)>=1){this._endDraw(t);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,l(fe,Vt).add(s,r)),v(fe,Go,t.timeStamp),dn(t)}}static _cleanup(t){t&&(this._currentDrawId=-1,this._currentParent=null,v(fe,Vt,null),v(fe,Vo,null),v(fe,la,null),v(fe,Go,NaN)),l(fe,Wo)&&(l(fe,Wo).abort(),v(fe,Wo,null),v(fe,oa,NaN),v(fe,ca,null))}static _endDraw(t){const s=this._currentParent;if(s){if(s.toggleDrawing(!0),this._cleanup(!1),t&&s.drawLayer.updateProperties(this._currentDrawId,l(fe,Vt).end(t.offsetX,t.offsetY)),this.supportMultipleDrawings){const r=l(fe,Vt),i=this._currentDrawId,a=r.getLastElement();s.addCommands({cmd:()=>{s.drawLayer.updateProperties(i,r.setLastElement(a))},undo:()=>{s.drawLayer.updateProperties(i,r.removeLastElement())},mustExec:!1,type:Be.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(t){const s=this._currentParent;if(!s)return null;if(s.toggleDrawing(!0),s.cleanUndoStack(Be.DRAW_STEP),!l(fe,Vt).isEmpty()){const{pageDimensions:[r,i],scale:a}=s,o=s.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:l(fe,Vt).getOutlines(r*a,i*a,a,this._INNER_MARGIN),drawingOptions:l(fe,Vo),mustBeCommitted:!t});return this._cleanup(!0),o}return s.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(t){}static deserializeDraw(t,s,r,i,a,o){st("Not implemented")}static async deserialize(t,s,r){var f,m;const{rawDims:{pageWidth:i,pageHeight:a,pageX:o,pageY:c}}=s.viewport,d=this.deserializeDraw(o,c,i,a,this._INNER_MARGIN,t),h=await super.deserialize(t,s,r);return h.createDrawingOptions(t),A(f=h,ze,iv).call(f,{drawOutlines:d}),A(m=h,ze,Ku).call(m),h.onScaleChanging(),h.rotate(),h}serializeDraw(t){const[s,r]=this.pageTranslation,[i,a]=this.pageDimensions;return l(this,rn).serialize([s,r,i,a],t)}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};rn=new WeakMap,Kc=new WeakMap,Vt=new WeakMap,Wo=new WeakMap,Vo=new WeakMap,oa=new WeakMap,la=new WeakMap,ca=new WeakMap,Go=new WeakMap,ze=new WeakSet,iv=function({drawOutlines:t,drawId:s,drawingOptions:r}){v(this,rn,t),this._drawingOptions||(this._drawingOptions=r),s>=0?(this._drawId=s,this.parent.drawLayer.finalizeDraw(s,t.defaultProperties)):this._drawId=A(this,ze,av).call(this,t,this.parent),A(this,ze,Xu).call(this,t.box)},av=function(t,s){const{id:r}=s.drawLayer.draw(fe._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1);return r},ov=function(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())},Ku=function(t=this.parent){if(!(this._drawId!==null&&this.parent===t)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,t.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=A(this,ze,av).call(this,l(this,rn),t)}},yN=function([t,s,r,i]){const{parentDimensions:[a,o],rotation:c}=this;switch(c){case 90:return[s,1-t,r*(o/a),i*(a/o)];case 180:return[1-t,1-s,r,i];case 270:return[1-s,t,r*(o/a),i*(a/o)];default:return[t,s,r,i]}},km=function(){const{x:t,y:s,width:r,height:i,parentDimensions:[a,o],rotation:c}=this;switch(c){case 90:return[1-s,t,r*(a/o),i*(o/a)];case 180:return[1-t,1-s,r,i];case 270:return[s,1-t,r*(a/o),i*(o/a)];default:return[t,s,r,i]}},Xu=function(t){if([this.x,this.y,this.width,this.height]=A(this,ze,yN).call(this,t),this.div){this.fixAndSetPosition();const[s,r]=this.parentDimensions;this.setDims(this.width*s,this.height*r)}this._onResized()},Tl=function(){const{x:t,y:s,width:r,height:i,rotation:a,parentRotation:o,parentDimensions:[c,d]}=this;switch((a*4+o)/90){case 1:return[1-s-i,t,i,r];case 2:return[1-t-r,1-s-i,r,i];case 3:return[s,1-t-r,i,r];case 4:return[t,s-r*(c/d),i*(d/c),r*(c/d)];case 5:return[1-s,t,r*(c/d),i*(d/c)];case 6:return[1-t-i*(d/c),1-s,i*(d/c),r*(c/d)];case 7:return[s-r*(c/d),1-t-i*(d/c),r*(c/d),i*(d/c)];case 8:return[t-r,s-i,r,i];case 9:return[1-s,t-r,i,r];case 10:return[1-t,1-s,r,i];case 11:return[s-i,1-t,i,r];case 12:return[t-i*(d/c),s,i*(d/c),r*(c/d)];case 13:return[1-s-r*(c/d),t-i*(d/c),r*(c/d),i*(d/c)];case 14:return[1-t,1-s-r*(c/d),i*(d/c),r*(c/d)];case 15:return[s,1-t,r*(c/d),i*(d/c)];default:return[t,s,r,i]}},xe(fe,"_currentDrawId",-1),xe(fe,"_currentParent",null),S(fe,Vt,null),S(fe,Wo,null),S(fe,Vo,null),S(fe,oa,NaN),S(fe,la,null),S(fe,ca,null),S(fe,Go,NaN),xe(fe,"_INNER_MARGIN",3);let rv=fe;var Nr,Gt,Kt,Ko,Xc,Ss,es,An,Xo,Yo,Jo,Yc,Em;class FR{constructor(e,t,s,r,i,a){S(this,Yc);S(this,Nr,new Float64Array(6));S(this,Gt);S(this,Kt);S(this,Ko);S(this,Xc);S(this,Ss);S(this,es,"");S(this,An,0);S(this,Xo,new hp);S(this,Yo);S(this,Jo);v(this,Yo,s),v(this,Jo,r),v(this,Ko,i),v(this,Xc,a),[e,t]=A(this,Yc,Em).call(this,e,t);const o=v(this,Gt,[NaN,NaN,NaN,NaN,e,t]);v(this,Ss,[e,t]),v(this,Kt,[{line:o,points:l(this,Ss)}]),l(this,Nr).set(o,0)}updateProperty(e,t){e==="stroke-width"&&v(this,Xc,t)}isEmpty(){return!l(this,Kt)||l(this,Kt).length===0}isCancellable(){return l(this,Ss).length<=10}add(e,t){[e,t]=A(this,Yc,Em).call(this,e,t);const[s,r,i,a]=l(this,Nr).subarray(2,6),o=e-i,c=t-a;return Math.hypot(l(this,Yo)*o,l(this,Jo)*c)<=2?null:(l(this,Ss).push(e,t),isNaN(s)?(l(this,Nr).set([i,a,e,t],2),l(this,Gt).push(NaN,NaN,NaN,NaN,e,t),{path:{d:this.toSVGPath()}}):(isNaN(l(this,Nr)[0])&&l(this,Gt).splice(6,6),l(this,Nr).set([s,r,i,a,e,t],0),l(this,Gt).push(...ue.createBezierPoints(s,r,i,a,e,t)),{path:{d:this.toSVGPath()}}))}end(e,t){const s=this.add(e,t);return s||(l(this,Ss).length===2?{path:{d:this.toSVGPath()}}:null)}startNew(e,t,s,r,i){v(this,Yo,s),v(this,Jo,r),v(this,Ko,i),[e,t]=A(this,Yc,Em).call(this,e,t);const a=v(this,Gt,[NaN,NaN,NaN,NaN,e,t]);v(this,Ss,[e,t]);const o=l(this,Kt).at(-1);return o&&(o.line=new Float32Array(o.line),o.points=new Float32Array(o.points)),l(this,Kt).push({line:a,points:l(this,Ss)}),l(this,Nr).set(a,0),v(this,An,0),this.toSVGPath(),null}getLastElement(){return l(this,Kt).at(-1)}setLastElement(e){return l(this,Kt)?(l(this,Kt).push(e),v(this,Gt,e.line),v(this,Ss,e.points),v(this,An,0),{path:{d:this.toSVGPath()}}):l(this,Xo).setLastElement(e)}removeLastElement(){if(!l(this,Kt))return l(this,Xo).removeLastElement();l(this,Kt).pop(),v(this,es,"");for(let e=0,t=l(this,Kt).length;e<t;e++){const{line:s,points:r}=l(this,Kt)[e];v(this,Gt,s),v(this,Ss,r),v(this,An,0),this.toSVGPath()}return{path:{d:l(this,es)}}}toSVGPath(){const e=ue.svgRound(l(this,Gt)[4]),t=ue.svgRound(l(this,Gt)[5]);if(l(this,Ss).length===2)return v(this,es,`${l(this,es)} M ${e} ${t} Z`),l(this,es);if(l(this,Ss).length<=6){const r=l(this,es).lastIndexOf("M");v(this,es,`${l(this,es).slice(0,r)} M ${e} ${t}`),v(this,An,6)}if(l(this,Ss).length===4){const r=ue.svgRound(l(this,Gt)[10]),i=ue.svgRound(l(this,Gt)[11]);return v(this,es,`${l(this,es)} L ${r} ${i}`),v(this,An,12),l(this,es)}const s=[];l(this,An)===0&&(s.push(`M ${e} ${t}`),v(this,An,6));for(let r=l(this,An),i=l(this,Gt).length;r<i;r+=6){const[a,o,c,d,h,f]=l(this,Gt).slice(r,r+6).map(ue.svgRound);s.push(`C${a} ${o} ${c} ${d} ${h} ${f}`)}return v(this,es,l(this,es)+s.join(" ")),v(this,An,l(this,Gt).length),l(this,es)}getOutlines(e,t,s,r){const i=l(this,Kt).at(-1);return i.line=new Float32Array(i.line),i.points=new Float32Array(i.points),l(this,Xo).build(l(this,Kt),e,t,s,l(this,Ko),l(this,Xc),r),v(this,Nr,null),v(this,Gt,null),v(this,Kt,null),v(this,es,null),l(this,Xo)}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}Nr=new WeakMap,Gt=new WeakMap,Kt=new WeakMap,Ko=new WeakMap,Xc=new WeakMap,Ss=new WeakMap,es=new WeakMap,An=new WeakMap,Xo=new WeakMap,Yo=new WeakMap,Jo=new WeakMap,Yc=new WeakSet,Em=function(e,t){return ue._normalizePoint(e,t,l(this,Yo),l(this,Jo),l(this,Ko))};var As,tf,sf,an,kr,Er,Jc,Qc,Zc,ns,$r,vN,bN,xN;const Lb=class Lb extends ue{constructor(){super(...arguments);S(this,ns);S(this,As);S(this,tf,0);S(this,sf);S(this,an);S(this,kr);S(this,Er);S(this,Jc);S(this,Qc);S(this,Zc)}build(t,s,r,i,a,o,c){v(this,kr,s),v(this,Er,r),v(this,Jc,i),v(this,Qc,a),v(this,Zc,o),v(this,sf,c??0),v(this,an,t),A(this,ns,bN).call(this)}setLastElement(t){return l(this,an).push(t),{path:{d:this.toSVGPath()}}}removeLastElement(){return l(this,an).pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const t=[];for(const{line:s}of l(this,an)){if(t.push(`M${ue.svgRound(s[4])} ${ue.svgRound(s[5])}`),s.length===6){t.push("Z");continue}if(s.length===12){t.push(`L${ue.svgRound(s[10])} ${ue.svgRound(s[11])}`);continue}for(let r=6,i=s.length;r<i;r+=6){const[a,o,c,d,h,f]=s.subarray(r,r+6).map(ue.svgRound);t.push(`C${a} ${o} ${c} ${d} ${h} ${f}`)}}return t.join("")}serialize([t,s,r,i],a){const o=[],c=[],[d,h,f,m]=A(this,ns,vN).call(this);let p,g,y,N,b,x,_,w,k;switch(l(this,Qc)){case 0:k=ue._rescale,p=t,g=s+i,y=r,N=-i,b=t+d*r,x=s+(1-h-m)*i,_=t+(d+f)*r,w=s+(1-h)*i;break;case 90:k=ue._rescaleAndSwap,p=t,g=s,y=r,N=i,b=t+h*r,x=s+d*i,_=t+(h+m)*r,w=s+(d+f)*i;break;case 180:k=ue._rescale,p=t+r,g=s,y=-r,N=i,b=t+(1-d-f)*r,x=s+h*i,_=t+(1-d)*r,w=s+(h+m)*i;break;case 270:k=ue._rescaleAndSwap,p=t+r,g=s+i,y=-r,N=-i,b=t+(1-h-m)*r,x=s+(1-d-f)*i,_=t+(1-h)*r,w=s+(1-d)*i;break}for(const{line:C,points:T}of l(this,an))o.push(k(C,p,g,y,N,a?new Array(C.length):null)),c.push(k(T,p,g,y,N,a?new Array(T.length):null));return{lines:o,points:c,rect:[b,x,_,w]}}static deserialize(t,s,r,i,a,{paths:{lines:o,points:c},rotation:d,thickness:h}){const f=[];let m,p,g,y,N;switch(d){case 0:N=ue._rescale,m=-t/r,p=s/i+1,g=1/r,y=-1/i;break;case 90:N=ue._rescaleAndSwap,m=-s/i,p=-t/r,g=1/i,y=1/r;break;case 180:N=ue._rescale,m=t/r+1,p=-s/i,g=-1/r,y=1/i;break;case 270:N=ue._rescaleAndSwap,m=s/i+1,p=t/r+1,g=-1/i,y=-1/r;break}if(!o){o=[];for(const x of c){const _=x.length;if(_===2){o.push(new Float32Array([NaN,NaN,NaN,NaN,x[0],x[1]]));continue}if(_===4){o.push(new Float32Array([NaN,NaN,NaN,NaN,x[0],x[1],NaN,NaN,NaN,NaN,x[2],x[3]]));continue}const w=new Float32Array(3*(_-2));o.push(w);let[k,C,T,D]=x.subarray(0,4);w.set([NaN,NaN,NaN,NaN,k,C],0);for(let B=4;B<_;B+=2){const ee=x[B],M=x[B+1];w.set(ue.createBezierPoints(k,C,T,D,ee,M),(B-2)*3),[k,C,T,D]=[T,D,ee,M]}}}for(let x=0,_=o.length;x<_;x++)f.push({line:N(o[x].map(w=>w??NaN),m,p,g,y),points:N(c[x].map(w=>w??NaN),m,p,g,y)});const b=new Lb;return b.build(f,r,i,1,d,h,a),b}get box(){return l(this,As)}updateProperty(t,s){return t==="stroke-width"?A(this,ns,xN).call(this,s):null}updateParentDimensions([t,s],r){const[i,a]=A(this,ns,$r).call(this);v(this,kr,t),v(this,Er,s),v(this,Jc,r);const[o,c]=A(this,ns,$r).call(this),d=o-i,h=c-a,f=l(this,As);return f[0]-=d,f[1]-=h,f[2]+=2*d,f[3]+=2*h,f}updateRotation(t){return v(this,tf,t),{path:{transform:this.rotationTransform}}}get viewBox(){return l(this,As).map(ue.svgRound).join(" ")}get defaultProperties(){const[t,s]=l(this,As);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${ue.svgRound(t)} ${ue.svgRound(s)}`}}}get rotationTransform(){const[,,t,s]=l(this,As);let r=0,i=0,a=0,o=0,c=0,d=0;switch(l(this,tf)){case 90:i=s/t,a=-t/s,c=t;break;case 180:r=-1,o=-1,c=t,d=s;break;case 270:i=-s/t,a=t/s,d=s;break;default:return""}return`matrix(${r} ${i} ${a} ${o} ${ue.svgRound(c)} ${ue.svgRound(d)})`}getPathResizingSVGProperties([t,s,r,i]){const[a,o]=A(this,ns,$r).call(this),[c,d,h,f]=l(this,As);if(Math.abs(h-a)<=ue.PRECISION||Math.abs(f-o)<=ue.PRECISION){const N=t+r/2-(c+h/2),b=s+i/2-(d+f/2);return{path:{"transform-origin":`${ue.svgRound(t)} ${ue.svgRound(s)}`,transform:`${this.rotationTransform} translate(${N} ${b})`}}}const m=(r-2*a)/(h-2*a),p=(i-2*o)/(f-2*o),g=h/r,y=f/i;return{path:{"transform-origin":`${ue.svgRound(c)} ${ue.svgRound(d)}`,transform:`${this.rotationTransform} scale(${g} ${y}) translate(${ue.svgRound(a)} ${ue.svgRound(o)}) scale(${m} ${p}) translate(${ue.svgRound(-a)} ${ue.svgRound(-o)})`}}}getPathResizedSVGProperties([t,s,r,i]){const[a,o]=A(this,ns,$r).call(this),c=l(this,As),[d,h,f,m]=c;if(c[0]=t,c[1]=s,c[2]=r,c[3]=i,Math.abs(f-a)<=ue.PRECISION||Math.abs(m-o)<=ue.PRECISION){const b=t+r/2-(d+f/2),x=s+i/2-(h+m/2);for(const{line:_,points:w}of l(this,an))ue._translate(_,b,x,_),ue._translate(w,b,x,w);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${ue.svgRound(t)} ${ue.svgRound(s)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const p=(r-2*a)/(f-2*a),g=(i-2*o)/(m-2*o),y=-p*(d+a)+t+a,N=-g*(h+o)+s+o;if(p!==1||g!==1||y!==0||N!==0)for(const{line:b,points:x}of l(this,an))ue._rescale(b,y,N,p,g,b),ue._rescale(x,y,N,p,g,x);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${ue.svgRound(t)} ${ue.svgRound(s)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([t,s],r){const[i,a]=r,o=l(this,As),c=t-o[0],d=s-o[1];if(l(this,kr)===i&&l(this,Er)===a)for(const{line:h,points:f}of l(this,an))ue._translate(h,c,d,h),ue._translate(f,c,d,f);else{const h=l(this,kr)/i,f=l(this,Er)/a;v(this,kr,i),v(this,Er,a);for(const{line:m,points:p}of l(this,an))ue._rescale(m,c,d,h,f,m),ue._rescale(p,c,d,h,f,p);o[2]*=h,o[3]*=f}return o[0]=t,o[1]=s,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${ue.svgRound(t)} ${ue.svgRound(s)}`}}}get defaultSVGProperties(){const t=l(this,As);return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${ue.svgRound(t[0])} ${ue.svgRound(t[1])}`,transform:this.rotationTransform||null},bbox:t}}};As=new WeakMap,tf=new WeakMap,sf=new WeakMap,an=new WeakMap,kr=new WeakMap,Er=new WeakMap,Jc=new WeakMap,Qc=new WeakMap,Zc=new WeakMap,ns=new WeakSet,$r=function(t=l(this,Zc)){const s=l(this,sf)+t/2*l(this,Jc);return l(this,Qc)%180===0?[s/l(this,kr),s/l(this,Er)]:[s/l(this,Er),s/l(this,kr)]},vN=function(){const[t,s,r,i]=l(this,As),[a,o]=A(this,ns,$r).call(this,0);return[t+a,s+o,r-2*a,i-2*o]},bN=function(){const t=v(this,As,new Float32Array([1/0,1/0,-1/0,-1/0]));for(const{line:i}of l(this,an)){if(i.length<=12){for(let c=4,d=i.length;c<d;c+=6){const[h,f]=i.subarray(c,c+2);t[0]=Math.min(t[0],h),t[1]=Math.min(t[1],f),t[2]=Math.max(t[2],h),t[3]=Math.max(t[3],f)}continue}let a=i[4],o=i[5];for(let c=6,d=i.length;c<d;c+=6){const[h,f,m,p,g,y]=i.subarray(c,c+6);ve.bezierBoundingBox(a,o,h,f,m,p,g,y,t),a=g,o=y}}const[s,r]=A(this,ns,$r).call(this);t[0]=Math.min(1,Math.max(0,t[0]-s)),t[1]=Math.min(1,Math.max(0,t[1]-r)),t[2]=Math.min(1,Math.max(0,t[2]+s)),t[3]=Math.min(1,Math.max(0,t[3]+r)),t[2]-=t[0],t[3]-=t[1]},xN=function(t){const[s,r]=A(this,ns,$r).call(this);v(this,Zc,t);const[i,a]=A(this,ns,$r).call(this),[o,c]=[i-s,a-r],d=l(this,As);return d[0]-=o,d[1]-=c,d[2]+=2*o,d[3]+=2*c,d};let hp=Lb;var eu;const Ob=class Ob extends OR{constructor(t){super();S(this,eu);v(this,eu,t),super.updateProperties({fill:"none",stroke:vt._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(t,s){t==="stroke-width"&&(s??(s=this["stroke-width"]),s*=l(this,eu).realScale),super.updateSVGProperty(t,s)}clone(){const t=new Ob(l(this,eu));return t.updateAll(this),t}};eu=new WeakMap;let lv=Ob;var Tp,wN;const Wl=class Wl extends rv{constructor(t){super({...t,name:"inkEditor"});S(this,Tp);this._willKeepAspectRatio=!0}static initialize(t,s){vt.initialize(t,s),this._defaultDrawingOptions=new lv(s.viewParameters)}static getDefaultDrawingOptions(t){const s=this._defaultDrawingOptions.clone();return s.updateProperties(t),s}static get supportMultipleDrawings(){return!0}static get typesMap(){return Le(this,"typesMap",new Map([[Be.INK_THICKNESS,"stroke-width"],[Be.INK_COLOR,"stroke"],[Be.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(t,s,r,i,a){return new FR(t,s,r,i,a,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(t,s,r,i,a,o){return hp.deserialize(t,s,r,i,a,o)}static async deserialize(t,s,r){let i=null;if(t instanceof Rb){const{data:{inkLists:o,rect:c,rotation:d,id:h,color:f,opacity:m,borderStyle:{rawWidth:p},popupRef:g},parent:{page:{pageNumber:y}}}=t;i=t={annotationType:Ie.INK,color:Array.from(f),thickness:p,opacity:m,paths:{points:o},boxes:null,pageIndex:y-1,rect:c.slice(0),rotation:d,id:h,deleted:!1,popupRef:g}}const a=await super.deserialize(t,s,r);return a.annotationElementId=t.id||null,a._initialData=i,a}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:t,_drawingOptions:s,parent:r}=this;s.updateSVGProperty("stroke-width"),r.drawLayer.updateProperties(t,s.toSVGProperties())}static onScaleChangingWhenDrawing(){const t=this._currentParent;t&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),t.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:t,thickness:s,opacity:r}){this._drawingOptions=Wl.getDefaultDrawingOptions({stroke:ve.makeHexColor(...t),"stroke-width":s,"stroke-opacity":r})}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:s,points:r,rect:i}=this.serializeDraw(t),{_drawingOptions:{stroke:a,"stroke-opacity":o,"stroke-width":c}}=this,d={annotationType:Ie.INK,color:vt._colorManager.convert(a),opacity:o,thickness:c,paths:{lines:s,points:r},pageIndex:this.pageIndex,rect:i,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?d:this.annotationElementId&&!A(this,Tp,wN).call(this,d)?null:(d.id=this.annotationElementId,d)}renderAnnotationElement(t){const{points:s,rect:r}=this.serializeDraw(!1);return t.updateEdited({rect:r,thickness:this._drawingOptions["stroke-width"],points:s}),null}};Tp=new WeakSet,wN=function(t){const{color:s,thickness:r,opacity:i,pageIndex:a}=this._initialData;return this._hasBeenMoved||this._hasBeenResized||t.color.some((o,c)=>o!==s[c])||t.thickness!==r||t.opacity!==i||t.pageIndex!==a},xe(Wl,"_type","ink"),xe(Wl,"_editorType",Ie.INK),xe(Wl,"_defaultDrawingOptions",null);let cv=Wl;var gt,ts,ua,hi,da,tu,Cr,jr,on,su,He,Yu,Ju,Cm,dv,jm,hv,Tm,_N;const dd=class dd extends vt{constructor(t){super({...t,name:"stampEditor"});S(this,He);S(this,gt,null);S(this,ts,null);S(this,ua,null);S(this,hi,null);S(this,da,null);S(this,tu,"");S(this,Cr,null);S(this,jr,null);S(this,on,!1);S(this,su,!1);v(this,hi,t.bitmapUrl),v(this,da,t.bitmapFile)}static initialize(t,s){vt.initialize(t,s)}static get supportedTypes(){return Le(this,"supportedTypes",["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"].map(s=>`image/${s}`))}static get supportedTypesStr(){return Le(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(t){return this.supportedTypes.includes(t)}static paste(t,s){s.pasteEditor(Ie.STAMP,{bitmapFile:t.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){var t;return{type:"stamp",hasAltText:!!((t=this.altTextData)!=null&&t.altText)}}static computeTelemetryFinalData(t){const s=t.get("hasAltText");return{hasAltText:s.get(!0)??0,hasNoAltText:s.get(!1)??0}}async mlGuessAltText(t=null,s=!0){if(this.hasAltTextData())return null;const{mlManager:r}=this._uiManager;if(!r)throw new Error("No ML.");if(!await r.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:i,width:a,height:o}=t||this.copyCanvas(null,null,!0).imageData,c=await r.guess({name:"altText",request:{data:i,width:a,height:o,channels:i.length/(a*o)}});if(!c)throw new Error("No response from the AI service.");if(c.error)throw new Error("Error from the AI service.");if(c.cancel)return null;if(!c.output)throw new Error("No valid response from the AI service.");const d=c.output;return await this.setGuessedAltText(d),s&&!this.hasAltTextData()&&(this.altTextData={alt:d,decorative:!1}),d}remove(){var t;l(this,ts)&&(v(this,gt,null),this._uiManager.imageManager.deleteId(l(this,ts)),(t=l(this,Cr))==null||t.remove(),v(this,Cr,null),l(this,jr)&&(clearTimeout(l(this,jr)),v(this,jr,null))),super.remove()}rebuild(){if(!this.parent){l(this,ts)&&A(this,He,Cm).call(this);return}super.rebuild(),this.div!==null&&(l(this,ts)&&l(this,Cr)===null&&A(this,He,Cm).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(t){this._isDraggable=!0,t&&this.div.focus()}isEmpty(){return!(l(this,ua)||l(this,gt)||l(this,hi)||l(this,da)||l(this,ts))}get isResizable(){return!0}render(){if(this.div)return this.div;let t,s;if(this.width&&(t=this.x,s=this.y),super.render(),this.div.hidden=!0,this.div.setAttribute("role","figure"),this.addAltTextButton(),l(this,gt)?A(this,He,dv).call(this):A(this,He,Cm).call(this),this.width&&!this.annotationElementId){const[r,i]=this.parentDimensions;this.setAt(t*r,s*i,this.width*r,this.height*i)}return this._uiManager.addShouldRescale(this),this.div}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;l(this,jr)!==null&&clearTimeout(l(this,jr)),v(this,jr,setTimeout(()=>{v(this,jr,null),A(this,He,hv).call(this)},200))}copyCanvas(t,s,r=!1){var p;t||(t=224);const{width:i,height:a}=l(this,gt),o=new ly;let c=l(this,gt),d=i,h=a,f=null;if(s){if(i>s||a>s){const D=Math.min(s/i,s/a);d=Math.floor(i*D),h=Math.floor(a*D)}f=document.createElement("canvas");const g=f.width=Math.ceil(d*o.sx),y=f.height=Math.ceil(h*o.sy);l(this,on)||(c=A(this,He,jm).call(this,g,y));const N=f.getContext("2d");N.filter=this._uiManager.hcmFilter;let b="white",x="#cfcfd8";this._uiManager.hcmFilter!=="none"?x="black":(p=window.matchMedia)!=null&&p.call(window,"(prefers-color-scheme: dark)").matches&&(b="#8f8f9d",x="#42414d");const _=15,w=_*o.sx,k=_*o.sy,C=new OffscreenCanvas(w*2,k*2),T=C.getContext("2d");T.fillStyle=b,T.fillRect(0,0,w*2,k*2),T.fillStyle=x,T.fillRect(0,0,w,k),T.fillRect(w,k,w,k),N.fillStyle=N.createPattern(C,"repeat"),N.fillRect(0,0,g,y),N.drawImage(c,0,0,c.width,c.height,0,0,g,y)}let m=null;if(r){let g,y;if(o.symmetric&&c.width<t&&c.height<t)g=c.width,y=c.height;else if(c=l(this,gt),i>t||a>t){const x=Math.min(t/i,t/a);g=Math.floor(i*x),y=Math.floor(a*x),l(this,on)||(c=A(this,He,jm).call(this,g,y))}const b=new OffscreenCanvas(g,y).getContext("2d",{willReadFrequently:!0});b.drawImage(c,0,0,c.width,c.height,0,0,g,y),m={width:g,height:y,data:b.getImageData(0,0,g,y).data}}return{canvas:f,width:d,height:h,imageData:m}}getImageForAltText(){return l(this,Cr)}static async deserialize(t,s,r){var y;let i=null;if(t instanceof HA){const{data:{rect:N,rotation:b,id:x,structParent:_,popupRef:w},container:k,parent:{page:{pageNumber:C}}}=t,T=k.querySelector("canvas"),D=r.imageManager.getFromCanvas(k.id,T);T.remove();const B=((y=await s._structTree.getAriaAttributes(`${Sb}${x}`))==null?void 0:y.get("aria-label"))||"";i=t={annotationType:Ie.STAMP,bitmapId:D.id,bitmap:D.bitmap,pageIndex:C-1,rect:N.slice(0),rotation:b,id:x,deleted:!1,accessibilityData:{decorative:!1,altText:B},isSvg:!1,structParent:_,popupRef:w}}const a=await super.deserialize(t,s,r),{rect:o,bitmap:c,bitmapUrl:d,bitmapId:h,isSvg:f,accessibilityData:m}=t;h&&r.imageManager.isValidId(h)?(v(a,ts,h),c&&v(a,gt,c)):v(a,hi,d),v(a,on,f);const[p,g]=a.pageDimensions;return a.width=(o[2]-o[0])/p,a.height=(o[3]-o[1])/g,a.annotationElementId=t.id||null,m&&(a.altTextData=m),a._initialData=i,v(a,su,!!i),a}serialize(t=!1,s=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const r={annotationType:Ie.STAMP,bitmapId:l(this,ts),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:l(this,on),structTreeParentId:this._structTreeParentId};if(t)return r.bitmapUrl=A(this,He,Tm).call(this,!0),r.accessibilityData=this.serializeAltText(!0),r;const{decorative:i,altText:a}=this.serializeAltText(!1);if(!i&&a&&(r.accessibilityData={type:"Figure",alt:a}),this.annotationElementId){const c=A(this,He,_N).call(this,r);if(c.isSame)return null;c.isSameAltText?delete r.accessibilityData:r.accessibilityData.structParent=this._initialData.structParent??-1}if(r.id=this.annotationElementId,s===null)return r;s.stamps||(s.stamps=new Map);const o=l(this,on)?(r.rect[2]-r.rect[0])*(r.rect[3]-r.rect[1]):null;if(!s.stamps.has(l(this,ts)))s.stamps.set(l(this,ts),{area:o,serialized:r}),r.bitmap=A(this,He,Tm).call(this,!1);else if(l(this,on)){const c=s.stamps.get(l(this,ts));o>c.area&&(c.area=o,c.serialized.bitmap.close(),c.serialized.bitmap=A(this,He,Tm).call(this,!1))}return r}renderAnnotationElement(t){return t.updateEdited({rect:this.getRect(0,0)}),null}};gt=new WeakMap,ts=new WeakMap,ua=new WeakMap,hi=new WeakMap,da=new WeakMap,tu=new WeakMap,Cr=new WeakMap,jr=new WeakMap,on=new WeakMap,su=new WeakMap,He=new WeakSet,Yu=function(t,s=!1){if(!t){this.remove();return}v(this,gt,t.bitmap),s||(v(this,ts,t.id),v(this,on,t.isSvg)),t.file&&v(this,tu,t.file.name),A(this,He,dv).call(this)},Ju=function(){if(v(this,ua,null),this._uiManager.enableWaiting(!1),!!l(this,Cr)){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&l(this,gt)){this._editToolbar.hide(),this._uiManager.editAltText(this,!0);return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&l(this,gt)){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}},Cm=function(){if(l(this,ts)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(l(this,ts)).then(r=>A(this,He,Yu).call(this,r,!0)).finally(()=>A(this,He,Ju).call(this));return}if(l(this,hi)){const r=l(this,hi);v(this,hi,null),this._uiManager.enableWaiting(!0),v(this,ua,this._uiManager.imageManager.getFromUrl(r).then(i=>A(this,He,Yu).call(this,i)).finally(()=>A(this,He,Ju).call(this)));return}if(l(this,da)){const r=l(this,da);v(this,da,null),this._uiManager.enableWaiting(!0),v(this,ua,this._uiManager.imageManager.getFromFile(r).then(i=>A(this,He,Yu).call(this,i)).finally(()=>A(this,He,Ju).call(this)));return}const t=document.createElement("input");t.type="file",t.accept=dd.supportedTypesStr;const s=this._uiManager._signal;v(this,ua,new Promise(r=>{t.addEventListener("change",async()=>{if(!t.files||t.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const i=await this._uiManager.imageManager.getFromFile(t.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),A(this,He,Yu).call(this,i)}r()},{signal:s}),t.addEventListener("cancel",()=>{this.remove(),r()},{signal:s})}).finally(()=>A(this,He,Ju).call(this))),t.click()},dv=function(){var f;const{div:t}=this;let{width:s,height:r}=l(this,gt);const[i,a]=this.pageDimensions,o=.75;if(this.width)s=this.width*i,r=this.height*a;else if(s>o*i||r>o*a){const m=Math.min(o*i/s,o*a/r);s*=m,r*=m}const[c,d]=this.parentDimensions;this.setDims(s*c/i,r*d/a),this._uiManager.enableWaiting(!1);const h=v(this,Cr,document.createElement("canvas"));h.setAttribute("role","img"),this.addContainer(h),this.width=s/i,this.height=r/a,(f=this._initialOptions)!=null&&f.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(t.hidden=!1),A(this,He,hv).call(this),l(this,su)||(this.parent.addUndoableEditor(this),v(this,su,!0)),this._reportTelemetry({action:"inserted_image"}),l(this,tu)&&h.setAttribute("aria-label",l(this,tu))},jm=function(t,s){const{width:r,height:i}=l(this,gt);let a=r,o=i,c=l(this,gt);for(;a>2*t||o>2*s;){const d=a,h=o;a>2*t&&(a=a>=16384?Math.floor(a/2)-1:Math.ceil(a/2)),o>2*s&&(o=o>=16384?Math.floor(o/2)-1:Math.ceil(o/2));const f=new OffscreenCanvas(a,o);f.getContext("2d").drawImage(c,0,0,d,h,0,0,a,o),c=f.transferToImageBitmap()}return c},hv=function(){const[t,s]=this.parentDimensions,{width:r,height:i}=this,a=new ly,o=Math.ceil(r*t*a.sx),c=Math.ceil(i*s*a.sy),d=l(this,Cr);if(!d||d.width===o&&d.height===c)return;d.width=o,d.height=c;const h=l(this,on)?l(this,gt):A(this,He,jm).call(this,o,c),f=d.getContext("2d");f.filter=this._uiManager.hcmFilter,f.drawImage(h,0,0,h.width,h.height,0,0,o,c)},Tm=function(t){if(t){if(l(this,on)){const i=this._uiManager.imageManager.getSvgUrl(l(this,ts));if(i)return i}const s=document.createElement("canvas");return{width:s.width,height:s.height}=l(this,gt),s.getContext("2d").drawImage(l(this,gt),0,0),s.toDataURL()}if(l(this,on)){const[s,r]=this.pageDimensions,i=Math.round(this.width*s*ja.PDF_TO_CSS_UNITS),a=Math.round(this.height*r*ja.PDF_TO_CSS_UNITS),o=new OffscreenCanvas(i,a);return o.getContext("2d").drawImage(l(this,gt),0,0,l(this,gt).width,l(this,gt).height,0,0,i,a),o.transferToImageBitmap()}return structuredClone(l(this,gt))},_N=function(t){var o;const{pageIndex:s,accessibilityData:{altText:r}}=this._initialData,i=t.pageIndex===s,a=(((o=t.accessibilityData)==null?void 0:o.alt)||"")===r;return{isSame:!this._hasBeenMoved&&!this._hasBeenResized&&i&&a,isSameAltText:a}},xe(dd,"_type","stamp"),xe(dd,"_editorType",Ie.STAMP);let uv=dd;var Qo,nu,Tr,ha,fi,Nn,fa,ru,Zo,Jn,mi,ms,pi,ye,ma,ft,SN,dr,mv,pv,Rm;const Fn=class Fn{constructor({uiManager:e,pageIndex:t,div:s,structTreeLayer:r,accessibilityManager:i,annotationLayer:a,drawLayer:o,textLayer:c,viewport:d,l10n:h}){S(this,ft);S(this,Qo);S(this,nu,!1);S(this,Tr,null);S(this,ha,null);S(this,fi,null);S(this,Nn,new Map);S(this,fa,!1);S(this,ru,!1);S(this,Zo,!1);S(this,Jn,null);S(this,mi,null);S(this,ms,null);S(this,pi,null);S(this,ye);const f=[...l(Fn,ma).values()];if(!Fn._initialized){Fn._initialized=!0;for(const m of f)m.initialize(h,e)}e.registerEditorTypes(f),v(this,ye,e),this.pageIndex=t,this.div=s,v(this,Qo,i),v(this,Tr,a),this.viewport=d,v(this,ms,c),this.drawLayer=o,this._structTree=r,l(this,ye).addLayer(this)}get isEmpty(){return l(this,Nn).size===0}get isInvisible(){return this.isEmpty&&l(this,ye).getMode()===Ie.NONE}updateToolbar(e){l(this,ye).updateToolbar(e)}updateMode(e=l(this,ye).getMode()){switch(A(this,ft,Rm).call(this),e){case Ie.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case Ie.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case Ie.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:t}=this.div;for(const s of l(Fn,ma).values())t.toggle(`${s._type}Editing`,e===s._editorType);this.div.hidden=!1}hasTextLayer(e){var t;return e===((t=l(this,ms))==null?void 0:t.div)}setEditingState(e){l(this,ye).setEditingState(e)}addCommands(e){l(this,ye).addCommands(e)}cleanUndoStack(e){l(this,ye).cleanUndoStack(e)}toggleDrawing(e=!1){this.div.classList.toggle("drawing",!e)}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}toggleAnnotationLayerPointerEvents(e=!1){var t;(t=l(this,Tr))==null||t.div.classList.toggle("disabled",!e)}async enable(){v(this,Zo,!0),this.div.tabIndex=0,this.togglePointerEvents(!0);const e=new Set;for(const s of l(this,Nn).values())s.enableEditing(),s.show(!0),s.annotationElementId&&(l(this,ye).removeChangedExistingAnnotation(s),e.add(s.annotationElementId));if(!l(this,Tr)){v(this,Zo,!1);return}const t=l(this,Tr).getEditableAnnotations();for(const s of t){if(s.hide(),l(this,ye).isDeletedAnnotationElement(s.data.id)||e.has(s.data.id))continue;const r=await this.deserialize(s);r&&(this.addOrRebuild(r),r.enableEditing())}v(this,Zo,!1)}disable(){var r;v(this,ru,!0),this.div.tabIndex=-1,this.togglePointerEvents(!1);const e=new Map,t=new Map;for(const i of l(this,Nn).values())if(i.disableEditing(),!!i.annotationElementId){if(i.serialize()!==null){e.set(i.annotationElementId,i);continue}else t.set(i.annotationElementId,i);(r=this.getEditableAnnotation(i.annotationElementId))==null||r.show(),i.remove()}if(l(this,Tr)){const i=l(this,Tr).getEditableAnnotations();for(const a of i){const{id:o}=a.data;if(l(this,ye).isDeletedAnnotationElement(o))continue;let c=t.get(o);if(c){c.resetAnnotationElement(a),c.show(!1),a.show();continue}c=e.get(o),c&&(l(this,ye).addChangedExistingAnnotation(c),c.renderAnnotationElement(a)&&c.show(!1)),a.show()}}A(this,ft,Rm).call(this),this.isEmpty&&(this.div.hidden=!0);const{classList:s}=this.div;for(const i of l(Fn,ma).values())s.remove(`${i._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),v(this,ru,!1)}getEditableAnnotation(e){var t;return((t=l(this,Tr))==null?void 0:t.getEditableAnnotation(e))||null}setActiveEditor(e){l(this,ye).getActive()!==e&&l(this,ye).setActiveEditor(e)}enableTextSelection(){var e;if(this.div.tabIndex=-1,(e=l(this,ms))!=null&&e.div&&!l(this,pi)){v(this,pi,new AbortController);const t=l(this,ye).combinedSignal(l(this,pi));l(this,ms).div.addEventListener("pointerdown",A(this,ft,SN).bind(this),{signal:t}),l(this,ms).div.classList.add("highlighting")}}disableTextSelection(){var e;this.div.tabIndex=0,(e=l(this,ms))!=null&&e.div&&l(this,pi)&&(l(this,pi).abort(),v(this,pi,null),l(this,ms).div.classList.remove("highlighting"))}enableClick(){if(l(this,ha))return;v(this,ha,new AbortController);const e=l(this,ye).combinedSignal(l(this,ha));this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:e});const t=this.pointerup.bind(this);this.div.addEventListener("pointerup",t,{signal:e}),this.div.addEventListener("pointercancel",t,{signal:e})}disableClick(){var e;(e=l(this,ha))==null||e.abort(),v(this,ha,null)}attach(e){l(this,Nn).set(e.id,e);const{annotationElementId:t}=e;t&&l(this,ye).isDeletedAnnotationElement(t)&&l(this,ye).removeDeletedAnnotationElement(e)}detach(e){var t;l(this,Nn).delete(e.id),(t=l(this,Qo))==null||t.removePointerInTextLayer(e.contentDiv),!l(this,ru)&&e.annotationElementId&&l(this,ye).addDeletedAnnotationElement(e)}remove(e){this.detach(e),l(this,ye).removeEditor(e),e.div.remove(),e.isAttachedToDOM=!1}changeParent(e){var t;e.parent!==this&&(e.parent&&e.annotationElementId&&(l(this,ye).addDeletedAnnotationElement(e.annotationElementId),vt.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),(t=e.parent)==null||t.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}add(e){if(!(e.parent===this&&e.isAttachedToDOM)){if(this.changeParent(e),l(this,ye).addEditor(e),this.attach(e),!e.isAttachedToDOM){const t=e.render();this.div.append(t),e.isAttachedToDOM=!0}e.fixAndSetPosition(),e.onceAdded(!l(this,Zo)),l(this,ye).addToAnnotationStorage(e),e._reportTelemetry(e.telemetryInitialData)}}moveEditorInDOM(e){var s;if(!e.isAttachedToDOM)return;const{activeElement:t}=document;e.div.contains(t)&&!l(this,fi)&&(e._focusEventsAllowed=!1,v(this,fi,setTimeout(()=>{v(this,fi,null),e.div.contains(document.activeElement)?e._focusEventsAllowed=!0:(e.div.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:l(this,ye)._signal}),t.focus())},0))),e._structTreeParentId=(s=l(this,Qo))==null?void 0:s.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?(e.parent||(e.parent=this),e.rebuild(),e.show()):this.add(e)}addUndoableEditor(e){const t=()=>e._uiManager.rebuild(e),s=()=>{e.remove()};this.addCommands({cmd:t,undo:s,mustExec:!1})}getNextId(){return l(this,ye).getId()}combinedSignal(e){return l(this,ye).combinedSignal(e)}canCreateNewEmptyEditor(){var e;return(e=l(this,ft,dr))==null?void 0:e.canCreateNewEmptyEditor()}pasteEditor(e,t){l(this,ye).updateToolbar(e),l(this,ye).updateMode(e);const{offsetX:s,offsetY:r}=A(this,ft,pv).call(this),i=this.getNextId(),a=A(this,ft,mv).call(this,{parent:this,id:i,x:s,y:r,uiManager:l(this,ye),isCentered:!0,...t});a&&this.add(a)}async deserialize(e){var t;return await((t=l(Fn,ma).get(e.annotationType??e.annotationEditorType))==null?void 0:t.deserialize(e,this,l(this,ye)))||null}createAndAddNewEditor(e,t,s={}){const r=this.getNextId(),i=A(this,ft,mv).call(this,{parent:this,id:r,x:e.offsetX,y:e.offsetY,uiManager:l(this,ye),isCentered:t,...s});return i&&this.add(i),i}addNewEditor(){this.createAndAddNewEditor(A(this,ft,pv).call(this),!0)}setSelected(e){l(this,ye).setSelected(e)}toggleSelected(e){l(this,ye).toggleSelected(e)}unselect(e){l(this,ye).unselect(e)}pointerup(e){var s;const{isMac:t}=Cs.platform;if(!(e.button!==0||e.ctrlKey&&t)&&e.target===this.div&&l(this,fa)&&(v(this,fa,!1),!((s=l(this,ft,dr))!=null&&s.isDrawer&&l(this,ft,dr).supportMultipleDrawings))){if(!l(this,nu)){v(this,nu,!0);return}if(l(this,ye).getMode()===Ie.STAMP){l(this,ye).unselectAll();return}this.createAndAddNewEditor(e,!1)}}pointerdown(e){var r;if(l(this,ye).getMode()===Ie.HIGHLIGHT&&this.enableTextSelection(),l(this,fa)){v(this,fa,!1);return}const{isMac:t}=Cs.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div)return;if(v(this,fa,!0),(r=l(this,ft,dr))!=null&&r.isDrawer){this.startDrawingSession(e);return}const s=l(this,ye).getActive();v(this,nu,!s||s.isEmpty())}startDrawingSession(e){if(this.div.focus(),l(this,Jn)){l(this,ft,dr).startDrawing(this,l(this,ye),!1,e);return}l(this,ye).setCurrentDrawingSession(this),v(this,Jn,new AbortController);const t=l(this,ye).combinedSignal(l(this,Jn));this.div.addEventListener("blur",({relatedTarget:s})=>{s&&!this.div.contains(s)&&(v(this,mi,null),this.commitOrRemove())},{signal:t}),l(this,ft,dr).startDrawing(this,l(this,ye),!1,e)}pause(e){if(e){const{activeElement:t}=document;this.div.contains(t)&&v(this,mi,t);return}l(this,mi)&&setTimeout(()=>{var t;(t=l(this,mi))==null||t.focus(),v(this,mi,null)},0)}endDrawingSession(e=!1){return l(this,Jn)?(l(this,ye).setCurrentDrawingSession(null),l(this,Jn).abort(),v(this,Jn,null),v(this,mi,null),l(this,ft,dr).endDrawing(e)):null}findNewParent(e,t,s){const r=l(this,ye).findParent(t,s);return r===null||r===this?!1:(r.changeParent(e),!0)}commitOrRemove(){return l(this,Jn)?(this.endDrawingSession(),!0):!1}onScaleChanging(){l(this,Jn)&&l(this,ft,dr).onScaleChangingWhenDrawing(this)}destroy(){var e,t;this.commitOrRemove(),((e=l(this,ye).getActive())==null?void 0:e.parent)===this&&(l(this,ye).commitOrRemove(),l(this,ye).setActiveEditor(null)),l(this,fi)&&(clearTimeout(l(this,fi)),v(this,fi,null));for(const s of l(this,Nn).values())(t=l(this,Qo))==null||t.removePointerInTextLayer(s.contentDiv),s.setParent(null),s.isAttachedToDOM=!1,s.div.remove();this.div=null,l(this,Nn).clear(),l(this,ye).removeLayer(this)}render({viewport:e}){this.viewport=e,ll(this.div,e);for(const t of l(this,ye).getEditors(this.pageIndex))this.add(t),t.rebuild();this.updateMode()}update({viewport:e}){l(this,ye).commitOrRemove(),A(this,ft,Rm).call(this);const t=this.viewport.rotation,s=e.rotation;if(this.viewport=e,ll(this.div,{rotation:s}),t!==s)for(const r of l(this,Nn).values())r.rotate(s)}get pageDimensions(){const{pageWidth:e,pageHeight:t}=this.viewport.rawDims;return[e,t]}get scale(){return l(this,ye).viewParameters.realScale}};Qo=new WeakMap,nu=new WeakMap,Tr=new WeakMap,ha=new WeakMap,fi=new WeakMap,Nn=new WeakMap,fa=new WeakMap,ru=new WeakMap,Zo=new WeakMap,Jn=new WeakMap,mi=new WeakMap,ms=new WeakMap,pi=new WeakMap,ye=new WeakMap,ma=new WeakMap,ft=new WeakSet,SN=function(e){l(this,ye).unselectAll();const{target:t}=e;if(t===l(this,ms).div||(t.getAttribute("role")==="img"||t.classList.contains("endOfContent"))&&l(this,ms).div.contains(t)){const{isMac:s}=Cs.platform;if(e.button!==0||e.ctrlKey&&s)return;l(this,ye).showAllEditors("highlight",!0,!0),l(this,ms).div.classList.add("free"),this.toggleDrawing(),dp.startHighlighting(this,l(this,ye).direction==="ltr",{target:l(this,ms).div,x:e.x,y:e.y}),l(this,ms).div.addEventListener("pointerup",()=>{l(this,ms).div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:l(this,ye)._signal}),e.preventDefault()}},dr=function(){return l(Fn,ma).get(l(this,ye).getMode())},mv=function(e){const t=l(this,ft,dr);return t?new t.prototype.constructor(e):null},pv=function(){const{x:e,y:t,width:s,height:r}=this.div.getBoundingClientRect(),i=Math.max(0,e),a=Math.max(0,t),o=Math.min(window.innerWidth,e+s),c=Math.min(window.innerHeight,t+r),d=(i+o)/2-e,h=(a+c)/2-t,[f,m]=this.viewport.rotation%180===0?[d,h]:[h,d];return{offsetX:f,offsetY:m}},Rm=function(){for(const e of l(this,Nn).values())e.isEmpty()&&e.remove()},xe(Fn,"_initialized",!1),S(Fn,ma,new Map([Ky,cv,uv,dp].map(e=>[e._editorType,e])));let fv=Fn;var Qn,nf,Ns,el,Rp,AN,Dr,yv,NN,vv;const us=class us{constructor({pageIndex:e}){S(this,Dr);S(this,Qn,null);S(this,nf,0);S(this,Ns,new Map);S(this,el,new Map);this.pageIndex=e}setParent(e){if(!l(this,Qn)){v(this,Qn,e);return}if(l(this,Qn)!==e){if(l(this,Ns).size>0)for(const t of l(this,Ns).values())t.remove(),e.append(t);v(this,Qn,e)}}static get _svgFactory(){return Le(this,"_svgFactory",new Tb)}draw(e,t=!1,s=!1){const r=bs(this,nf)._++,i=A(this,Dr,yv).call(this),a=us._svgFactory.createElement("defs");i.append(a);const o=us._svgFactory.createElement("path");a.append(o);const c=`path_p${this.pageIndex}_${r}`;o.setAttribute("id",c),o.setAttribute("vector-effect","non-scaling-stroke"),t&&l(this,el).set(r,o);const d=s?A(this,Dr,NN).call(this,a,c):null,h=us._svgFactory.createElement("use");return i.append(h),h.setAttribute("href",`#${c}`),this.updateProperties(i,e),l(this,Ns).set(r,i),{id:r,clipPathId:`url(#${d})`}}drawOutline(e,t){const s=bs(this,nf)._++,r=A(this,Dr,yv).call(this),i=us._svgFactory.createElement("defs");r.append(i);const a=us._svgFactory.createElement("path");i.append(a);const o=`path_p${this.pageIndex}_${s}`;a.setAttribute("id",o),a.setAttribute("vector-effect","non-scaling-stroke");let c;if(t){const f=us._svgFactory.createElement("mask");i.append(f),c=`mask_p${this.pageIndex}_${s}`,f.setAttribute("id",c),f.setAttribute("maskUnits","objectBoundingBox");const m=us._svgFactory.createElement("rect");f.append(m),m.setAttribute("width","1"),m.setAttribute("height","1"),m.setAttribute("fill","white");const p=us._svgFactory.createElement("use");f.append(p),p.setAttribute("href",`#${o}`),p.setAttribute("stroke","none"),p.setAttribute("fill","black"),p.setAttribute("fill-rule","nonzero"),p.classList.add("mask")}const d=us._svgFactory.createElement("use");r.append(d),d.setAttribute("href",`#${o}`),c&&d.setAttribute("mask",`url(#${c})`);const h=d.cloneNode();return r.append(h),d.classList.add("mainOutline"),h.classList.add("secondaryOutline"),this.updateProperties(r,e),l(this,Ns).set(s,r),s}finalizeDraw(e,t){l(this,el).delete(e),this.updateProperties(e,t)}updateProperties(e,t){var c;if(!t)return;const{root:s,bbox:r,rootClass:i,path:a}=t,o=typeof e=="number"?l(this,Ns).get(e):e;if(o){if(s&&A(this,Dr,vv).call(this,o,s),r&&A(c=us,Rp,AN).call(c,o,r),i){const{classList:d}=o;for(const[h,f]of Object.entries(i))d.toggle(h,f)}if(a){const h=o.firstChild.firstChild;A(this,Dr,vv).call(this,h,a)}}}updateParent(e,t){if(t===this)return;const s=l(this,Ns).get(e);s&&(l(t,Qn).append(s),l(this,Ns).delete(e),l(t,Ns).set(e,s))}remove(e){l(this,el).delete(e),l(this,Qn)!==null&&(l(this,Ns).get(e).remove(),l(this,Ns).delete(e))}destroy(){v(this,Qn,null);for(const e of l(this,Ns).values())e.remove();l(this,Ns).clear(),l(this,el).clear()}};Qn=new WeakMap,nf=new WeakMap,Ns=new WeakMap,el=new WeakMap,Rp=new WeakSet,AN=function(e,[t,s,r,i]){const{style:a}=e;a.top=`${100*s}%`,a.left=`${100*t}%`,a.width=`${100*r}%`,a.height=`${100*i}%`},Dr=new WeakSet,yv=function(){const e=us._svgFactory.create(1,1,!0);return l(this,Qn).append(e),e.setAttribute("aria-hidden",!0),e},NN=function(e,t){const s=us._svgFactory.createElement("clipPath");e.append(s);const r=`clip_${t}`;s.setAttribute("id",r),s.setAttribute("clipPathUnits","objectBoundingBox");const i=us._svgFactory.createElement("use");return s.append(i),i.setAttribute("href",`#${t}`),i.classList.add("clip"),r},vv=function(e,t){for(const[s,r]of Object.entries(t))r===null?e.removeAttribute(s):e.setAttribute(s,r)},S(us,Rp);let gv=us;globalThis.pdfjsTestingUtils={HighlightOutliner:Yy};ke.AbortException;ke.AnnotationEditorLayer;ke.AnnotationEditorParamsType;ke.AnnotationEditorType;ke.AnnotationEditorUIManager;ke.AnnotationLayer;ke.AnnotationMode;ke.ColorPicker;ke.DOMSVGFactory;ke.DrawLayer;ke.FeatureTest;var $R=ke.GlobalWorkerOptions;ke.ImageKind;ke.InvalidPDFException;ke.MissingPDFException;ke.OPS;ke.OutputScale;ke.PDFDataRangeTransport;ke.PDFDateString;ke.PDFWorker;ke.PasswordResponses;ke.PermissionFlag;ke.PixelsPerInch;ke.RenderingCancelledException;ke.TextLayer;ke.TouchManager;ke.UnexpectedResponseException;ke.Util;ke.VerbosityLevel;ke.XfaLayer;ke.build;ke.createValidAbsoluteUrl;ke.fetchData;var BR=ke.getDocument;ke.getFilenameFromUrl;ke.getPdfFilenameFromUrl;ke.getXfaPageViewport;ke.isDataScheme;ke.isPdfFile;ke.noContextMenu;ke.normalizeUnicode;ke.setLayerDimensions;ke.shadow;ke.stopEvent;ke.version;const UR="/assets/pdf.worker.min-yatZIOMy.mjs";$R.workerSrc=UR;const Ow="https://primary-production-c8d0.up.railway.app/webhook/extractor",zR=async n=>{try{const e=await n.arrayBuffer(),t=await BR({data:e}).promise;let s="";for(let i=1;i<=t.numPages;i++){const c=(await(await t.getPage(i)).getTextContent()).items.map(d=>d.str).join(" ");s+=c+" "}const r=HR(s);return await qR(r,n),r}catch(e){throw console.error("PDF extraction error:",e),new Error("Failed to extract data from PDF")}},HR=n=>{const t=n.replace(/\*start\*[\s\S]*?\*end\*/gi," ").replace(/\s+/g," ").trim(),s={businessName:[/business\s+dba\s+name[:\s]+([^\n\r]+)/i,/(?:business\s+name|company\s+name|legal\s+name)[:\s]+([^\n\r]+)/i,/(?:dba|doing\s+business\s+as)[:\s]+([^\n\r]+)/i],ownerName:[/(?:owner\s+name|principal\s+name|applicant\s+name)[:\s]+([^\n\r]+)/i,/(?:first\s+name\s+last\s+name|full\s+name)[:\s]+([^\n\r]+)/i],email:[/([a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,})/g,/(?:email|e-mail)[:\s]+([^\s\n\r]+)/i],phone:[/(?:phone|telephone|cell|mobile)[:\s]*(\(?[0-9]{3}\)?[-.\s]?[0-9]{3}[-.\s]?[0-9]{4})/i],address:[/address\s+cty\s+state\s+zip[:\s]+([^\n\r]+(?:\s+[^\n\r]+)*)/i,/(?:business\s+address|address)[:\s]+([^\n\r]+(?:\s+[^\n\r]+)*)/i,/(?:street|address\s+line)[:\s]+([^\n\r]+)/i],ein:[/federal\s+tax\s+id\s*#[:\s]*(\d{2}-?\d{7})/i,/(?:federal\s+tax\s+id|tax\s+id\s*#)[:\s]*(\d{2}-?\d{7})/i,/(?:ein|tax\s+id|federal\s+id)[:\s]*(\d{2}-?\d{7})/i],businessType:[/(?:business\s+type|entity\s+type|legal\s+structure)[:\s]+([^,\n]+)/i,/(?:llc|corporation|partnership|sole\s+proprietorship|s-corp|c-corp)/i],industry:[/(?:industry|business\s+type|nature\s+of\s+business)[:\s]+([^,\n]+)/i,/(?:retail|restaurant|healthcare|construction|professional\s+services|transportation|manufacturing|technology|real\s+estate)/i],yearsInBusiness:[/(?:years\s+in\s+business|time\s+in\s+business)[:\s]*(\d+(?:\.\d+)?)/i,/(?:established|started)[:\s]*(\d{4})/i],numberOfEmployees:[/(?:number\s+of\s+employees|employees|staff\s+size)[:\s]*(\d+)/i,/(\d+)\s+employees/i],annualRevenue:[/(?:annual\s+revenue|yearly\s+revenue|annual\s+sales)[:\s]*\$?([0-9,]+)/i,/(?:gross\s+revenue)[:\s]*\$?([0-9,]+)/i],averageMonthlyRevenue:[/(?:monthly\s+revenue|average\s+monthly\s+sales)[:\s]*\$?([0-9,]+)/i,/(?:monthly\s+gross)[:\s]*\$?([0-9,]+)/i],averageMonthlyDeposits:[/(?:monthly\s+deposits|average\s+monthly\s+deposits)[:\s]*\$?([0-9,]+)/i,/(?:bank\s+deposits)[:\s]*\$?([0-9,]+)/i],existingDebt:[/(?:existing\s+debt|current\s+debt|outstanding\s+debt)[:\s]*\$?([0-9,]+)/i,/(?:debt\s+balance)[:\s]*\$?([0-9,]+)/i],creditScore:[/(?:credit\s+score|fico\s+score|personal\s+credit)[:\s]*(\d{3})/i,/(?:score)[:\s]*(\d{3})/i],requestedAmount:[/amount\s+requested[:\s]*\$?([0-9,]+)/i,/(?:requested\s+amount|loan\s+amount|funding\s+amount)[:\s]*\$?([0-9,]+)/i,/(?:amount\s+needed|capital\s+needed)[:\s]*\$?([0-9,]+)/i]},r={businessName:"",ownerName:"",email:"",phone:"",address:"",ein:"",businessType:"",industry:"",yearsInBusiness:"",numberOfEmployees:"",annualRevenue:"",averageMonthlyRevenue:"",averageMonthlyDeposits:"",existingDebt:"",creditScore:"",requestedAmount:""};if(Object.keys(s).forEach(i=>{const a=s[i];for(const o of a){const c=t.match(o);if(c&&c[1]){let d=c[1].trim().replace(/\s+/g," ");(i.includes("Revenue")||i.includes("Amount")||i.includes("Debt")||i.includes("Deposits"))&&(d=d.replace(/[,$]/g,"")),i==="phone"&&(d=d.replace(/[^\d]/g,""),d.length===10&&(d=`(${d.slice(0,3)}) ${d.slice(3,6)}-${d.slice(6)}`)),i==="ein"&&d.length===9&&(d=`${d.slice(0,2)}-${d.slice(2)}`),i==="address"&&(d=d.replace(/\s+/g," ").trim()),r[i]=d;break}}}),console.log("PDF Extraction Results:",r),!r.businessType&&t.toLowerCase().includes("llc")&&(r.businessType="LLC"),!r.yearsInBusiness&&r.businessName){const i=new Date().getFullYear(),a=t.match(/(?:established|started|founded)[:\s]*(\d{4})/i);a&&(r.yearsInBusiness=(i-parseInt(a[1])).toString())}if(!r.averageMonthlyRevenue&&r.annualRevenue){const i=parseInt(r.annualRevenue.replace(/[,$]/g,""));isNaN(i)||(r.averageMonthlyRevenue=Math.round(i/12).toString())}return r},qR=async(n,e)=>{try{console.log("Sending PDF file and extracted data to server:",Ow);const t=new FormData;t.append("file",e),t.append("data",JSON.stringify({fileName:e.name,extractedAt:new Date().toISOString(),extractedData:n}));const s=await fetch(Ow,{method:"POST",body:t});if(!s.ok)throw new Error(`Extracted data submit error: ${s.status} ${s.statusText}`);const r=await s.json();console.log("Extracted data response:",r);try{window.postMessage({type:"webhook-response",payload:r},window.location.origin),console.log("Dispatched window message: extracted-response")}catch(i){console.warn("Failed to dispatch webhook-response message:",i)}}catch(t){console.error("Failed to send extracted data to server:",t)}},kN=({onSubmit:n,initialStep:e="upload",reviewMode:t=!1,reviewInitial:s=null,onReviewSubmit:r,onReadyForForm:i,reviewDocName:a,onReplaceDocument:o})=>{const[c,d]=V.useState(e),[h,f]=V.useState(!1),[m,p]=V.useState(0),[g,y]=V.useState(null),[N,b]=V.useState(null),[x,_]=V.useState(!1),w=V.useRef(0),[k,C]=V.useState({businessName:"",ownerName:"",email:"",phone:"",address:"",ein:"",businessType:"",industry:"",yearsInBusiness:"",numberOfEmployees:"",annualRevenue:"",averageMonthlyRevenue:"",averageMonthlyDeposits:"",existingDebt:"",creditScore:"",requestedAmount:"",documents:[]});V.useEffect(()=>{var j,R,Y,he,Ae,tt,Pt,je,Ge,I,L,z;if(!t||!s)return;C(q=>{var K,U,J,O,te,ae,Ne,Ce,ge,me,G,Z;return{...q,businessName:s.businessName??q.businessName,ownerName:((K=s.contactInfo)==null?void 0:K.ownerName)??q.ownerName,email:((U=s.contactInfo)==null?void 0:U.email)??q.email,phone:((J=s.contactInfo)==null?void 0:J.phone)??q.phone,address:((O=s.contactInfo)==null?void 0:O.address)??q.address,ein:((te=s.businessInfo)==null?void 0:te.ein)??q.ein,businessType:((ae=s.businessInfo)==null?void 0:ae.businessType)??q.businessType,industry:s.industry??q.industry,yearsInBusiness:((Ne=s.businessInfo)==null?void 0:Ne.yearsInBusiness)!==void 0?String(s.businessInfo.yearsInBusiness):q.yearsInBusiness,numberOfEmployees:((Ce=s.businessInfo)==null?void 0:Ce.numberOfEmployees)!==void 0?String(s.businessInfo.numberOfEmployees):q.numberOfEmployees,annualRevenue:((ge=s.financialInfo)==null?void 0:ge.annualRevenue)!==void 0?String(s.financialInfo.annualRevenue):q.annualRevenue,averageMonthlyRevenue:((me=s.financialInfo)==null?void 0:me.averageMonthlyRevenue)!==void 0?String(s.financialInfo.averageMonthlyRevenue):q.averageMonthlyRevenue,averageMonthlyDeposits:((G=s.financialInfo)==null?void 0:G.averageMonthlyDeposits)!==void 0?String(s.financialInfo.averageMonthlyDeposits):q.averageMonthlyDeposits,existingDebt:((Z=s.financialInfo)==null?void 0:Z.existingDebt)!==void 0?String(s.financialInfo.existingDebt):q.existingDebt,creditScore:s.creditScore!==void 0?String(s.creditScore):q.creditScore,requestedAmount:s.requestedAmount!==void 0?String(s.requestedAmount):q.requestedAmount,documents:s.documents??q.documents}});const H=[];s.businessName&&H.push("businessName"),(j=s.contactInfo)!=null&&j.ownerName&&H.push("ownerName"),(R=s.contactInfo)!=null&&R.email&&H.push("email"),(Y=s.contactInfo)!=null&&Y.phone&&H.push("phone"),(he=s.contactInfo)!=null&&he.address&&H.push("address"),(Ae=s.businessInfo)!=null&&Ae.ein&&H.push("ein"),(tt=s.businessInfo)!=null&&tt.businessType&&H.push("businessType"),s.industry&&H.push("industry"),((Pt=s.businessInfo)==null?void 0:Pt.yearsInBusiness)!==void 0&&H.push("yearsInBusiness"),((je=s.businessInfo)==null?void 0:je.numberOfEmployees)!==void 0&&H.push("numberOfEmployees"),((Ge=s.financialInfo)==null?void 0:Ge.annualRevenue)!==void 0&&H.push("annualRevenue"),((I=s.financialInfo)==null?void 0:I.averageMonthlyRevenue)!==void 0&&H.push("averageMonthlyRevenue"),((L=s.financialInfo)==null?void 0:L.averageMonthlyDeposits)!==void 0&&H.push("averageMonthlyDeposits"),((z=s.financialInfo)==null?void 0:z.existingDebt)!==void 0&&H.push("existingDebt"),s.creditScore!==void 0&&H.push("creditScore"),s.requestedAmount!==void 0&&H.push("requestedAmount"),(s.documents??[]).length>0&&H.push("documents"),H.length>0&&pe(q=>{const K={...q};return H.forEach(U=>{K[U]=!0}),K})},[t,s]);const[T,D]=V.useState({}),[B,ee]=V.useState({}),[M,E]=V.useState(null),[$]=V.useState(!1),[ie,pe]=V.useState({});V.useEffect(()=>{t&&pe({businessName:!0,industry:!0,businessType:!0,yearsInBusiness:!0,numberOfEmployees:!0,ownerName:!0,email:!0,phone:!0,address:!0,ein:!0,annualRevenue:!0,averageMonthlyRevenue:!0,averageMonthlyDeposits:!0,existingDebt:!0,creditScore:!0,requestedAmount:!0})},[t]);const P=V.useMemo(()=>$?new Set:new Set(Object.keys(ie)),[$,ie]),se=V.useMemo(()=>{const H=new Set(["businessName","industry","businessType","ein","yearsInBusiness","numberOfEmployees","ownerName","email","phone","address","annualRevenue"]);let j=0;return H.forEach(R=>{P.has(R)&&j++}),j},[P]),F=V.useRef(!1),W=V.useMemo(()=>["Retail","Restaurant","Healthcare","Construction","Professional Services","Transportation","Manufacturing","Technology","Real Estate","Other"],[]),ne=V.useMemo(()=>["Sole Proprietorship","Partnership","LLC","Corporation","S-Corporation"],[]);V.useEffect(()=>{if($)return;const H=async j=>{var R;try{const he=new Set([window.location.origin]),Ae=he.has(j.origin);if(Ae||console.warn("Ignoring extracted message from unallowed origin:",j.origin,"Allowed:",Array.from(he)),Ae&&((R=j.data)==null?void 0:R.type)==="webhook-response"){const tt=j.data.payload;if(b(tt),console.log("Extracted data received:",JSON.stringify(tt,null,2)),console.log("Extracted data type:",typeof tt),console.log("Extracted data keys:",tt?Object.keys(tt):"No data"),tt){const Pt={},je=tt;console.log("Processing extracted data:",je);let Ge=je;const I=["extractedData","data","fields","formData","values"];for(const O of I)if(je&&typeof je=="object"&&O in je&&je[O]&&typeof je[O]=="object"){console.log(`Found data in ${O} property`),Ge=je[O];break}console.log("Final data to process:",Ge);const L={},z=(O,te="")=>{O&&typeof O=="object"&&!Array.isArray(O)&&Object.entries(O).forEach(([ae,Ne])=>{const Ce=te?`${te}.${ae}`:ae;Ne&&typeof Ne=="object"&&!Array.isArray(Ne)?z(Ne,Ce):(L[Ce]=Ne,L[ae]=Ne)})};z(je),console.log("Flattened data:",L),[Ge,L].forEach(O=>{Object.entries(O).forEach(([te,ae])=>{let Ne="";if(typeof ae=="string")Ne=ae;else if(typeof ae=="number"||typeof ae=="boolean")Ne=String(ae);else return;Ne.trim()!==""&&(Pt[te]=Ne,te==="Credit Score"||te==="Number of Employees"?Pt[te]=Ne.replace(/[^0-9]/g,""):["Requested Amount","Annual Revenue","Average Monthly Revenue","Average Monthly Deposits","Existing Debt","Years in Business"].includes(te)&&(Pt[te]=Ne.replace(/[^0-9.]/g,"")))})}),console.log("Cleaned extracted keys available:",Object.keys(Pt));const q=O=>O.trim().replace(/:+$/,"").toLowerCase().replace(/[\s_]+/g,""),K=new Map;Object.entries(Pt).forEach(([O,te])=>{new Set([O,O.trim(),O.replace(/:+$/,"")]).forEach(Ne=>K.set(q(Ne),te))});const U=new Set,J={};if(C(O=>{const te={...O},ae=(ge,me)=>{const G=le=>le.toLowerCase().replace(/[^a-z0-9]+/g," ").trim(),Z=G(ge);for(const le of me)if(G(le)===Z)return le;const ce=new Set(Z.split(" "));let Ee=null;for(const le of me){const nt=G(le),ut=new Set(nt.split(" "));let Ct=0;ce.forEach(gf=>{ut.has(gf)&&Ct++}),(!Ee||Ct>Ee.score)&&(Ee={opt:le,score:Ct})}return Ee&&Ee.score>0?Ee.opt:me.includes("Other")?"Other":me[0]||""},Ne=ge=>{for(const me of ge){const G=Pt[me];if(typeof G=="string"&&G.trim()!=="")return G;const Z=Pt[`${me}:`];if(typeof Z=="string"&&Z.trim()!=="")return Z;const ce=K.get(q(me));if(typeof ce=="string"&&ce.trim()!=="")return ce}},Ce=(ge,me,G)=>{let Z=Ne(me);if(!Z){console.log(`Skipped empty: ${String(ge)}`);return}if(G){const le=G(Z);if(!le||le.toString().trim()===""){console.log(`Transform produced empty for ${String(ge)} from '${Z}', skipping.`);return}Z=le}const ce=String(te[ge]??""),Ee=T[String(ge)];!ce||ce.trim()===""?(te[ge]=Z,U.add(String(ge)),J[String(ge)]=Z,console.log(`Filled empty: ${String(ge)} ->`,Z)):Ee!==void 0&&ce===Ee?(te[ge]=Z,U.add(String(ge)),J[String(ge)]=Z,console.log(`Updated auto-filled: ${String(ge)} ${ce} -> ${Z}`)):console.log(`Preserved user edit: ${String(ge)} (current: ${ce})`)};return Ce("businessName",["Business Name","business_name","businessName","company","Company Name","company_name"]),Ce("ownerName",["Owner Name","owner_name","ownerName","name","Name","full_name","Full Name"]),Ce("email",["Email","email","email_address","emailAddress","contact_email"]),Ce("phone",["Phone","phone","phone_number","phoneNumber","contact_phone","telephone"]),Ce("address",["Business Address","business_address","businessAddress","address","Address","location"]),Ce("ein",["EIN","ein","tax_id","taxId","employer_identification_number"]),Ce("businessType",["Business Type","business_type","businessType","company_type","entity_type"],ge=>ae(ge,ne)),Ce("industry",["Industry","industry","business_industry","sector","business_sector"],ge=>ae(ge,W)),Ce("yearsInBusiness",["Years in Business","years_in_business","yearsInBusiness","business_age","company_age"]),Ce("numberOfEmployees",["Number of Employees","number_of_employees","numberOfEmployees","employee_count","staff_count"]),Ce("annualRevenue",["Annual Revenue","annual_revenue","annualRevenue","yearly_revenue","revenue"]),Ce("averageMonthlyRevenue",["Average Monthly Revenue","average_monthly_revenue","averageMonthlyRevenue","monthly_revenue"]),Ce("averageMonthlyDeposits",["Average Monthly Deposits","average_monthly_deposits","averageMonthlyDeposits","monthly_deposits"]),Ce("existingDebt",["Existing Debt","existing_debt","existingDebt","current_debt","debt"]),Ce("creditScore",["Credit Score","credit_score","creditScore","fico_score","credit_rating"]),Ce("requestedAmount",["Requested Amount","requested_amount","requestedAmount","loan_amount","funding_amount"]),te}),Object.keys(J).length>0&&D(O=>({...O,...J})),!$&&U.size>0&&pe(O=>{const te={...O};return U.forEach(ae=>{te[ae]=!0}),te}),c==="upload"&&!t)if(i){const O=ge=>{for(const me of ge){const G=K.get(q(me));if(G!=null&&`${G}`.trim()!=="")return`${G}`}},te=(ge,me)=>{const G=le=>le.toLowerCase().replace(/[^a-z0-9]+/g," ").trim(),Z=G(ge),ce=me.find(le=>G(le)===Z);return ce||me.find(le=>Z.startsWith(G(le))||G(le).startsWith(Z))||ge},ae=ge=>{if(!ge)return;const me=ge.replace(/[^0-9.]/g,""),G=me.split("."),Z=G.length>2?`${G[0]}.${G.slice(1).join("")}`:me,ce=Number(Z);return Number.isNaN(ce)?void 0:ce},Ne=(()=>{const ge=k.documents||[],G=[...M!=null&&M.name?[M.name]:[],...ge].filter(Boolean);return G.length>0?G:[]})(),Ce={businessName:O(["Business Name","business_name","businessName","company","Company Name","company_name"])||"",creditScore:ae(O(["Credit Score","credit_score","creditScore","fico_score","credit_rating"])),industry:te(O(["Industry","industry","business_industry","sector","business_sector"])||"",W),requestedAmount:ae(O(["Requested Amount","requested_amount","requestedAmount","loan_amount","funding_amount"])),contactInfo:{ownerName:O(["Owner Name","owner_name","ownerName","name","Name","full_name","Full Name"])||"",email:O(["Email","email","email_address","emailAddress","contact_email"])||"",phone:O(["Phone","phone","phone_number","phoneNumber","contact_phone","telephone"])||"",address:O(["Business Address","business_address","businessAddress","address","Address","location"])||""},businessInfo:{ein:O(["EIN","ein","tax_id","taxId","employer_identification_number"])||"",businessType:te(O(["Business Type","business_type","businessType","company_type","entity_type"])||"",ne),yearsInBusiness:ae(O(["Years in Business","years_in_business","yearsInBusiness","business_age","company_age"])),numberOfEmployees:ae(O(["Number of Employees","number_of_employees","numberOfEmployees","employee_count","staff_count"]))},financialInfo:{annualRevenue:ae(O(["Annual Revenue","annual_revenue","annualRevenue","yearly_revenue","revenue"])),averageMonthlyRevenue:ae(O(["Average Monthly Revenue","average_monthly_revenue","averageMonthlyRevenue","monthly_revenue"])),averageMonthlyDeposits:ae(O(["Average Monthly Deposits","average_monthly_deposits","averageMonthlyDeposits","monthly_deposits"])),existingDebt:ae(O(["Existing Debt","existing_debt","existingDebt","current_debt","debt"]))},documents:Ne};i(Ce),F.current=!0}else d("form")}}}catch(Y){console.error("Error processing extracted response:",Y),console.warn("Failed to process extracted data. Please fill the form manually.")}};return window.addEventListener("message",H),()=>{window.removeEventListener("message",H)}},[c,T,W,ne,$,t,k,i,M==null?void 0:M.name]);const be=async H=>{f(!0),p(0);const j=setInterval(()=>{p(R=>R>=90?R:R+Math.random()*15)},200);try{const R=await zR(H);y(R);const Y=Object.fromEntries(Object.entries(R).filter(([Ae])=>Ae!=="businessName"&&Ae!=="address"));C(Ae=>({...Ae,...Y}));const he={...k,...Y};if($||pe(Ae=>{const tt={...Ae};return Object.keys(Y).forEach(Pt=>{tt[Pt]=!0}),tt}),!t)if(i){const Ae={businessName:he.businessName,creditScore:Number(he.creditScore)||void 0,industry:he.industry,requestedAmount:Number(he.requestedAmount)||void 0,contactInfo:{ownerName:he.ownerName,email:he.email,phone:he.phone,address:he.address},businessInfo:{ein:he.ein,businessType:he.businessType,yearsInBusiness:he.yearsInBusiness?Number(he.yearsInBusiness):void 0,numberOfEmployees:he.numberOfEmployees?Number(he.numberOfEmployees):void 0},financialInfo:{annualRevenue:he.annualRevenue?Number(he.annualRevenue):void 0,averageMonthlyRevenue:he.averageMonthlyRevenue?Number(he.averageMonthlyRevenue):void 0,averageMonthlyDeposits:he.averageMonthlyDeposits?Number(he.averageMonthlyDeposits):void 0,existingDebt:he.existingDebt?Number(he.existingDebt):void 0},documents:he.documents};setTimeout(()=>{if(!F.current){const tt=(()=>{const je=k.documents||[],I=[...M!=null&&M.name?[M.name]:[],...je].filter(Boolean);return I.length>0?I:[]})(),Pt={...Ae,documents:tt};i(Pt)}},1200)}else d("form")}catch(R){console.error("Error extracting data from PDF:",R),alert("Error extracting data from PDF. Please fill the form manually."),t||d("form")}finally{clearInterval(j),p(100),setTimeout(()=>{f(!1),p(0)},500)}},_e=async H=>{var R;const j=(R=H.target.files)==null?void 0:R[0];j&&(E(j),await be(j))},Oe=H=>{H.preventDefault(),H.stopPropagation(),w.current+=1,_(!0)},et=H=>{H.preventDefault(),H.stopPropagation(),H.dataTransfer.dropEffect="copy",x||_(!0)},qe=H=>{H.preventDefault(),H.stopPropagation(),w.current=Math.max(0,w.current-1),w.current===0&&_(!1)},Se=async H=>{var he;H.preventDefault(),H.stopPropagation(),_(!1),w.current=0;const j=(he=H.dataTransfer.files)==null?void 0:he[0];if(!j)return;const R=j.name.toLowerCase();(R.endsWith(".pdf")||R.endsWith(".doc")||R.endsWith(".docx")||j.type==="application/pdf")&&(E(j),await be(j))},Q=()=>{const H={};return k.businessName||(H.businessName="Business name is required"),k.ownerName||(H.ownerName="Owner name is required"),k.industry||(H.industry="Please select an industry"),k.businessType||(H.businessType="Please select a business type"),k.yearsInBusiness?Number(k.yearsInBusiness)<0&&(H.yearsInBusiness="Years in business must be a positive number"):H.yearsInBusiness="Years in business is required",ee(H),Object.keys(H).length===0},Ve=H=>{if(H.preventDefault(),!Q())return;(async()=>{try{if(t){const tt={id:(s==null?void 0:s.id)||"",businessName:k.businessName,monthlyRevenue:Number(k.averageMonthlyRevenue),timeInBusiness:Number(k.yearsInBusiness),creditScore:Number(k.creditScore),industry:k.industry,requestedAmount:Number(k.requestedAmount),status:"submitted",contactInfo:{ownerName:k.ownerName,email:k.email,phone:k.phone,address:k.address},businessInfo:{ein:k.ein,businessType:k.businessType,yearsInBusiness:Number(k.yearsInBusiness),numberOfEmployees:Number(k.numberOfEmployees)},financialInfo:{annualRevenue:Number(k.annualRevenue),averageMonthlyRevenue:Number(k.averageMonthlyRevenue)||0,averageMonthlyDeposits:Number(k.averageMonthlyDeposits)||0,existingDebt:Number(k.existingDebt)||0},documents:k.documents};r&&r(tt);return}const R={business_name:k.businessName,owner_name:k.ownerName,email:k.email,phone:k.phone,address:k.address,ein:k.ein,business_type:k.businessType,industry:k.industry,years_in_business:Number(k.yearsInBusiness),number_of_employees:Number(k.numberOfEmployees),annual_revenue:Number(k.annualRevenue),monthly_revenue:Number(k.averageMonthlyRevenue)||0,monthly_deposits:Number(k.averageMonthlyDeposits)||0,existing_debt:Number(k.existingDebt)||0,credit_score:Number(k.creditScore)||0,requested_amount:Number(k.requestedAmount)||0,status:"submitted",documents:k.documents},Y=await xb(R),he={id:Y.id,businessName:Y.business_name,monthlyRevenue:Y.monthly_revenue,timeInBusiness:Y.years_in_business,creditScore:Y.credit_score,industry:Y.industry,requestedAmount:Y.requested_amount,status:Y.status,contactInfo:{ownerName:Y.owner_name,email:Y.email,phone:Y.phone||"",address:Y.address||""},businessInfo:{ein:Y.ein||"",businessType:Y.business_type||"",yearsInBusiness:Y.years_in_business,numberOfEmployees:Y.number_of_employees},financialInfo:{annualRevenue:Y.annual_revenue,averageMonthlyRevenue:Y.monthly_revenue??0,averageMonthlyDeposits:Y.monthly_deposits??0,existingDebt:Y.existing_debt??0},documents:Y.documents},Ae=M&&(M.type==="application/pdf"||M.name.toLowerCase().endsWith(".pdf"))?{pdfFile:M}:null;n(he,Ae)}catch(R){console.error("Error saving application:",R),alert("Error saving application. Please try again.")}})()};return c==="upload"?u.jsxs("div",{className:"bg-white rounded-xl shadow-lg",children:[u.jsxs("div",{className:"px-8 py-6 border-b border-gray-200",children:[u.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Upload Application Document"}),u.jsx("p",{className:"text-gray-600 mt-1",children:"Upload your completed MCA application form to auto-populate the submission"})]}),u.jsxs("div",{className:"p-8",children:[h?u.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[u.jsx("div",{className:"p-4 bg-gradient-to-br from-blue-100 to-indigo-100 rounded-2xl mb-6 shadow-sm",children:u.jsx(z0,{className:"w-8 h-8 text-blue-600 animate-spin"})}),u.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-3",children:"Processing Your Document"}),u.jsx("p",{className:"text-gray-600 mb-6 max-w-md leading-relaxed",children:"We're extracting information from your application document..."}),u.jsxs("div",{className:"max-w-md mx-auto w-full",children:[u.jsx("div",{className:"bg-gray-200 rounded-full h-3 overflow-hidden",children:u.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-600 h-3 rounded-full transition-all duration-500 ease-out",style:{width:`${Math.min(m,100)}%`}})}),u.jsx("p",{className:"text-sm text-gray-500 mt-3 font-medium",children:m<100?"This usually takes 30-60 seconds":"Almost done..."})]})]}):u.jsx("div",{className:`relative p-10 border-2 border-dashed rounded-3xl text-center transition-all duration-300 bg-gradient-to-br from-gray-50/50 via-white to-blue-50/30 hover:border-blue-400 hover:bg-gradient-to-br hover:from-blue-50/50 hover:to-indigo-50/50 hover:shadow-lg hover:scale-[1.01] ${x?"border-blue-500 ring-4 ring-blue-400/30":"border-gray-300"}`,onDragEnter:Oe,onDragOver:et,onDragLeave:qe,onDrop:Se,"aria-label":"Drop your application document here",children:u.jsxs("div",{className:"relative",children:[u.jsx("div",{className:"p-4 bg-gradient-to-br from-blue-100 to-indigo-100 rounded-2xl w-fit mx-auto mb-6 shadow-sm",children:u.jsx(Dg,{className:"w-8 h-8 text-blue-600"})}),u.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-3",children:"Upload Application Document"}),u.jsx("p",{className:"text-sm text-gray-600 mb-8 max-w-md mx-auto leading-relaxed",children:"We'll automatically extract your business information from PDF, DOC, or DOCX files."}),u.jsxs("label",{className:"cursor-pointer inline-flex items-center gap-3 px-8 py-4 rounded-2xl bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-bold hover:from-blue-700 hover:to-indigo-700 focus:outline-none focus:ring-4 focus:ring-blue-500/40 transition-all duration-200 shadow-lg hover:shadow-xl hover:scale-105",children:[u.jsx(Dg,{className:"w-5 h-5"}),"Choose Application File",u.jsx("input",{id:"document-upload",name:"document-upload",type:"file",className:"sr-only",accept:".pdf,.doc,.docx",onChange:_e})]}),u.jsx("p",{className:"text-xs text-gray-500 mt-4 font-medium",children:"PDF, DOC, DOCX files only, max 10MB"})]})}),u.jsx("div",{className:"mt-8 pt-6 border-t border-gray-200",children:u.jsx("button",{onClick:()=>{d("form"),y(null),b(null),E(null),pe({})},className:"text-blue-600 hover:text-blue-700 font-medium",children:"Skip and fill form manually →"})})]})]}):u.jsx("div",{className:"max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:u.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm",children:[u.jsxs("div",{className:"px-8 py-6 border-b border-gray-200",children:[u.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Merchant Cash Advance Application"}),u.jsx("p",{className:"text-gray-600 mt-1",children:g||N?"Review and confirm the extracted information":"Please fill out all required information to get matched with qualified lenders"})]}),(M||t)&&u.jsx("div",{className:"mt-3 p-3 bg-blue-50 rounded-lg",children:u.jsxs("div",{className:"flex items-center w-full",children:[u.jsx(Dg,{className:"w-4 h-4 text-blue-600 mr-2"}),(()=>{const H=t?a??"":(M==null?void 0:M.name)??"";return u.jsx("span",{className:"text-sm text-blue-800 font-medium truncate",title:H||void 0,children:H?`Source Document: ${H}`:"No source document detected"})})(),u.jsx("button",{onClick:()=>{t?o&&o():(d("upload"),E(null),y(null),C({businessName:"",ownerName:"",email:"",phone:"",address:"",ein:"",businessType:"",industry:"",yearsInBusiness:"",numberOfEmployees:"",annualRevenue:"",averageMonthlyRevenue:"",averageMonthlyDeposits:"",existingDebt:"",creditScore:"",requestedAmount:"",documents:[]}))},className:"ml-auto text-blue-600 hover:text-blue-800 text-sm",children:"Upload Different Document"})]})}),u.jsxs("form",{onSubmit:Ve,className:"p-8",children:[se>0&&u.jsxs("div",{className:"mb-8 relative overflow-hidden rounded-2xl border border-emerald-200 bg-gradient-to-br from-emerald-50 via-green-50 to-teal-50 p-6 shadow-lg",children:[u.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-emerald-100/20 to-teal-100/20 opacity-50"}),u.jsxs("div",{className:"relative flex items-start gap-4",children:[u.jsx("div",{className:"flex-shrink-0 p-3 bg-gradient-to-br from-emerald-100 to-green-100 rounded-2xl shadow-sm border border-emerald-200",children:u.jsx(Ks,{className:"w-6 h-6 text-emerald-700"})}),u.jsxs("div",{className:"flex-1",children:[u.jsx("h4",{className:"text-lg font-bold text-emerald-900 mb-2",children:"Data Extraction Complete"}),u.jsxs("p",{className:"text-emerald-800 font-medium mb-2",children:[se," fields automatically populated from your documents"]}),u.jsx("p",{className:"text-sm text-emerald-700 leading-relaxed",children:"Review the highlighted fields below. All information can be edited if needed."})]}),u.jsx("div",{className:"flex-shrink-0",children:u.jsxs("span",{className:"inline-flex items-center px-4 py-2 rounded-full text-sm font-bold bg-gradient-to-r from-emerald-100 to-green-100 text-emerald-800 border border-emerald-200 shadow-sm",children:[se," Fields"]})})]})]}),u.jsxs("div",{className:"mb-8",children:[u.jsxs("div",{className:"mb-6",children:[u.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[u.jsx("div",{className:"p-2 bg-gradient-to-br from-blue-100 to-indigo-100 rounded-xl shadow-sm border border-blue-200",children:u.jsx(zs,{className:"w-5 h-5 text-blue-700"})}),u.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Business Information"})]}),u.jsx("p",{className:"text-sm text-gray-600 ml-12",children:"Basic details about your business"})]}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"relative",children:[u.jsx("label",{className:"block text-sm font-bold text-gray-800 mb-2",htmlFor:"businessName",children:"Business Name"}),u.jsx("input",{type:"text",id:"businessName",value:k.businessName,onChange:H=>C({...k,businessName:H.target.value}),className:`w-full rounded-xl border-2 px-4 py-3 text-gray-900 font-medium transition-all duration-200 focus:outline-none ${P.has("businessName")?"border-emerald-300 bg-gradient-to-r from-emerald-50 to-green-50 ring-2 ring-emerald-200/50 shadow-sm focus:border-emerald-400 focus:ring-emerald-300/50":"border-gray-200 bg-white hover:border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 shadow-sm hover:shadow-sm"}`}),P.has("businessName")&&u.jsxs("div",{className:"mt-2 flex items-center gap-2 text-emerald-700 text-xs font-medium",children:[u.jsx("div",{className:"w-2 h-2 bg-emerald-500 rounded-full animate-pulse"}),u.jsx("span",{children:"Extracted from documents"})]})]}),B.businessName&&u.jsx("p",{className:"mt-1 text-sm text-red-600",children:B.businessName})]}),u.jsxs("div",{className:"relative",children:[u.jsx("label",{className:"block text-sm font-bold text-gray-800 mb-2",htmlFor:"industry",children:"Industry*"}),u.jsxs("select",{id:"industry",value:k.industry,onChange:H=>C({...k,industry:H.target.value}),className:`w-full rounded-xl border-2 px-4 py-3 text-gray-900 font-medium transition-all duration-200 focus:outline-none ${P.has("industry")?"border-emerald-300 bg-gradient-to-r from-emerald-50 to-green-50 ring-2 ring-emerald-200/50 shadow-sm focus:border-emerald-400 focus:ring-emerald-300/50":B.industry?"border-red-300 bg-white focus:border-red-500 focus:ring-2 focus:ring-red-500/20 shadow-sm":"border-gray-200 bg-white hover:border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 shadow-sm hover:shadow-sm"}`,children:[u.jsx("option",{value:"",children:"Select Industry"}),W.map(H=>u.jsx("option",{value:H,children:H},H))]}),P.has("industry")&&u.jsxs("div",{className:"mt-2 flex items-center gap-2 text-emerald-700 text-xs font-medium",children:[u.jsx("div",{className:"w-2 h-2 bg-emerald-500 rounded-full animate-pulse"}),u.jsx("span",{children:"Extracted from documents"})]}),B.industry&&u.jsx("p",{className:"mt-1 text-sm text-red-600",children:B.industry})]}),u.jsxs("div",{className:"relative",children:[u.jsx("label",{className:"block text-sm font-bold text-gray-800 mb-2",htmlFor:"businessType",children:"Business Type*"}),u.jsxs("select",{id:"businessType",value:k.businessType,onChange:H=>C({...k,businessType:H.target.value}),className:`w-full rounded-xl border-2 px-4 py-3 text-gray-900 font-medium transition-all duration-200 focus:outline-none ${P.has("businessType")?"border-emerald-300 bg-gradient-to-r from-emerald-50 to-green-50 ring-2 ring-emerald-200/50 shadow-sm focus:border-emerald-400 focus:ring-emerald-300/50":B.businessType?"border-red-300 bg-white focus:border-red-500 focus:ring-2 focus:ring-red-500/20 shadow-sm":"border-gray-200 bg-white hover:border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 shadow-sm hover:shadow-sm"}`,children:[u.jsx("option",{value:"",children:"Select Business Type"}),ne.map(H=>u.jsx("option",{value:H,children:H},H))]}),P.has("businessType")&&u.jsxs("div",{className:"mt-2 flex items-center gap-2 text-emerald-700 text-xs font-medium",children:[u.jsx("div",{className:"w-2 h-2 bg-emerald-500 rounded-full animate-pulse"}),u.jsx("span",{children:"Extracted from documents"})]}),B.businessType&&u.jsx("p",{className:"mt-1 text-sm text-red-600",children:B.businessType})]}),u.jsxs("div",{className:"relative",children:[u.jsx("label",{className:"block text-sm font-bold text-gray-800 mb-2",htmlFor:"ein",children:"EIN"}),u.jsx("input",{type:"text",id:"ein",value:k.ein,onChange:H=>C({...k,ein:H.target.value}),className:`w-full rounded-xl border-2 px-4 py-3 text-gray-900 font-medium transition-all duration-200 focus:outline-none ${P.has("ein")?"border-emerald-300 bg-gradient-to-r from-emerald-50 to-green-50 ring-2 ring-emerald-200/50 shadow-sm focus:border-emerald-400 focus:ring-emerald-300/50":"border-gray-200 bg-white hover:border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 shadow-sm hover:shadow-sm"}`}),P.has("ein")&&u.jsxs("div",{className:"mt-2 flex items-center gap-2 text-emerald-700 text-xs font-medium",children:[u.jsx("div",{className:"w-2 h-2 bg-emerald-500 rounded-full animate-pulse"}),u.jsx("span",{children:"Extracted from documents"})]})]}),u.jsxs("div",{className:"relative",children:[u.jsx("label",{className:"block text-sm font-bold text-gray-800 mb-2",htmlFor:"yearsInBusiness",children:"Years in Business*"}),u.jsx("input",{type:"number",id:"yearsInBusiness",value:k.yearsInBusiness,onChange:H=>C({...k,yearsInBusiness:H.target.value}),className:`w-full rounded-xl border-2 px-4 py-3 text-gray-900 font-medium transition-all duration-200 focus:outline-none ${P.has("yearsInBusiness")?"border-emerald-300 bg-gradient-to-r from-emerald-50 to-green-50 ring-2 ring-emerald-200/50 shadow-sm focus:border-emerald-400 focus:ring-emerald-300/50":B.yearsInBusiness?"border-red-300 bg-white focus:border-red-500 focus:ring-2 focus:ring-red-500/20 shadow-sm":"border-gray-200 bg-white hover:border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 shadow-sm hover:shadow-sm"}`}),P.has("yearsInBusiness")&&u.jsxs("div",{className:"mt-2 flex items-center gap-2 text-emerald-700 text-xs font-medium",children:[u.jsx("div",{className:"w-2 h-2 bg-emerald-500 rounded-full animate-pulse"}),u.jsx("span",{children:"Extracted from documents"})]}),B.yearsInBusiness&&u.jsx("p",{className:"mt-1 text-sm text-red-600",children:B.yearsInBusiness})]}),u.jsxs("div",{className:"relative",children:[u.jsx("label",{className:"block text-sm font-bold text-gray-800 mb-2",htmlFor:"numberOfEmployees",children:"Number of Employees"}),u.jsx("input",{type:"number",id:"numberOfEmployees",value:k.numberOfEmployees,onChange:H=>C({...k,numberOfEmployees:H.target.value}),className:`w-full rounded-xl border-2 px-4 py-3 text-gray-900 font-medium transition-all duration-200 focus:outline-none ${P.has("numberOfEmployees")?"border-emerald-300 bg-gradient-to-r from-emerald-50 to-green-50 ring-2 ring-emerald-200/50 shadow-sm focus:border-emerald-400 focus:ring-emerald-300/50":"border-gray-200 bg-white hover:border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 shadow-sm hover:shadow-sm"}`}),P.has("numberOfEmployees")&&u.jsxs("div",{className:"mt-2 flex items-center gap-2 text-emerald-700 text-xs font-medium",children:[u.jsx("div",{className:"w-2 h-2 bg-emerald-500 rounded-full animate-pulse"}),u.jsx("span",{children:"Extracted from documents"})]})]})]})]}),u.jsxs("div",{className:"mb-8",children:[u.jsxs("div",{className:"mb-6",children:[u.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[u.jsx("div",{className:"p-2 bg-gradient-to-br from-purple-100 to-violet-100 rounded-xl shadow-sm border border-purple-200",children:u.jsx(pC,{className:"w-5 h-5 text-purple-700"})}),u.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Contact Information"})]}),u.jsx("p",{className:"text-sm text-gray-600 ml-12",children:"Owner and business contact details"})]}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"relative",children:[u.jsx("label",{className:"block text-sm font-bold text-gray-800 mb-2",htmlFor:"ownerName",children:"Owner Name"}),u.jsx("input",{type:"text",id:"ownerName",value:k.ownerName,onChange:H=>C({...k,ownerName:H.target.value}),className:`w-full rounded-xl border-2 px-4 py-3 text-gray-900 font-medium transition-all duration-200 focus:outline-none ${P.has("ownerName")?"border-emerald-300 bg-gradient-to-r from-emerald-50 to-green-50 ring-2 ring-emerald-200/50 shadow-sm focus:border-emerald-400 focus:ring-emerald-300/50":"border-gray-200 bg-white hover:border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 shadow-sm hover:shadow-sm"}`}),P.has("ownerName")&&u.jsxs("div",{className:"mt-2 flex items-center gap-2 text-emerald-700 text-xs font-medium",children:[u.jsx("div",{className:"w-2 h-2 bg-emerald-500 rounded-full animate-pulse"}),u.jsx("span",{children:"Extracted from documents"})]})]}),B.ownerName&&u.jsx("p",{className:"mt-1 text-sm text-red-600",children:B.ownerName})]}),u.jsxs("div",{className:"relative",children:[u.jsx("label",{className:"block text-sm font-bold text-gray-800 mb-2",htmlFor:"email",children:"Email*"}),u.jsx("input",{type:"email",id:"email",value:k.email,onChange:H=>C({...k,email:H.target.value}),className:`w-full rounded-xl border-2 px-4 py-3 text-gray-900 font-medium transition-all duration-200 focus:outline-none ${P.has("email")?"border-emerald-300 bg-gradient-to-r from-emerald-50 to-green-50 ring-2 ring-emerald-200/50 shadow-sm focus:border-emerald-400 focus:ring-emerald-300/50":B.email?"border-red-300 bg-white focus:border-red-500 focus:ring-2 focus:ring-red-500/20 shadow-sm":"border-gray-200 bg-white hover:border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 shadow-sm hover:shadow-sm"}`}),P.has("email")&&u.jsxs("div",{className:"mt-2 flex items-center gap-2 text-emerald-700 text-xs font-medium",children:[u.jsx("div",{className:"w-2 h-2 bg-emerald-500 rounded-full animate-pulse"}),u.jsx("span",{children:"Extracted from documents"})]}),B.email&&u.jsx("p",{className:"mt-1 text-sm text-red-600",children:B.email})]}),u.jsxs("div",{className:"relative",children:[u.jsx("label",{className:"block text-sm font-bold text-gray-800 mb-2",htmlFor:"phone",children:"Phone*"}),u.jsx("input",{type:"tel",id:"phone",value:k.phone,onChange:H=>C({...k,phone:H.target.value}),className:`w-full rounded-xl border-2 px-4 py-3 text-gray-900 font-medium transition-all duration-200 focus:outline-none ${P.has("phone")?"border-emerald-300 bg-gradient-to-r from-emerald-50 to-green-50 ring-2 ring-emerald-200/50 shadow-sm focus:border-emerald-400 focus:ring-emerald-300/50":B.phone?"border-red-300 bg-white focus:border-red-500 focus:ring-2 focus:ring-red-500/20 shadow-sm":"border-gray-200 bg-white hover:border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 shadow-sm hover:shadow-sm"}`}),P.has("phone")&&u.jsxs("div",{className:"mt-2 flex items-center gap-2 text-emerald-700 text-xs font-medium",children:[u.jsx("div",{className:"w-2 h-2 bg-emerald-500 rounded-full animate-pulse"}),u.jsx("span",{children:"Extracted from documents"})]}),B.phone&&u.jsx("p",{className:"mt-1 text-sm text-red-600",children:B.phone})]}),u.jsxs("div",{className:"relative",children:[u.jsx("label",{className:"block text-sm font-bold text-gray-800 mb-2",htmlFor:"address",children:"Business Address"}),u.jsx("input",{type:"text",id:"address",value:k.address,onChange:H=>C({...k,address:H.target.value}),className:`w-full rounded-xl border-2 px-4 py-3 text-gray-900 font-medium transition-all duration-200 focus:outline-none ${P.has("address")?"border-emerald-300 bg-gradient-to-r from-emerald-50 to-green-50 ring-2 ring-emerald-200/50 shadow-sm focus:border-emerald-400 focus:ring-emerald-300/50":"border-gray-200 bg-white hover:border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 shadow-sm hover:shadow-sm"}`}),P.has("address")&&u.jsxs("div",{className:"mt-2 flex items-center gap-2 text-emerald-700 text-xs font-medium",children:[u.jsx("div",{className:"w-2 h-2 bg-emerald-500 rounded-full animate-pulse"}),u.jsx("span",{children:"Extracted from documents"})]})]})]})]}),u.jsxs("div",{className:"mb-8",children:[u.jsxs("div",{className:"mb-6",children:[u.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[u.jsx("div",{className:"p-2 bg-gradient-to-br from-green-100 to-emerald-100 rounded-xl shadow-sm border border-green-200",children:u.jsx(sp,{className:"w-5 h-5 text-green-700"})}),u.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Financial Information"})]}),u.jsx("p",{className:"text-sm text-gray-600 ml-12",children:"Annual revenue and financial metrics"})]}),u.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:u.jsx("div",{children:u.jsxs("div",{className:"relative",children:[u.jsx("label",{className:"block text-sm font-bold text-gray-800 mb-2",htmlFor:"annualRevenue",children:"Annual Revenue"}),u.jsxs("div",{className:"relative",children:[u.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:u.jsx("span",{className:"text-gray-500 font-medium",children:"$"})}),u.jsx("input",{type:"number",id:"annualRevenue",value:k.annualRevenue,onChange:H=>C({...k,annualRevenue:H.target.value}),className:`w-full pl-8 pr-4 py-3 rounded-xl border-2 text-gray-900 font-medium transition-all duration-200 focus:outline-none ${P.has("annualRevenue")?"border-emerald-300 bg-gradient-to-r from-emerald-50 to-green-50 ring-2 ring-emerald-200/50 shadow-sm focus:border-emerald-400 focus:ring-emerald-300/50":"border-gray-200 bg-white hover:border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 shadow-sm hover:shadow-sm"}`})]}),P.has("annualRevenue")&&u.jsxs("div",{className:"mt-2 flex items-center gap-2 text-emerald-700 text-xs font-medium",children:[u.jsx("div",{className:"w-2 h-2 bg-emerald-500 rounded-full animate-pulse"}),u.jsx("span",{children:"Extracted from documents"})]})]})})})]}),u.jsx("div",{className:"flex justify-end pt-8 mt-8 border-t border-gray-100",children:u.jsxs("button",{type:"submit",className:"inline-flex items-center gap-3 px-8 py-4 rounded-2xl font-bold text-lg shadow-lg transition-all duration-200 focus:outline-none focus:ring-4 bg-gradient-to-r from-blue-600 to-indigo-600 text-white hover:from-blue-700 hover:to-indigo-700 hover:shadow-xl hover:scale-105 focus:ring-blue-500/40",children:["Submit Application",u.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:u.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7l5 5m0 0l-5 5m5-5H6"})})]})})]})]})})},WR=({onContinue:n,application:e,onReplaceDocument:t})=>{const s=(()=>{const i=e!=null&&e.documents&&e.documents.length>0?e.documents[0]:"";if(!i)return"";const a=i.split(/[/\\]/);return a[a.length-1]})(),r=async i=>{var o,c,d,h,f,m,p,g,y,N,b,x;let a=null;try{const _={business_name:i.businessName,owner_name:((o=i.contactInfo)==null?void 0:o.ownerName)??"",email:((c=i.contactInfo)==null?void 0:c.email)??"",phone:((d=i.contactInfo)==null?void 0:d.phone)??"",address:((h=i.contactInfo)==null?void 0:h.address)??"",ein:((f=i.businessInfo)==null?void 0:f.ein)??"",business_type:((m=i.businessInfo)==null?void 0:m.businessType)??"",industry:i.industry,years_in_business:Number(((p=i.businessInfo)==null?void 0:p.yearsInBusiness)??i.timeInBusiness??0)||0,number_of_employees:Number(((g=i.businessInfo)==null?void 0:g.numberOfEmployees)??0)||0,annual_revenue:Number(((y=i.financialInfo)==null?void 0:y.annualRevenue)??0)||0,monthly_revenue:Number(((N=i.financialInfo)==null?void 0:N.averageMonthlyRevenue)??i.monthlyRevenue??0)||0,monthly_deposits:Number(((b=i.financialInfo)==null?void 0:b.averageMonthlyDeposits)??0)||0,existing_debt:Number(((x=i.financialInfo)==null?void 0:x.existingDebt)??0)||0,credit_score:Number(i.creditScore??0)||0,requested_amount:Number(i.requestedAmount??0)||0,status:i.status??"submitted",documents:Array.isArray(i.documents)?i.documents:[]};if(i.id)console.log("[BankStatement] Updating application id",i.id,"with payload",_),await k1(i.id,_);else{console.log("[BankStatement] Creating application with payload",_);const w=await xb(_);console.log("[BankStatement] Created application id",w.id),a=w.id}}catch(_){console.error("[BankStatement] Failed to persist application on review submit:",_)}finally{const _={...i,id:(i==null?void 0:i.id)||a||""};n(_)}};return u.jsx(kN,{initialStep:"form",reviewMode:!0,reviewInitial:e,reviewDocName:s,onReplaceDocument:t,onReviewSubmit:r,onSubmit:()=>{}},JSON.stringify(e))},VR=({application:n,matches:e,onLenderSelect:t,onBack:s,lockedLenderIds:r=[]})=>{const[i,a]=V.useState([]),[o,c]=V.useState([]),[d,h]=V.useState(!0),f=V.useMemo(()=>new Set(r),[r]);V.useEffect(()=>{(async()=>{if(n)try{h(!0);const N=await wb()||[],x=["draft","submitted","under-review","approved","funded","declined"].includes(n.status)?n.status:"draft",_={id:"",business_name:n.businessName||"",owner_name:n.ownerName||"",email:n.email||"",phone:n.phone||"",address:n.address||"",ein:n.ein||"",business_type:n.businessType||"",industry:n.industry||"",years_in_business:n.yearsInBusiness||0,number_of_employees:n.numberOfEmployees||0,annual_revenue:n.annualRevenue||0,monthly_revenue:n.monthlyRevenue||0,monthly_deposits:n.monthlyDeposits||0,existing_debt:n.existingDebt||0,credit_score:n.creditScore||0,requested_amount:n.requestedAmount||0,status:x,documents:n.documents||[],created_at:new Date().toISOString(),updated_at:new Date().toISOString()},w=await $2(N,_);if(Array.isArray(e)&&e.length>0){const k=new Map(w.map(T=>[T.id,T])),C=[];for(const T of e){const D=k.get(T.lender_id);D&&C.push({...D,match_score:T.match_score})}a(C)}else a(w);r&&r.length>0&&c(k=>Array.from(new Set([...r,...k])))}catch(y){console.error("Error loading lenders:",y)}finally{h(!1)}})()},[n,e,r]);const m=g=>{f.has(g)||c(y=>y.includes(g)?y.filter(N=>N!==g):[...y,g])},p=()=>{t(o)};return d?u.jsx("div",{className:"flex items-center justify-center py-12",children:u.jsxs("div",{className:"text-center",children:[u.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-emerald-600 mx-auto mb-4"}),u.jsx("p",{className:"text-gray-600",children:"Finding qualified lenders..."})]})}):n?u.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[u.jsxs("div",{className:"text-center mb-12",children:[u.jsxs("div",{className:"inline-flex items-center px-4 py-2 bg-emerald-50 border border-emerald-200 rounded-full text-emerald-700 text-sm font-medium mb-4",children:[u.jsx(Ks,{className:"w-4 h-4 mr-2"}),i.length," Qualified Lenders Found"]}),u.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-4",children:"Qualified Lenders"}),u.jsx("p",{className:"text-xl text-gray-600 max-w-2xl mx-auto",children:"We've analyzed your business profile and found the best lending partners for your needs"})]}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-12",children:[u.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-lg ring-1 ring-gray-100 hover:shadow-xl transition-shadow h-full",children:[u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsx("div",{className:"w-10 h-10 rounded-xl bg-blue-100 flex items-center justify-center shadow-inner",children:u.jsx(sp,{className:"w-5 h-5 text-blue-600"})}),u.jsx("div",{className:"text-sm font-medium text-gray-600",children:"Requested Amount"})]}),u.jsxs("div",{className:"mt-3 text-3xl font-bold text-slate-800",children:["$",(n.requestedAmount||0).toLocaleString()]})]}),u.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-lg ring-1 ring-gray-100 hover:shadow-xl transition-shadow h-full",children:[u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsx("div",{className:"w-10 h-10 rounded-xl bg-green-100 flex items-center justify-center shadow-inner",children:u.jsx(Jx,{className:"w-5 h-5 text-green-600"})}),u.jsx("div",{className:"text-sm font-medium text-gray-600",children:"Monthly Revenue"})]}),u.jsxs("div",{className:"mt-3 text-3xl font-bold text-slate-800",children:["$",(n.monthlyRevenue||0).toLocaleString()]})]}),u.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-lg ring-1 ring-gray-100 hover:shadow-xl transition-shadow h-full",children:[u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsx("div",{className:"w-10 h-10 rounded-xl bg-purple-100 flex items-center justify-center shadow-inner",children:u.jsx(Yx,{className:"w-5 h-5 text-purple-600"})}),u.jsx("div",{className:"text-sm font-medium text-gray-600",children:"Credit Score"})]}),u.jsx("div",{className:"mt-3 text-3xl font-bold text-slate-800",children:n.creditScore||"N/A"})]}),u.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-lg ring-1 ring-gray-100 hover:shadow-xl transition-shadow h-full",children:[u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsx("div",{className:"w-10 h-10 rounded-xl bg-orange-100 flex items-center justify-center shadow-inner",children:u.jsx(zs,{className:"w-5 h-5 text-orange-600"})}),u.jsx("div",{className:"text-sm font-medium text-gray-600",children:"Industry"})]}),u.jsx("div",{className:"mt-3 text-3xl font-bold text-slate-800",children:n.industry||"N/A"})]})]}),u.jsx("div",{className:"space-y-6",children:i.map(g=>{const y=f.has(g.id),N=o.includes(g.id);return u.jsx("div",{className:`group relative bg-white rounded-2xl border-2 transition-all duration-200 ${y?"border-gray-200 opacity-60 filter cursor-not-allowed":N?"border-emerald-400 bg-gradient-to-r from-emerald-50 to-green-50 shadow-lg shadow-emerald-100/50 cursor-pointer":"border-gray-200 hover:border-blue-300 hover:shadow-xl hover:shadow-blue-100/50 cursor-pointer"}`,onClick:y?void 0:()=>m(g.id),children:u.jsxs("div",{className:"p-8",children:[u.jsxs("div",{className:"flex items-start justify-between mb-6",children:[u.jsxs("div",{className:"flex items-start",children:[u.jsx("div",{className:`w-20 h-20 rounded-2xl flex items-center justify-center mr-6 shadow-sm ${N?"bg-gradient-to-br from-emerald-100 to-emerald-200 border-2 border-emerald-300":"bg-gradient-to-br from-blue-100 to-blue-200 border-2 border-blue-200"}`,children:u.jsx(zs,{className:`w-10 h-10 ${N?"text-emerald-700":"text-blue-700"}`})}),u.jsxs("div",{className:"flex-1",children:[u.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[u.jsx("h3",{className:`text-2xl font-bold ${y?"text-gray-700":"text-gray-900"}`,children:g.name}),y&&u.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-orange-100 text-orange-700 border border-orange-200",children:[u.jsx(cC,{className:"w-3 h-3 mr-1"}),"Already Submitted"]})]}),u.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[u.jsxs("div",{className:"flex items-center",children:[u.jsx(mb,{className:"w-5 h-5 text-yellow-400 fill-current mr-1"}),u.jsx("span",{className:"text-lg font-semibold text-gray-900",children:g.rating}),u.jsx("span",{className:"text-sm text-gray-500 ml-1",children:"/5.0"})]}),u.jsx("div",{className:"h-4 w-px bg-gray-300"}),u.jsxs("div",{className:"flex items-center",children:[u.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full mr-2"}),u.jsxs("span",{className:"text-sm font-medium text-gray-700",children:[g.approval_rate,"% approval rate"]})]})]})]})]}),u.jsxs("div",{className:"flex items-center gap-4",children:[u.jsxs("div",{className:"text-right",children:[u.jsx("div",{className:`text-2xl font-bold ${y?"text-gray-500":N?"text-emerald-600":"text-blue-600"}`,children:(()=>{const b=g.match_score;if(typeof b=="number")return`${b<=1?Math.round(b*100):Math.round(b)}%`;const x=g.matchScore;return typeof x=="number"?`${Math.round(x)}%`:"95%"})()}),u.jsx("div",{className:"text-sm font-medium text-gray-500",children:"Match Score"})]}),!y&&u.jsx("div",{className:`w-8 h-8 rounded-full border-3 flex items-center justify-center transition-all ${N?"bg-emerald-500 border-emerald-500 text-white shadow-lg":"border-gray-300 text-gray-400 group-hover:border-blue-400 group-hover:text-blue-400"}`,children:N&&u.jsx(Ks,{className:"w-5 h-5"})})]})]}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[u.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100/50 border border-blue-200 p-4 rounded-xl",children:[u.jsxs("div",{className:"flex items-center mb-2",children:[u.jsx(sp,{className:"w-4 h-4 text-blue-600 mr-2"}),u.jsx("div",{className:"text-sm font-semibold text-blue-700",children:"Amount Range"})]}),u.jsxs("div",{className:"text-lg font-bold text-blue-900",children:["$",g.min_amount.toLocaleString()," - $",g.max_amount.toLocaleString()]})]}),u.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-green-100/50 border border-green-200 p-4 rounded-xl",children:[u.jsxs("div",{className:"flex items-center mb-2",children:[u.jsx(Jx,{className:"w-4 h-4 text-green-600 mr-2"}),u.jsx("div",{className:"text-sm font-semibold text-green-700",children:"Factor Rate"})]}),u.jsx("div",{className:"text-lg font-bold text-green-900",children:g.factor_rate})]}),u.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100/50 border border-purple-200 p-4 rounded-xl",children:[u.jsxs("div",{className:"flex items-center mb-2",children:[u.jsx(tm,{className:"w-4 h-4 text-purple-600 mr-2"}),u.jsx("div",{className:"text-sm font-semibold text-purple-700",children:"Payback Term"})]}),u.jsx("div",{className:"text-lg font-bold text-purple-900",children:g.payback_term})]}),u.jsxs("div",{className:"bg-gradient-to-br from-orange-50 to-orange-100/50 border border-orange-200 p-4 rounded-xl",children:[u.jsxs("div",{className:"flex items-center mb-2",children:[u.jsx(Yx,{className:"w-4 h-4 text-orange-600 mr-2"}),u.jsx("div",{className:"text-sm font-semibold text-orange-700",children:"Approval Time"})]}),u.jsx("div",{className:"text-lg font-bold text-orange-900",children:g.approval_time})]})]}),u.jsxs("div",{children:[u.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Key Features"}),u.jsx("div",{className:"bg-white border border-gray-200 rounded-2xl p-5 shadow-sm",children:g.features&&g.features.length>0?u.jsxs("div",{className:"flex flex-wrap gap-2.5",children:[g.features.slice(0,8).map((b,x)=>u.jsxs("span",{className:"inline-flex items-center gap-2 px-3.5 py-2 rounded-lg text-sm font-medium border bg-emerald-50 border-emerald-200 text-emerald-800",children:[u.jsx(Ks,{className:"w-4 h-4 text-emerald-600"}),b]},x)),g.features.length>8&&u.jsxs("span",{className:"inline-flex items-center px-3.5 py-2 rounded-lg text-sm font-medium bg-gray-50 text-gray-600 border border-gray-200",children:["+",g.features.length-8," more"]})]}):u.jsx("div",{className:"text-sm text-gray-500",children:"No feature information provided"})})]})]})},g.id)})}),u.jsx("div",{className:"bg-white border-t border-gray-200 pt-8 mt-12",children:u.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[u.jsx("button",{onClick:s,className:"w-full sm:w-auto px-6 py-3 border-2 border-gray-300 rounded-xl font-medium text-gray-700 hover:bg-gray-50 hover:border-gray-400 transition-all duration-200",children:"Back to Application"}),u.jsxs("div",{className:"flex items-center gap-4",children:[o.length>0&&u.jsxs("div",{className:"text-sm text-gray-600",children:[u.jsx("span",{className:"font-semibold text-emerald-600",children:o.length})," lender",o.length!==1?"s":""," selected"]}),u.jsxs("button",{onClick:p,disabled:o.length===0,className:`w-full sm:w-auto justify-center flex items-center px-8 py-4 rounded-xl font-semibold text-lg transition-all duration-200 ${o.length>0?"bg-gradient-to-r from-emerald-600 to-emerald-700 text-white hover:from-emerald-700 hover:to-emerald-800 shadow-lg shadow-emerald-200/50 hover:shadow-xl hover:shadow-emerald-300/50":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,children:["Continue with Selected Lenders",u.jsx(oC,{className:"w-5 h-5 ml-2"})]})]})]})})]}):u.jsx("div",{className:"text-center py-12",children:u.jsx("p",{className:"text-gray-500",children:"No application data available"})})},GR=({application:n,selectedLenderIds:e,onBack:t,onSubmit:s})=>{const[r,i]=V.useState(!1),[a,o]=V.useState(()=>{var $,ie;const M=localStorage.getItem("mcaPortalSmtpSettings"),E={smtpHost:"",smtpPort:"",smtpUser:"",smtpPassword:"",fromEmail:(($=n==null?void 0:n.contactInfo)==null?void 0:$.email)||""};if(M)try{const pe=JSON.parse(M);return{...pe,fromEmail:((ie=n==null?void 0:n.contactInfo)==null?void 0:ie.email)||pe.fromEmail}}catch(pe){return console.error("Error parsing saved SMTP settings:",pe),E}return E}),[c,d]=V.useState(!1),[h,f]=V.useState(!1),[m,p]=V.useState(0),[g,y]=V.useState(!1),[N,b]=V.useState(null),[x,_]=V.useState([]);Sv.useEffect(()=>{(async()=>{try{const E=await wb();_(E)}catch(E){console.error("Error loading lenders:",E)}})()},[]);const w=x.filter(M=>e.includes(M.id)),k=M=>n?(localStorage.getItem("mcaPortalEmailTemplate")||`Subject: Merchant Cash Advance Application - {{businessName}}

Dear {{lenderName}} Team,

I hope this email finds you well. I am writing to submit a merchant cash advance application for your review and consideration.

BUSINESS INFORMATION:
• Business Name: {{businessName}}
• Owner: {{ownerName}}
• Industry: {{industry}}
• Years in Business: {{yearsInBusiness}}
• Business Type: {{businessType}}
• EIN: {{ein}}

FINANCIAL DETAILS:
• Requested Amount: \${{requestedAmount}}
• Monthly Revenue: \${{monthlyRevenue}}
• Annual Revenue: \${{annualRevenue}}
• Credit Score: {{creditScore}}
• Existing Debt: \${{existingDebt}}

CONTACT INFORMATION:
• Email: {{email}}
• Phone: {{phone}}
• Address: {{address}}

I have attached the following documents for your review:
• Business bank statements (last 6 months)
• Tax returns
• Completed application form
• Voided business check

Based on your underwriting guidelines, I believe this application aligns well with your lending criteria:
• Amount Range: \${{lenderMinAmount}} - \${{lenderMaxAmount}}
• Factor Rate: {{lenderFactorRate}}
• Payback Term: {{lenderPaybackTerm}}
• Approval Time: {{lenderApprovalTime}}

I would appreciate the opportunity to discuss this application further and answer any questions you may have. Please let me know if you need any additional information or documentation.

Thank you for your time and consideration. I look forward to hearing from you soon.

Best regards,
{{ownerName}}
{{businessName}}
{{email}}
{{phone}}

---
This application was submitted through MCAPortal Pro
Application ID: {{applicationId}}`).replace(/\{\{businessName\}\}/g,n.businessName).replace(/\{\{ownerName\}\}/g,n.contactInfo.ownerName).replace(/\{\{industry\}\}/g,n.industry).replace(/\{\{yearsInBusiness\}\}/g,n.timeInBusiness.toString()).replace(/\{\{businessType\}\}/g,n.businessInfo.businessType).replace(/\{\{ein\}\}/g,n.businessInfo.ein).replace(/\{\{requestedAmount\}\}/g,n.requestedAmount.toLocaleString()).replace(/\{\{monthlyRevenue\}\}/g,n.monthlyRevenue.toLocaleString()).replace(/\{\{annualRevenue\}\}/g,n.financialInfo.annualRevenue.toLocaleString()).replace(/\{\{creditScore\}\}/g,n.creditScore.toString()).replace(/\{\{existingDebt\}\}/g,n.financialInfo.existingDebt.toLocaleString()).replace(/\{\{email\}\}/g,n.contactInfo.email).replace(/\{\{phone\}\}/g,n.contactInfo.phone).replace(/\{\{address\}\}/g,n.contactInfo.address).replace(/\{\{lenderName\}\}/g,M.name).replace(/\{\{lenderMinAmount\}\}/g,M.min_amount.toLocaleString()).replace(/\{\{lenderMaxAmount\}\}/g,M.max_amount.toLocaleString()).replace(/\{\{lenderFactorRate\}\}/g,M.factor_rate).replace(/\{\{lenderPaybackTerm\}\}/g,M.payback_term).replace(/\{\{lenderApprovalTime\}\}/g,M.approval_time).replace(/\{\{applicationId\}\}/g,n.id):"",C=M=>{var P;const E=k(M);let $=`Merchant Cash Advance Application - ${(n==null?void 0:n.businessName)??""}`.trim(),ie=E;const pe=E.match(/^Subject:\s*(.+)\s*\n([\s\S]*)$/i);return pe&&($=pe[1].trim(),ie=pe[2].trim()),{subject:$,body:ie,from:(a.fromEmail||((P=n==null?void 0:n.contactInfo)==null?void 0:P.email)||"").trim(),to:(M.contact_email||"").trim()}},T=M=>{try{const E={smtpHost:M.smtpHost,smtpPort:M.smtpPort,smtpUser:M.smtpUser,smtpPassword:"",fromEmail:M.fromEmail};localStorage.setItem("mcaPortalSmtpSettings",JSON.stringify(E))}catch(E){console.error("Error saving SMTP settings:",E)}},D=async(M,E)=>{var $;if(M)try{const ie=await fetch("/.netlify/functions/save-smtp-settings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({applicationId:M,smtp:{host:E.smtpHost,port:E.smtpPort,username:E.smtpUser,password:E.smtpPassword,fromEmail:E.fromEmail||(($=n==null?void 0:n.contactInfo)==null?void 0:$.email)||""}})});if(!ie.ok){const pe=await ie.text();console.warn("Failed to save SMTP settings (backend):",ie.status,pe)}}catch(ie){console.warn("Failed to reach SMTP settings backend:",ie)}},B=async M=>{var ie,pe;const E="https://primary-production-c8d0.up.railway.app/webhook/smtp",$={applicationId:(n==null?void 0:n.id)??null,smtp:{host:M.smtpHost,port:M.smtpPort,user:M.smtpUser,password:M.smtpPassword,fromEmail:M.fromEmail||((ie=n==null?void 0:n.contactInfo)==null?void 0:ie.email)||""},context:{businessName:(n==null?void 0:n.businessName)??null,applicantEmail:((pe=n==null?void 0:n.contactInfo)==null?void 0:pe.email)??null},sentAt:new Date().toISOString()};try{const P=await fetch(E,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify($)});P.ok||console.warn("SMTP webhook non-OK status:",P.status,P.statusText)}catch(P){console.warn("Failed to send SMTP settings to webhook:",P)}},ee=async()=>{var E;f(!0),p(0);const M=setInterval(()=>{p($=>$>=90?$:Math.min(90,$+Math.random()*12))},200);T(a),n!=null&&n.id&&await D(n.id,{...a,fromEmail:a.fromEmail||n.contactInfo.email});try{n&&await E1(n.id,e);const $=w.map(F=>(F.contact_email||"").trim()).filter(F=>F.length>0),ie=w[0]?C(w[0]):{subject:`Merchant Cash Advance Application - ${(n==null?void 0:n.businessName)??""}`.trim(),body:"",from:((E=n==null?void 0:n.contactInfo)==null?void 0:E.email)||""},pe=F=>`<div style="white-space:pre-wrap; font-family:Arial, Helvetica, sans-serif;">${(F||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}</div>`;let P=[];try{n!=null&&n.id&&(P=(await ry(n.id)||[]).filter(W=>!!W.file_url).map(W=>({filename:W.file_name,url:W.file_url})))}catch(F){console.warn("Failed to load application documents for attachments:",F)}const se=await fetch("/.netlify/functions/send-application-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({applicationId:n==null?void 0:n.id,lenders:$,subject:ie.subject,body:pe(ie.body),attachments:P})});if(!se.ok){const F=await se.text();throw console.warn("Email server responded with error:",se.status,F),new Error("Email sending failed")}y(!0),s()}catch($){console.error("Error submitting application:",$),alert("Error submitting application. Please try again.")}finally{p(100),f(!1),clearInterval(M)}};return n?g?u.jsx("div",{className:"bg-white rounded-xl shadow-lg p-8",children:u.jsxs("div",{className:"text-center",children:[u.jsx(Ks,{className:"w-16 h-16 text-green-600 mx-auto mb-6"}),u.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Application Submitted Successfully!"}),u.jsxs("p",{className:"text-gray-600 mb-6",children:["Your application and business bank statements have been sent to ",w.length," selected lender",w.length>1?"s":"",". You should receive responses within 24-48 hours at ",n.contactInfo.email,"."]}),u.jsxs("div",{className:"bg-green-50 rounded-lg p-6 mb-6",children:[u.jsx("h3",{className:"text-lg font-medium text-green-800 mb-3",children:"Submitted to:"}),u.jsx("div",{className:"space-y-2",children:w.map(M=>u.jsxs("div",{className:"flex items-center justify-between bg-white p-3 rounded border",children:[u.jsxs("div",{className:"flex items-center",children:[u.jsx("img",{src:"https://images.pexels.com/photos/259027/pexels-photo-259027.jpeg?auto=compress&cs=tinysrgb&w=100&h=100",alt:M.name,className:"w-12 h-12 rounded-lg mr-4"}),u.jsx("span",{className:"font-medium text-green-900",children:M.name})]}),u.jsx("span",{className:"text-sm text-green-600",children:"✓ Sent"})]},M.id))})]}),u.jsx("button",{onClick:()=>window.location.reload(),className:"bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors",children:"Submit Another Application"})]})}):u.jsxs("div",{className:"space-y-8",children:[h&&u.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-white/70 backdrop-blur-sm",children:u.jsx("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-xl mx-4 p-8 border border-gray-100",children:u.jsxs("div",{className:"flex flex-col items-center text-center",children:[u.jsx("div",{className:"w-14 h-14 rounded-full bg-blue-50 flex items-center justify-center mb-4",children:u.jsx(z0,{className:"w-7 h-7 text-blue-600 animate-spin"})}),u.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Sending Your Application"}),u.jsx("p",{className:"text-gray-600 mb-6",children:"We’re sending your application and attachments to selected lenders…"}),u.jsxs("div",{className:"w-full",children:[u.jsx("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden",children:u.jsx("div",{className:"h-2 bg-blue-600 rounded-full transition-all duration-200",style:{width:`${Math.round(m)}%`}})}),u.jsx("div",{className:"text-xs text-gray-500 mt-2",children:"This can take 30–60 seconds"})]})]})})}),u.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[u.jsxs("button",{onClick:t,className:"w-full sm:w-auto flex items-center justify-center sm:justify-start text-gray-600 hover:text-gray-900 transition-colors",children:[u.jsx(aC,{className:"w-5 h-5 mr-2"}),"Back to Lender Selection"]}),u.jsxs("div",{className:"text-sm text-gray-500 break-all",children:["Application ID: ",n.id]})]}),u.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[u.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Submission Summary"}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[u.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[u.jsx("div",{className:"text-sm text-blue-600 font-medium",children:"Business"}),u.jsx("div",{className:"text-lg font-bold text-blue-900",children:n.businessName}),u.jsx("div",{className:"text-sm text-blue-700",children:n.industry})]}),u.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[u.jsx("div",{className:"text-sm text-green-600 font-medium",children:"Requested Amount"}),u.jsxs("div",{className:"text-lg font-bold text-green-900",children:["$",n.requestedAmount.toLocaleString()]})]}),u.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[u.jsx("div",{className:"text-sm text-purple-600 font-medium",children:"Monthly Revenue"}),u.jsxs("div",{className:"text-lg font-bold text-purple-900",children:["$",n.monthlyRevenue.toLocaleString()]})]}),u.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg",children:[u.jsx("div",{className:"text-sm text-orange-600 font-medium",children:"Credit Score"}),u.jsx("div",{className:"text-lg font-bold text-orange-900",children:n.creditScore})]})]}),u.jsxs("div",{className:"mb-6",children:[u.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:["Selected Lenders (",w.length,")"]}),u.jsx("div",{className:"space-y-3",children:w.map(M=>u.jsxs("div",{className:"flex items-center justify-between bg-gray-50 p-4 rounded-lg",children:[u.jsxs("div",{className:"flex items-center",children:[u.jsx("img",{src:"https://images.pexels.com/photos/259027/pexels-photo-259027.jpeg?auto=compress&cs=tinysrgb&w=100&h=100",alt:M.name,className:"w-12 h-12 rounded-lg mr-4"}),u.jsxs("div",{children:[u.jsx("h4",{className:"font-medium text-gray-900",children:M.name}),u.jsxs("p",{className:"text-sm text-gray-600",children:[M.factor_rate," • ",M.payback_term," • ",M.approval_time]})]})]}),u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsx("span",{className:"text-sm font-medium text-green-600",children:"95% Match"}),u.jsx("button",{onClick:()=>{b(M),i(!0)},className:"text-blue-600 hover:text-blue-800 text-sm flex items-center",children:"Preview Email"})]})]},M.id))})]}),u.jsx("div",{className:"bg-blue-50 rounded-lg p-4 mb-6",children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("div",{children:[u.jsx("h4",{className:"font-medium text-blue-900",children:"Email Configuration"}),u.jsxs("p",{className:"text-sm text-blue-700",children:["Emails will be sent from: ",u.jsx("span",{className:"font-medium",children:n.contactInfo.email})]}),u.jsxs("p",{className:"text-sm text-blue-600 mt-1",children:["SMTP Status: ",a.smtpHost?"Configured ✓":"Not configured - using default settings",a.smtpHost&&u.jsx("span",{className:"block text-xs text-blue-500 mt-1",children:"Settings saved for future submissions"})]})]}),u.jsxs("button",{onClick:()=>d(!0),className:"flex items-center text-blue-600 hover:text-blue-800 text-sm",children:[u.jsx(t1,{className:"w-4 h-4 mr-1"}),"Configure SMTP"]})]})}),u.jsxs("div",{className:"mb-6",children:[u.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Documents to be Included:"}),u.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[u.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[u.jsx(Hl,{className:"w-4 h-4 mr-2 text-blue-600"}),"Application Form"]}),u.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[u.jsx(Hl,{className:"w-4 h-4 mr-2 text-green-600"}),"Bank Statements (6 months)"]}),u.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[u.jsx(Hl,{className:"w-4 h-4 mr-2 text-purple-600"}),"Tax Returns"]}),u.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[u.jsx(Hl,{className:"w-4 h-4 mr-2 text-orange-600"}),"Voided Check"]})]})]}),u.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center justify-end gap-3 pt-6 border-t border-gray-200",children:u.jsx("button",{onClick:ee,disabled:h,className:`w-full sm:w-auto justify-center flex items-center px-8 py-3 rounded-lg font-medium transition-colors ${h?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-green-600 text-white hover:bg-green-700"}`,children:h?u.jsxs(u.Fragment,{children:[u.jsx(z0,{className:"w-5 h-5 mr-2 animate-spin"}),"Sending Applications..."]}):u.jsxs(u.Fragment,{children:[u.jsx(mC,{className:"w-5 h-5 mr-2"}),"Send to ",w.length," Lender",w.length>1?"s":""]})})})]}),c&&u.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50",children:u.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full mx-4",children:[u.jsxs("div",{className:"p-6 border-b border-gray-200",children:[u.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Email Settings"}),u.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Configure your SMTP settings for sending applications"})]}),u.jsxs("div",{className:"p-6 space-y-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"SMTP Host"}),u.jsx("input",{type:"text",value:a.smtpHost,onChange:M=>o(E=>({...E,smtpHost:M.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"smtp.gmail.com"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"SMTP Port"}),u.jsx("input",{type:"text",value:a.smtpPort,onChange:M=>o(E=>({...E,smtpPort:M.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"587"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Username"}),u.jsx("input",{type:"text",value:a.smtpUser,onChange:M=>o(E=>({...E,smtpUser:M.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"your-email@gmail.com"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),u.jsx("input",{type:"password",value:a.smtpPassword,onChange:M=>o(E=>({...E,smtpPassword:M.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"your-app-password"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"From Email"}),u.jsx("input",{type:"email",value:n.contactInfo.email,className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50",disabled:!0}),u.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Using your application email address"})]})]}),u.jsxs("div",{className:"p-6 border-t border-gray-200 flex justify-end space-x-3",children:[u.jsx("button",{onClick:()=>d(!1),className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancel"}),u.jsx("button",{onClick:async()=>{T(a),await B({...a,fromEmail:a.fromEmail||n.contactInfo.email}),d(!1)},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Save Settings"})]})]})}),r&&N&&u.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50",children:u.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[u.jsx("div",{className:"p-6 border-b border-gray-200",children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Email Preview - ",N.name]}),u.jsx("button",{onClick:()=>i(!1),className:"text-gray-400 hover:text-gray-600",children:"×"})]})}),u.jsxs("div",{className:"p-6",children:[u.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 mb-4",children:[u.jsxs("div",{className:"text-sm text-gray-600 mb-2",children:[u.jsx("strong",{children:"From:"})," ",n.contactInfo.email]}),u.jsxs("div",{className:"text-sm text-gray-600 mb-2",children:[u.jsx("strong",{children:"To:"})," ",N.contact_email||"—"]})]}),u.jsx("div",{className:"bg-white border rounded-lg p-6",children:u.jsx("pre",{className:"whitespace-pre-wrap text-sm text-gray-800 font-mono",children:k(N)})})]}),u.jsx("div",{className:"p-6 border-t border-gray-200 flex justify-end",children:u.jsx("button",{onClick:()=>i(!1),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Close Preview"})})]})})]}):u.jsx("div",{className:"text-center py-12",children:u.jsx("p",{className:"text-gray-500",children:"No application data available"})})},Fw="/webhook/newDeal",KR="/webhook/updatingApplications",XR="https://primary-production-c8d0.up.railway.app/webhook/documentFile",YR=({onContinue:n,onBack:e,initial:t,loading:s})=>{const[r,i]=V.useState({id:(t==null?void 0:t.id)||"",applicationId:(t==null?void 0:t.applicationId)||"",dealName:(t==null?void 0:t.dealName)||"",entityType:(t==null?void 0:t.entityType)||"",industry:(t==null?void 0:t.industry)||"",state:(t==null?void 0:t.state)||"",creditScore:"",timeInBiz:"",grossAnnualRevenue:"",avgMonthlyRevenue:"",averageMonthlyDeposits:"",existingDebt:"",requestedAmount:"",avgDailyBalance:"",avgMonthlyDepositCount:"",nsfCount:"",negativeDays:"",currentPositionCount:"",holdback:"",hasBankruptcies:!!(t!=null&&t.hasBankruptcies)||!1,hasOpenJudgments:!!(t!=null&&t.hasOpenJudgments)||!1});V.useEffect(()=>{if(!t)return;console.log("[SubmissionIntermediate] received initial:",t),i(z=>({...z,id:t.id??z.id??"",applicationId:t.applicationId??z.applicationId??"",dealName:t.dealName??z.dealName??"",entityType:t.entityType??z.entityType??"",industry:t.industry??z.industry??"",state:t.state??z.state??"",creditScore:z.creditScore||"",timeInBiz:z.timeInBiz||"",grossAnnualRevenue:z.grossAnnualRevenue||"",avgMonthlyRevenue:z.avgMonthlyRevenue||"",averageMonthlyDeposits:z.averageMonthlyDeposits||"",existingDebt:z.existingDebt||"",requestedAmount:z.requestedAmount||"",avgDailyBalance:z.avgDailyBalance||"",avgMonthlyDepositCount:z.avgMonthlyDepositCount||"",nsfCount:z.nsfCount||"",negativeDays:z.negativeDays||"",currentPositionCount:z.currentPositionCount||"",holdback:z.holdback||"",hasBankruptcies:typeof t.hasBankruptcies=="boolean"?t.hasBankruptcies:!!z.hasBankruptcies,hasOpenJudgments:typeof t.hasOpenJudgments=="boolean"?t.hasOpenJudgments:!!z.hasOpenJudgments}));const I=["dealName","industry","entityType","state"],L=[];I.forEach(z=>{const q=t[z];q!=null&&String(q).trim()!==""&&L.push(z)}),L.length&&w(z=>new Set([...z,...L])),setTimeout(()=>{console.log("[SubmissionIntermediate] details after merge snapshot:",{entityType:t.entityType??"",state:t.state??"",grossAnnualRevenue:t.grossAnnualRevenue??"",avgDailyBalance:t.avgDailyBalance??"",averageMonthlyDeposits:t.averageMonthlyDeposits??"",existingDebt:t.existingDebt??"",requestedAmount:t.requestedAmount??"",avgMonthlyDepositCount:t.avgMonthlyDepositCount??"",nsfCount:t.nsfCount??"",negativeDays:t.negativeDays??"",currentPositionCount:t.currentPositionCount??"",holdback:t.holdback??""})},0)},[t]);const a=async I=>{try{D(!0);const L=await ry(I);C(L||[])}finally{D(!1)}},o=(I,L,z={})=>{if(!L||typeof L!="object")return;const q=Array.isArray(L)?L.filter(G=>!!G&&typeof G=="object"&&!Array.isArray(G)):[L],K=q.length?Object.assign({},...q):{},U=F(K),J=G=>G.toLowerCase().replace(/[^a-z0-9]/g,""),O=Object.entries(U).map(([G,Z])=>[G.toLowerCase(),Z]),te=Object.entries(U).map(([G,Z])=>[J(G),Z]),ae={dealName:["dealName","business_name","company_name","legal_business_name","merchant_name","dba","doing_business_as"],industry:["industry","industry_type","business_industry","naics_industry","naics_description"],entityType:["entityType","business_type","entity","business_entity","entity_type"],creditScore:["creditScore","credit_score","credit","fico"],timeInBiz:["timeInBiz","time_in_biz","tib_months","time_in_business_months"],avgMonthlyRevenue:["avgMonthlyRevenue","average_monthly_revenue","monthly_revenue_avg"],averageMonthlyDeposits:["averageMonthlyDeposits","avgMonthlyDeposits","average_monthly_deposits"],existingDebt:["existingDebt","existing_business_debt","current_debt"],requestedAmount:["requestedAmount","requested_amount","request_amount"],avgDailyBalance:["avgDailyBalance","average_daily_balance"],avgMonthlyDepositCount:["avgMonthlyDepositCount","average_monthly_deposit_count"],nsfCount:["nsfCount","nsf_count"],negativeDays:["negativeDays","negative_days"],currentPositionCount:["currentPositionCount","current_position_count"],holdback:["holdback","hold_back","holdback_percent"],grossAnnualRevenue:["grossAnnualRevenue","gross_annual_revenue","annual_revenue"],state:["state","State"]},Ne=new Set(["creditScore","timeInBiz","avgMonthlyRevenue","averageMonthlyDeposits","existingDebt","requestedAmount","avgDailyBalance","avgMonthlyDepositCount","nsfCount","negativeDays","currentPositionCount","holdback","grossAnnualRevenue"]),Ce=G=>{const Z=String(G??"").trim();return Z?Z.replace(/,/g,"").replace(/[^0-9.-]/g,""):""},ge=G=>{const Z=G.map(ce=>K[ce]).find(ce=>ce!=null&&String(ce).trim()!=="");if(Z!==void 0)return Z;for(const ce of G){const Ee=ce.toLowerCase(),le=O.find(([Ct])=>Ct.endsWith(Ee)||Ct===Ee||Ct.includes(`.${Ee}`));if(le&&le[1]!==void 0&&le[1]!==null&&String(le[1]).trim()!=="")return le[1];const nt=J(ce),ut=te.find(([Ct])=>Ct===nt||Ct.endsWith(nt)||Ct.includes(nt));if(ut&&ut[1]!==void 0&&ut[1]!==null&&String(ut[1]).trim()!=="")return ut[1]}},me={};Object.keys(ae).forEach(G=>{const Z=ge(ae[G]);Z!==void 0&&(me[G]=Ne.has(G)?Ce(Z):String(Z))}),console.log("[populatePerDocDetails] mapped keys for",I,Object.keys(me)),ee(G=>{const ce={...G[I]||{}};return Object.entries(me).forEach(([Ee,le])=>{(z.overwrite||!ce[Ee]||String(ce[Ee]).trim()==="")&&(ce[Ee]=le)}),{...G,[I]:ce}});try{let G,Z,ce;const Ee=[...Y(K,"monthly_table"),...Y(L,"monthly_table")],le=[...Y(K,"mca_summary"),...Y(L,"mca_summary")],nt=[...Y(K,"fraud_flags"),...Y(L,"fraud_flags")],ut=Ee.find(wt=>Array.isArray(wt));Array.isArray(ut)&&(G=ut.map(wt=>{const Mr=wt&&typeof wt=="object"?wt:{},Fb={};return Object.keys(Mr).forEach($b=>{Fb[$b]=String(Mr[$b]??"")}),Fb}));const Ct=le.find(wt=>Array.isArray(wt)||wt&&typeof wt=="object");if(Array.isArray(Ct))Z=Ct.map(wt=>{const Mr=wt;return{FUNDER:String(Mr.FUNDER??""),AMOUNT:String(Mr.AMOUNT??""),"DAILY/WEEKLY Debit":String(Mr["DAILY/WEEKLY Debit"]??""),NOTES:String(Mr.NOTES??"")}});else if(Ct&&typeof Ct=="object"){const wt=Ct;Z=[{FUNDER:String(wt.FUNDER??""),AMOUNT:String(wt.AMOUNT??""),"DAILY/WEEKLY Debit":String(wt["DAILY/WEEKLY Debit"]??""),NOTES:String(wt.NOTES??"")}]}const gf=nt.find(wt=>Array.isArray(wt));if(Array.isArray(gf)&&(ce=gf.map(wt=>String(wt))),G||Z||ce){const wt={monthly_table:G,mca_summary:Z,fraud_flags:ce};console.log("[populatePerDocDetails] Storing MCA-like data",{dateKey:I,monthlyRows:(G==null?void 0:G.length)||0,summaryRows:(Z==null?void 0:Z.length)||0,fraudFlags:(ce==null?void 0:ce.length)||0}),E(Mr=>({...Mr,[I]:wt}))}else console.log("[populatePerDocDetails] No MCA-like fields present in merged payload for",I)}catch(G){console.warn("[populatePerDocDetails] Failed to derive MCA-like fields:",G)}};V.useEffect(()=>{const I=r.id||r.applicationId||(t==null?void 0:t.id)||(t==null?void 0:t.applicationId)||"";if(!I)return;let L=!1;return(async()=>{try{D(!0);const q=await ry(I);L||C(q||[])}catch(q){console.warn("Failed to load application documents:",q)}finally{L||D(!1)}})(),()=>{L=!0}},[r.id,r.applicationId,t==null?void 0:t.id,t==null?void 0:t.applicationId]);const c=(I,L)=>i(z=>({...z,[I]:L})),[d,h]=V.useState(!1),[f,m]=V.useState(!1),[p,g]=V.useState(new Map),[y,N]=V.useState(0);V.useEffect(()=>{if(!(s||d)){N(0);return}N(10);const I=setInterval(()=>{N(L=>L>=90?L:Math.min(L+Math.random()*10+5,90))},300);return()=>clearInterval(I)},[s,d]);const[b,x]=V.useState(new Map),[_,w]=V.useState(new Set),[k,C]=V.useState([]),[T,D]=V.useState(!1),[B,ee]=V.useState({}),[M,E]=V.useState({});V.useEffect(()=>{const I=Object.keys(M||{});try{if(I.length){console.log("[MCA state] perDocMcaData updated. Keys:",I);const L=I[I.length-1];console.log("[MCA state] latest entry sample",L,M[L])}}catch(L){console.warn("[MCA state] Failed to log perDocMcaData update",L,{keys:I})}},[M]);const[$,ie]=V.useState(null),[pe,P]=V.useState(null),se=V.useRef(null),F=(I,L="")=>{const z={};return!I||typeof I!="object"||Object.entries(I).forEach(([q,K])=>{const U=L?`${L}.${q}`:q;K&&typeof K=="object"&&!Array.isArray(K)?Object.assign(z,F(K,U)):z[U]=K}),z},W=async(I,L={})=>{const z={...L};return"timeoutMs"in z&&delete z.timeoutMs,fetch(I,z)},ne=(I,L={})=>{if(!I||typeof I!="object")return;let z={};if(Array.isArray(I))for(const me of I)me&&typeof me=="object"&&!Array.isArray(me)&&(z={...z,...me});else z=I;console.log("[populateDetailsFromWebhook] raw payload keys:",Object.keys(z));const q=F(z);console.log("[populateDetailsFromWebhook] flattened keys:",Object.keys(q));const K=me=>me.toLowerCase().replace(/[^a-z0-9]/g,""),U=Object.entries(q).map(([me,G])=>[me.toLowerCase(),G]),J=Object.entries(q).map(([me,G])=>[K(me),G]),O={dealName:["dealName","business_name","company_name","legal_business_name","merchant_name","dba","doing_business_as"],industry:["industry","industry_type","business_industry","naics_industry","naics_description"],entityType:["entityType","business_type","entity","business_entity","entity_type"],creditScore:["creditScore","credit_score","credit","fico"],timeInBiz:["timeInBiz","time_in_biz","tib_months","time_in_business_months"],avgMonthlyRevenue:["avgMonthlyRevenue","average_monthly_revenue","monthly_revenue_avg"],averageMonthlyDeposits:["averageMonthlyDeposits","avgMonthlyDeposits","average_monthly_deposits"],existingDebt:["existingDebt","existing_business_debt","current_debt"],requestedAmount:["requestedAmount","requested_amount","request_amount"],avgDailyBalance:["avgDailyBalance","average_daily_balance"],avgMonthlyDepositCount:["avgMonthlyDepositCount","average_monthly_deposit_count"],nsfCount:["nsfCount","nsf_count"],negativeDays:["negativeDays","negative_days"],currentPositionCount:["currentPositionCount","current_position_count"],holdback:["holdback","hold_back","holdback_percent"],grossAnnualRevenue:["grossAnnualRevenue","gross_annual_revenue","annual_revenue"],state:["state","State"]},te={},ae=me=>{const G=me.map(Z=>z[Z]).find(Z=>Z!=null&&String(Z).trim()!=="");if(G!==void 0)return G;for(const Z of me){const ce=Z.toLowerCase(),Ee=U.find(([ut])=>ut.endsWith(ce)||ut===ce||ut.includes(`.${ce}`));if(Ee&&Ee[1]!==void 0&&Ee[1]!==null&&String(Ee[1]).trim()!=="")return Ee[1];const le=K(Z),nt=J.find(([ut])=>ut===le||ut.endsWith(le)||ut.includes(le));if(nt&&nt[1]!==void 0&&nt[1]!==null&&String(nt[1]).trim()!=="")return nt[1]}},Ne=new Set(["creditScore","timeInBiz","avgMonthlyRevenue","averageMonthlyDeposits","existingDebt","requestedAmount","avgDailyBalance","avgMonthlyDepositCount","nsfCount","negativeDays","currentPositionCount","holdback","grossAnnualRevenue"]),Ce=me=>{const G=String(me??"").trim();return G?G.replace(/,/g,"").replace(/[^0-9.-]/g,""):""};Object.keys(O).forEach(me=>{const G=ae(O[me]);G!==void 0&&(te[me]=Ne.has(me)?Ce(G):String(G),console.log(`[populateDetailsFromWebhook] mapped ${me} <-`,G))});const ge=new Set;L.markProvidedEvenIfNoChange&&(Object.keys(te).forEach(G=>ge.add(G)),["creditScore","timeInBiz","avgMonthlyRevenue","averageMonthlyDeposits","existingDebt","requestedAmount","avgDailyBalance","avgMonthlyDepositCount","nsfCount","negativeDays","currentPositionCount","holdback","grossAnnualRevenue"].forEach(G=>ge.add(G)),console.log("[populateDetailsFromWebhook] prefilling providedKeys due to markProvidedEvenIfNoChange (financial targets included):",Array.from(ge))),i(me=>{const G={...me};return Object.entries(te).forEach(([Z,ce])=>{const Ee=G[Z]??"";(L.overwrite||!Ee||String(Ee).trim()==="")&&(G[Z]=ce,ge.add(Z))}),console.log("[populateDetailsFromWebhook] merged details snapshot:",G),G}),ge.size&&(console.log("[populateDetailsFromWebhook] providedKeys for highlight:",Array.from(ge)),w(me=>{const G=new Set([...me,...ge]);return console.log("[populateDetailsFromWebhook] autoPopulatedKeys now:",Array.from(G)),G}))},be=()=>{const I=Array.from(b.keys()),L=(q,K)=>{const U=`${q}-${String(K+1).padStart(2,"0")}`;return I.some(J=>J.startsWith(U))},z=new Date;for(z.setDate(1);L(z.getFullYear(),z.getMonth());)z.setMonth(z.getMonth()+1);return`${z.getFullYear()}-${String(z.getMonth()+1).padStart(2,"0")}-01`},_e=async I=>{if(!I)return;if(I.type!=="application/pdf"){alert("Please upload PDF files only");return}if(I.size>10*1024*1024){alert("File size must be under 10MB");return}const L=be();await Oe(I,L)},Oe=async(I,L)=>{x(q=>new Map(q.set(L,{file:I,status:"uploading"}))),g(q=>new Map(q.set(L,0)));const z=setInterval(()=>{g(q=>{const K=q.get(L)||0;if(K>=90)return q;const U=new Map(q);return U.set(L,K+Math.random()*15),U})},200);try{try{const q=new FormData;q.append("file",I,I.name),q.append("statementDate",L),console.log("[newDeal webhook] Starting request",{url:Fw,fileName:I.name,dateKey:L});const K=await W(Fw,{method:"POST",body:q,timeoutMs:45e3});if(K.ok){const U=K.headers.get("content-type")||"";console.log("[newDeal webhook] Response received",{status:K.status,contentType:U});try{let J;if(U.includes("application/json"))J=await K.json();else{const O=await K.text();try{J=JSON.parse(O)}catch{J=void 0}}if(J){const O=Array.isArray(J);console.log("[newDeal webhook - daily] Parsed response summary:",{dateKey:L,isArray:O,arrayLength:O?J.length:void 0,topLevelKeys:!O&&typeof J=="object"?Object.keys(J):void 0}),ne(J,{overwrite:!0,markProvidedEvenIfNoChange:!0}),o(L,J,{overwrite:!0});const te=Y(J,"monthly_table"),ae=Y(J,"mca_summary"),Ne=Y(J,"fraud_flags");console.log("[newDeal webhook] deep-search candidates",{dateKey:L,monthlyCandidates:te.length,summaryCandidates:ae.length,flagCandidates:Ne.length});let Ce,ge,me;const G=te.find(le=>Array.isArray(le));Array.isArray(G)&&(Ce=G.map(le=>{const nt=le&&typeof le=="object"?le:{},ut={};return Object.keys(nt).forEach(Ct=>{ut[Ct]=String(nt[Ct]??"")}),ut}),console.log("[newDeal webhook] monthly_table extracted rows:",Ce.length));const Z=ae.find(le=>Array.isArray(le)||le&&typeof le=="object");if(Array.isArray(Z))ge=Z.map(le=>{const nt=le;return{FUNDER:String(nt.FUNDER??""),AMOUNT:String(nt.AMOUNT??""),"DAILY/WEEKLY Debit":String(nt["DAILY/WEEKLY Debit"]??""),NOTES:String(nt.NOTES??"")}}),console.log("[newDeal webhook] mca_summary extracted rows:",ge.length);else if(Z&&typeof Z=="object"){const le=Z;ge=[{FUNDER:String(le.FUNDER??""),AMOUNT:String(le.AMOUNT??""),"DAILY/WEEKLY Debit":String(le["DAILY/WEEKLY Debit"]??""),NOTES:String(le.NOTES??"")}],console.log("[newDeal webhook] mca_summary extracted 1 object row")}const ce=Ne.find(le=>Array.isArray(le));Array.isArray(ce)&&(me=ce.map(le=>String(le)),console.log("[newDeal webhook] fraud_flags extracted count:",me.length));const Ee={monthly_table:Ce,mca_summary:ge,fraud_flags:me};Ce||ge||me?(console.log("[newDeal webhook] Storing MCA-like payload from newDeal",{dateKey:L,monthlyRows:(Ce==null?void 0:Ce.length)||0,summaryRows:(ge==null?void 0:ge.length)||0,fraudFlags:(me==null?void 0:me.length)||0}),E(le=>({...le,[L]:Ee}))):console.log("[newDeal webhook] No MCA-like fields found in response (monthly_table, mca_summary, fraud_flags) for",L)}}catch(J){console.warn("Unable to read daily webhook response:",J)}}else console.warn(`newDeal webhook responded ${K.status} ${K.statusText}; continuing upload flow`)}catch(q){q instanceof DOMException&&q.name==="AbortError"?console.warn("[newDeal webhook] Request aborted due to timeout (45s). Continuing upload flow.",{fileName:I.name,dateKey:L}):console.warn("newDeal webhook failed; continuing upload flow:",q)}try{const K={application_id:r.id||(t==null?void 0:t.id)||r.applicationId||(t==null?void 0:t.applicationId)||"",file_name:I.name,file_size:I.size,file_type:I.type||"application/pdf",statement_date:L},U=await W(XR,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(K),timeoutMs:3e4});let J;if((U.headers.get("content-type")||"").includes("application/json")){const te=await U.json().catch(()=>{});if(te&&typeof te=="object"){const ae=te.file_url;typeof ae=="string"&&ae&&(J=ae)}}else{const te=await U.text();try{const Ne=JSON.parse(te).file_url;typeof Ne=="string"&&Ne&&(J=Ne)}catch{}}clearInterval(z),g(te=>{const ae=new Map(te);return ae.set(L,100),ae}),setTimeout(()=>{x(te=>new Map(te.set(L,{file:I,status:"completed",fileUrl:J}))),g(te=>{const ae=new Map(te);return ae.delete(L),ae})},500)}catch(q){console.warn("documentFile webhook call failed; marking completed without URL:",q),clearInterval(z),g(K=>{const U=new Map(K);return U.set(L,100),U}),setTimeout(()=>{x(K=>new Map(K.set(L,{file:I,status:"completed"}))),g(K=>{const U=new Map(K);return U.delete(L),U})},500)}}catch(q){console.error("Daily upload failed:",q),clearInterval(z),x(K=>new Map(K.set(L,{file:I,status:"error"}))),g(K=>{const U=new Map(K);return U.delete(L),U})}},et=async I=>{if(!I||I.length===0)return;const L=Array.from(I);for(const z of L)await _e(z)},qe=async I=>{var z;const L=(z=I.target.files)==null?void 0:z[0];if(L){const q=r.id||(t==null?void 0:t.id)||r.applicationId||(t==null?void 0:t.applicationId)||"",K=($==null?void 0:$.dateKey)||be();if(await Oe(L,K),($==null?void 0:$.source)==="db"&&$.docId){try{await yw($.docId)}catch(U){console.warn("Failed to delete old DB document during replace:",U)}q&&await a(q)}}I.target.value="",ie(null)},Se=async I=>{const L=b.get(I);L&&await _e(L.file)},Q=I=>{I.preventDefault(),I.stopPropagation(),m(!0)},Ve=I=>{I.preventDefault(),I.stopPropagation(),m(!1)},H=I=>{I.preventDefault(),I.stopPropagation(),m(!1),et(I.dataTransfer.files)},j=I=>{if(!I)return"";const L=new Date(I);return Number.isNaN(L.getTime())?"":L.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})},R=I=>I.toLowerCase().replace(/[^a-z0-9]/g,""),Y=(I,L)=>{const z=R(L),q=[],K=[I];for(;K.length;){const U=K.pop();if(U){if(Array.isArray(U))for(const J of U)K.push(J);else if(typeof U=="object"){const J=U;for(const O of Object.keys(J))R(O)===z&&q.push(J[O]),K.push(J[O])}}}return q},he=()=>{const I=new Date,L=I.getFullYear(),z=I.getMonth(),q=I.getDate(),K=Array.from(b.entries()).map(([J,O])=>{const[te,ae,Ne]=J.split("-").map(Number),Ce=new Date(te,ae-1,Ne),ge=te===L&&ae-1===z,me=new Date(te,ae-1,ge?q:Ne);return{key:`local:${J}`,dateKey:J,dateDisplay:me.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}),status:O.status,file:{name:O.file.name,size:O.file.size},fileUrl:O.fileUrl,sortDate:Ce,source:"local"}});return[...(k||[]).map(J=>{const O=J.statement_date?new Date(J.statement_date):new Date(J.created_at),te=j(J.statement_date||J.created_at)||"",ae=(J.statement_date||J.created_at||"").slice(0,10)||J.id;return{key:`db:${J.id}`,dateKey:ae,dateDisplay:te,status:"completed",file:{name:J.file_name,size:typeof J.file_size=="number"?J.file_size:0},fileUrl:J.file_url,sortDate:O,source:"db",docId:J.id}}),...K].sort((J,O)=>O.sortDate.getTime()-J.sortDate.getTime())},Ae=I=>{x(L=>{const z=new Map(L);return z.delete(I),z})},tt=async I=>{var z;const L=r.id||(t==null?void 0:t.id)||r.applicationId||(t==null?void 0:t.applicationId)||"";if(I.source==="db"&&I.docId){try{await yw(I.docId),console.log("Successfully deleted document from database:",I.docId)}catch(q){console.error("Failed to delete DB document:",q),alert("Failed to delete document. Please try again.");return}L&&await a(L);return}try{L&&I.dateKey&&(await F2(L,I.dateKey,(z=I.file)==null?void 0:z.name),L&&await a(L))}catch(q){console.warn("Failed to delete matching DB document for local item:",q)}Ae(I.dateKey)},Pt=I=>{var L;I.source==="db"?ie({source:"db",dateKey:I.dateKey,docId:I.docId}):ie({source:"local",dateKey:I.dateKey}),(L=se.current)==null||L.click()},je=async I=>{if(!d){h(!0);try{const L={id:r.id||(t==null?void 0:t.id)||"",applicationId:r.applicationId||(t==null?void 0:t.applicationId)||r.id||(t==null?void 0:t.id)||""},z=K=>typeof K=="string"&&/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(K);(!L.applicationId||!z(L.applicationId))&&console.warn("[updatingApplications] Skipping webhook: missing or invalid applicationId",{id:L.id,applicationId:L.applicationId});let q={};if(I){const K=B[I.dateKey]||{},U=new Set(["creditScore","timeInBiz","avgMonthlyRevenue","averageMonthlyDeposits","existingDebt","requestedAmount","avgDailyBalance","avgMonthlyDepositCount","nsfCount","negativeDays","currentPositionCount","holdback","grossAnnualRevenue"]),J={...r};for(const te of Object.keys(K)){const ae=K[te];ae===""||ae===void 0||ae===null||(J[te]=ae)}const O={...J};for(const te of Object.keys(J))if(U.has(te)){const ae=String(J[te]??"");if(ae==="")continue;const Ne=ae.replace(/,/g,""),Ce=te==="holdback"?Ne.replace(/%/g,""):Ne;O[te]=Ce}q={id:L.id,applicationId:L.applicationId,dealName:O.dealName??"",entityType:O.entityType??"",industry:O.industry??"",state:O.state??"",creditScore:O.creditScore??"",timeInBiz:O.timeInBiz??"",grossAnnualRevenue:O.grossAnnualRevenue??"",avgMonthlyRevenue:O.avgMonthlyRevenue??"",averageMonthlyDeposits:O.averageMonthlyDeposits??"",existingDebt:O.existingDebt??"",requestedAmount:O.requestedAmount??"",avgDailyBalance:O.avgDailyBalance??"",avgMonthlyDepositCount:O.avgMonthlyDepositCount??"",nsfCount:O.nsfCount??"",negativeDays:O.negativeDays??"",currentPositionCount:O.currentPositionCount??"",holdback:O.holdback??"",hasBankruptcies:!!(O.hasBankruptcies??r.hasBankruptcies??!1),hasOpenJudgments:!!(O.hasOpenJudgments??r.hasOpenJudgments??!1)}}else{const K=new Set(["creditScore","timeInBiz","avgMonthlyRevenue","averageMonthlyDeposits","existingDebt","requestedAmount","avgDailyBalance","avgMonthlyDepositCount","nsfCount","negativeDays","currentPositionCount","holdback","grossAnnualRevenue"]),U={...r};for(const J of Object.keys(r))if(K.has(J)){const O=String(r[J]??"");if(!O)continue;const te=O.replace(/,/g,""),ae=J==="holdback"?te.replace(/%/g,""):te;U[J]=ae}q={id:L.id,applicationId:L.applicationId,dealName:U.dealName??"",entityType:U.entityType??"",industry:U.industry??"",state:U.state??"",creditScore:U.creditScore??"",timeInBiz:U.timeInBiz??"",grossAnnualRevenue:U.grossAnnualRevenue??"",avgMonthlyRevenue:U.avgMonthlyRevenue??"",averageMonthlyDeposits:U.averageMonthlyDeposits??"",existingDebt:U.existingDebt??"",requestedAmount:U.requestedAmount??"",avgDailyBalance:U.avgDailyBalance??"",avgMonthlyDepositCount:U.avgMonthlyDepositCount??"",nsfCount:U.nsfCount??"",negativeDays:U.negativeDays??"",currentPositionCount:U.currentPositionCount??"",holdback:U.holdback??"",hasBankruptcies:!!(U.hasBankruptcies??r.hasBankruptcies??!1),hasOpenJudgments:!!(U.hasOpenJudgments??r.hasOpenJudgments??!1)}}if(L.applicationId&&z(L.applicationId)){try{console.log("[updatingApplications] payload preview (flat)",q)}catch{}const K=await W(KR,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(q),timeoutMs:8e3});if(!K.ok){let U="";try{U=await K.text()}catch{}console.error("[updatingApplications] Non-OK response (flat payload)",{status:K.status,statusText:K.statusText,body:(U||"").slice(0,2048)})}}}catch(L){console.error("[updatingApplications] Error sending webhook:",L)}finally{if(I){const L=B[I.dateKey]||{},z=new Set(["creditScore","timeInBiz","avgMonthlyRevenue","averageMonthlyDeposits","existingDebt","requestedAmount","avgDailyBalance","avgMonthlyDepositCount","nsfCount","negativeDays","currentPositionCount","holdback","grossAnnualRevenue"]),q={...r};for(const K of Object.keys(L)){const U=L[K];U===""||U===void 0||U===null||(q[K]=U)}for(const K of Object.keys(q))if(z.has(K)){const U=String(q[K]??"");if(U==="")continue;const J=U.replace(/,/g,""),O=K==="holdback"?J.replace(/%/g,""):J,te=O===""?void 0:Number(O);q[K]=Number.isFinite(te)?te:O}n(q)}else n(r);h(!1)}}},Ge=({label:I,name:L,type:z="text",inputMode:q,valueProp:K,onValueChange:U})=>{const J=V.useRef(null),O=V.useRef(!1),te=V.useRef(!1),ae=V.useRef(null),Ne=new Set(["creditScore","timeInBiz","avgMonthlyRevenue","averageMonthlyDeposits","existingDebt","requestedAmount","avgDailyBalance","avgMonthlyDepositCount","nsfCount","negativeDays","currentPositionCount","holdback","grossAnnualRevenue"]),Ce=Z=>{if(!Z)return"";let ce="";Z.startsWith("-")&&(ce="-",Z=Z.slice(1));const Ee=Z.split("."),le=Ee[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),nt=Ee.length>1?`.${Ee.slice(1).join(".")}`:"";return`${ce}${le}${nt}`},ge=()=>{te.current=!0,ae.current&&window.clearTimeout(ae.current),ae.current=window.setTimeout(()=>{var Z;te.current=!1,O.current||(Z=J.current)==null||Z.blur()},600)},me=()=>{O.current=!0,J.current&&J.current.focus()},G=()=>{var Z;O.current=!1,te.current||(Z=J.current)==null||Z.blur()};return u.jsxs("div",{className:"relative",children:[u.jsx("label",{className:"block text-sm font-bold text-gray-800 mb-2",htmlFor:L,children:I}),u.jsx("div",{className:"relative",children:u.jsx("input",{ref:J,id:L,name:L,type:z,inputMode:q,autoComplete:"off",value:K??(r[L]||""),onFocus:()=>{},onMouseEnter:me,onMouseLeave:G,onKeyDown:ge,onInput:ge,onChange:Z=>{ge();let ce=Z.target.value;if(Ne.has(L)){let Ee=!1;if(L==="holdback"&&ce.includes("%")&&(Ee=!0),ce=ce.replace(/,/g,"").replace(/[^0-9.-]/g,""),L==="holdback"){const le=Number(ce);Number.isNaN(le)||(le<0?ce="0":le>100&&(ce="100")),Ee&&ce!==""&&(ce=`${ce}%`)}}_.has(L)&&w(Ee=>{const le=new Set(Ee);return le.delete(L),le}),U?U(ce):c(L,ce)},onBlur:()=>{var ut;if(!Ne.has(L))return;const Z=((ut=J.current)==null?void 0:ut.value)??"";let ce=!1;L==="holdback"&&Z.includes("%")&&(ce=!0);const Ee=Z.replace(/,/g,"").replace(/[^0-9.-]/g,"");if(Ee===""||Ee==="-"||Ee===".")return;const le=Ce(Ee),nt=ce?`${le}%`:le;U?U(nt):c(L,nt)},className:`w-full rounded-xl border-2 px-4 py-3 text-gray-900 font-medium transition-all duration-200 ${_.has(L)?"border-emerald-300 bg-gradient-to-r from-emerald-50 to-green-50 ring-2 ring-emerald-200/50 shadow-sm focus:border-emerald-400 focus:ring-emerald-300/50":"border-gray-200 bg-white hover:border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 shadow-sm hover:shadow-sm"} focus:outline-none`})}),_.has(L)&&u.jsxs("div",{className:"mt-2 flex items-center gap-2 text-emerald-700 text-xs font-medium",children:[u.jsx("div",{className:"w-2 h-2 bg-emerald-500 rounded-full animate-pulse"}),u.jsx("span",{children:"Extracted from documents"})]})]})};return u.jsx("div",{className:"max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:u.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm",children:[u.jsxs("div",{className:"px-8 py-6 border-b border-gray-200",children:[u.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Merchant Cash Advance Application"}),u.jsx("p",{className:"text-gray-600 mt-1",children:"Please fill out all required information to get matched with qualified lenders"})]}),u.jsx("div",{className:"p-8",children:s||d?u.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-center",children:[u.jsx("div",{className:"w-16 h-16 rounded-xl bg-gradient-to-b from-blue-50 to-blue-100/70 border border-blue-100 flex items-center justify-center shadow-sm mb-5",children:u.jsx("svg",{className:"w-7 h-7 text-blue-600 animate-spin",viewBox:"0 0 24 24",fill:"none","aria-hidden":"true",children:u.jsxs("g",{stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",children:[u.jsx("line",{x1:"12",y1:"3.5",x2:"12",y2:"6.5",opacity:"1"}),u.jsx("line",{x1:"12",y1:"17.5",x2:"12",y2:"20.5",opacity:"0.25"}),u.jsx("line",{x1:"3.5",y1:"12",x2:"6.5",y2:"12",opacity:"0.6"}),u.jsx("line",{x1:"17.5",y1:"12",x2:"20.5",y2:"12",opacity:"0.25"}),u.jsx("line",{x1:"6.1",y1:"6.1",x2:"8.2",y2:"8.2",opacity:"0.85"}),u.jsx("line",{x1:"15.8",y1:"15.8",x2:"17.9",y2:"17.9",opacity:"0.2"}),u.jsx("line",{x1:"6.1",y1:"17.9",x2:"8.2",y2:"15.8",opacity:"0.45"}),u.jsx("line",{x1:"15.8",y1:"8.2",x2:"17.9",y2:"6.1",opacity:"0.25"})]})})}),u.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Finding Your Lender Matches"}),u.jsx("p",{className:"text-gray-600 mt-1",children:"We’re reviewing your application and matching it with lenders best suited to your needs."}),u.jsx("div",{className:"w-full max-w-md mt-6",children:u.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 overflow-hidden",children:u.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-500 ease-out",style:{width:`${y}%`}})})}),u.jsx("p",{className:"text-gray-500 text-xs mt-3",children:"This usually takes 30–60 seconds"})]}):u.jsxs(u.Fragment,{children:[u.jsxs("div",{className:"mb-8",children:[u.jsxs("div",{className:"mb-8",children:[u.jsxs("h3",{className:"text-xl font-semibold text-gray-900 mb-2 flex items-center gap-3",children:[u.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:u.jsx(Df,{className:"w-5 h-5 text-blue-600"})}),"Bank Statement Documents"]}),u.jsx("p",{className:"text-gray-600 text-sm",children:"Upload and manage your monthly bank statements for processing"})]}),he().length>0&&u.jsxs("div",{className:"space-y-4 mb-8",children:[u.jsx("div",{className:"flex items-center justify-end mb-6",children:u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsxs("span",{className:"inline-flex items-center px-4 py-2 rounded-full text-sm font-semibold bg-gradient-to-r from-blue-50 to-blue-100 text-blue-700 border border-blue-200",children:[u.jsx(Hl,{className:"w-4 h-4 mr-2"}),he().length," ",he().length===1?"Document":"Documents"]}),T&&u.jsx("span",{className:"text-xs text-gray-500",children:"Syncing…"})]})}),he().map(I=>{const L=I.status==="uploading",z=I.status==="completed",q=I.status==="error";return u.jsxs("div",{className:`group bg-gradient-to-r from-white to-gray-50/50 border border-gray-200 rounded-2xl p-6 shadow-sm hover:shadow-xl hover:border-blue-200 hover:from-blue-50/30 hover:to-white transition-all duration-300 ${z?"cursor-pointer":""}`,onClick:()=>{z&&P(I.key)},role:z?"button":void 0,tabIndex:z?0:-1,"aria-expanded":z?pe===I.key:void 0,children:[u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("div",{className:"flex items-center gap-4 min-w-0 flex-1",children:[u.jsx("div",{className:`flex items-center justify-center w-14 h-14 rounded-2xl shadow-sm ${z?"bg-gradient-to-br from-green-100 to-green-200 border border-green-200":L?"bg-gradient-to-br from-blue-100 to-blue-200 border border-blue-200":q?"bg-gradient-to-br from-red-100 to-red-200 border border-red-200":"bg-gradient-to-br from-gray-100 to-gray-200 border border-gray-200"}`,children:u.jsx(Hl,{className:`w-7 h-7 ${z?"text-green-700":L?"text-blue-700":q?"text-red-700":"text-gray-600"}`})}),u.jsxs("div",{className:"min-w-0 flex-1",children:[u.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[u.jsx("h5",{className:"text-lg font-bold text-gray-900",children:I.dateDisplay}),u.jsxs("div",{className:`inline-flex items-center px-4 py-2 rounded-full text-xs font-bold shadow-sm border ${z?"bg-gradient-to-r from-green-50 to-green-100 text-green-800 border-green-200":L?"bg-gradient-to-r from-blue-50 to-blue-100 text-blue-800 border-blue-200":q?"bg-gradient-to-r from-red-50 to-red-100 text-red-800 border-red-200":"bg-gradient-to-r from-gray-50 to-gray-100 text-gray-800 border-gray-200"}`,children:[z&&u.jsx(Ks,{className:"w-3 h-3 mr-1.5"}),L&&u.jsx("div",{className:"w-3 h-3 mr-1.5 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"}),q&&u.jsx("span",{className:"w-3 h-3 mr-1.5",children:"⚠"}),z?"Completed":L?"Processing":q?"Error":"Uploaded"]})]}),u.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[u.jsx("span",{className:"font-medium truncate",title:I.file.name,children:I.file.name}),u.jsx("span",{className:"text-gray-400",children:"•"}),u.jsxs("span",{className:"px-2 py-1 bg-gray-100 rounded-md text-xs font-semibold text-gray-700",children:[(I.file.size/1024/1024).toFixed(1)," MB"]})]}),I.fileUrl&&u.jsx("div",{className:"mt-1 text-sm",children:u.jsx("a",{href:I.fileUrl,target:"_blank",rel:"noreferrer",className:"text-blue-600 hover:text-blue-700 underline",children:"View uploaded file"})})]})]}),u.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[u.jsx("button",{type:"button",className:"p-3 rounded-xl text-gray-400 hover:text-blue-600 hover:bg-blue-50 border border-transparent hover:border-blue-200 transition-all duration-200 group-hover:text-gray-500 shadow-sm hover:shadow-md",onClick:K=>{K.stopPropagation(),Pt(I)},title:"Replace file",children:u.jsx(dC,{className:"w-4 h-4"})}),I.source==="local"&&q&&u.jsx("button",{type:"button",className:"p-3 rounded-xl text-gray-400 hover:text-orange-600 hover:bg-orange-50 border border-transparent hover:border-orange-200 transition-all duration-200 shadow-sm hover:shadow-md",onClick:K=>{K.stopPropagation(),Se(I.dateKey)},title:"Retry upload",children:u.jsx(hC,{className:"w-4 h-4"})}),u.jsx("button",{type:"button",className:"p-3 rounded-xl text-gray-400 hover:text-red-600 hover:bg-red-50 border border-transparent hover:border-red-200 transition-all duration-200 group-hover:text-gray-500 shadow-sm hover:shadow-md",onClick:K=>{K.stopPropagation(),tt(I)},title:"Remove file",children:u.jsx(q0,{className:"w-4 h-4"})})]})]}),L&&u.jsxs("div",{className:"mt-4",children:[u.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 overflow-hidden",children:u.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-500 ease-out",style:{width:`${Math.min(p.get(I.dateKey)||0,100)}%`}})}),u.jsx("p",{className:"text-xs text-blue-600 mt-2 font-medium",children:(p.get(I.dateKey)||0)<100?"Processing document...":"Almost done..."})]}),z&&pe===I.key&&u.jsx("div",{className:"mt-6 pt-6 border-t border-gray-200",children:(()=>{const K=B[I.dateKey]||{},U=O=>({valueProp:K[O]??"",onValueChange:te=>{ee(ae=>({...ae,[I.dateKey]:{...ae[I.dateKey],[O]:te}}))}}),J=Object.values(K).filter(O=>String(O??"").trim()!=="").length;return u.jsxs(u.Fragment,{children:[J>0&&u.jsxs("div",{className:"mb-6 relative overflow-hidden rounded-2xl border border-emerald-200 bg-gradient-to-br from-emerald-50 via-green-50 to-teal-50 p-5 shadow-lg",children:[u.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-emerald-100/20 to-teal-100/20 opacity-50"}),u.jsxs("div",{className:"relative flex items-start gap-4",children:[u.jsx("div",{className:"flex-shrink-0 p-2.5 bg-gradient-to-br from-emerald-100 to-green-100 rounded-2xl shadow-sm border border-emerald-200",children:u.jsx(Ks,{className:"w-5 h-5 text-emerald-700"})}),u.jsxs("div",{className:"flex-1",children:[u.jsx("h5",{className:"text-base font-bold text-emerald-900 mb-1",children:"Data Extraction Complete"}),u.jsxs("p",{className:"text-emerald-800 font-medium mb-1 text-sm",children:[J," ",J===1?"field":"fields"," automatically populated from this document"]}),u.jsx("p",{className:"text-xs text-emerald-700 leading-relaxed",children:"Review the highlighted fields below. All information can be edited if needed."})]}),u.jsx("div",{className:"flex-shrink-0",children:u.jsxs("span",{className:"inline-flex items-center px-3 py-1.5 rounded-full text-xs font-bold bg-gradient-to-r from-emerald-100 to-green-100 text-emerald-800 border border-emerald-200 shadow-sm",children:[J," ",J===1?"Field":"Fields"]})})]})]}),u.jsx("div",{className:"mb-4 flex justify-end",children:u.jsx("button",{type:"button",onClick:O=>{O.stopPropagation(),P(null)},className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-lg text-sm font-semibold text-gray-700 bg-gray-100 hover:bg-gray-200 border border-gray-200 shadow-sm","aria-label":"Close details",children:"Close"})}),u.jsxs("div",{className:"mb-6",children:[u.jsxs("div",{className:"mb-4 flex items-center gap-3",children:[u.jsx("div",{className:"p-2 bg-gradient-to-br from-blue-100 to-indigo-100 rounded-xl shadow-sm border border-blue-200",children:u.jsx(zs,{className:"w-5 h-5 text-blue-700"})}),u.jsx("h4",{className:"text-lg font-bold text-gray-900",children:"Business Information"})]}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[u.jsx(Ge,{label:"Deal Name",name:"dealName",...U("dealName")}),u.jsx(Ge,{label:"Industry",name:"industry",...U("industry")}),u.jsx(Ge,{label:"Entity Type",name:"entityType",...U("entityType")}),u.jsx(Ge,{label:"State",name:"state",...U("state")})]})]}),u.jsxs("div",{className:"mb-4 flex items-center gap-3",children:[u.jsx("div",{className:"p-2 bg-gradient-to-br from-purple-100 to-violet-100 rounded-xl shadow-sm border border-purple-200",children:u.jsx(zs,{className:"w-5 h-5 text-purple-700"})}),u.jsx("h4",{className:"text-lg font-bold text-gray-900",children:"Financial Details"})]}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[u.jsx(Ge,{label:"Credit Score",name:"creditScore",type:"text",inputMode:"decimal",...U("creditScore")}),u.jsx(Ge,{label:"Time in Biz (months)",name:"timeInBiz",type:"text",inputMode:"decimal",...U("timeInBiz")}),u.jsx(Ge,{label:"Avg Monthly Revenue",name:"avgMonthlyRevenue",type:"text",inputMode:"decimal",...U("avgMonthlyRevenue")}),u.jsx(Ge,{label:"Avg Monthly Deposits",name:"averageMonthlyDeposits",type:"text",inputMode:"decimal",...U("averageMonthlyDeposits")}),u.jsx(Ge,{label:"Existing Business Debt",name:"existingDebt",type:"text",inputMode:"decimal",...U("existingDebt")}),u.jsx(Ge,{label:"Requested Amount",name:"requestedAmount",type:"text",inputMode:"decimal",...U("requestedAmount")}),u.jsx(Ge,{label:"Gross Annual Revenue",name:"grossAnnualRevenue",type:"text",inputMode:"decimal",...U("grossAnnualRevenue")}),u.jsx(Ge,{label:"Avg Daily Balance",name:"avgDailyBalance",type:"text",inputMode:"decimal",...U("avgDailyBalance")}),u.jsx(Ge,{label:"Avg Monthly Deposit Count",name:"avgMonthlyDepositCount",type:"text",inputMode:"decimal",...U("avgMonthlyDepositCount")}),u.jsx(Ge,{label:"NSF Count",name:"nsfCount",type:"text",inputMode:"decimal",...U("nsfCount")}),u.jsx(Ge,{label:"Negative Days",name:"negativeDays",type:"text",inputMode:"decimal",...U("negativeDays")}),u.jsx(Ge,{label:"Current Position Count",name:"currentPositionCount",type:"text",inputMode:"decimal",...U("currentPositionCount")}),u.jsx(Ge,{label:"Holdback",name:"holdback",type:"text",inputMode:"decimal",...U("holdback")})]}),(()=>{const O=M[I.dateKey];return O&&console.log("[MCA render]",{dateKey:I.dateKey,monthlyLen:Array.isArray(O.monthly_table)?O.monthly_table.length:0,summaryLen:Array.isArray(O.mca_summary)?O.mca_summary.length:0,flagsLen:Array.isArray(O.fraud_flags)?O.fraud_flags.length:0}),O?u.jsxs("div",{className:"mt-8 space-y-8",children:[Array.isArray(O.monthly_table)&&O.monthly_table.length>0&&u.jsxs("div",{className:"bg-gradient-to-br from-slate-50 to-gray-50 rounded-2xl p-6 border border-slate-200 shadow-sm",children:[u.jsxs("div",{className:"mb-6 flex items-center gap-4",children:[u.jsx("div",{className:"p-3 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl shadow-lg",children:u.jsx(zs,{className:"w-6 h-6 text-white"})}),u.jsxs("div",{children:[u.jsx("h4",{className:"text-xl font-bold text-gray-900",children:"Monthly Analysis"}),u.jsx("p",{className:"text-sm text-gray-600",children:"Financial performance overview"})]})]}),u.jsx("div",{className:"grid gap-4",children:O.monthly_table.map((te,ae)=>u.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-6 shadow-sm hover:shadow-md transition-shadow",children:u.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:Object.entries(te).map(([Ne,Ce])=>u.jsxs("div",{className:"space-y-1",children:[u.jsx("div",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide",children:Ne.replace(/_/g," ")}),u.jsx("div",{className:"text-lg font-bold text-gray-900",children:Ce||"—"})]},Ne))})},ae))})]}),Array.isArray(O.mca_summary)&&O.mca_summary.length>0&&u.jsxs("div",{className:"bg-gradient-to-br from-amber-50 to-orange-50 rounded-2xl p-6 border border-amber-200 shadow-sm",children:[u.jsxs("div",{className:"mb-6 flex items-center gap-4",children:[u.jsx("div",{className:"p-3 bg-gradient-to-br from-amber-500 to-orange-600 rounded-xl shadow-lg",children:u.jsx(zs,{className:"w-6 h-6 text-white"})}),u.jsxs("div",{children:[u.jsx("h4",{className:"text-xl font-bold text-gray-900",children:"MCA Opportunities"}),u.jsx("p",{className:"text-sm text-gray-600",children:"Merchant cash advance options"})]})]}),u.jsx("div",{className:"space-y-4",children:O.mca_summary.map((te,ae)=>u.jsxs("div",{className:"bg-white rounded-xl border border-amber-200 p-6 shadow-sm hover:shadow-md transition-all duration-200",children:[u.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[u.jsxs("div",{className:"space-y-1",children:[u.jsx("div",{className:"text-xs font-semibold text-amber-600 uppercase tracking-wide",children:"Funder"}),u.jsx("div",{className:"text-lg font-bold text-gray-900",children:te.FUNDER||"Not specified"})]}),u.jsxs("div",{className:"space-y-1",children:[u.jsx("div",{className:"text-xs font-semibold text-amber-600 uppercase tracking-wide",children:"Amount"}),u.jsx("div",{className:"text-lg font-bold text-green-700",children:te.AMOUNT||"Not specified"})]}),u.jsxs("div",{className:"space-y-1",children:[u.jsx("div",{className:"text-xs font-semibold text-amber-600 uppercase tracking-wide",children:"Daily/Weekly Debit"}),u.jsx("div",{className:"text-lg font-bold text-blue-700",children:te["DAILY/WEEKLY Debit"]||"Not specified"})]})]}),te.NOTES&&te.NOTES.trim()&&u.jsxs("div",{className:"mt-4 pt-4 border-t border-amber-100",children:[u.jsx("div",{className:"text-xs font-semibold text-amber-600 uppercase tracking-wide mb-2",children:"Additional Notes"}),u.jsx("div",{className:"text-sm text-gray-700 leading-relaxed bg-amber-50 rounded-lg p-3",children:te.NOTES})]})]},ae))})]}),Array.isArray(O.fraud_flags)&&O.fraud_flags.length>0&&u.jsxs("div",{className:"bg-gradient-to-br from-red-50 to-rose-50 rounded-2xl p-6 border border-red-200 shadow-sm",children:[u.jsxs("div",{className:"mb-6 flex items-center gap-4",children:[u.jsx("div",{className:"p-3 bg-gradient-to-br from-red-500 to-rose-600 rounded-xl shadow-lg",children:u.jsx(zs,{className:"w-6 h-6 text-white"})}),u.jsxs("div",{children:[u.jsx("h4",{className:"text-xl font-bold text-gray-900",children:"Risk Assessment"}),u.jsx("p",{className:"text-sm text-gray-600",children:"Identified potential concerns"})]})]}),u.jsx("div",{className:"space-y-3",children:O.fraud_flags.map((te,ae)=>u.jsxs("div",{className:"bg-white rounded-lg border border-red-200 p-4 flex items-start gap-3 shadow-sm",children:[u.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full mt-2 flex-shrink-0"}),u.jsx("div",{className:"text-sm text-gray-800 leading-relaxed",children:te})]},ae))})]})]}):(console.log("[MCA render] No perDocMcaData for dateKey",I.dateKey,"existing keys:",Object.keys(M||{})),u.jsx("div",{className:"mt-6 text-sm text-gray-500",children:"No MCA data parsed yet for this document."}))})(),u.jsx("div",{className:"flex items-center justify-end pt-4 mt-2",children:u.jsx("button",{type:"button",onClick:O=>{O.stopPropagation(),je(I)},disabled:d,className:`inline-flex items-center gap-3 px-6 py-3 rounded-xl font-bold text-base shadow-md transition-all duration-200 focus:outline-none focus:ring-4 ${d?"bg-gradient-to-r from-gray-400 to-gray-500 text-white cursor-not-allowed":"bg-gradient-to-r from-blue-600 to-indigo-600 text-white hover:from-blue-700 hover:to-indigo-700 hover:shadow-lg hover:scale-[1.02] focus:ring-blue-500/40"}`,"aria-label":"Continue to Lender Matches",children:d?u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Processing…"]}):u.jsxs(u.Fragment,{children:["Continue to Lender Matches",u.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:u.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7l5 5m0 0l-5 5m5-5H6"})})]})})})]})})()})]},I.key)})]}),(()=>{const I=he().filter(te=>te.status==="completed");if(I.length===0)return null;const L=I[0],[z,q,K]=L.dateKey.split("-").map(Number);if(!z||!q||!K)return null;const U=new Date(z,q-1,K),O=new Date(U.getFullYear(),U.getMonth()+1,1).toLocaleDateString("en-US",{month:"long",year:"numeric"});return u.jsx("div",{className:"mb-6 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-2xl shadow-sm",children:u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsx("div",{className:"p-2 bg-blue-100 rounded-xl",children:u.jsx(Df,{className:"w-5 h-5 text-blue-600"})}),u.jsxs("div",{children:[u.jsxs("p",{className:"text-sm font-bold text-blue-900 mb-1",children:["Next: Upload statement for ",O]}),u.jsx("p",{className:"text-xs text-blue-700",children:"Continue your document sequence"})]})]})})})(),u.jsx("div",{className:`relative p-10 border-2 border-dashed rounded-3xl text-center transition-all duration-300 ${f?"border-blue-400 bg-gradient-to-br from-blue-50 to-indigo-50 shadow-xl scale-[1.02]":"border-gray-300 bg-gradient-to-br from-gray-50/50 via-white to-blue-50/30 hover:border-blue-400 hover:bg-gradient-to-br hover:from-blue-50/50 hover:to-indigo-50/50 hover:shadow-lg hover:scale-[1.01]"}`,onDragOver:Q,onDragLeave:Ve,onDrop:H,children:u.jsxs("div",{className:"relative",children:[u.jsx("div",{className:"p-4 bg-gradient-to-br from-blue-100 to-indigo-100 rounded-2xl w-fit mx-auto mb-6 shadow-sm",children:u.jsx(Df,{className:"w-8 h-8 text-blue-600"})}),u.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-3",children:"Upload Bank Statements"}),u.jsx("p",{className:"text-sm text-gray-600 mb-8 max-w-md mx-auto leading-relaxed",children:"We'll automatically organize them by month. Drag & drop files here or click to browse."}),u.jsxs("label",{className:"cursor-pointer inline-flex items-center gap-3 px-8 py-4 rounded-2xl bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-bold hover:from-blue-700 hover:to-indigo-700 focus:outline-none focus:ring-4 focus:ring-blue-500/40 transition-all duration-200 shadow-lg hover:shadow-xl hover:scale-105",children:[u.jsx(Df,{className:"w-5 h-5"}),"Choose Files",u.jsx("input",{type:"file",className:"sr-only",accept:".pdf",multiple:!0,onChange:I=>et(I.target.files)})]}),u.jsx("p",{className:"text-xs text-gray-500 mt-4 font-medium",children:"PDF files only, max 10MB each"})]})})]}),u.jsxs("div",{className:"mb-8",children:[u.jsxs("div",{className:"mb-6",children:[u.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[u.jsx("div",{className:"p-2 bg-gradient-to-br from-amber-100 to-orange-100 rounded-xl shadow-sm border border-amber-200",children:u.jsx(zs,{className:"w-5 h-5 text-amber-700"})}),u.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Legal & Compliance"})]}),u.jsx("p",{className:"text-sm text-gray-600 ml-12",children:"Legal status and financial history"})]}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[u.jsx("div",{className:"group",children:u.jsxs("label",{className:"flex items-start gap-4 p-5 rounded-2xl border-2 border-gray-200 bg-white hover:border-gray-300 hover:shadow-md transition-all duration-200 cursor-pointer",children:[u.jsx("div",{className:"flex items-center justify-center w-6 h-6 mt-0.5",children:u.jsx("input",{type:"checkbox",checked:!!r.hasBankruptcies,onChange:I=>c("hasBankruptcies",I.target.checked),className:"w-5 h-5 rounded-lg border-2 border-gray-300 text-blue-600 focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500 transition-colors duration-200"})}),u.jsxs("div",{className:"flex-1",children:[u.jsx("span",{className:"text-base font-semibold text-gray-900 block mb-1",children:"Has Bankruptcies"}),u.jsx("span",{className:"text-sm text-gray-600",children:"Any bankruptcy filings in business history"})]})]})}),u.jsx("div",{className:"group",children:u.jsxs("label",{className:"flex items-start gap-4 p-5 rounded-2xl border-2 border-gray-200 bg-white hover:border-gray-300 hover:shadow-md transition-all duration-200 cursor-pointer",children:[u.jsx("div",{className:"flex items-center justify-center w-6 h-6 mt-0.5",children:u.jsx("input",{type:"checkbox",checked:!!r.hasOpenJudgments,onChange:I=>c("hasOpenJudgments",I.target.checked),className:"w-5 h-5 rounded-lg border-2 border-gray-300 text-blue-600 focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500 transition-colors duration-200"})}),u.jsxs("div",{className:"flex-1",children:[u.jsx("span",{className:"text-base font-semibold text-gray-900 block mb-1",children:"Has Open Judgments"}),u.jsx("span",{className:"text-sm text-gray-600",children:"Any outstanding legal judgments"})]})]})})]})]}),u.jsx("div",{className:"flex items-center justify-between pt-8 mt-8 border-t border-gray-100",children:u.jsx("div",{className:"flex items-center gap-4",children:e&&u.jsx("button",{type:"button",onClick:e,className:"inline-flex items-center gap-2 px-6 py-3 rounded-xl border-2 border-gray-200 text-gray-700 font-semibold hover:border-gray-300 hover:bg-gray-50 hover:shadow-md transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-gray-500/20",children:"Back"})})}),u.jsx("input",{ref:se,type:"file",className:"sr-only",accept:".pdf",onChange:qe})]})})]})})};function JR(n){const e=h=>{try{return JSON.parse(h)}catch{const f=h.match(/(?:\{|\[)[\s\S]*(?:\}|\])/);if(f)try{return JSON.parse(f[0])}catch{}return null}},t=h=>h&&typeof h=="object"&&!Array.isArray(h)?h:null;let s=n;typeof s=="string"&&(s=e(s)??{});const r=t(s)??{};let i=r;const a=r.output;if(typeof a=="string"){const h=e(a);h&&(i=h)}else a&&typeof a=="object"&&(i=a);const o=[i,i==null?void 0:i.data,i==null?void 0:i.result,i==null?void 0:i.payload,r,r.data,r.result,r.payload,r.matches].filter(h=>h!==void 0);let c=o.find(h=>Array.isArray(h));if(!c)for(const h of o){const f=t(h);if(f&&Array.isArray(f.matches)){c=f.matches;break}}return Array.isArray(c)?c.map(h=>{const f=(h==null?void 0:h.lender_id)||(h==null?void 0:h.id)||(h==null?void 0:h.lenderId)||(h==null?void 0:h.lenderID)||null,m=(h==null?void 0:h.match_score)??(h==null?void 0:h.score)??(h==null?void 0:h.matchScore)??(h==null?void 0:h.qualification_score),p=typeof m=="number"?m:Number(m);return typeof f=="string"&&Number.isFinite(p)?{lender_id:f,match_score:p}:null}).filter(h=>h!==null):[]}const $w=n=>{var e,t,s,r,i,a,o,c,d,h,f,m,p,g,y,N,b,x,_,w,k,C,T,D,B;return{id:n.id??"",businessName:n.businessName??"",monthlyRevenue:((e=n.financialInfo)==null?void 0:e.averageMonthlyRevenue)??0,timeInBusiness:((t=n.businessInfo)==null?void 0:t.yearsInBusiness)??0,creditScore:n.creditScore??0,industry:n.industry??"",requestedAmount:n.requestedAmount??0,status:"draft",ownerName:((s=n.contactInfo)==null?void 0:s.ownerName)??"",email:((r=n.contactInfo)==null?void 0:r.email)??"",phone:((i=n.contactInfo)==null?void 0:i.phone)??"",address:((a=n.contactInfo)==null?void 0:a.address)??"",ein:((o=n.businessInfo)==null?void 0:o.ein)??"",businessType:((c=n.businessInfo)==null?void 0:c.businessType)??"",yearsInBusiness:((d=n.businessInfo)==null?void 0:d.yearsInBusiness)??0,numberOfEmployees:((h=n.businessInfo)==null?void 0:h.numberOfEmployees)??0,annualRevenue:((f=n.financialInfo)==null?void 0:f.annualRevenue)??0,monthlyDeposits:((m=n.financialInfo)==null?void 0:m.averageMonthlyDeposits)??0,existingDebt:((p=n.financialInfo)==null?void 0:p.existingDebt)??0,documents:n.documents??[],contactInfo:{ownerName:((g=n.contactInfo)==null?void 0:g.ownerName)??"",email:((y=n.contactInfo)==null?void 0:y.email)??"",phone:((N=n.contactInfo)==null?void 0:N.phone)??"",address:((b=n.contactInfo)==null?void 0:b.address)??""},businessInfo:{ein:((x=n.businessInfo)==null?void 0:x.ein)??"",businessType:((_=n.businessInfo)==null?void 0:_.businessType)??"",yearsInBusiness:((w=n.businessInfo)==null?void 0:w.yearsInBusiness)??0,numberOfEmployees:((k=n.businessInfo)==null?void 0:k.numberOfEmployees)??0},financialInfo:{annualRevenue:((C=n.financialInfo)==null?void 0:C.annualRevenue)??0,averageMonthlyRevenue:((T=n.financialInfo)==null?void 0:T.averageMonthlyRevenue)??0,averageMonthlyDeposits:((D=n.financialInfo)==null?void 0:D.averageMonthlyDeposits)??0,existingDebt:((B=n.financialInfo)==null?void 0:B.existingDebt)??0}}},QR=({initialStep:n,initialApplicationId:e,lockedLenderIds:t=[]})=>{const[s,r]=V.useState("application"),[i,a]=V.useState(null),[o,c]=V.useState(null),[d,h]=V.useState(null),[f,m]=V.useState([]),[p,g]=V.useState(!1),[y,N]=V.useState(null),[b,x]=V.useState(null);V.useEffect(()=>{(async()=>{if(n==="matches"&&e)try{const E=await gw(e);if(E){const $={id:E.id,businessName:E.business_name,monthlyRevenue:E.monthly_revenue,timeInBusiness:E.years_in_business,creditScore:E.credit_score,industry:E.industry,requestedAmount:E.requested_amount,status:E.status,ownerName:E.owner_name,email:E.email,phone:E.phone,address:E.address,ein:E.ein,businessType:E.business_type,yearsInBusiness:E.years_in_business,numberOfEmployees:E.number_of_employees,annualRevenue:E.annual_revenue,monthlyDeposits:E.monthly_deposits,existingDebt:E.existing_debt,documents:E.documents??[],contactInfo:{ownerName:E.owner_name,email:E.email,phone:E.phone,address:E.address},businessInfo:{ein:E.ein,businessType:E.business_type,yearsInBusiness:E.years_in_business,numberOfEmployees:E.number_of_employees},financialInfo:{annualRevenue:E.annual_revenue,averageMonthlyRevenue:E.monthly_revenue,averageMonthlyDeposits:E.monthly_deposits,existingDebt:E.existing_debt}};c($),r("matches")}}catch(E){console.warn("Failed to preload application for matches:",E)}})()},[n,e]);const _=E=>E?{id:E.id,businessName:E.businessName,creditScore:E.creditScore,industry:E.industry,requestedAmount:E.requestedAmount,documents:E.documents??[],contactInfo:{ownerName:E.ownerName,email:E.email,phone:E.phone,address:E.address},businessInfo:{ein:E.ein,businessType:E.businessType,yearsInBusiness:E.yearsInBusiness??E.timeInBusiness,numberOfEmployees:E.numberOfEmployees},financialInfo:{annualRevenue:E.annualRevenue,averageMonthlyRevenue:E.monthlyRevenue}}:null,w=E=>({id:E.id,businessName:E.businessName,creditScore:E.creditScore,industry:E.industry,requestedAmount:E.requestedAmount,documents:E.documents,contactInfo:E.contactInfo,businessInfo:E.businessInfo,financialInfo:E.financialInfo}),k=E=>{a(s),r(E)},C=()=>{if(i){const E=i;a(s),r(E)}},T=(E,$)=>{const ie={id:E.id,businessName:E.businessName,monthlyRevenue:E.monthlyRevenue,timeInBusiness:E.timeInBusiness,creditScore:E.creditScore,industry:E.industry,requestedAmount:E.requestedAmount,status:E.status,ownerName:E.contactInfo.ownerName,email:E.contactInfo.email,phone:E.contactInfo.phone,address:E.contactInfo.address,ein:E.businessInfo.ein,businessType:E.businessInfo.businessType,yearsInBusiness:E.businessInfo.yearsInBusiness,numberOfEmployees:E.businessInfo.numberOfEmployees,annualRevenue:E.financialInfo.annualRevenue,monthlyDeposits:E.financialInfo.averageMonthlyDeposits,existingDebt:E.financialInfo.existingDebt,documents:E.documents,contactInfo:E.contactInfo,businessInfo:E.businessInfo,financialInfo:E.financialInfo};c(ie),g(!0),N(null),k("bank"),(async()=>{try{if($!=null&&$.pdfFile&&!y){console.log("[newDeal] starting POST to /webhook/newDeal with file:",{name:$.pdfFile.name,size:$.pdfFile.size,type:$.pdfFile.type});const pe="/webhook/newDeal",P=new FormData;P.append("file",$.pdfFile,$.pdfFile.name);const se=await fetch(pe,{method:"POST",body:P});console.log("[newDeal] response status:",se.status,se.statusText),console.log("[newDeal] response content-type:",se.headers?se.headers.get("content-type"):"(no headers)");let F={},W={};try{const R=await se.text();if(console.log("[newDeal] raw body:",R),R)try{W=JSON.parse(R)}catch{const Y=R.match(/\[[\s\S]*?\]/),he=R.match(/\{[\s\S]*\}/);if(Y)try{W=JSON.parse(Y[0])}catch{W={}}else if(he)try{W=JSON.parse(he[0])}catch{W={}}else W={}}}catch{W={}}Array.isArray(W)&&console.log("[newDeal] parsed array length:",W.length),Array.isArray(W)&&W.length>0&&typeof W[0]=="object"&&W[0]!==null?F=W[0]:W&&typeof W=="object"&&!Array.isArray(W)?F=W:F={},console.log("[newDeal] parsed normalized root object:",F);const ne={"Entity Type":F["Entity Type"]??null,State:F.State??null,"Gross Annual Revenue":F["Gross Annual Revenue"]??null,"Avg Daily Balance":F["Avg Daily Balance"]??null,"Avg Monthly Deposit Count":F["Avg Monthly Deposit Count"]??null,"NSF Count":F["NSF Count"]??null,"Negative Days":F["Negative Days"]??null,"Current Position Count":F["Current Position Count"]??null,Holdback:F.Holdback??null};console.log("[newDeal] expected-key preview:",ne);const be={},_e=(R,Y="")=>{if(R&&typeof R=="object")for(const[he,Ae]of Object.entries(R)){const tt=Y?`${Y}.${he}`:he;Ae&&typeof Ae=="object"&&!Array.isArray(Ae)?_e(Ae,tt):be[tt]=Ae}};_e(F);const Oe=R=>R.toLowerCase().replace(/[^a-z0-9]/g,""),et={};for(const[R,Y]of Object.entries({...F,...be}))et[Oe(R)]=Y;const qe=R=>{for(const Y of R){const he=Oe(Y),Ae=et[he];if(Ae!=null){if(typeof Ae=="string"){if(Ae.trim()!=="")return Ae}else if(typeof Ae=="number"||typeof Ae=="boolean")return String(Ae)}}return""},Se=R=>R?R.replace(/[^0-9.-]/g,""):"",Q={},Ve=R=>typeof F[R]=="string"||typeof F[R]=="number"||typeof F[R]=="boolean"?String(F[R]):"";Q.entityType=Ve("Entity Type"),Q.state=Ve("State"),Q.grossAnnualRevenue=Se(Ve("Gross Annual Revenue")),Q.avgDailyBalance=Se(Ve("Avg Daily Balance")),Q.avgMonthlyDepositCount=Se(Ve("Avg Monthly Deposit Count")),Q.nsfCount=Se(Ve("NSF Count")),Q.negativeDays=Se(Ve("Negative Days")),Q.currentPositionCount=Se(Ve("Current Position Count")),Q.holdback=Se(Ve("Holdback")),Q.entityType=Q.entityType||qe(["Entity Type","Business Type","Entity","Business Entity"]),Q.state=Q.state||qe(["State","Business State","Company State"]),Q.grossAnnualRevenue=Q.grossAnnualRevenue||Se(qe(["Gross Annual Revenue","Annual Revenue","Yearly Revenue","Gross Annual Sales"])),Q.avgDailyBalance=Q.avgDailyBalance||Se(qe(["Avg Daily Balance","Average Daily Balance"])),Q.avgMonthlyDepositCount=Q.avgMonthlyDepositCount||Se(qe(["Avg Monthly Deposit Count","Average Monthly Deposit Count"])),Q.nsfCount=Q.nsfCount||Se(qe(["NSF Count","NSF","NSFCount"])),Q.negativeDays=Q.negativeDays||Se(qe(["Negative Days","Days Negative"])),Q.currentPositionCount=Q.currentPositionCount||Se(qe(["Current Position Count","Positions","Current Positions"])),Q.holdback=Q.holdback||Se(qe(["Holdback","Hold Back","Hold-back"])),Q.creditScore=Se(qe(["Credit Score","FICO","FICO Score"]));const H=qe(["Time in Biz","Time In Business","Months In Business","Years In Business"]);if(H){const R=Number(Se(H));isNaN(R)?Q.timeInBiz=H:Q.timeInBiz=String(R<=10?Math.round(R*12):Math.round(R))}Q.avgMonthlyRevenue=Se(qe(["Avg Monthly Revenue","Average Monthly Revenue","Monthly Revenue"]));const j=(R,Y)=>R&&String(R).trim()!==""?R:Y==null?"":String(Y);if(Q.entityType=j(Q.entityType,ie.businessType),!Q.state||String(Q.state).trim()===""){const Y=(ie.address||"").match(/\b([A-Z]{2})\b(?:\s+\d{5}(?:-\d{4})?)?$/);Y&&(Q.state=Y[1])}Q.grossAnnualRevenue=j(Q.grossAnnualRevenue,ie.annualRevenue),Q.avgMonthlyDepositCount=j(Q.avgMonthlyDepositCount,ie.monthlyDeposits),Q.creditScore=j(Q.creditScore,ie.creditScore),Q.timeInBiz=j(Q.timeInBiz,ie.timeInBusiness),Q.avgMonthlyRevenue=j(Q.avgMonthlyRevenue,ie.monthlyRevenue),console.log("[newDeal] final normalized prefill:",Q),N(Q)}}catch(pe){console.warn("PDF webhook failed:",pe),N(null)}finally{g(!1)}})()},D=E=>{if(!o){k("matches");return}const $=pe=>{if(typeof pe=="number")return pe;if(typeof pe!="string")return NaN;const P=pe.replace(/[^0-9.]/g,""),se=P.split("."),F=se.length>2?`${se[0]}.${se.slice(1).join("")}`:P,W=Number(F);return isNaN(W)?NaN:W},ie={...o,businessName:E.dealName||o.businessName,industry:E.industry||o.industry,businessType:E.entityType||o.businessType,creditScore:isNaN($(E.creditScore))?o.creditScore:$(E.creditScore),timeInBusiness:isNaN($(E.timeInBiz))?o.timeInBusiness:$(E.timeInBiz),monthlyRevenue:isNaN($(E.avgMonthlyRevenue))?o.monthlyRevenue:$(E.avgMonthlyRevenue),annualRevenue:isNaN($(E.grossAnnualRevenue))?o.annualRevenue:$(E.grossAnnualRevenue),monthlyDeposits:isNaN($(E.avgMonthlyDepositCount))?o.monthlyDeposits??0:$(E.avgMonthlyDepositCount),requestedAmount:isNaN($(E.requestedAmount))?o.requestedAmount:$(E.requestedAmount)};c(ie),(async()=>{try{g(!0);const pe=ne=>typeof ne=="string"&&/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(ne);let P=ie;if(!pe(P.id)){const ne=E.applicationId||o.id;if(pe(ne))P={...P,id:ne},c(be=>be?{...be,id:ne}:P);else{console.warn("No valid application id available; skipping lenders webhook to avoid creating a new row."),g(!1);return}}let se=null;try{se=await gw(P.id)}catch(ne){console.warn("Failed to fetch latest application row; falling back to in-memory state:",ne)}const F=se??{id:P.id,business_name:P.businessName,owner_name:P.ownerName,email:P.email,phone:P.phone||"",address:P.address||"",ein:P.ein||"",business_type:P.businessType||"",industry:P.industry,years_in_business:P.yearsInBusiness??P.timeInBusiness??0,number_of_employees:P.numberOfEmployees??0,annual_revenue:P.annualRevenue??0,monthly_revenue:P.monthlyRevenue??0,monthly_deposits:P.monthlyDeposits??0,existing_debt:P.existingDebt??0,credit_score:P.creditScore??0,requested_amount:P.requestedAmount??0,status:P.status||"submitted",documents:Array.isArray(P.documents)?P.documents:[],created_at:new Date().toISOString(),updated_at:new Date().toISOString()},W=await fetch("/webhook/applications/lenders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(F)});try{if(!W.ok)console.warn("applications/lenders webhook non-OK status:",W.status,W.statusText),x(null);else{const ne=await W.text();if(!ne||ne.trim().length===0)x(null);else try{const be=JSON.parse(ne),_e=JR(be);x(_e)}catch(be){console.warn("Failed to parse cleaned matches from webhook response:",be),x(null)}}}catch(ne){console.warn("Failed handling applications/lenders webhook response:",ne),x(null)}}catch(pe){console.warn("applications/lenders webhook failed:",pe),x(null)}finally{g(!1),k("matches")}})()},B=E=>{m(E),k("recap")},ee=()=>{k("matches")},M=()=>{console.log("Final submission completed")};return u.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[u.jsxs("div",{className:"mb-8",children:[u.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Submissions Portal"}),u.jsx("p",{className:"text-gray-600",children:"Submit your merchant cash advance application and get matched with qualified lenders"})]}),u.jsx("div",{className:"mb-8",children:u.jsxs("div",{className:"flex items-center",children:[u.jsxs("div",{className:`flex items-center ${s==="application"?"text-blue-600":o?"text-green-600":"text-gray-400"}`,children:[u.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${o?"bg-green-100 text-green-600":s==="application"?"bg-blue-100 text-blue-600":"bg-gray-100 text-gray-400"}`,children:o?u.jsx(Ks,{className:"w-5 h-5"}):"1"}),u.jsx("span",{className:"ml-2 text-sm font-medium",children:"Document Upload & Application"})]}),u.jsx("div",{className:`flex-1 h-1 mx-4 ${o?"bg-green-200":"bg-gray-200"}`}),u.jsxs("div",{className:`flex items-center ${s==="bank"?"text-blue-600":s!=="application"?"text-green-600":"text-gray-400"}`,children:[u.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${s==="bank"?"bg-blue-100 text-blue-600":s!=="application"?"bg-green-100 text-green-600":"bg-gray-100 text-gray-400"}`,children:s!=="application"?u.jsx(Ks,{className:"w-5 h-5"}):"2"}),u.jsx("span",{className:"ml-2 text-sm font-medium",children:"Bank Statement"})]}),u.jsx("div",{className:`flex-1 h-1 mx-4 ${s!=="application"&&s!=="bank"?"bg-green-200":"bg-gray-200"}`}),u.jsxs("div",{className:`flex items-center ${s==="matches"?"text-blue-600":f.length>0?"text-green-600":"text-gray-400"}`,children:[u.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${f.length>0?"bg-green-100 text-green-600":s==="matches"?"bg-blue-100 text-blue-600":"bg-gray-100 text-gray-400"}`,children:f.length>0?u.jsx(Ks,{className:"w-5 h-5"}):"3"}),u.jsx("span",{className:"ml-2 text-sm font-medium",children:"Lender Matches"})]}),u.jsx("div",{className:`flex-1 h-1 mx-4 ${f.length>0?"bg-green-200":"bg-gray-200"}`}),u.jsxs("div",{className:`flex items-center ${s==="recap"?"text-blue-600":"text-gray-400"}`,children:[u.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${s==="recap"?"bg-blue-100 text-blue-600":"bg-gray-100 text-gray-400"}`,children:"4"}),u.jsx("span",{className:"ml-2 text-sm font-medium",children:"Submission Recap"})]})]})}),s==="application"?u.jsx(kN,{onSubmit:T,onReadyForForm:E=>{console.log("[SubmissionsPortal] onReadyForForm prefill:",E),h(E);try{if(E){const $=$w(E);c($)}}catch($){console.warn("Failed to map prefill to AppData:",$)}setTimeout(()=>{k("bank")},0)}}):s==="bank"?u.jsx(WR,{onContinue:async E=>{var $,ie,pe,P,se,F,W,ne,be,_e,Oe,et,qe,Se,Q,Ve,H,j,R,Y,he,Ae,tt,Pt;if(E){g(!0);const je={...o||$w(E),id:E.id||(o==null?void 0:o.id)||"",businessName:E.businessName||(o==null?void 0:o.businessName)||"",creditScore:Number(E.creditScore??(o==null?void 0:o.creditScore)??0),industry:E.industry||(o==null?void 0:o.industry)||"",requestedAmount:Number(E.requestedAmount??(o==null?void 0:o.requestedAmount)??0),ownerName:(($=E.contactInfo)==null?void 0:$.ownerName)||(o==null?void 0:o.ownerName)||"",email:((ie=E.contactInfo)==null?void 0:ie.email)||(o==null?void 0:o.email)||"",phone:((pe=E.contactInfo)==null?void 0:pe.phone)||(o==null?void 0:o.phone),address:((P=E.contactInfo)==null?void 0:P.address)||(o==null?void 0:o.address),ein:((se=E.businessInfo)==null?void 0:se.ein)||(o==null?void 0:o.ein),businessType:((F=E.businessInfo)==null?void 0:F.businessType)||(o==null?void 0:o.businessType),yearsInBusiness:Number(((W=E.businessInfo)==null?void 0:W.yearsInBusiness)??(o==null?void 0:o.yearsInBusiness)??(o==null?void 0:o.timeInBusiness)??0),numberOfEmployees:Number(((ne=E.businessInfo)==null?void 0:ne.numberOfEmployees)??(o==null?void 0:o.numberOfEmployees)??0),annualRevenue:Number(((be=E.financialInfo)==null?void 0:be.annualRevenue)??(o==null?void 0:o.annualRevenue)??0),monthlyRevenue:Number(((_e=E.financialInfo)==null?void 0:_e.averageMonthlyRevenue)??(o==null?void 0:o.monthlyRevenue)??0),monthlyDeposits:Number(((Oe=E.financialInfo)==null?void 0:Oe.averageMonthlyDeposits)??(o==null?void 0:o.monthlyDeposits)??0),existingDebt:Number(((et=E.financialInfo)==null?void 0:et.existingDebt)??(o==null?void 0:o.existingDebt)??0),documents:Array.isArray(E.documents)?E.documents:(o==null?void 0:o.documents)??[],status:E.status||(o==null?void 0:o.status),contactInfo:{ownerName:((qe=E.contactInfo)==null?void 0:qe.ownerName)||(o==null?void 0:o.contactInfo.ownerName)||"",email:((Se=E.contactInfo)==null?void 0:Se.email)||(o==null?void 0:o.contactInfo.email)||"",phone:((Q=E.contactInfo)==null?void 0:Q.phone)||(o==null?void 0:o.contactInfo.phone)||"",address:((Ve=E.contactInfo)==null?void 0:Ve.address)||(o==null?void 0:o.contactInfo.address)||""},businessInfo:{ein:((H=E.businessInfo)==null?void 0:H.ein)||(o==null?void 0:o.businessInfo.ein)||"",businessType:((j=E.businessInfo)==null?void 0:j.businessType)||(o==null?void 0:o.businessInfo.businessType)||"",yearsInBusiness:Number(((R=E.businessInfo)==null?void 0:R.yearsInBusiness)??(o==null?void 0:o.businessInfo.yearsInBusiness)??0),numberOfEmployees:Number(((Y=E.businessInfo)==null?void 0:Y.numberOfEmployees)??(o==null?void 0:o.businessInfo.numberOfEmployees)??0)},financialInfo:{annualRevenue:Number(((he=E.financialInfo)==null?void 0:he.annualRevenue)??(o==null?void 0:o.financialInfo.annualRevenue)??0),averageMonthlyRevenue:Number(((Ae=E.financialInfo)==null?void 0:Ae.averageMonthlyRevenue)??(o==null?void 0:o.financialInfo.averageMonthlyRevenue)??0),averageMonthlyDeposits:Number(((tt=E.financialInfo)==null?void 0:tt.averageMonthlyDeposits)??(o==null?void 0:o.financialInfo.averageMonthlyDeposits)??0),existingDebt:Number(((Pt=E.financialInfo)==null?void 0:Pt.existingDebt)??(o==null?void 0:o.financialInfo.existingDebt)??0)}};if(!je.id||String(je.id).trim()==="")try{const Ge={business_name:je.businessName,owner_name:je.ownerName,email:je.email,phone:je.phone||"",address:je.address||"",ein:je.ein||"",business_type:je.businessType||"",industry:je.industry,years_in_business:je.yearsInBusiness??je.timeInBusiness??0,number_of_employees:je.numberOfEmployees??0,annual_revenue:je.annualRevenue??0,monthly_revenue:je.monthlyRevenue??0,monthly_deposits:je.monthlyDeposits??0,existing_debt:je.existingDebt??0,credit_score:je.creditScore??0,requested_amount:je.requestedAmount??0,status:je.status||"submitted",documents:Array.isArray(je.documents)?je.documents:[]};console.log("[SubmissionsPortal] No application ID; creating draft in Supabase with:",Ge);const I=await xb(Ge);console.log("[SubmissionsPortal] Draft created. New ID:",I.id);const L={...je,id:I.id};c(L),k("intermediate")}catch(Ge){console.warn("Failed to create draft application before intermediate step:",Ge),c(je),k("intermediate")}else c(je),k("intermediate");h(E),g(!1)}else k("intermediate")},onReplaceDocument:()=>k("application"),application:d?w(d):_(o)}):s==="intermediate"?u.jsx(YR,{initial:{id:(o==null?void 0:o.id)??"",applicationId:(o==null?void 0:o.id)??"",dealName:(y==null?void 0:y.dealName)??(o==null?void 0:o.businessName)??"",industry:(y==null?void 0:y.industry)??(o==null?void 0:o.industry)??"",entityType:(y==null?void 0:y.entityType)??(o==null?void 0:o.businessType)??"",state:(y==null?void 0:y.state)??"",creditScore:String((o==null?void 0:o.creditScore)!==void 0&&(o==null?void 0:o.creditScore)!==null?o.creditScore:(y==null?void 0:y.creditScore)??""),timeInBiz:(y==null?void 0:y.timeInBiz)??String((o==null?void 0:o.timeInBusiness)??""),avgMonthlyRevenue:(y==null?void 0:y.avgMonthlyRevenue)??String((o==null?void 0:o.monthlyRevenue)??""),requestedAmount:(y==null?void 0:y.requestedAmount)??String((o==null?void 0:o.requestedAmount)??""),grossAnnualRevenue:(y==null?void 0:y.grossAnnualRevenue)??String((o==null?void 0:o.annualRevenue)??""),avgDailyBalance:(y==null?void 0:y.avgDailyBalance)??"",avgMonthlyDepositCount:(y==null?void 0:y.avgMonthlyDepositCount)??String((o==null?void 0:o.monthlyDeposits)??""),nsfCount:(y==null?void 0:y.nsfCount)??"",negativeDays:(y==null?void 0:y.negativeDays)??"",currentPositionCount:(y==null?void 0:y.currentPositionCount)??"",holdback:(y==null?void 0:y.holdback)??"",hasBankruptcies:!!(y!=null&&y.hasBankruptcies)||!1,hasOpenJudgments:!!(y!=null&&y.hasOpenJudgments)||!1},loading:p,onBack:C,onContinue:D}):s==="matches"?u.jsx(VR,{application:o,matches:b??void 0,onBack:C,onLenderSelect:B,lockedLenderIds:t}):u.jsx(GR,{application:o?{...o,status:["draft","submitted","under-review","matched"].includes(String(o.status))?o.status:"submitted"}:null,selectedLenderIds:f,onBack:ee,onSubmit:M})]})},ZR=()=>{const[n,e]=V.useState("applications"),[t,s]=V.useState(!1),[r,i]=V.useState(null),[a,o]=V.useState(!1),[c,d]=V.useState(!1),[h,f]=V.useState(()=>localStorage.getItem("mcaPortalEmailTemplate")||`Subject: Merchant Cash Advance Application - {{businessName}}

Dear {{lenderName}} Team,

I hope this email finds you well. I am writing to submit a merchant cash advance application for your review and consideration.

BUSINESS INFORMATION:
• Business Name: {{businessName}}
• Owner: {{ownerName}}
• Industry: {{industry}}
• Years in Business: {{yearsInBusiness}}
• Business Type: {{businessType}}
• EIN: {{ein}}

FINANCIAL DETAILS:
• Requested Amount: \${{requestedAmount}}
• Monthly Revenue: \${{monthlyRevenue}}
• Annual Revenue: \${{annualRevenue}}
• Credit Score: {{creditScore}}
• Existing Debt: \${{existingDebt}}

CONTACT INFORMATION:
• Email: {{email}}
• Phone: {{phone}}
• Address: {{address}}

I have attached the following documents for your review:
• Business bank statements (last 6 months)
• Tax returns
• Completed application form
• Voided business check

Based on your underwriting guidelines, I believe this application aligns well with your lending criteria:
• Amount Range: \${{lenderMinAmount}} - \${{lenderMaxAmount}}
• Factor Rate: {{lenderFactorRate}}
• Payback Term: {{lenderPaybackTerm}}
• Approval Time: {{lenderApprovalTime}}

I would appreciate the opportunity to discuss this application further and answer any questions you may have. Please let me know if you need any additional information or documentation.

Thank you for your time and consideration. I look forward to hearing from you soon.

Best regards,
{{ownerName}}
{{businessName}}
{{email}}
{{phone}}

---
This application was submitted through MCAPortal Pro
Application ID: {{applicationId}}`),[m,p]=V.useState(null),[g,y]=V.useState([]),[N,b]=V.useState([]),[x,_]=V.useState(!0),[w,k]=V.useState(null),[C,T]=V.useState(!1),[D,B]=V.useState([]),[ee,M]=V.useState(!1),[E,$]=V.useState({name:"",contactEmail:"",phone:"",status:"active",rating:4,minAmount:1e4,maxAmount:5e5,minCreditScore:550,maxCreditScore:850,minTimeInBusiness:1,minMonthlyRevenue:15e3,industries:[],factorRate:"1.1 - 1.4",paybackTerm:"3-18 months",approvalTime:"24 hours",features:[]}),ie=["All Industries","Retail","Restaurant","Healthcare","Professional Services","Technology","Construction","Transportation","Manufacturing","Real Estate","Automotive","Education","Entertainment","Agriculture","Finance"],pe=["No collateral required","Same day funding","Flexible payments","Competitive rates","Larger amounts","Industry expertise","Instant approval","Bad credit OK","Fast funding","Best rates","Large amounts","Premium service","Merchant-focused","Flexible terms"];Sv.useEffect(()=>{(async()=>{try{_(!0);const[R,Y]=await Promise.all([wb(),N1()]),he=await Promise.all(Y.map(async Ae=>{const tt=await ny(Ae.id);return{...Ae,matchedLenders:tt.length}}));y(R),b(he)}catch(R){console.error("Error loading data:",R)}finally{_(!1)}})()},[]);const P=async j=>{try{const R=await ny(j);B(R)}catch(R){console.error("Error loading submissions:",R)}},se=j=>{p(j),o(!0),P(j.id)},F=j=>{k(j),T(!0),P(j.id)},W=async j=>{if(j.preventDefault(),!!w)try{const R={business_name:w.business_name,owner_name:w.owner_name,email:w.email,phone:w.phone,address:w.address,ein:w.ein,business_type:w.business_type,industry:w.industry,years_in_business:w.years_in_business,number_of_employees:w.number_of_employees,annual_revenue:w.annual_revenue,monthly_revenue:w.monthly_revenue,monthly_deposits:w.monthly_deposits,existing_debt:w.existing_debt,credit_score:w.credit_score,requested_amount:w.requested_amount,status:w.status,documents:w.documents,user_id:w.user_id},Y=await k1(w.id,R);b(he=>he.map(Ae=>Ae.id===w.id?{...Y,matchedLenders:w.matchedLenders||Ae.matchedLenders}:Ae)),T(!1),k(null)}catch(R){console.error("Error updating application:",R),alert("Error updating application")}};if(x)return u.jsx("div",{className:"flex items-center justify-center py-12",children:u.jsxs("div",{className:"text-center",children:[u.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-emerald-600 mx-auto mb-4"}),u.jsx("p",{className:"text-gray-600",children:"Loading admin data..."})]})});const ne=j=>{switch(j){case"active":case"matched":case"funded":return"bg-green-100 text-green-800";case"inactive":case"declined":return"bg-red-100 text-red-800";case"pending":case"under-review":return"bg-yellow-100 text-yellow-800";case"submitted":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}},be=j=>{(async()=>{try{await L2(j),y(Y=>Y.filter(he=>he.id!==j))}catch(Y){console.error("Error deleting lender:",Y),alert("Error deleting lender. Please try again.")}})()},_e=j=>{$({name:j.name,contactEmail:j.contact_email,phone:j.phone||"",status:j.status,rating:j.rating,minAmount:j.min_amount,maxAmount:j.max_amount,minCreditScore:j.min_credit_score,maxCreditScore:j.max_credit_score,minTimeInBusiness:j.min_time_in_business,minMonthlyRevenue:j.min_monthly_revenue,industries:j.industries,factorRate:j.factor_rate,paybackTerm:j.payback_term,approvalTime:j.approval_time,features:j.features}),i(j),s(!0)},Oe=()=>{$({name:"",contactEmail:"",phone:"",status:"active",rating:4,minAmount:1e4,maxAmount:5e5,minCreditScore:550,maxCreditScore:850,minTimeInBusiness:1,minMonthlyRevenue:15e3,industries:[],factorRate:"1.1 - 1.4",paybackTerm:"3-18 months",approvalTime:"24 hours",features:[]}),i(null),s(!0)},et=j=>{$(R=>({...R,industries:R.industries.includes(j)?R.industries.filter(Y=>Y!==j):[...R.industries,j]}))},qe=j=>{$(R=>({...R,features:R.features.includes(j)?R.features.filter(Y=>Y!==j):[...R.features,j]}))},Se=()=>{(async()=>{try{const R={name:E.name,contact_email:E.contactEmail,phone:E.phone,status:E.status,rating:E.rating,total_applications:0,approval_rate:0,min_amount:E.minAmount,max_amount:E.maxAmount,min_credit_score:E.minCreditScore,max_credit_score:E.maxCreditScore,min_time_in_business:E.minTimeInBusiness,min_monthly_revenue:E.minMonthlyRevenue,industries:E.industries,factor_rate:E.factorRate,payback_term:E.paybackTerm,approval_time:E.approvalTime,features:E.features};if(r){const Y=await M2(r.id,R);y(he=>he.map(Ae=>Ae.id===r.id?Y:Ae))}else{const Y=await D2(R);y(he=>[...he,Y])}s(!1),i(null)}catch(R){console.error("Error saving lender:",R),alert("Error saving lender. Please try again.")}})()},Q=j=>{confirm("Are you sure you want to delete this application? This action cannot be undone.")&&(async()=>{try{await P2(j),b(Y=>Y.filter(he=>he.id!==j))}catch(Y){console.error("Error deleting application:",Y),alert("Error deleting application. Please try again.")}})()},Ve=async(j,R)=>{try{const Y=await O2(j.id,R);B(he=>he.map(Ae=>Ae.id===j.id?{...Ae,...Y}:Ae))}catch(Y){console.error("Error updating submission:",Y),alert("Error updating submission")}},H=async j=>{if(w)try{await E1(w.id,[j]),P(w.id),M(!1)}catch(R){console.error("Error adding lender submission:",R),alert("Error adding lender submission")}};return u.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[u.jsxs("div",{className:"mb-8",children:[u.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Admin Portal"}),u.jsx("p",{className:"text-gray-600",children:"Manage applications, lenders, and underwriting guidelines"})]}),u.jsx("div",{className:"border-b border-gray-200 mb-8",children:u.jsxs("nav",{className:"flex flex-wrap gap-4 overflow-x-auto no-scrollbar -mx-1 px-1",children:[u.jsxs("button",{onClick:()=>e("applications"),className:`py-2 px-1 border-b-2 font-medium text-sm ${n==="applications"?"border-emerald-500 text-emerald-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[u.jsx(gC,{className:"w-5 h-5 inline mr-2"}),"Applications"]}),u.jsxs("button",{onClick:()=>e("lenders"),className:`py-2 px-1 border-b-2 font-medium text-sm ${n==="lenders"?"border-emerald-500 text-emerald-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[u.jsx(zs,{className:"w-5 h-5 inline mr-2"}),"Lenders"]}),u.jsxs("button",{onClick:()=>d(!0),className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors flex items-center text-sm",children:[u.jsx(uC,{className:"w-4 h-4 mr-2"}),"Email Template"]}),u.jsxs("button",{onClick:()=>e("settings"),className:`py-2 px-1 border-b-2 font-medium text-sm ${n==="settings"?"border-emerald-500 text-emerald-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[u.jsx(t1,{className:"w-5 h-5 inline mr-2"}),"Settings"]})]})}),n==="applications"&&u.jsxs("div",{children:[u.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-3 mb-6",children:[u.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Applications"}),u.jsx("div",{className:"flex flex-wrap gap-2",children:u.jsxs("select",{className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 text-sm",children:[u.jsx("option",{children:"All Statuses"}),u.jsx("option",{children:"Submitted"}),u.jsx("option",{children:"Under Review"}),u.jsx("option",{children:"Matched"}),u.jsx("option",{children:"Funded"}),u.jsx("option",{children:"Declined"})]})})]}),u.jsx("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden",children:u.jsx("div",{className:"overflow-x-auto",children:u.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[u.jsx("thead",{className:"bg-gray-50",children:u.jsxs("tr",{children:[u.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Application"}),u.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),u.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Revenue/Credit"}),u.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),u.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Matches"}),u.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),u.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:N.map(j=>u.jsxs("tr",{className:"hover:bg-gray-50",children:[u.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:u.jsxs("div",{children:[u.jsx("div",{className:"text-sm font-medium text-gray-900",children:j.business_name}),u.jsx("div",{className:"text-sm text-gray-500",children:j.owner_name}),u.jsx("div",{className:"text-xs text-gray-400 break-all max-w-[220px] sm:max-w-none",children:j.id})]})}),u.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[u.jsxs("div",{className:"text-sm font-medium text-gray-900",children:["$",j.requested_amount.toLocaleString()]}),u.jsx("div",{className:"text-sm text-gray-500",children:j.industry})]}),u.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[u.jsxs("div",{className:"text-sm text-gray-900",children:["$",j.monthly_revenue.toLocaleString(),"/mo"]}),u.jsxs("div",{className:"text-sm text-gray-500",children:["Credit: ",j.credit_score]})]}),u.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:u.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${ne(j.status)}`,children:j.status})}),u.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[j.matchedLenders," lenders"]}),u.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[u.jsx("button",{onClick:()=>se(j),className:"text-emerald-600 hover:text-emerald-900 mr-3",children:u.jsx(e1,{className:"w-4 h-4"})}),u.jsx("button",{onClick:()=>F(j),className:"text-blue-600 hover:text-blue-900 mr-3",children:u.jsx(H0,{className:"w-4 h-4"})}),u.jsx("button",{onClick:()=>Q(j.id),className:"text-red-600 hover:text-red-900",children:u.jsx(q0,{className:"w-4 h-4"})})]})]},j.id))})]})})})]}),n==="lenders"&&u.jsxs("div",{children:[u.jsxs("div",{className:"flex justify-between items-center mb-6",children:[u.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Lender Management"}),u.jsxs("button",{onClick:()=>{Oe()},className:"bg-emerald-600 text-white px-4 py-2 rounded-lg hover:bg-emerald-700 transition-colors flex items-center",children:[u.jsx(Mg,{className:"w-4 h-4 mr-2"}),"Add Lender"]})]}),u.jsx("div",{className:"grid gap-6",children:g.map(j=>u.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[u.jsxs("div",{className:"flex items-start justify-between mb-4",children:[u.jsxs("div",{className:"flex items-center",children:[u.jsx("div",{className:"w-12 h-12 bg-emerald-100 rounded-lg flex items-center justify-center mr-4",children:u.jsx(zs,{className:"w-6 h-6 text-emerald-600"})}),u.jsxs("div",{children:[u.jsx("h3",{className:"text-xl font-bold text-gray-900",children:j.name}),u.jsx("p",{className:"text-gray-600",children:j.contact_email}),u.jsx("p",{className:"text-gray-500 text-sm",children:j.phone})]})]}),u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${ne(j.status)}`,children:j.status}),u.jsxs("div",{className:"flex items-center",children:[u.jsx(mb,{className:"w-4 h-4 text-yellow-400 fill-current mr-1"}),u.jsx("span",{className:"text-sm font-medium",children:j.rating})]})]})]}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-4",children:[u.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg",children:[u.jsx("div",{className:"text-sm text-blue-600 font-medium",children:"Total Applications"}),u.jsx("div",{className:"text-lg font-bold text-blue-900",children:j.total_applications})]}),u.jsxs("div",{className:"bg-green-50 p-3 rounded-lg",children:[u.jsx("div",{className:"text-sm text-green-600 font-medium",children:"Approval Rate"}),u.jsxs("div",{className:"text-lg font-bold text-green-900",children:[j.approval_rate,"%"]})]}),u.jsxs("div",{className:"bg-purple-50 p-3 rounded-lg",children:[u.jsx("div",{className:"text-sm text-purple-600 font-medium",children:"Amount Range"}),u.jsxs("div",{className:"text-sm font-bold text-purple-900",children:["$",j.min_amount.toLocaleString()," - $",j.max_amount.toLocaleString()]})]}),u.jsxs("div",{className:"bg-orange-50 p-3 rounded-lg",children:[u.jsx("div",{className:"text-sm text-orange-600 font-medium",children:"Factor Rate"}),u.jsx("div",{className:"text-sm font-bold text-orange-900",children:j.factor_rate})]})]}),u.jsxs("div",{className:"mb-4",children:[u.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Underwriting Guidelines"}),u.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 text-sm",children:[u.jsxs("div",{children:[u.jsx("span",{className:"text-gray-500",children:"Min Credit Score:"}),u.jsx("span",{className:"ml-1 font-medium",children:j.min_credit_score})]}),u.jsxs("div",{children:[u.jsx("span",{className:"text-gray-500",children:"Min Time in Business:"}),u.jsxs("span",{className:"ml-1 font-medium",children:[j.min_time_in_business," years"]})]}),u.jsxs("div",{children:[u.jsx("span",{className:"text-gray-500",children:"Min Monthly Revenue:"}),u.jsxs("span",{className:"ml-1 font-medium",children:["$",j.min_monthly_revenue.toLocaleString()]})]}),u.jsxs("div",{children:[u.jsx("span",{className:"text-gray-500",children:"Approval Time:"}),u.jsx("span",{className:"ml-1 font-medium",children:j.approval_time})]})]})]}),u.jsxs("div",{className:"mb-4",children:[u.jsx("span",{className:"text-sm text-gray-500",children:"Industries: "}),u.jsx("span",{className:"text-sm font-medium",children:j.industries.join(", ")})]}),u.jsxs("div",{className:"flex justify-end space-x-3",children:[u.jsxs("button",{onClick:()=>_e(j),className:"px-4 py-2 text-blue-600 border border-blue-300 rounded-lg hover:bg-blue-50 transition-colors flex items-center",children:[u.jsx(H0,{className:"w-4 h-4 mr-1"}),"Edit"]}),u.jsxs("button",{onClick:()=>be(j.id),className:"px-4 py-2 text-red-600 border border-red-300 rounded-lg hover:bg-red-50 transition-colors flex items-center",children:[u.jsx(q0,{className:"w-4 h-4 mr-1"}),"Delete"]})]})]},j.id))})]}),n==="settings"&&u.jsxs("div",{children:[u.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"System Settings"}),u.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[u.jsxs("div",{className:"space-y-6",children:[u.jsxs("div",{children:[u.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"General Settings"}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Minimum Application Amount"}),u.jsx("input",{type:"number",defaultValue:"10000",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Maximum Application Amount"}),u.jsx("input",{type:"number",defaultValue:"2000000",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500"})]})]})]}),u.jsxs("div",{children:[u.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Notification Settings"}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{className:"flex items-center",children:[u.jsx("input",{type:"checkbox",defaultChecked:!0,className:"mr-3"}),u.jsx("label",{className:"text-sm text-gray-700",children:"Email notifications for new applications"})]}),u.jsxs("div",{className:"flex items-center",children:[u.jsx("input",{type:"checkbox",defaultChecked:!0,className:"mr-3"}),u.jsx("label",{className:"text-sm text-gray-700",children:"Email notifications for lender matches"})]}),u.jsxs("div",{className:"flex items-center",children:[u.jsx("input",{type:"checkbox",className:"mr-3"}),u.jsx("label",{className:"text-sm text-gray-700",children:"SMS notifications for urgent matters"})]})]})]})]}),u.jsx("div",{className:"mt-8 pt-6 border-t border-gray-200",children:u.jsx("button",{className:"bg-emerald-600 text-white px-6 py-2 rounded-lg hover:bg-emerald-700 transition-colors",children:"Save Settings"})})]})]}),t&&u.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50",children:u.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[u.jsx("div",{className:"p-6 border-b border-gray-200",children:u.jsx("h3",{className:"text-lg font-medium text-gray-900",children:r?"Edit Lender":"Add New Lender"})}),u.jsxs("div",{className:"p-6",children:[u.jsxs("div",{className:"space-y-6",children:[u.jsxs("div",{children:[u.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Basic Information"}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Lender Name *"}),u.jsx("input",{type:"text",value:E.name,onChange:j=>$(R=>({...R,name:j.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500",placeholder:"Enter lender name"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Contact Email *"}),u.jsx("input",{type:"email",value:E.contactEmail,onChange:j=>$(R=>({...R,contactEmail:j.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500",placeholder:"contact@lender.com"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone"}),u.jsx("input",{type:"tel",value:E.phone,onChange:j=>$(R=>({...R,phone:j.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500",placeholder:"(555) 123-4567"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),u.jsxs("select",{value:E.status,onChange:j=>$(R=>({...R,status:j.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500",children:[u.jsx("option",{value:"active",children:"Active"}),u.jsx("option",{value:"inactive",children:"Inactive"}),u.jsx("option",{value:"pending",children:"Pending"})]})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Rating"}),u.jsx("input",{type:"number",min:"1",max:"5",step:"0.1",value:E.rating,onChange:j=>$(R=>({...R,rating:parseFloat(j.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500"})]})]})]}),u.jsxs("div",{children:[u.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Underwriting Guidelines"}),u.jsxs("div",{className:"mb-6",children:[u.jsx("h5",{className:"font-medium text-gray-700 mb-3",children:"Funding Range"}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Minimum Amount ($)"}),u.jsx("input",{type:"number",value:E.minAmount,onChange:j=>$(R=>({...R,minAmount:parseInt(j.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Maximum Amount ($)"}),u.jsx("input",{type:"number",value:E.maxAmount,onChange:j=>$(R=>({...R,maxAmount:parseInt(j.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500"})]})]})]}),u.jsxs("div",{className:"mb-6",children:[u.jsx("h5",{className:"font-medium text-gray-700 mb-3",children:"Credit Score Requirements"}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Minimum Credit Score"}),u.jsx("input",{type:"number",min:"300",max:"850",value:E.minCreditScore,onChange:j=>$(R=>({...R,minCreditScore:parseInt(j.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Maximum Credit Score"}),u.jsx("input",{type:"number",min:"300",max:"850",value:E.maxCreditScore,onChange:j=>$(R=>({...R,maxCreditScore:parseInt(j.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500"})]})]})]}),u.jsxs("div",{className:"mb-6",children:[u.jsx("h5",{className:"font-medium text-gray-700 mb-3",children:"Business Requirements"}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Minimum Time in Business (years)"}),u.jsx("input",{type:"number",min:"0",step:"0.5",value:E.minTimeInBusiness,onChange:j=>$(R=>({...R,minTimeInBusiness:parseFloat(j.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Minimum Monthly Revenue ($)"}),u.jsx("input",{type:"number",value:E.minMonthlyRevenue,onChange:j=>$(R=>({...R,minMonthlyRevenue:parseInt(j.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500"})]})]})]}),u.jsxs("div",{className:"mb-6",children:[u.jsx("h5",{className:"font-medium text-gray-700 mb-3",children:"Terms & Processing"}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Factor Rate"}),u.jsx("input",{type:"text",value:E.factorRate,onChange:j=>$(R=>({...R,factorRate:j.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500",placeholder:"1.1 - 1.4"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Payback Term"}),u.jsx("input",{type:"text",value:E.paybackTerm,onChange:j=>$(R=>({...R,paybackTerm:j.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500",placeholder:"3-18 months"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Approval Time"}),u.jsx("input",{type:"text",value:E.approvalTime,onChange:j=>$(R=>({...R,approvalTime:j.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500",placeholder:"24 hours"})]})]})]}),u.jsxs("div",{className:"mb-6",children:[u.jsx("h5",{className:"font-medium text-gray-700 mb-3",children:"Accepted Industries"}),u.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:ie.map(j=>u.jsxs("label",{className:"flex items-center",children:[u.jsx("input",{type:"checkbox",checked:E.industries.includes(j),onChange:()=>et(j),className:"mr-2 text-emerald-600 focus:ring-emerald-500"}),u.jsx("span",{className:"text-sm text-gray-700",children:j})]},j))})]}),u.jsxs("div",{className:"mb-6",children:[u.jsx("h5",{className:"font-medium text-gray-700 mb-3",children:"Key Features"}),u.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:pe.map(j=>u.jsxs("label",{className:"flex items-center",children:[u.jsx("input",{type:"checkbox",checked:E.features.includes(j),onChange:()=>qe(j),className:"mr-2 text-emerald-600 focus:ring-emerald-500"}),u.jsx("span",{className:"text-sm text-gray-700",children:j})]},j))})]})]})]}),u.jsxs("div",{className:"flex justify-end space-x-3",children:[u.jsx("button",{onClick:()=>s(!1),className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancel"}),u.jsx("button",{onClick:Se,className:"px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700",children:r?"Update Lender":"Add Lender"})]})]})]})}),a&&m&&u.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50",children:u.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[u.jsx("div",{className:"p-6 border-b border-gray-200",children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("div",{children:[u.jsx("h3",{className:"text-2xl font-bold text-gray-900",children:m.business_name}),u.jsxs("div",{className:"flex items-center mt-1",children:[u.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${ne(m.status)}`,children:m.status}),u.jsxs("span",{className:"ml-4 text-sm text-gray-500",children:["Application ID: ",m.id]})]})]}),u.jsx("button",{onClick:()=>o(!1),className:"text-gray-400 hover:text-gray-600 text-2xl",children:"×"})]})}),u.jsxs("div",{className:"p-6",children:[u.jsxs("div",{className:"mb-8",children:[u.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Business Information"}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Business Name"}),u.jsx("p",{className:"mt-1 text-sm text-gray-900",children:m.business_name})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Industry"}),u.jsx("p",{className:"mt-1 text-sm text-gray-900",children:m.industry})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Business Type"}),u.jsx("p",{className:"mt-1 text-sm text-gray-900",children:m.business_type||"N/A"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"EIN"}),u.jsx("p",{className:"mt-1 text-sm text-gray-900",children:m.ein||"N/A"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Years in Business"}),u.jsx("p",{className:"mt-1 text-sm text-gray-900",children:m.years_in_business})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Number of Employees"}),u.jsx("p",{className:"mt-1 text-sm text-gray-900",children:m.number_of_employees})]})]})]}),u.jsxs("div",{className:"mb-8",children:[u.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Contact Information"}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Owner Name"}),u.jsx("p",{className:"mt-1 text-sm text-gray-900",children:m.owner_name})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Email"}),u.jsx("p",{className:"mt-1 text-sm text-gray-900",children:m.email})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Phone"}),u.jsx("p",{className:"mt-1 text-sm text-gray-900",children:m.phone||"N/A"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Address"}),u.jsx("p",{className:"mt-1 text-sm text-gray-900",children:m.address||"N/A"})]})]})]}),u.jsxs("div",{className:"mb-8",children:[u.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Financial Information"}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Requested Amount"}),u.jsxs("p",{className:"mt-1 text-sm text-gray-900 font-semibold",children:["$",m.requested_amount.toLocaleString()]})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Monthly Revenue"}),u.jsxs("p",{className:"mt-1 text-sm text-gray-900",children:["$",m.monthly_revenue.toLocaleString()]})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Annual Revenue"}),u.jsxs("p",{className:"mt-1 text-sm text-gray-900",children:["$",m.annual_revenue.toLocaleString()]})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Monthly Deposits"}),u.jsxs("p",{className:"mt-1 text-sm text-gray-900",children:["$",m.monthly_deposits.toLocaleString()]})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Existing Debt"}),u.jsxs("p",{className:"mt-1 text-sm text-gray-900",children:["$",m.existing_debt.toLocaleString()]})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Credit Score"}),u.jsx("p",{className:"mt-1 text-sm text-gray-900",children:m.credit_score})]})]})]}),u.jsxs("div",{className:"mb-8",children:[u.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Application Status"}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Current Status"}),u.jsx("span",{className:`inline-flex px-3 py-1 rounded-full text-sm font-medium ${ne(m.status)}`,children:m.status})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Matched Lenders"}),u.jsxs("p",{className:"mt-1 text-sm text-gray-900",children:[m.matchedLenders," lenders"]})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Created"}),u.jsx("p",{className:"mt-1 text-sm text-gray-900",children:new Date(m.created_at).toLocaleDateString()})]})]})]}),m.documents&&m.documents.length>0&&u.jsxs("div",{className:"mb-8",children:[u.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Documents"}),u.jsx("div",{className:"space-y-2",children:m.documents.map((j,R)=>u.jsxs("div",{className:"flex items-center bg-gray-50 p-3 rounded",children:[u.jsx(Ks,{className:"w-4 h-4 text-green-500 mr-2"}),u.jsx("span",{className:"text-sm text-gray-700",children:j})]},R))})]}),u.jsxs("div",{className:"flex justify-end space-x-3 pt-6 border-t border-gray-200",children:[u.jsx("button",{onClick:()=>o(!1),className:"px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Close"}),u.jsx("button",{onClick:()=>Q(m.id),className:"px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Delete Application"})]})]})]})}),C&&w&&u.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50",children:u.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-6xl w-full mx-4 max-h-[95vh] overflow-y-auto",children:[u.jsx("div",{className:"p-6 border-b border-gray-200",children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("h3",{className:"text-xl font-medium text-gray-900",children:["Edit Application - ",w.business_name]}),u.jsx("button",{onClick:()=>{T(!1),k(null)},className:"text-gray-400 hover:text-gray-600",children:u.jsx(W0,{className:"w-6 h-6"})})]})}),u.jsx("div",{className:"p-6",children:u.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[u.jsxs("div",{children:[u.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-4",children:"Application Details"}),u.jsxs("form",{onSubmit:W,className:"space-y-4",children:[u.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Business Name"}),u.jsx("input",{type:"text",value:w.business_name,onChange:j=>k(R=>R?{...R,business_name:j.target.value}:null),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Owner Name"}),u.jsx("input",{type:"text",value:w.owner_name,onChange:j=>k(R=>R?{...R,owner_name:j.target.value}:null),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),u.jsx("input",{type:"email",value:w.email,onChange:j=>k(R=>R?{...R,email:j.target.value}:null),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone"}),u.jsx("input",{type:"tel",value:w.phone||"",onChange:j=>k(R=>R?{...R,phone:j.target.value}:null),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Industry"}),u.jsxs("select",{value:w.industry||"",onChange:j=>k(R=>R?{...R,industry:j.target.value}:null),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[u.jsx("option",{value:"",children:"Select Industry"}),u.jsx("option",{value:"Retail",children:"Retail"}),u.jsx("option",{value:"Restaurant",children:"Restaurant"}),u.jsx("option",{value:"Healthcare",children:"Healthcare"}),u.jsx("option",{value:"Construction",children:"Construction"}),u.jsx("option",{value:"Professional Services",children:"Professional Services"}),u.jsx("option",{value:"Transportation",children:"Transportation"}),u.jsx("option",{value:"Manufacturing",children:"Manufacturing"}),u.jsx("option",{value:"Technology",children:"Technology"}),u.jsx("option",{value:"Real Estate",children:"Real Estate"}),u.jsx("option",{value:"Other",children:"Other"})]})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),u.jsxs("select",{value:w.status,onChange:j=>k(R=>R&&{...R,status:j.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[u.jsx("option",{value:"draft",children:"Draft"}),u.jsx("option",{value:"submitted",children:"Submitted"}),u.jsx("option",{value:"under-review",children:"Under Review"}),u.jsx("option",{value:"approved",children:"Approved"}),u.jsx("option",{value:"funded",children:"Funded"}),u.jsx("option",{value:"declined",children:"Declined"})]})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Requested Amount"}),u.jsx("input",{type:"number",value:w.requested_amount,onChange:j=>k(R=>R&&{...R,requested_amount:Number(j.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Monthly Revenue"}),u.jsx("input",{type:"number",value:w.monthly_revenue,onChange:j=>k(R=>R&&{...R,monthly_revenue:Number(j.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Credit Score"}),u.jsx("input",{type:"number",value:w.credit_score,onChange:j=>k(R=>R&&{...R,credit_score:Number(j.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",min:"300",max:"850"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Years in Business"}),u.jsx("input",{type:"number",value:w.years_in_business,onChange:j=>k(R=>R&&{...R,years_in_business:Number(j.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",min:"0"})]})]}),u.jsx("div",{className:"flex justify-end pt-4",children:u.jsxs("button",{type:"submit",className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 flex items-center",children:[u.jsx(Ks,{className:"w-4 h-4 mr-2"}),"Save Changes"]})})]})]}),u.jsxs("div",{children:[u.jsxs("div",{className:"flex items-center justify-between mb-4",children:[u.jsx("h4",{className:"text-lg font-medium text-gray-900",children:"Lender Submissions"}),u.jsxs("button",{onClick:()=>M(!0),className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 flex items-center text-sm",children:[u.jsx(Mg,{className:"w-4 h-4 mr-1"}),"Add Lender"]})]}),u.jsxs("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:[D.map(j=>u.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[u.jsxs("div",{className:"flex items-start justify-between mb-3",children:[u.jsxs("div",{children:[u.jsx("h5",{className:"font-medium text-gray-900",children:j.lender.name}),u.jsxs("p",{className:"text-sm text-gray-500",children:["Created: ",new Date(j.created_at).toLocaleDateString()]})]}),u.jsxs("select",{value:j.status,onChange:R=>Ve(j,{status:R.target.value}),className:`px-3 py-1 rounded-full text-xs font-medium border-0 ${j.status==="approved"?"bg-green-100 text-green-800":j.status==="declined"?"bg-red-100 text-red-800":j.status==="funded"?"bg-blue-100 text-blue-800":j.status==="counter-offer"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:[u.jsx("option",{value:"pending",children:"Pending"}),u.jsx("option",{value:"approved",children:"Approved"}),u.jsx("option",{value:"declined",children:"Declined"}),u.jsx("option",{value:"counter-offer",children:"Counter Offer"}),u.jsx("option",{value:"funded",children:"Funded"})]})]}),u.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-3",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Offered Amount"}),u.jsx("input",{type:"number",value:j.offered_amount||"",onChange:R=>Ve(j,{offered_amount:R.target.value===""?void 0:Number(R.target.value)}),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:ring-1 focus:ring-blue-500",placeholder:"Amount"})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Factor Rate"}),u.jsx("input",{type:"text",value:j.factor_rate||"",onChange:R=>Ve(j,{factor_rate:R.target.value===""?void 0:R.target.value}),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:ring-1 focus:ring-blue-500",placeholder:"1.2"})]})]}),u.jsxs("div",{className:"mb-3",children:[u.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Terms"}),u.jsx("input",{type:"text",value:j.terms||"",onChange:R=>Ve(j,{terms:R.target.value===""?void 0:R.target.value}),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:ring-1 focus:ring-blue-500",placeholder:"12 months"})]}),u.jsxs("div",{className:"mb-3",children:[u.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Response"}),u.jsx("textarea",{value:j.response||"",onChange:R=>Ve(j,{response:R.target.value===""?void 0:R.target.value}),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:ring-1 focus:ring-blue-500",rows:2,placeholder:"Lender response..."})]}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Notes"}),u.jsx("textarea",{value:j.notes||"",onChange:R=>Ve(j,{notes:R.target.value===""?void 0:R.target.value}),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:ring-1 focus:ring-blue-500",rows:2,placeholder:"Internal notes..."})]})]},j.id)),D.length===0&&u.jsxs("div",{className:"text-center py-8 text-gray-500",children:[u.jsx(zs,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),u.jsx("p",{children:"No lender submissions yet"}),u.jsx("p",{className:"text-sm",children:'Click "Add Lender" to create submissions'})]})]})]})]})})]})}),ee&&u.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50",children:u.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full mx-4",children:[u.jsx("div",{className:"p-6 border-b border-gray-200",children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Add Lender Submission"}),u.jsx("button",{onClick:()=>M(!1),className:"text-gray-400 hover:text-gray-600",children:u.jsx(W0,{className:"w-5 h-5"})})]})}),u.jsxs("div",{className:"p-6",children:[u.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:g.filter(j=>!D.some(R=>R.lender_id===j.id)).map(j=>u.jsxs("div",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer",onClick:()=>H(j.id),children:[u.jsxs("div",{children:[u.jsx("h4",{className:"font-medium text-gray-900",children:j.name}),u.jsxs("p",{className:"text-sm text-gray-500",children:["$",j.min_amount.toLocaleString()," - $",j.max_amount.toLocaleString()]})]}),u.jsx(Mg,{className:"w-5 h-5 text-green-600"})]},j.id))}),g.filter(j=>!D.some(R=>R.lender_id===j.id)).length===0&&u.jsx("div",{className:"text-center py-8 text-gray-500",children:u.jsx("p",{children:"All available lenders have been added"})})]})]})}),c&&u.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50",children:u.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[u.jsx("div",{className:"p-6 border-b border-gray-200",children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("div",{children:[u.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Email Template Settings"}),u.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Customize the email template sent to lenders"})]}),u.jsx("button",{onClick:()=>d(!1),className:"text-gray-400 hover:text-gray-600",children:"×"})]})}),u.jsxs("div",{className:"p-6",children:[u.jsxs("div",{className:"mb-6",children:[u.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Available Variables"}),u.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:u.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3 text-sm",children:[u.jsxs("div",{className:"space-y-1",children:[u.jsx("p",{className:"font-medium text-gray-700",children:"Business Info:"}),u.jsx("p",{className:"text-gray-600",children:"{{businessName}}"}),u.jsx("p",{className:"text-gray-600",children:"{{ownerName}}"}),u.jsx("p",{className:"text-gray-600",children:"{{industry}}"}),u.jsx("p",{className:"text-gray-600",children:"{{businessType}}"}),u.jsx("p",{className:"text-gray-600",children:"{{ein}}"}),u.jsx("p",{className:"text-gray-600",children:"{{yearsInBusiness}}"})]}),u.jsxs("div",{className:"space-y-1",children:[u.jsx("p",{className:"font-medium text-gray-700",children:"Financial Info:"}),u.jsx("p",{className:"text-gray-600",children:"{{requestedAmount}}"}),u.jsx("p",{className:"text-gray-600",children:"{{monthlyRevenue}}"}),u.jsx("p",{className:"text-gray-600",children:"{{annualRevenue}}"}),u.jsx("p",{className:"text-gray-600",children:"{{creditScore}}"}),u.jsx("p",{className:"text-gray-600",children:"{{existingDebt}}"})]}),u.jsxs("div",{className:"space-y-1",children:[u.jsx("p",{className:"font-medium text-gray-700",children:"Contact & Lender:"}),u.jsx("p",{className:"text-gray-600",children:"{{email}}"}),u.jsx("p",{className:"text-gray-600",children:"{{phone}}"}),u.jsx("p",{className:"text-gray-600",children:"{{address}}"}),u.jsx("p",{className:"text-gray-600",children:"{{lenderName}}"}),u.jsx("p",{className:"text-gray-600",children:"{{lenderMinAmount}}"}),u.jsx("p",{className:"text-gray-600",children:"{{lenderMaxAmount}}"}),u.jsx("p",{className:"text-gray-600",children:"{{lenderFactorRate}}"}),u.jsx("p",{className:"text-gray-600",children:"{{lenderPaybackTerm}}"}),u.jsx("p",{className:"text-gray-600",children:"{{lenderApprovalTime}}"}),u.jsx("p",{className:"text-gray-600",children:"{{applicationId}}"})]})]})})]}),u.jsxs("div",{className:"mb-6",children:[u.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Template"}),u.jsx("textarea",{value:h,onChange:j=>f(j.target.value),className:"w-full h-96 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent font-mono text-sm",placeholder:"Enter your email template..."}),u.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Use the variables above to dynamically insert application and lender data"})]}),u.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 mb-6",children:[u.jsx("h4",{className:"text-sm font-medium text-blue-800 mb-2",children:"Preview"}),u.jsx("div",{className:"bg-white border rounded p-3 max-h-40 overflow-y-auto",children:u.jsx("pre",{className:"text-xs text-gray-700 whitespace-pre-wrap",children:h.replace(/\{\{businessName\}\}/g,"Sample Business LLC").replace(/\{\{ownerName\}\}/g,"John Smith").replace(/\{\{industry\}\}/g,"Technology").replace(/\{\{businessType\}\}/g,"LLC").replace(/\{\{ein\}\}/g,"12-3456789").replace(/\{\{yearsInBusiness\}\}/g,"3").replace(/\{\{requestedAmount\}\}/g,"150,000").replace(/\{\{monthlyRevenue\}\}/g,"50,000").replace(/\{\{annualRevenue\}\}/g,"600,000").replace(/\{\{creditScore\}\}/g,"720").replace(/\{\{existingDebt\}\}/g,"25,000").replace(/\{\{email\}\}/g,"john@samplebusiness.com").replace(/\{\{phone\}\}/g,"(555) 123-4567").replace(/\{\{address\}\}/g,"123 Business St, City, ST 12345").replace(/\{\{lenderName\}\}/g,"Sample Lender").replace(/\{\{lenderMinAmount\}\}/g,"50,000").replace(/\{\{lenderMaxAmount\}\}/g,"500,000").replace(/\{\{lenderFactorRate\}\}/g,"1.2 - 1.4").replace(/\{\{lenderPaybackTerm\}\}/g,"6-18 months").replace(/\{\{lenderApprovalTime\}\}/g,"24 hours").replace(/\{\{applicationId\}\}/g,"APP-12345")})})]})]}),u.jsxs("div",{className:"p-6 border-t border-gray-200 flex justify-between",children:[u.jsx("button",{onClick:()=>{f(`Subject: Merchant Cash Advance Application - {{businessName}}

Dear {{lenderName}} Team,

I hope this email finds you well. I am writing to submit a merchant cash advance application for your review and consideration.

BUSINESS INFORMATION:
• Business Name: {{businessName}}
• Owner: {{ownerName}}
• Industry: {{industry}}
• Years in Business: {{yearsInBusiness}}
• Business Type: {{businessType}}
• EIN: {{ein}}

FINANCIAL DETAILS:
• Requested Amount: \${{requestedAmount}}
• Monthly Revenue: \${{monthlyRevenue}}
• Annual Revenue: \${{annualRevenue}}
• Credit Score: {{creditScore}}
• Existing Debt: \${{existingDebt}}

CONTACT INFORMATION:
• Email: {{email}}
• Phone: {{phone}}
• Address: {{address}}

I have attached the following documents for your review:
• Business bank statements (last 6 months)
• Tax returns
• Completed application form
• Voided business check

Based on your underwriting guidelines, I believe this application aligns well with your lending criteria:
• Amount Range: \${{lenderMinAmount}} - \${{lenderMaxAmount}}
• Factor Rate: {{lenderFactorRate}}
• Payback Term: {{lenderPaybackTerm}}
• Approval Time: {{lenderApprovalTime}}

I would appreciate the opportunity to discuss this application further and answer any questions you may have. Please let me know if you need any additional information or documentation.

Thank you for your time and consideration. I look forward to hearing from you soon.

Best regards,
{{ownerName}}
{{businessName}}
{{email}}
{{phone}}

---
This application was submitted through MCAPortal Pro
Application ID: {{applicationId}}`)},className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Reset to Default"}),u.jsxs("div",{className:"flex space-x-3",children:[u.jsx("button",{onClick:()=>d(!1),className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),u.jsx("button",{onClick:()=>{localStorage.setItem("mcaPortalEmailTemplate",h),d(!1),alert("Email template saved successfully!")},className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:"Save Template"})]})]})]})})]})},eI=({onEditDeal:n})=>{const[e,t]=V.useState(""),[s,r]=V.useState("all"),[i,a]=V.useState(null),[o,c]=V.useState(!1),[d,h]=V.useState([]),[f,m]=V.useState(!0);Sv.useEffect(()=>{(async()=>{try{m(!0);const k=await N1(),C=await Promise.all(k.map(async T=>{const D=await ny(T.id);return{...T,matchedLenders:D.length,lenderSubmissions:D}}));h(C)}catch(k){console.error("Error loading applications:",k)}finally{m(!1)}})()},[]);const p=w=>{switch(w){case"funded":return"bg-green-100 text-green-800";case"approved":return"bg-blue-100 text-blue-800";case"counter-offer":return"bg-yellow-100 text-yellow-800";case"pending":return"bg-gray-100 text-gray-800";case"declined":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},g=w=>{switch(w){case"funded":return"bg-blue-100 text-blue-800";case"approved":return"bg-green-100 text-green-800";case"submitted":return"bg-yellow-100 text-yellow-800";case"under-review":return"bg-purple-100 text-purple-800";case"declined":return"bg-red-100 text-red-800";case"draft":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}},y=w=>{switch(w){case"funded":return u.jsx(mb,{className:"w-4 h-4"});case"approved":return u.jsx(Ks,{className:"w-4 h-4"});case"submitted":return u.jsx(tm,{className:"w-4 h-4"});case"under-review":return u.jsx(iC,{className:"w-4 h-4"});case"declined":return u.jsx(W0,{className:"w-4 h-4"});default:return u.jsx(tm,{className:"w-4 h-4"})}},N=d.filter(w=>{const k=w.business_name.toLowerCase().includes(e.toLowerCase())||w.owner_name.toLowerCase().includes(e.toLowerCase())||w.id.toLowerCase().includes(e.toLowerCase()),C=s==="all"||w.status===s;return k&&C}),b={all:d.length,submitted:d.filter(w=>w.status==="submitted").length,approved:d.filter(w=>w.status==="approved").length,declined:d.filter(w=>w.status==="declined").length},x=w=>{const k=Array.from(new Set((w.lenderSubmissions||[]).map(C=>C.lender_id).filter(C=>typeof C=="string"&&C.length>0)));n==null||n({applicationId:w.id,lockedLenderIds:k})},_=w=>{a(w),c(!0)};return u.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[f&&u.jsx("div",{className:"flex items-center justify-center py-12",children:u.jsxs("div",{className:"text-center",children:[u.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto mb-4"}),u.jsx("p",{className:"text-gray-600",children:"Loading applications..."})]})}),u.jsxs("div",{className:"mb-8",children:[u.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"All Deals"}),u.jsx("p",{className:"text-gray-600",children:"View and manage all merchant cash advance submissions"})]}),u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[u.jsx("div",{className:"bg-white rounded-xl shadow-lg p-6",children:u.jsxs("div",{className:"flex items-center",children:[u.jsx("div",{className:"p-3 bg-blue-100 rounded-lg",children:u.jsx(zs,{className:"w-6 h-6 text-blue-600"})}),u.jsxs("div",{className:"ml-4",children:[u.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Deals"}),u.jsx("p",{className:"text-2xl font-bold text-gray-900",children:d.length})]})]})}),u.jsx("div",{className:"bg-white rounded-xl shadow-lg p-6",children:u.jsxs("div",{className:"flex items-center",children:[u.jsx("div",{className:"p-3 bg-green-100 rounded-lg",children:u.jsx(Ks,{className:"w-6 h-6 text-green-600"})}),u.jsxs("div",{className:"ml-4",children:[u.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Approved"}),u.jsx("p",{className:"text-2xl font-bold text-gray-900",children:b.approved})]})]})}),u.jsx("div",{className:"bg-white rounded-xl shadow-lg p-6",children:u.jsxs("div",{className:"flex items-center",children:[u.jsx("div",{className:"p-3 bg-yellow-100 rounded-lg",children:u.jsx(tm,{className:"w-6 h-6 text-yellow-600"})}),u.jsxs("div",{className:"ml-4",children:[u.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Submitted"}),u.jsx("p",{className:"text-2xl font-bold text-gray-900",children:b.submitted})]})]})}),u.jsx("div",{className:"bg-white rounded-xl shadow-lg p-6",children:u.jsxs("div",{className:"flex items-center",children:[u.jsx("div",{className:"p-3 bg-purple-100 rounded-lg",children:u.jsx(sp,{className:"w-6 h-6 text-purple-600"})}),u.jsxs("div",{className:"ml-4",children:[u.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Volume"}),u.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:["$",d.reduce((w,k)=>w+k.requested_amount,0).toLocaleString()]})]})]})})]}),u.jsx("div",{className:"bg-white rounded-xl shadow-lg p-6 mb-8",children:u.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0",children:[u.jsxs("div",{className:"flex items-center space-x-4",children:[u.jsxs("div",{className:"relative",children:[u.jsx(fC,{className:"w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),u.jsx("input",{type:"text",placeholder:"Search deals...",value:e,onChange:w=>t(w.target.value),className:"pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]}),u.jsxs("select",{value:s,onChange:w=>r(w.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[u.jsxs("option",{value:"all",children:["All Status (",b.all,")"]}),u.jsxs("option",{value:"submitted",children:["Submitted (",b.submitted,")"]}),u.jsxs("option",{value:"approved",children:["Approved (",b.approved,")"]}),u.jsxs("option",{value:"approved",children:["Approved (",b.approved,")"]}),u.jsxs("option",{value:"declined",children:["Declined (",b.declined,")"]})]})]}),u.jsx("div",{className:"flex items-center space-x-2",children:u.jsxs("button",{className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors flex items-center",children:[u.jsx(lC,{className:"w-4 h-4 mr-2"}),"Export"]})})]})}),u.jsx("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden",children:u.jsx("div",{className:"overflow-x-auto",children:u.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[u.jsx("thead",{className:"bg-gray-50",children:u.jsxs("tr",{children:[u.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Deal Info"}),u.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Contact"}),u.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Financial"}),u.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),u.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Activity"}),u.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),u.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:N.map(w=>u.jsxs("tr",{className:"hover:bg-gray-50",children:[u.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:u.jsxs("div",{children:[u.jsx("div",{className:"text-sm font-medium text-gray-900",children:w.business_name}),u.jsx("div",{className:"text-sm text-gray-500",children:w.id}),u.jsxs("div",{className:"flex items-center mt-1",children:[u.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${g(w.status)}`,children:w.status}),u.jsx("span",{className:"ml-2 text-xs text-gray-500",children:"website"})]})]})}),u.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:u.jsxs("div",{children:[u.jsx("div",{className:"text-sm font-medium text-gray-900",children:w.owner_name}),u.jsx("div",{className:"text-sm text-gray-500",children:w.email}),u.jsx("div",{className:"text-sm text-gray-500",children:w.phone||"N/A"})]})}),u.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:u.jsxs("div",{children:[u.jsxs("div",{className:"text-sm font-medium text-gray-900",children:["$",w.requested_amount.toLocaleString()]}),u.jsxs("div",{className:"text-sm text-gray-500",children:["$",w.monthly_revenue.toLocaleString(),"/mo"]}),u.jsxs("div",{className:"text-sm text-gray-500",children:["Credit: ",w.credit_score," | ",w.years_in_business,"y"]})]})}),u.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:u.jsxs("div",{className:"flex flex-col space-y-2",children:[u.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${g(w.status)}`,children:[y(w.status),u.jsx("span",{className:"ml-1",children:w.status.replace("-"," ")})]}),w.lenderSubmissions.length>0&&u.jsxs("span",{className:"text-xs text-gray-500",children:[w.lenderSubmissions.length," lender",w.lenderSubmissions.length>1?"s":""]})]})}),u.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:u.jsxs("div",{children:[u.jsxs("div",{className:"text-sm text-gray-900",children:["Submitted: ",new Date(w.created_at).toLocaleDateString()]}),u.jsxs("div",{className:"text-sm text-gray-500",children:["Last: ",new Date(w.updated_at).toLocaleDateString()]})]})}),u.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:u.jsxs("div",{className:"flex space-x-2",children:[u.jsx("button",{onClick:()=>_(w),className:"text-purple-600 hover:text-purple-900",children:u.jsx(e1,{className:"w-4 h-4"})}),u.jsx("button",{className:"text-blue-600 hover:text-blue-900",onClick:()=>x(w),children:u.jsx(H0,{className:"w-4 h-4"})})]})})]},w.id))})]})})}),o&&i&&u.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50",children:u.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[u.jsx("div",{className:"p-6 border-b border-gray-200",children:u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Deal Details - ",i.business_name]}),u.jsx("button",{onClick:()=>c(!1),className:"text-gray-400 hover:text-gray-600",children:"×"})]})}),u.jsxs("div",{className:"p-6",children:[u.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[u.jsxs("div",{children:[u.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Business Information"}),u.jsxs("div",{className:"space-y-2 text-sm",children:[u.jsxs("div",{children:[u.jsx("span",{className:"text-gray-500",children:"Business Name:"})," ",u.jsx("span",{className:"font-medium",children:i.business_name})]}),u.jsxs("div",{children:[u.jsx("span",{className:"text-gray-500",children:"Industry:"})," ",u.jsx("span",{className:"font-medium",children:i.industry})]}),u.jsxs("div",{children:[u.jsx("span",{className:"text-gray-500",children:"Time in Business:"})," ",u.jsxs("span",{className:"font-medium",children:[i.years_in_business," years"]})]}),u.jsxs("div",{children:[u.jsx("span",{className:"text-gray-500",children:"Monthly Revenue:"})," ",u.jsxs("span",{className:"font-medium",children:["$",i.monthly_revenue.toLocaleString()]})]}),u.jsxs("div",{children:[u.jsx("span",{className:"text-gray-500",children:"Credit Score:"})," ",u.jsx("span",{className:"font-medium",children:i.credit_score})]})]})]}),u.jsxs("div",{children:[u.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Contact Information"}),u.jsxs("div",{className:"space-y-2 text-sm",children:[u.jsxs("div",{children:[u.jsx("span",{className:"text-gray-500",children:"Owner:"})," ",u.jsx("span",{className:"font-medium",children:i.owner_name})]}),u.jsxs("div",{children:[u.jsx("span",{className:"text-gray-500",children:"Email:"})," ",u.jsx("span",{className:"font-medium",children:i.email})]}),u.jsxs("div",{children:[u.jsx("span",{className:"text-gray-500",children:"Phone:"})," ",u.jsx("span",{className:"font-medium",children:i.phone||"N/A"})]}),u.jsxs("div",{children:[u.jsx("span",{className:"text-gray-500",children:"Source:"})," ",u.jsx("span",{className:"font-medium",children:"website"})]})]})]})]}),u.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[u.jsxs("h4",{className:"text-lg font-medium text-gray-900 mb-4",children:["Lender Submissions (",i.lenderSubmissions.length,")"]}),u.jsx("div",{className:"space-y-4",children:i.lenderSubmissions.map((w,k)=>u.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[u.jsxs("div",{className:"flex items-start justify-between mb-3",children:[u.jsxs("div",{children:[u.jsx("h5",{className:"font-medium text-gray-900",children:w.lender.name}),u.jsxs("p",{className:"text-sm text-gray-500",children:["Submitted: ",new Date(w.created_at).toLocaleDateString(),w.response_date&&u.jsxs("span",{children:[" • Responded: ",new Date(w.response_date).toLocaleDateString()]})]})]}),u.jsx("span",{className:`inline-flex px-2.5 py-0.5 rounded-full text-xs font-medium ${p(w.status)}`,children:w.status})]}),w.response&&u.jsx("div",{className:"mb-3",children:u.jsxs("p",{className:"text-sm text-gray-700",children:[u.jsx("span",{className:"font-medium",children:"Response:"})," ",w.response]})}),(w.offered_amount||w.factor_rate||w.terms)&&u.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-3",children:[w.offered_amount&&u.jsxs("div",{children:[u.jsx("span",{className:"text-xs text-gray-500",children:"Offered Amount"}),u.jsxs("p",{className:"font-medium text-sm",children:["$",w.offered_amount.toLocaleString()]})]}),w.factor_rate&&u.jsxs("div",{children:[u.jsx("span",{className:"text-xs text-gray-500",children:"Factor Rate"}),u.jsx("p",{className:"font-medium text-sm",children:w.factor_rate})]}),w.terms&&u.jsxs("div",{children:[u.jsx("span",{className:"text-xs text-gray-500",children:"Terms"}),u.jsx("p",{className:"font-medium text-sm",children:w.terms})]})]}),w.notes&&u.jsxs("div",{className:"text-xs text-gray-600 bg-white p-2 rounded border",children:[u.jsx("span",{className:"font-medium",children:"Notes:"})," ",w.notes]})]},k))})]}),u.jsx("div",{className:"mt-6 pt-6 border-t border-gray-200",children:u.jsxs("div",{className:"flex justify-end space-x-3",children:[u.jsx("button",{onClick:()=>c(!1),className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Close"}),u.jsx("button",{className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",onClick:()=>x(i),children:"Edit Deal"})]})})]})]})})]})};function tI(){const[n,e]=V.useState("submissions"),[t,s]=V.useState(null);return u.jsxs("div",{className:"min-h-screen bg-gray-50",children:[u.jsx("div",{className:"bg-white shadow-sm border-b",children:u.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:u.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-3 py-4",children:[u.jsxs("div",{className:"flex items-center space-x-2",children:[u.jsx(zs,{className:"h-8 w-8 text-blue-600"}),u.jsx("span",{className:"text-2xl font-bold text-gray-900",children:"MCAPortal Pro"})]}),u.jsxs("div",{className:"flex flex-wrap gap-2",children:[u.jsx("button",{onClick:()=>{s(null),e("submissions")},className:`px-4 py-2 rounded-lg font-medium text-sm transition-colors ${n==="submissions"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Submissions Portal"}),u.jsx("button",{onClick:()=>{s(null),e("deals")},className:`px-4 py-2 rounded-lg font-medium text-sm transition-colors ${n==="deals"?"bg-purple-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"All Deals"}),u.jsx("button",{onClick:()=>{s(null),e("admin")},className:`px-4 py-2 rounded-lg font-medium text-sm transition-colors ${n==="admin"?"bg-emerald-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Admin Portal"})]})]})})}),n==="submissions"&&u.jsx(QR,{initialStep:t==null?void 0:t.initialStep,initialApplicationId:t==null?void 0:t.initialApplicationId,lockedLenderIds:t==null?void 0:t.lockedLenderIds}),n==="deals"&&u.jsx(eI,{onEditDeal:({applicationId:r,lockedLenderIds:i})=>{s({initialStep:"matches",initialApplicationId:r,lockedLenderIds:i}),e("submissions")}}),n==="admin"&&u.jsx(ZR,{})]})}ZS(document.getElementById("root")).render(u.jsx(V.StrictMode,{children:u.jsx(tI,{})}));
